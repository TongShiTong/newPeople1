{"remainingRequest":"C:\\Users\\abcd\\Desktop\\activity-durian\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\abcd\\Desktop\\activity-durian\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\abcd\\Desktop\\activity-durian\\src\\api\\jquery.js","dependencies":[{"path":"C:\\Users\\abcd\\Desktop\\activity-durian\\src\\api\\jquery.js","mtime":1597212499657},{"path":"C:\\Users\\abcd\\Desktop\\activity-durian\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\abcd\\Desktop\\activity-durian\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\abcd\\Desktop\\activity-durian\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwudG8tanNvbiIpOwoKdmFyIF90eXBlb2YgPSByZXF1aXJlKCJDOi9Vc2Vycy9hYmNkL0Rlc2t0b3AvYWN0aXZpdHktZHVyaWFuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiIpOwoKLyohDQogKiBqUXVlcnkgSmF2YVNjcmlwdCBMaWJyYXJ5IHYxLjkuMQ0KICogaHR0cDovL2pxdWVyeS5jb20vDQogKg0KICogSW5jbHVkZXMgU2l6emxlLmpzDQogKiBodHRwOi8vc2l6emxlanMuY29tLw0KICoNCiAqIENvcHlyaWdodCAyMDA1LCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnMNCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQ0KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQ0KICoNCiAqIERhdGU6IDIwMTMtMi00DQogKi8KKGZ1bmN0aW9uICh3aW5kb3csIHVuZGVmaW5lZCkgewogIC8vIENhbid0IGRvIHRoaXMgYmVjYXVzZSBzZXZlcmFsIGFwcHMgaW5jbHVkaW5nIEFTUC5ORVQgdHJhY2UKICAvLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKICAvLyB5b3UgdHJ5IHRvIHRyYWNlIHRocm91Z2ggInVzZSBzdHJpY3QiIGNhbGwgY2hhaW5zLiAoIzEzMzM1KQogIC8vIFN1cHBvcnQ6IEZpcmVmb3ggMTgrCiAgLy8idXNlIHN0cmljdCI7CiAgdmFyIC8vIFRoZSBkZWZlcnJlZCB1c2VkIG9uIERPTSByZWFkeQogIHJlYWR5TGlzdCwKICAgICAgLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCiAgcm9vdGpRdWVyeSwKICAgICAgLy8gU3VwcG9ydDogSUU8OQogIC8vIEZvciBgdHlwZW9mIG5vZGUubWV0aG9kYCBpbnN0ZWFkIG9mIGBub2RlLm1ldGhvZCAhPT0gdW5kZWZpbmVkYAogIGNvcmVfc3RydW5kZWZpbmVkID0gX3R5cGVvZih1bmRlZmluZWQpLAogICAgICAvLyBVc2UgdGhlIGNvcnJlY3QgZG9jdW1lbnQgYWNjb3JkaW5nbHkgd2l0aCB3aW5kb3cgYXJndW1lbnQgKHNhbmRib3gpCiAgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCiAgICAgIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLAogICAgICAvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKICBfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSwKICAgICAgLy8gTWFwIG92ZXIgdGhlICQgaW4gY2FzZSBvZiBvdmVyd3JpdGUKICBfJCA9IHdpbmRvdy4kLAogICAgICAvLyBbW0NsYXNzXV0gLT4gdHlwZSBwYWlycwogIGNsYXNzMnR5cGUgPSB7fSwKICAgICAgLy8gTGlzdCBvZiBkZWxldGVkIGRhdGEgY2FjaGUgaWRzLCBzbyB3ZSBjYW4gcmV1c2UgdGhlbQogIGNvcmVfZGVsZXRlZElkcyA9IFtdLAogICAgICBjb3JlX3ZlcnNpb24gPSAiMS45LjEiLAogICAgICAvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHNvbWUgY29yZSBtZXRob2RzCiAgY29yZV9jb25jYXQgPSBjb3JlX2RlbGV0ZWRJZHMuY29uY2F0LAogICAgICBjb3JlX3B1c2ggPSBjb3JlX2RlbGV0ZWRJZHMucHVzaCwKICAgICAgY29yZV9zbGljZSA9IGNvcmVfZGVsZXRlZElkcy5zbGljZSwKICAgICAgY29yZV9pbmRleE9mID0gY29yZV9kZWxldGVkSWRzLmluZGV4T2YsCiAgICAgIGNvcmVfdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nLAogICAgICBjb3JlX2hhc093biA9IGNsYXNzMnR5cGUuaGFzT3duUHJvcGVydHksCiAgICAgIGNvcmVfdHJpbSA9IGNvcmVfdmVyc2lvbi50cmltLAogICAgICAvLyBEZWZpbmUgYSBsb2NhbCBjb3B5IG9mIGpRdWVyeQogIGpRdWVyeSA9IGZ1bmN0aW9uIGpRdWVyeShzZWxlY3RvciwgY29udGV4dCkgewogICAgLy8gVGhlIGpRdWVyeSBvYmplY3QgaXMgYWN0dWFsbHkganVzdCB0aGUgaW5pdCBjb25zdHJ1Y3RvciAnZW5oYW5jZWQnCiAgICByZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KHNlbGVjdG9yLCBjb250ZXh0LCByb290alF1ZXJ5KTsKICB9LAogICAgICAvLyBVc2VkIGZvciBtYXRjaGluZyBudW1iZXJzCiAgY29yZV9wbnVtID0gL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UsCiAgICAgIC8vIFVzZWQgZm9yIHNwbGl0dGluZyBvbiB3aGl0ZXNwYWNlCiAgY29yZV9ybm90d2hpdGUgPSAvXFMrL2csCiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUCAoaGVyZSdzIGxvb2tpbmcgYXQgeW91LCBTYWZhcmkgNS4wIGFuZCBJRSkKICBydHJpbSA9IC9eW1xzXHVGRUZGXHhBMF0rfFtcc1x1RkVGRlx4QTBdKyQvZywKICAgICAgLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3MKICAvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpCiAgLy8gU3RyaWN0IEhUTUwgcmVjb2duaXRpb24gKCMxMTI5MDogbXVzdCBzdGFydCB3aXRoIDwpCiAgcnF1aWNrRXhwciA9IC9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sCiAgICAgIC8vIE1hdGNoIGEgc3RhbmRhbG9uZSB0YWcKICByc2luZ2xlVGFnID0gL148KFx3KylccypcLz8+KD86PFwvXDE+fCkkLywKICAgICAgLy8gSlNPTiBSZWdFeHAKICBydmFsaWRjaGFycyA9IC9eW1xdLDp7fVxzXSokLywKICAgICAgcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKICAgICAgcnZhbGlkZXNjYXBlID0gL1xcKD86WyJcXFwvYmZucnRdfHVbXGRhLWZBLUZdezR9KS9nLAogICAgICBydmFsaWR0b2tlbnMgPSAvIlteIlxcXHJcbl0qInx0cnVlfGZhbHNlfG51bGx8LT8oPzpcZCtcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvZywKICAgICAgLy8gTWF0Y2hlcyBkYXNoZWQgc3RyaW5nIGZvciBjYW1lbGl6aW5nCiAgcm1zUHJlZml4ID0gL14tbXMtLywKICAgICAgcmRhc2hBbHBoYSA9IC8tKFtcZGEtel0pL2dpLAogICAgICAvLyBVc2VkIGJ5IGpRdWVyeS5jYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCiAgZmNhbWVsQ2FzZSA9IGZ1bmN0aW9uIGZjYW1lbENhc2UoYWxsLCBsZXR0ZXIpIHsKICAgIHJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKICB9LAogICAgICAvLyBUaGUgcmVhZHkgZXZlbnQgaGFuZGxlcgogIGNvbXBsZXRlZCA9IGZ1bmN0aW9uIGNvbXBsZXRlZChldmVudCkgewogICAgLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCiAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciB8fCBldmVudC50eXBlID09PSAibG9hZCIgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIikgewogICAgICBkZXRhY2goKTsKICAgICAgalF1ZXJ5LnJlYWR5KCk7CiAgICB9CiAgfSwKICAgICAgLy8gQ2xlYW4tdXAgbWV0aG9kIGZvciBkb20gcmVhZHkgZXZlbnRzCiAgZGV0YWNoID0gZnVuY3Rpb24gZGV0YWNoKCkgewogICAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCwgZmFsc2UpOwogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsIGNvbXBsZXRlZCwgZmFsc2UpOwogICAgfSBlbHNlIHsKICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCk7CiAgICAgIHdpbmRvdy5kZXRhY2hFdmVudCgib25sb2FkIiwgY29tcGxldGVkKTsKICAgIH0KICB9OwoKICBqUXVlcnkuZm4gPSBqUXVlcnkucHJvdG90eXBlID0gewogICAgLy8gVGhlIGN1cnJlbnQgdmVyc2lvbiBvZiBqUXVlcnkgYmVpbmcgdXNlZAogICAganF1ZXJ5OiBjb3JlX3ZlcnNpb24sCiAgICBjb25zdHJ1Y3RvcjogalF1ZXJ5LAogICAgaW5pdDogZnVuY3Rpb24gaW5pdChzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeSkgewogICAgICB2YXIgbWF0Y2gsIGVsZW07IC8vIEhBTkRMRTogJCgiIiksICQobnVsbCksICQodW5kZWZpbmVkKSwgJChmYWxzZSkKCiAgICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSAvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgoKICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIpIHsKICAgICAgICBpZiAoc2VsZWN0b3IuY2hhckF0KDApID09PSAiPCIgJiYgc2VsZWN0b3IuY2hhckF0KHNlbGVjdG9yLmxlbmd0aCAtIDEpID09PSAiPiIgJiYgc2VsZWN0b3IubGVuZ3RoID49IDMpIHsKICAgICAgICAgIC8vIEFzc3VtZSB0aGF0IHN0cmluZ3MgdGhhdCBzdGFydCBhbmQgZW5kIHdpdGggPD4gYXJlIEhUTUwgYW5kIHNraXAgdGhlIHJlZ2V4IGNoZWNrCiAgICAgICAgICBtYXRjaCA9IFtudWxsLCBzZWxlY3RvciwgbnVsbF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdGNoID0gcnF1aWNrRXhwci5leGVjKHNlbGVjdG9yKTsKICAgICAgICB9IC8vIE1hdGNoIGh0bWwgb3IgbWFrZSBzdXJlIG5vIGNvbnRleHQgaXMgc3BlY2lmaWVkIGZvciAjaWQKCgogICAgICAgIGlmIChtYXRjaCAmJiAobWF0Y2hbMV0gfHwgIWNvbnRleHQpKSB7CiAgICAgICAgICAvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKICAgICAgICAgIGlmIChtYXRjaFsxXSkgewogICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeSA/IGNvbnRleHRbMF0gOiBjb250ZXh0OyAvLyBzY3JpcHRzIGlzIHRydWUgZm9yIGJhY2stY29tcGF0CgogICAgICAgICAgICBqUXVlcnkubWVyZ2UodGhpcywgalF1ZXJ5LnBhcnNlSFRNTChtYXRjaFsxXSwgY29udGV4dCAmJiBjb250ZXh0Lm5vZGVUeXBlID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBkb2N1bWVudCwgdHJ1ZSkpOyAvLyBIQU5ETEU6ICQoaHRtbCwgcHJvcHMpCgogICAgICAgICAgICBpZiAocnNpbmdsZVRhZy50ZXN0KG1hdGNoWzFdKSAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdChjb250ZXh0KSkgewogICAgICAgICAgICAgIGZvciAobWF0Y2ggaW4gY29udGV4dCkgewogICAgICAgICAgICAgICAgLy8gUHJvcGVydGllcyBvZiBjb250ZXh0IGFyZSBjYWxsZWQgYXMgbWV0aG9kcyBpZiBwb3NzaWJsZQogICAgICAgICAgICAgICAgaWYgKGpRdWVyeS5pc0Z1bmN0aW9uKHRoaXNbbWF0Y2hdKSkgewogICAgICAgICAgICAgICAgICB0aGlzW21hdGNoXShjb250ZXh0W21hdGNoXSk7IC8vIC4uLmFuZCBvdGhlcndpc2Ugc2V0IGFzIGF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYXR0cihtYXRjaCwgY29udGV4dFttYXRjaF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7IC8vIEhBTkRMRTogJCgjaWQpCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWF0Y2hbMl0pOyAvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwogICAgICAgICAgICAvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgogICAgICAgICAgICBpZiAoZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwogICAgICAgICAgICAgIC8vIGJ5IG5hbWUgaW5zdGVhZCBvZiBJRAogICAgICAgICAgICAgIGlmIChlbGVtLmlkICE9PSBtYXRjaFsyXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJvb3RqUXVlcnkuZmluZChzZWxlY3Rvcik7CiAgICAgICAgICAgICAgfSAvLyBPdGhlcndpc2UsIHdlIGluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgoKICAgICAgICAgICAgICB0aGlzLmxlbmd0aCA9IDE7CiAgICAgICAgICAgICAgdGhpc1swXSA9IGVsZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGRvY3VtZW50OwogICAgICAgICAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSAvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQoKICAgICAgICB9IGVsc2UgaWYgKCFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5KSB7CiAgICAgICAgICByZXR1cm4gKGNvbnRleHQgfHwgcm9vdGpRdWVyeSkuZmluZChzZWxlY3Rvcik7IC8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQogICAgICAgICAgLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yKGNvbnRleHQpLmZpbmQoc2VsZWN0b3IpOwogICAgICAgIH0gLy8gSEFORExFOiAkKERPTUVsZW1lbnQpCgogICAgICB9IGVsc2UgaWYgKHNlbGVjdG9yLm5vZGVUeXBlKSB7CiAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yOwogICAgICAgIHRoaXMubGVuZ3RoID0gMTsKICAgICAgICByZXR1cm4gdGhpczsgLy8gSEFORExFOiAkKGZ1bmN0aW9uKQogICAgICAgIC8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQogICAgICB9IGVsc2UgaWYgKGpRdWVyeS5pc0Z1bmN0aW9uKHNlbGVjdG9yKSkgewogICAgICAgIHJldHVybiByb290alF1ZXJ5LnJlYWR5KHNlbGVjdG9yKTsKICAgICAgfQoKICAgICAgaWYgKHNlbGVjdG9yLnNlbGVjdG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CiAgICAgICAgdGhpcy5jb250ZXh0ID0gc2VsZWN0b3IuY29udGV4dDsKICAgICAgfQoKICAgICAgcmV0dXJuIGpRdWVyeS5tYWtlQXJyYXkoc2VsZWN0b3IsIHRoaXMpOwogICAgfSwKICAgIC8vIFN0YXJ0IHdpdGggYW4gZW1wdHkgc2VsZWN0b3IKICAgIHNlbGVjdG9yOiAiIiwKICAgIC8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAogICAgbGVuZ3RoOiAwLAogICAgLy8gVGhlIG51bWJlciBvZiBlbGVtZW50cyBjb250YWluZWQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQKICAgIHNpemU6IGZ1bmN0aW9uIHNpemUoKSB7CiAgICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgIH0sCiAgICB0b0FycmF5OiBmdW5jdGlvbiB0b0FycmF5KCkgewogICAgICByZXR1cm4gY29yZV9zbGljZS5jYWxsKHRoaXMpOwogICAgfSwKICAgIC8vIEdldCB0aGUgTnRoIGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQgT1IKICAgIC8vIEdldCB0aGUgd2hvbGUgbWF0Y2hlZCBlbGVtZW50IHNldCBhcyBhIGNsZWFuIGFycmF5CiAgICBnZXQ6IGZ1bmN0aW9uIGdldChudW0pIHsKICAgICAgcmV0dXJuIG51bSA9PSBudWxsID8gLy8gUmV0dXJuIGEgJ2NsZWFuJyBhcnJheQogICAgICB0aGlzLnRvQXJyYXkoKSA6IC8vIFJldHVybiBqdXN0IHRoZSBvYmplY3QKICAgICAgbnVtIDwgMCA/IHRoaXNbdGhpcy5sZW5ndGggKyBudW1dIDogdGhpc1tudW1dOwogICAgfSwKICAgIC8vIFRha2UgYW4gYXJyYXkgb2YgZWxlbWVudHMgYW5kIHB1c2ggaXQgb250byB0aGUgc3RhY2sKICAgIC8vIChyZXR1cm5pbmcgdGhlIG5ldyBtYXRjaGVkIGVsZW1lbnQgc2V0KQogICAgcHVzaFN0YWNrOiBmdW5jdGlvbiBwdXNoU3RhY2soZWxlbXMpIHsKICAgICAgLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKICAgICAgdmFyIHJldCA9IGpRdWVyeS5tZXJnZSh0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zKTsgLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCiAgICAgIHJldC5wcmV2T2JqZWN0ID0gdGhpczsKICAgICAgcmV0LmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7IC8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgogICAgICByZXR1cm4gcmV0OwogICAgfSwKICAgIC8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuCiAgICAvLyAoWW91IGNhbiBzZWVkIHRoZSBhcmd1bWVudHMgd2l0aCBhbiBhcnJheSBvZiBhcmdzLCBidXQgdGhpcyBpcwogICAgLy8gb25seSB1c2VkIGludGVybmFsbHkuKQogICAgZWFjaDogZnVuY3Rpb24gZWFjaChjYWxsYmFjaywgYXJncykgewogICAgICByZXR1cm4galF1ZXJ5LmVhY2godGhpcywgY2FsbGJhY2ssIGFyZ3MpOwogICAgfSwKICAgIHJlYWR5OiBmdW5jdGlvbiByZWFkeShmbikgewogICAgICAvLyBBZGQgdGhlIGNhbGxiYWNrCiAgICAgIGpRdWVyeS5yZWFkeS5wcm9taXNlKCkuZG9uZShmbik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHNsaWNlOiBmdW5jdGlvbiBzbGljZSgpIHsKICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGNvcmVfc2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9LAogICAgZmlyc3Q6IGZ1bmN0aW9uIGZpcnN0KCkgewogICAgICByZXR1cm4gdGhpcy5lcSgwKTsKICAgIH0sCiAgICBsYXN0OiBmdW5jdGlvbiBsYXN0KCkgewogICAgICByZXR1cm4gdGhpcy5lcSgtMSk7CiAgICB9LAogICAgZXE6IGZ1bmN0aW9uIGVxKGkpIHsKICAgICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgaiA9ICtpICsgKGkgPCAwID8gbGVuIDogMCk7CiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhqID49IDAgJiYgaiA8IGxlbiA/IFt0aGlzW2pdXSA6IFtdKTsKICAgIH0sCiAgICBtYXA6IGZ1bmN0aW9uIG1hcChjYWxsYmFjaykgewogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soalF1ZXJ5Lm1hcCh0aGlzLCBmdW5jdGlvbiAoZWxlbSwgaSkgewogICAgICAgIHJldHVybiBjYWxsYmFjay5jYWxsKGVsZW0sIGksIGVsZW0pOwogICAgICB9KSk7CiAgICB9LAogICAgZW5kOiBmdW5jdGlvbiBlbmQoKSB7CiAgICAgIHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcihudWxsKTsKICAgIH0sCiAgICAvLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkuCiAgICAvLyBCZWhhdmVzIGxpa2UgYW4gQXJyYXkncyBtZXRob2QsIG5vdCBsaWtlIGEgalF1ZXJ5IG1ldGhvZC4KICAgIHB1c2g6IGNvcmVfcHVzaCwKICAgIHNvcnQ6IFtdLnNvcnQsCiAgICBzcGxpY2U6IFtdLnNwbGljZQogIH07IC8vIEdpdmUgdGhlIGluaXQgZnVuY3Rpb24gdGhlIGpRdWVyeSBwcm90b3R5cGUgZm9yIGxhdGVyIGluc3RhbnRpYXRpb24KCiAgalF1ZXJ5LmZuLmluaXQucHJvdG90eXBlID0galF1ZXJ5LmZuOwoKICBqUXVlcnkuZXh0ZW5kID0galF1ZXJ5LmZuLmV4dGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzcmMsCiAgICAgICAgY29weUlzQXJyYXksCiAgICAgICAgY29weSwKICAgICAgICBuYW1lLAogICAgICAgIG9wdGlvbnMsCiAgICAgICAgY2xvbmUsCiAgICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAogICAgICAgIGkgPSAxLAogICAgICAgIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgZGVlcCA9IGZhbHNlOyAvLyBIYW5kbGUgYSBkZWVwIGNvcHkgc2l0dWF0aW9uCgogICAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICJib29sZWFuIikgewogICAgICBkZWVwID0gdGFyZ2V0OwogICAgICB0YXJnZXQgPSBhcmd1bWVudHNbMV0gfHwge307IC8vIHNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCiAgICAgIGkgPSAyOwogICAgfSAvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSkKCgogICAgaWYgKF90eXBlb2YodGFyZ2V0KSAhPT0gIm9iamVjdCIgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKHRhcmdldCkpIHsKICAgICAgdGFyZ2V0ID0ge307CiAgICB9IC8vIGV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoKCiAgICBpZiAobGVuZ3RoID09PSBpKSB7CiAgICAgIHRhcmdldCA9IHRoaXM7CiAgICAgIC0taTsKICAgIH0KCiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIC8vIE9ubHkgZGVhbCB3aXRoIG5vbi1udWxsL3VuZGVmaW5lZCB2YWx1ZXMKICAgICAgaWYgKChvcHRpb25zID0gYXJndW1lbnRzW2ldKSAhPSBudWxsKSB7CiAgICAgICAgLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAogICAgICAgIGZvciAobmFtZSBpbiBvcHRpb25zKSB7CiAgICAgICAgICBzcmMgPSB0YXJnZXRbbmFtZV07CiAgICAgICAgICBjb3B5ID0gb3B0aW9uc1tuYW1lXTsgLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcAoKICAgICAgICAgIGlmICh0YXJnZXQgPT09IGNvcHkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIFJlY3Vyc2UgaWYgd2UncmUgbWVyZ2luZyBwbGFpbiBvYmplY3RzIG9yIGFycmF5cwoKCiAgICAgICAgICBpZiAoZGVlcCAmJiBjb3B5ICYmIChqUXVlcnkuaXNQbGFpbk9iamVjdChjb3B5KSB8fCAoY29weUlzQXJyYXkgPSBqUXVlcnkuaXNBcnJheShjb3B5KSkpKSB7CiAgICAgICAgICAgIGlmIChjb3B5SXNBcnJheSkgewogICAgICAgICAgICAgIGNvcHlJc0FycmF5ID0gZmFsc2U7CiAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNsb25lID0gc3JjICYmIGpRdWVyeS5pc1BsYWluT2JqZWN0KHNyYykgPyBzcmMgOiB7fTsKICAgICAgICAgICAgfSAvLyBOZXZlciBtb3ZlIG9yaWdpbmFsIG9iamVjdHMsIGNsb25lIHRoZW0KCgogICAgICAgICAgICB0YXJnZXRbbmFtZV0gPSBqUXVlcnkuZXh0ZW5kKGRlZXAsIGNsb25lLCBjb3B5KTsgLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwogICAgICAgICAgfSBlbHNlIGlmIChjb3B5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGFyZ2V0W25hbWVdID0gY29weTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCgogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICBqUXVlcnkuZXh0ZW5kKHsKICAgIG5vQ29uZmxpY3Q6IGZ1bmN0aW9uIG5vQ29uZmxpY3QoZGVlcCkgewogICAgICBpZiAod2luZG93LiQgPT09IGpRdWVyeSkgewogICAgICAgIHdpbmRvdy4kID0gXyQ7CiAgICAgIH0KCiAgICAgIGlmIChkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSkgewogICAgICAgIHdpbmRvdy5qUXVlcnkgPSBfalF1ZXJ5OwogICAgICB9CgogICAgICByZXR1cm4galF1ZXJ5OwogICAgfSwKICAgIC8vIElzIHRoZSBET00gcmVhZHkgdG8gYmUgdXNlZD8gU2V0IHRvIHRydWUgb25jZSBpdCBvY2N1cnMuCiAgICBpc1JlYWR5OiBmYWxzZSwKICAgIC8vIEEgY291bnRlciB0byB0cmFjayBob3cgbWFueSBpdGVtcyB0byB3YWl0IGZvciBiZWZvcmUKICAgIC8vIHRoZSByZWFkeSBldmVudCBmaXJlcy4gU2VlICM2NzgxCiAgICByZWFkeVdhaXQ6IDEsCiAgICAvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKICAgIGhvbGRSZWFkeTogZnVuY3Rpb24gaG9sZFJlYWR5KGhvbGQpIHsKICAgICAgaWYgKGhvbGQpIHsKICAgICAgICBqUXVlcnkucmVhZHlXYWl0Kys7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgalF1ZXJ5LnJlYWR5KHRydWUpOwogICAgICB9CiAgICB9LAogICAgLy8gSGFuZGxlIHdoZW4gdGhlIERPTSBpcyByZWFkeQogICAgcmVhZHk6IGZ1bmN0aW9uIHJlYWR5KHdhaXQpIHsKICAgICAgLy8gQWJvcnQgaWYgdGhlcmUgYXJlIHBlbmRpbmcgaG9sZHMgb3Igd2UncmUgYWxyZWFkeSByZWFkeQogICAgICBpZiAod2FpdCA9PT0gdHJ1ZSA/IC0talF1ZXJ5LnJlYWR5V2FpdCA6IGpRdWVyeS5pc1JlYWR5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIE1ha2Ugc3VyZSBib2R5IGV4aXN0cywgYXQgbGVhc3QsIGluIGNhc2UgSUUgZ2V0cyBhIGxpdHRsZSBvdmVyemVhbG91cyAodGlja2V0ICM1NDQzKS4KCgogICAgICBpZiAoIWRvY3VtZW50LmJvZHkpIHsKICAgICAgICByZXR1cm4gc2V0VGltZW91dChqUXVlcnkucmVhZHkpOwogICAgICB9IC8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQoKCiAgICAgIGpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsgLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCiAgICAgIGlmICh3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZQoKCiAgICAgIHJlYWR5TGlzdC5yZXNvbHZlV2l0aChkb2N1bWVudCwgW2pRdWVyeV0pOyAvLyBUcmlnZ2VyIGFueSBib3VuZCByZWFkeSBldmVudHMKCiAgICAgIGlmIChqUXVlcnkuZm4udHJpZ2dlcikgewogICAgICAgIGpRdWVyeShkb2N1bWVudCkudHJpZ2dlcigicmVhZHkiKS5vZmYoInJlYWR5Iik7CiAgICAgIH0KICAgIH0sCiAgICAvLyBTZWUgdGVzdC91bml0L2NvcmUuanMgZm9yIGRldGFpbHMgY29uY2VybmluZyBpc0Z1bmN0aW9uLgogICAgLy8gU2luY2UgdmVyc2lvbiAxLjMsIERPTSBtZXRob2RzIGFuZCBmdW5jdGlvbnMgbGlrZSBhbGVydAogICAgLy8gYXJlbid0IHN1cHBvcnRlZC4gVGhleSByZXR1cm4gZmFsc2Ugb24gSUUgKCMyOTY4KS4KICAgIGlzRnVuY3Rpb246IGZ1bmN0aW9uIGlzRnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwogICAgfSwKICAgIGlzQXJyYXk6IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKG9iaikgewogICAgICByZXR1cm4galF1ZXJ5LnR5cGUob2JqKSA9PT0gImFycmF5IjsKICAgIH0sCiAgICBpc1dpbmRvdzogZnVuY3Rpb24gaXNXaW5kb3cob2JqKSB7CiAgICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKICAgIH0sCiAgICBpc051bWVyaWM6IGZ1bmN0aW9uIGlzTnVtZXJpYyhvYmopIHsKICAgICAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG9iaikpICYmIGlzRmluaXRlKG9iaik7CiAgICB9LAogICAgdHlwZTogZnVuY3Rpb24gdHlwZShvYmopIHsKICAgICAgaWYgKG9iaiA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZyhvYmopOwogICAgICB9CgogICAgICByZXR1cm4gX3R5cGVvZihvYmopID09PSAib2JqZWN0IiB8fCB0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iID8gY2xhc3MydHlwZVtjb3JlX3RvU3RyaW5nLmNhbGwob2JqKV0gfHwgIm9iamVjdCIgOiBfdHlwZW9mKG9iaik7CiAgICB9LAogICAgaXNQbGFpbk9iamVjdDogZnVuY3Rpb24gaXNQbGFpbk9iamVjdChvYmopIHsKICAgICAgLy8gTXVzdCBiZSBhbiBPYmplY3QuCiAgICAgIC8vIEJlY2F1c2Ugb2YgSUUsIHdlIGFsc28gaGF2ZSB0byBjaGVjayB0aGUgcHJlc2VuY2Ugb2YgdGhlIGNvbnN0cnVjdG9yIHByb3BlcnR5LgogICAgICAvLyBNYWtlIHN1cmUgdGhhdCBET00gbm9kZXMgYW5kIHdpbmRvdyBvYmplY3RzIGRvbid0IHBhc3MgdGhyb3VnaCwgYXMgd2VsbAogICAgICBpZiAoIW9iaiB8fCBqUXVlcnkudHlwZShvYmopICE9PSAib2JqZWN0IiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KG9iaikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAogICAgICAgIGlmIChvYmouY29uc3RydWN0b3IgJiYgIWNvcmVfaGFzT3duLmNhbGwob2JqLCAiY29uc3RydWN0b3IiKSAmJiAhY29yZV9oYXNPd24uY2FsbChvYmouY29uc3RydWN0b3IucHJvdG90eXBlLCAiaXNQcm90b3R5cGVPZiIpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gSUU4LDkgV2lsbCB0aHJvdyBleGNlcHRpb25zIG9uIGNlcnRhaW4gaG9zdCBvYmplY3RzICM5ODk3CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIE93biBwcm9wZXJ0aWVzIGFyZSBlbnVtZXJhdGVkIGZpcnN0bHksIHNvIHRvIHNwZWVkIHVwLAogICAgICAvLyBpZiBsYXN0IG9uZSBpcyBvd24sIHRoZW4gYWxsIHByb3BlcnRpZXMgYXJlIG93bi4KCgogICAgICB2YXIga2V5OwoKICAgICAgZm9yIChrZXkgaW4gb2JqKSB7fQoKICAgICAgcmV0dXJuIGtleSA9PT0gdW5kZWZpbmVkIHx8IGNvcmVfaGFzT3duLmNhbGwob2JqLCBrZXkpOwogICAgfSwKICAgIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uIGlzRW1wdHlPYmplY3Qob2JqKSB7CiAgICAgIHZhciBuYW1lOwoKICAgICAgZm9yIChuYW1lIGluIG9iaikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKG1zZykgewogICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgIH0sCiAgICAvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAogICAgLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAogICAgLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwogICAgcGFyc2VIVE1MOiBmdW5jdGlvbiBwYXJzZUhUTUwoZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMpIHsKICAgICAgaWYgKCFkYXRhIHx8IHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIGNvbnRleHQgPT09ICJib29sZWFuIikgewogICAgICAgIGtlZXBTY3JpcHRzID0gY29udGV4dDsKICAgICAgICBjb250ZXh0ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwogICAgICB2YXIgcGFyc2VkID0gcnNpbmdsZVRhZy5leGVjKGRhdGEpLAogICAgICAgICAgc2NyaXB0cyA9ICFrZWVwU2NyaXB0cyAmJiBbXTsgLy8gU2luZ2xlIHRhZwoKICAgICAgaWYgKHBhcnNlZCkgewogICAgICAgIHJldHVybiBbY29udGV4dC5jcmVhdGVFbGVtZW50KHBhcnNlZFsxXSldOwogICAgICB9CgogICAgICBwYXJzZWQgPSBqUXVlcnkuYnVpbGRGcmFnbWVudChbZGF0YV0sIGNvbnRleHQsIHNjcmlwdHMpOwoKICAgICAgaWYgKHNjcmlwdHMpIHsKICAgICAgICBqUXVlcnkoc2NyaXB0cykucmVtb3ZlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBqUXVlcnkubWVyZ2UoW10sIHBhcnNlZC5jaGlsZE5vZGVzKTsKICAgIH0sCiAgICBwYXJzZUpTT046IGZ1bmN0aW9uIHBhcnNlSlNPTihkYXRhKSB7CiAgICAgIC8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAogICAgICBpZiAod2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UpIHsKICAgICAgICByZXR1cm4gd2luZG93LkpTT04ucGFyc2UoZGF0YSk7CiAgICAgIH0KCiAgICAgIGlmIChkYXRhID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICAvLyBNYWtlIHN1cmUgbGVhZGluZy90cmFpbGluZyB3aGl0ZXNwYWNlIGlzIHJlbW92ZWQgKElFIGNhbid0IGhhbmRsZSBpdCkKICAgICAgICBkYXRhID0galF1ZXJ5LnRyaW0oZGF0YSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGluY29taW5nIGRhdGEgaXMgYWN0dWFsIEpTT04KICAgICAgICAgIC8vIExvZ2ljIGJvcnJvd2VkIGZyb20gaHR0cDovL2pzb24ub3JnL2pzb24yLmpzCiAgICAgICAgICBpZiAocnZhbGlkY2hhcnMudGVzdChkYXRhLnJlcGxhY2UocnZhbGlkZXNjYXBlLCAiQCIpLnJlcGxhY2UocnZhbGlkdG9rZW5zLCAiXSIpLnJlcGxhY2UocnZhbGlkYnJhY2VzLCAiIikpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24oInJldHVybiAiICsgZGF0YSkoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGpRdWVyeS5lcnJvcigiSW52YWxpZCBKU09OOiAiICsgZGF0YSk7CiAgICB9LAogICAgLy8gQ3Jvc3MtYnJvd3NlciB4bWwgcGFyc2luZwogICAgcGFyc2VYTUw6IGZ1bmN0aW9uIHBhcnNlWE1MKGRhdGEpIHsKICAgICAgdmFyIHhtbCwgdG1wOwoKICAgICAgaWYgKCFkYXRhIHx8IHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7CiAgICAgICAgICAvLyBTdGFuZGFyZAogICAgICAgICAgdG1wID0gbmV3IERPTVBhcnNlcigpOwogICAgICAgICAgeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyhkYXRhLCAidGV4dC94bWwiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSUUKICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIik7CiAgICAgICAgICB4bWwuYXN5bmMgPSAiZmFsc2UiOwogICAgICAgICAgeG1sLmxvYWRYTUwoZGF0YSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgeG1sID0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBpZiAoIXhtbCB8fCAheG1sLmRvY3VtZW50RWxlbWVudCB8fCB4bWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInBhcnNlcmVycm9yIikubGVuZ3RoKSB7CiAgICAgICAgalF1ZXJ5LmVycm9yKCJJbnZhbGlkIFhNTDogIiArIGRhdGEpOwogICAgICB9CgogICAgICByZXR1cm4geG1sOwogICAgfSwKICAgIG5vb3A6IGZ1bmN0aW9uIG5vb3AoKSB7fSwKICAgIC8vIEV2YWx1YXRlcyBhIHNjcmlwdCBpbiBhIGdsb2JhbCBjb250ZXh0CiAgICAvLyBXb3JrYXJvdW5kcyBiYXNlZCBvbiBmaW5kaW5ncyBieSBKaW0gRHJpc2NvbGwKICAgIC8vIGh0dHA6Ly93ZWJsb2dzLmphdmEubmV0L2Jsb2cvZHJpc2NvbGwvYXJjaGl2ZS8yMDA5LzA5LzA4L2V2YWwtamF2YXNjcmlwdC1nbG9iYWwtY29udGV4dAogICAgZ2xvYmFsRXZhbDogZnVuY3Rpb24gZ2xvYmFsRXZhbChkYXRhKSB7CiAgICAgIGlmIChkYXRhICYmIGpRdWVyeS50cmltKGRhdGEpKSB7CiAgICAgICAgLy8gV2UgdXNlIGV4ZWNTY3JpcHQgb24gSW50ZXJuZXQgRXhwbG9yZXIKICAgICAgICAvLyBXZSB1c2UgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHNvIHRoYXQgY29udGV4dCBpcyB3aW5kb3cKICAgICAgICAvLyByYXRoZXIgdGhhbiBqUXVlcnkgaW4gRmlyZWZveAogICAgICAgICh3aW5kb3cuZXhlY1NjcmlwdCB8fCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgd2luZG93WyJldmFsIl0uY2FsbCh3aW5kb3csIGRhdGEpOwogICAgICAgIH0pKGRhdGEpOwogICAgICB9CiAgICB9LAogICAgLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwogICAgLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQogICAgY2FtZWxDYXNlOiBmdW5jdGlvbiBjYW1lbENhc2Uoc3RyaW5nKSB7CiAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZShybXNQcmVmaXgsICJtcy0iKS5yZXBsYWNlKHJkYXNoQWxwaGEsIGZjYW1lbENhc2UpOwogICAgfSwKICAgIG5vZGVOYW1lOiBmdW5jdGlvbiBub2RlTmFtZShlbGVtLCBuYW1lKSB7CiAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgfSwKICAgIC8vIGFyZ3MgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKICAgIGVhY2g6IGZ1bmN0aW9uIGVhY2gob2JqLCBjYWxsYmFjaywgYXJncykgewogICAgICB2YXIgdmFsdWUsCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGxlbmd0aCA9IG9iai5sZW5ndGgsCiAgICAgICAgICBpc0FycmF5ID0gaXNBcnJheWxpa2Uob2JqKTsKCiAgICAgIGlmIChhcmdzKSB7CiAgICAgICAgaWYgKGlzQXJyYXkpIHsKICAgICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjay5hcHBseShvYmpbaV0sIGFyZ3MpOwoKICAgICAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoaSBpbiBvYmopIHsKICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjay5hcHBseShvYmpbaV0sIGFyZ3MpOwoKICAgICAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaAoKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaXNBcnJheSkgewogICAgICAgICAgZm9yICg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrLmNhbGwob2JqW2ldLCBpLCBvYmpbaV0pOwoKICAgICAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoaSBpbiBvYmopIHsKICAgICAgICAgICAgdmFsdWUgPSBjYWxsYmFjay5jYWxsKG9ialtpXSwgaSwgb2JqW2ldKTsKCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9iajsKICAgIH0sCiAgICAvLyBVc2UgbmF0aXZlIFN0cmluZy50cmltIGZ1bmN0aW9uIHdoZXJldmVyIHBvc3NpYmxlCiAgICB0cmltOiBjb3JlX3RyaW0gJiYgIWNvcmVfdHJpbS5jYWxsKCJcdUZFRkZceEEwIikgPyBmdW5jdGlvbiAodGV4dCkgewogICAgICByZXR1cm4gdGV4dCA9PSBudWxsID8gIiIgOiBjb3JlX3RyaW0uY2FsbCh0ZXh0KTsKICAgIH0gOiAvLyBPdGhlcndpc2UgdXNlIG91ciBvd24gdHJpbW1pbmcgZnVuY3Rpb25hbGl0eQogICAgZnVuY3Rpb24gKHRleHQpIHsKICAgICAgcmV0dXJuIHRleHQgPT0gbnVsbCA/ICIiIDogKHRleHQgKyAiIikucmVwbGFjZShydHJpbSwgIiIpOwogICAgfSwKICAgIC8vIHJlc3VsdHMgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKICAgIG1ha2VBcnJheTogZnVuY3Rpb24gbWFrZUFycmF5KGFyciwgcmVzdWx0cykgewogICAgICB2YXIgcmV0ID0gcmVzdWx0cyB8fCBbXTsKCiAgICAgIGlmIChhcnIgIT0gbnVsbCkgewogICAgICAgIGlmIChpc0FycmF5bGlrZShPYmplY3QoYXJyKSkpIHsKICAgICAgICAgIGpRdWVyeS5tZXJnZShyZXQsIHR5cGVvZiBhcnIgPT09ICJzdHJpbmciID8gW2Fycl0gOiBhcnIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb3JlX3B1c2guY2FsbChyZXQsIGFycik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfSwKICAgIGluQXJyYXk6IGZ1bmN0aW9uIGluQXJyYXkoZWxlbSwgYXJyLCBpKSB7CiAgICAgIHZhciBsZW47CgogICAgICBpZiAoYXJyKSB7CiAgICAgICAgaWYgKGNvcmVfaW5kZXhPZikgewogICAgICAgICAgcmV0dXJuIGNvcmVfaW5kZXhPZi5jYWxsKGFyciwgZWxlbSwgaSk7CiAgICAgICAgfQoKICAgICAgICBsZW4gPSBhcnIubGVuZ3RoOwogICAgICAgIGkgPSBpID8gaSA8IDAgPyBNYXRoLm1heCgwLCBsZW4gKyBpKSA6IGkgOiAwOwoKICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCiAgICAgICAgICBpZiAoaSBpbiBhcnIgJiYgYXJyW2ldID09PSBlbGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfSwKICAgIG1lcmdlOiBmdW5jdGlvbiBtZXJnZShmaXJzdCwgc2Vjb25kKSB7CiAgICAgIHZhciBsID0gc2Vjb25kLmxlbmd0aCwKICAgICAgICAgIGkgPSBmaXJzdC5sZW5ndGgsCiAgICAgICAgICBqID0gMDsKCiAgICAgIGlmICh0eXBlb2YgbCA9PT0gIm51bWJlciIpIHsKICAgICAgICBmb3IgKDsgaiA8IGw7IGorKykgewogICAgICAgICAgZmlyc3RbaSsrXSA9IHNlY29uZFtqXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUgKHNlY29uZFtqXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBmaXJzdFtpKytdID0gc2Vjb25kW2orK107CiAgICAgICAgfQogICAgICB9CgogICAgICBmaXJzdC5sZW5ndGggPSBpOwogICAgICByZXR1cm4gZmlyc3Q7CiAgICB9LAogICAgZ3JlcDogZnVuY3Rpb24gZ3JlcChlbGVtcywgY2FsbGJhY2ssIGludikgewogICAgICB2YXIgcmV0VmFsLAogICAgICAgICAgcmV0ID0gW10sCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGxlbmd0aCA9IGVsZW1zLmxlbmd0aDsKICAgICAgaW52ID0gISFpbnY7IC8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKICAgICAgLy8gdGhhdCBwYXNzIHRoZSB2YWxpZGF0b3IgZnVuY3Rpb24KCiAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICByZXRWYWwgPSAhIWNhbGxiYWNrKGVsZW1zW2ldLCBpKTsKCiAgICAgICAgaWYgKGludiAhPT0gcmV0VmFsKSB7CiAgICAgICAgICByZXQucHVzaChlbGVtc1tpXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfSwKICAgIC8vIGFyZyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQogICAgbWFwOiBmdW5jdGlvbiBtYXAoZWxlbXMsIGNhbGxiYWNrLCBhcmcpIHsKICAgICAgdmFyIHZhbHVlLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBsZW5ndGggPSBlbGVtcy5sZW5ndGgsCiAgICAgICAgICBpc0FycmF5ID0gaXNBcnJheWxpa2UoZWxlbXMpLAogICAgICAgICAgcmV0ID0gW107IC8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCB0cmFuc2xhdGluZyBlYWNoIG9mIHRoZSBpdGVtcyB0byB0aGVpcgoKICAgICAgaWYgKGlzQXJyYXkpIHsKICAgICAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKGVsZW1zW2ldLCBpLCBhcmcpOwoKICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldFtyZXQubGVuZ3RoXSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gR28gdGhyb3VnaCBldmVyeSBrZXkgb24gdGhlIG9iamVjdCwKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChpIGluIGVsZW1zKSB7CiAgICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKGVsZW1zW2ldLCBpLCBhcmcpOwoKICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldFtyZXQubGVuZ3RoXSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgoKICAgICAgcmV0dXJuIGNvcmVfY29uY2F0LmFwcGx5KFtdLCByZXQpOwogICAgfSwKICAgIC8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwogICAgZ3VpZDogMSwKICAgIC8vIEJpbmQgYSBmdW5jdGlvbiB0byBhIGNvbnRleHQsIG9wdGlvbmFsbHkgcGFydGlhbGx5IGFwcGx5aW5nIGFueQogICAgLy8gYXJndW1lbnRzLgogICAgcHJveHk6IGZ1bmN0aW9uIHByb3h5KGZuLCBjb250ZXh0KSB7CiAgICAgIHZhciBhcmdzLCBwcm94eSwgdG1wOwoKICAgICAgaWYgKHR5cGVvZiBjb250ZXh0ID09PSAic3RyaW5nIikgewogICAgICAgIHRtcCA9IGZuW2NvbnRleHRdOwogICAgICAgIGNvbnRleHQgPSBmbjsKICAgICAgICBmbiA9IHRtcDsKICAgICAgfSAvLyBRdWljayBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGFyZ2V0IGlzIGNhbGxhYmxlLCBpbiB0aGUgc3BlYwogICAgICAvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoKCiAgICAgIGlmICghalF1ZXJ5LmlzRnVuY3Rpb24oZm4pKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfSAvLyBTaW11bGF0ZWQgYmluZAoKCiAgICAgIGFyZ3MgPSBjb3JlX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKCiAgICAgIHByb3h5ID0gZnVuY3Rpb24gcHJveHkoKSB7CiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoY29yZV9zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgfTsgLy8gU2V0IHRoZSBndWlkIG9mIHVuaXF1ZSBoYW5kbGVyIHRvIHRoZSBzYW1lIG9mIG9yaWdpbmFsIGhhbmRsZXIsIHNvIGl0IGNhbiBiZSByZW1vdmVkCgoKICAgICAgcHJveHkuZ3VpZCA9IGZuLmd1aWQgPSBmbi5ndWlkIHx8IGpRdWVyeS5ndWlkKys7CiAgICAgIHJldHVybiBwcm94eTsKICAgIH0sCiAgICAvLyBNdWx0aWZ1bmN0aW9uYWwgbWV0aG9kIHRvIGdldCBhbmQgc2V0IHZhbHVlcyBvZiBhIGNvbGxlY3Rpb24KICAgIC8vIFRoZSB2YWx1ZS9zIGNhbiBvcHRpb25hbGx5IGJlIGV4ZWN1dGVkIGlmIGl0J3MgYSBmdW5jdGlvbgogICAgYWNjZXNzOiBmdW5jdGlvbiBhY2Nlc3MoZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcpIHsKICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAogICAgICAgICAgYnVsayA9IGtleSA9PSBudWxsOyAvLyBTZXRzIG1hbnkgdmFsdWVzCgogICAgICBpZiAoalF1ZXJ5LnR5cGUoa2V5KSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBjaGFpbmFibGUgPSB0cnVlOwoKICAgICAgICBmb3IgKGkgaW4ga2V5KSB7CiAgICAgICAgICBqUXVlcnkuYWNjZXNzKGVsZW1zLCBmbiwgaSwga2V5W2ldLCB0cnVlLCBlbXB0eUdldCwgcmF3KTsKICAgICAgICB9IC8vIFNldHMgb25lIHZhbHVlCgogICAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjaGFpbmFibGUgPSB0cnVlOwoKICAgICAgICBpZiAoIWpRdWVyeS5pc0Z1bmN0aW9uKHZhbHVlKSkgewogICAgICAgICAgcmF3ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChidWxrKSB7CiAgICAgICAgICAvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKICAgICAgICAgIGlmIChyYXcpIHsKICAgICAgICAgICAgZm4uY2FsbChlbGVtcywgdmFsdWUpOwogICAgICAgICAgICBmbiA9IG51bGw7IC8vIC4uLmV4Y2VwdCB3aGVuIGV4ZWN1dGluZyBmdW5jdGlvbiB2YWx1ZXMKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1bGsgPSBmbjsKCiAgICAgICAgICAgIGZuID0gZnVuY3Rpb24gZm4oZWxlbSwga2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgIHJldHVybiBidWxrLmNhbGwoalF1ZXJ5KGVsZW0pLCB2YWx1ZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZm4pIHsKICAgICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZm4oZWxlbXNbaV0sIGtleSwgcmF3ID8gdmFsdWUgOiB2YWx1ZS5jYWxsKGVsZW1zW2ldLCBpLCBmbihlbGVtc1tpXSwga2V5KSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGNoYWluYWJsZSA/IGVsZW1zIDogLy8gR2V0cwogICAgICBidWxrID8gZm4uY2FsbChlbGVtcykgOiBsZW5ndGggPyBmbihlbGVtc1swXSwga2V5KSA6IGVtcHR5R2V0OwogICAgfSwKICAgIG5vdzogZnVuY3Rpb24gbm93KCkgewogICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB9CiAgfSk7CgogIGpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24gKG9iaikgewogICAgaWYgKCFyZWFkeUxpc3QpIHsKICAgICAgcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7IC8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZSBicm93c2VyIGV2ZW50IGhhcyBhbHJlYWR5IG9jY3VycmVkLgogICAgICAvLyB3ZSBvbmNlIHRyaWVkIHRvIHVzZSByZWFkeVN0YXRlICJpbnRlcmFjdGl2ZSIgaGVyZSwgYnV0IGl0IGNhdXNlZCBpc3N1ZXMgbGlrZSB0aGUgb25lCiAgICAgIC8vIGRpc2NvdmVyZWQgYnkgQ2hyaXNTIGhlcmU6IGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMjgyI2NvbW1lbnQ6MTUKCiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgLy8gSGFuZGxlIGl0IGFzeW5jaHJvbm91c2x5IHRvIGFsbG93IHNjcmlwdHMgdGhlIG9wcG9ydHVuaXR5IHRvIGRlbGF5IHJlYWR5CiAgICAgICAgc2V0VGltZW91dChqUXVlcnkucmVhZHkpOyAvLyBTdGFuZGFyZHMtYmFzZWQgYnJvd3NlcnMgc3VwcG9ydCBET01Db250ZW50TG9hZGVkCiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgIC8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSk7IC8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrCgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSk7IC8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBFbnN1cmUgZmlyaW5nIGJlZm9yZSBvbmxvYWQsIG1heWJlIGxhdGUgYnV0IHNhZmUgYWxzbyBmb3IgaWZyYW1lcwogICAgICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBjb21wbGV0ZWQpOyAvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoKICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoIm9ubG9hZCIsIGNvbXBsZXRlZCk7IC8vIElmIElFIGFuZCBub3QgYSBmcmFtZQogICAgICAgIC8vIGNvbnRpbnVhbGx5IGNoZWNrIHRvIHNlZSBpZiB0aGUgZG9jdW1lbnQgaXMgcmVhZHkKCiAgICAgICAgdmFyIHRvcCA9IGZhbHNlOwoKICAgICAgICB0cnkgewogICAgICAgICAgdG9wID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICBpZiAodG9wICYmIHRvcC5kb1Njcm9sbCkgewogICAgICAgICAgKGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CiAgICAgICAgICAgIGlmICghalF1ZXJ5LmlzUmVhZHkpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvCiAgICAgICAgICAgICAgICB0b3AuZG9TY3JvbGwoImxlZnQiKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChkb1Njcm9sbENoZWNrLCA1MCk7CiAgICAgICAgICAgICAgfSAvLyBkZXRhY2ggYWxsIGRvbSByZWFkeSBldmVudHMKCgogICAgICAgICAgICAgIGRldGFjaCgpOyAvLyBhbmQgZXhlY3V0ZSBhbnkgd2FpdGluZyBmdW5jdGlvbnMKCiAgICAgICAgICAgICAgalF1ZXJ5LnJlYWR5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlYWR5TGlzdC5wcm9taXNlKG9iaik7CiAgfTsgLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCgoKICBqUXVlcnkuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciIuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKGksIG5hbWUpIHsKICAgIGNsYXNzMnR5cGVbIltvYmplY3QgIiArIG5hbWUgKyAiXSJdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogIH0pOwoKICBmdW5jdGlvbiBpc0FycmF5bGlrZShvYmopIHsKICAgIHZhciBsZW5ndGggPSBvYmoubGVuZ3RoLAogICAgICAgIHR5cGUgPSBqUXVlcnkudHlwZShvYmopOwoKICAgIGlmIChqUXVlcnkuaXNXaW5kb3cob2JqKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG9iai5ub2RlVHlwZSA9PT0gMSAmJiBsZW5ndGgpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIHR5cGUgPT09ICJhcnJheSIgfHwgdHlwZSAhPT0gImZ1bmN0aW9uIiAmJiAobGVuZ3RoID09PSAwIHx8IHR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgbGVuZ3RoIC0gMSBpbiBvYmopOwogIH0gLy8gQWxsIGpRdWVyeSBvYmplY3RzIHNob3VsZCBwb2ludCBiYWNrIHRvIHRoZXNlCgoKICByb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsgLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQoKICB2YXIgb3B0aW9uc0NhY2hlID0ge307IC8vIENvbnZlcnQgU3RyaW5nLWZvcm1hdHRlZCBvcHRpb25zIGludG8gT2JqZWN0LWZvcm1hdHRlZCBvbmVzIGFuZCBzdG9yZSBpbiBjYWNoZQoKICBmdW5jdGlvbiBjcmVhdGVPcHRpb25zKG9wdGlvbnMpIHsKICAgIHZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbb3B0aW9uc10gPSB7fTsKICAgIGpRdWVyeS5lYWNoKG9wdGlvbnMubWF0Y2goY29yZV9ybm90d2hpdGUpIHx8IFtdLCBmdW5jdGlvbiAoXywgZmxhZykgewogICAgICBvYmplY3RbZmxhZ10gPSB0cnVlOwogICAgfSk7CiAgICByZXR1cm4gb2JqZWN0OwogIH0KICAvKg0KICAgKiBDcmVhdGUgYSBjYWxsYmFjayBsaXN0IHVzaW5nIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoNCiAgICoNCiAgICoJb3B0aW9uczogYW4gb3B0aW9uYWwgbGlzdCBvZiBzcGFjZS1zZXBhcmF0ZWQgb3B0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIGhvdw0KICAgKgkJCXRoZSBjYWxsYmFjayBsaXN0IGJlaGF2ZXMgb3IgYSBtb3JlIHRyYWRpdGlvbmFsIG9wdGlvbiBvYmplY3QNCiAgICoNCiAgICogQnkgZGVmYXVsdCBhIGNhbGxiYWNrIGxpc3Qgd2lsbCBhY3QgbGlrZSBhbiBldmVudCBjYWxsYmFjayBsaXN0IGFuZCBjYW4gYmUNCiAgICogImZpcmVkIiBtdWx0aXBsZSB0aW1lcy4NCiAgICoNCiAgICogUG9zc2libGUgb3B0aW9uczoNCiAgICoNCiAgICoJb25jZToJCQl3aWxsIGVuc3VyZSB0aGUgY2FsbGJhY2sgbGlzdCBjYW4gb25seSBiZSBmaXJlZCBvbmNlIChsaWtlIGEgRGVmZXJyZWQpDQogICAqDQogICAqCW1lbW9yeToJCQl3aWxsIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdmFsdWVzIGFuZCB3aWxsIGNhbGwgYW55IGNhbGxiYWNrIGFkZGVkDQogICAqCQkJCQlhZnRlciB0aGUgbGlzdCBoYXMgYmVlbiBmaXJlZCByaWdodCBhd2F5IHdpdGggdGhlIGxhdGVzdCAibWVtb3JpemVkIg0KICAgKgkJCQkJdmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpDQogICAqDQogICAqCXVuaXF1ZToJCQl3aWxsIGVuc3VyZSBhIGNhbGxiYWNrIGNhbiBvbmx5IGJlIGFkZGVkIG9uY2UgKG5vIGR1cGxpY2F0ZSBpbiB0aGUgbGlzdCkNCiAgICoNCiAgICoJc3RvcE9uRmFsc2U6CWludGVycnVwdCBjYWxsaW5ncyB3aGVuIGEgY2FsbGJhY2sgcmV0dXJucyBmYWxzZQ0KICAgKg0KICAgKi8KCgogIGpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZAogICAgLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KQogICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/IG9wdGlvbnNDYWNoZVtvcHRpb25zXSB8fCBjcmVhdGVPcHRpb25zKG9wdGlvbnMpIDogalF1ZXJ5LmV4dGVuZCh7fSwgb3B0aW9ucyk7CgogICAgdmFyIC8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IGlzIGN1cnJlbnRseSBmaXJpbmcKICAgIGZpcmluZywKICAgICAgICAvLyBMYXN0IGZpcmUgdmFsdWUgKGZvciBub24tZm9yZ2V0dGFibGUgbGlzdHMpCiAgICBtZW1vcnksCiAgICAgICAgLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKICAgIF9maXJlZCwKICAgICAgICAvLyBFbmQgb2YgdGhlIGxvb3Agd2hlbiBmaXJpbmcKICAgIGZpcmluZ0xlbmd0aCwKICAgICAgICAvLyBJbmRleCBvZiBjdXJyZW50bHkgZmlyaW5nIGNhbGxiYWNrIChtb2RpZmllZCBieSByZW1vdmUgaWYgbmVlZGVkKQogICAgZmlyaW5nSW5kZXgsCiAgICAgICAgLy8gRmlyc3QgY2FsbGJhY2sgdG8gZmlyZSAodXNlZCBpbnRlcm5hbGx5IGJ5IGFkZCBhbmQgZmlyZVdpdGgpCiAgICBmaXJpbmdTdGFydCwKICAgICAgICAvLyBBY3R1YWwgY2FsbGJhY2sgbGlzdAogICAgbGlzdCA9IFtdLAogICAgICAgIC8vIFN0YWNrIG9mIGZpcmUgY2FsbHMgZm9yIHJlcGVhdGFibGUgbGlzdHMKICAgIHN0YWNrID0gIW9wdGlvbnMub25jZSAmJiBbXSwKICAgICAgICAvLyBGaXJlIGNhbGxiYWNrcwogICAgZmlyZSA9IGZ1bmN0aW9uIGZpcmUoZGF0YSkgewogICAgICBtZW1vcnkgPSBvcHRpb25zLm1lbW9yeSAmJiBkYXRhOwogICAgICBfZmlyZWQgPSB0cnVlOwogICAgICBmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7CiAgICAgIGZpcmluZ1N0YXJ0ID0gMDsKICAgICAgZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CiAgICAgIGZpcmluZyA9IHRydWU7CgogICAgICBmb3IgKDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKykgewogICAgICAgIGlmIChsaXN0W2ZpcmluZ0luZGV4XS5hcHBseShkYXRhWzBdLCBkYXRhWzFdKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSkgewogICAgICAgICAgbWVtb3J5ID0gZmFsc2U7IC8vIFRvIHByZXZlbnQgZnVydGhlciBjYWxscyB1c2luZyBhZGQKCiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZpcmluZyA9IGZhbHNlOwoKICAgICAgaWYgKGxpc3QpIHsKICAgICAgICBpZiAoc3RhY2spIHsKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGgpIHsKICAgICAgICAgICAgZmlyZShzdGFjay5zaGlmdCgpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG1lbW9yeSkgewogICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWxmLmRpc2FibGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAgICAgLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKICAgIHNlbGYgPSB7CiAgICAgIC8vIEFkZCBhIGNhbGxiYWNrIG9yIGEgY29sbGVjdGlvbiBvZiBjYWxsYmFja3MgdG8gdGhlIGxpc3QKICAgICAgYWRkOiBmdW5jdGlvbiBhZGQoKSB7CiAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgIC8vIEZpcnN0LCB3ZSBzYXZlIHRoZSBjdXJyZW50IGxlbmd0aAogICAgICAgICAgdmFyIHN0YXJ0ID0gbGlzdC5sZW5ndGg7CgogICAgICAgICAgKGZ1bmN0aW9uIGFkZChhcmdzKSB7CiAgICAgICAgICAgIGpRdWVyeS5lYWNoKGFyZ3MsIGZ1bmN0aW9uIChfLCBhcmcpIHsKICAgICAgICAgICAgICB2YXIgdHlwZSA9IGpRdWVyeS50eXBlKGFyZyk7CgogICAgICAgICAgICAgIGlmICh0eXBlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMudW5pcXVlIHx8ICFzZWxmLmhhcyhhcmcpKSB7CiAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChhcmcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXJnICYmIGFyZy5sZW5ndGggJiYgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIC8vIEluc3BlY3QgcmVjdXJzaXZlbHkKICAgICAgICAgICAgICAgIGFkZChhcmcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KShhcmd1bWVudHMpOyAvLyBEbyB3ZSBuZWVkIHRvIGFkZCB0aGUgY2FsbGJhY2tzIHRvIHRoZQogICAgICAgICAgLy8gY3VycmVudCBmaXJpbmcgYmF0Y2g/CgoKICAgICAgICAgIGlmIChmaXJpbmcpIHsKICAgICAgICAgICAgZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7IC8vIFdpdGggbWVtb3J5LCBpZiB3ZSdyZSBub3QgZmlyaW5nIHRoZW4KICAgICAgICAgICAgLy8gd2Ugc2hvdWxkIGNhbGwgcmlnaHQgYXdheQogICAgICAgICAgfSBlbHNlIGlmIChtZW1vcnkpIHsKICAgICAgICAgICAgZmlyaW5nU3RhcnQgPSBzdGFydDsKICAgICAgICAgICAgZmlyZShtZW1vcnkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIC8vIFJlbW92ZSBhIGNhbGxiYWNrIGZyb20gdGhlIGxpc3QKICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgIGpRdWVyeS5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24gKF8sIGFyZykgewogICAgICAgICAgICB2YXIgaW5kZXg7CgogICAgICAgICAgICB3aGlsZSAoKGluZGV4ID0galF1ZXJ5LmluQXJyYXkoYXJnLCBsaXN0LCBpbmRleCkpID4gLTEpIHsKICAgICAgICAgICAgICBsaXN0LnNwbGljZShpbmRleCwgMSk7IC8vIEhhbmRsZSBmaXJpbmcgaW5kZXhlcwoKICAgICAgICAgICAgICBpZiAoZmlyaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPD0gZmlyaW5nTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGZpcmluZ0xlbmd0aC0tOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChpbmRleCA8PSBmaXJpbmdJbmRleCkgewogICAgICAgICAgICAgICAgICBmaXJpbmdJbmRleC0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgLy8gQ2hlY2sgaWYgYSBnaXZlbiBjYWxsYmFjayBpcyBpbiB0aGUgbGlzdC4KICAgICAgLy8gSWYgbm8gYXJndW1lbnQgaXMgZ2l2ZW4sIHJldHVybiB3aGV0aGVyIG9yIG5vdCBsaXN0IGhhcyBjYWxsYmFja3MgYXR0YWNoZWQuCiAgICAgIGhhczogZnVuY3Rpb24gaGFzKGZuKSB7CiAgICAgICAgcmV0dXJuIGZuID8galF1ZXJ5LmluQXJyYXkoZm4sIGxpc3QpID4gLTEgOiAhIShsaXN0ICYmIGxpc3QubGVuZ3RoKTsKICAgICAgfSwKICAgICAgLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAogICAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgbGlzdCA9IFtdOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICAvLyBIYXZlIHRoZSBsaXN0IGRvIG5vdGhpbmcgYW55bW9yZQogICAgICBkaXNhYmxlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICAgIGxpc3QgPSBzdGFjayA9IG1lbW9yeSA9IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgLy8gSXMgaXQgZGlzYWJsZWQ/CiAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICByZXR1cm4gIWxpc3Q7CiAgICAgIH0sCiAgICAgIC8vIExvY2sgdGhlIGxpc3QgaW4gaXRzIGN1cnJlbnQgc3RhdGUKICAgICAgbG9jazogZnVuY3Rpb24gbG9jaygpIHsKICAgICAgICBzdGFjayA9IHVuZGVmaW5lZDsKCiAgICAgICAgaWYgKCFtZW1vcnkpIHsKICAgICAgICAgIHNlbGYuZGlzYWJsZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIC8vIElzIGl0IGxvY2tlZD8KICAgICAgbG9ja2VkOiBmdW5jdGlvbiBsb2NrZWQoKSB7CiAgICAgICAgcmV0dXJuICFzdGFjazsKICAgICAgfSwKICAgICAgLy8gQ2FsbCBhbGwgY2FsbGJhY2tzIHdpdGggdGhlIGdpdmVuIGNvbnRleHQgYW5kIGFyZ3VtZW50cwogICAgICBmaXJlV2l0aDogZnVuY3Rpb24gZmlyZVdpdGgoY29udGV4dCwgYXJncykgewogICAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdOwogICAgICAgIGFyZ3MgPSBbY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3NdOwoKICAgICAgICBpZiAobGlzdCAmJiAoIV9maXJlZCB8fCBzdGFjaykpIHsKICAgICAgICAgIGlmIChmaXJpbmcpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhcmdzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpcmUoYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKICAgICAgZmlyZTogZnVuY3Rpb24gZmlyZSgpIHsKICAgICAgICBzZWxmLmZpcmVXaXRoKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIC8vIFRvIGtub3cgaWYgdGhlIGNhbGxiYWNrcyBoYXZlIGFscmVhZHkgYmVlbiBjYWxsZWQgYXQgbGVhc3Qgb25jZQogICAgICBmaXJlZDogZnVuY3Rpb24gZmlyZWQoKSB7CiAgICAgICAgcmV0dXJuICEhX2ZpcmVkOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBzZWxmOwogIH07CgogIGpRdWVyeS5leHRlbmQoewogICAgRGVmZXJyZWQ6IGZ1bmN0aW9uIERlZmVycmVkKGZ1bmMpIHsKICAgICAgdmFyIHR1cGxlcyA9IFsvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgbGlzdGVuZXIgbGlzdCwgZmluYWwgc3RhdGUKICAgICAgWyJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiXSwgWyJyZWplY3QiLCAiZmFpbCIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZWplY3RlZCJdLCBbIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpXV0sCiAgICAgICAgICBfc3RhdGUgPSAicGVuZGluZyIsCiAgICAgICAgICBfcHJvbWlzZSA9IHsKICAgICAgICBzdGF0ZTogZnVuY3Rpb24gc3RhdGUoKSB7CiAgICAgICAgICByZXR1cm4gX3N0YXRlOwogICAgICAgIH0sCiAgICAgICAgYWx3YXlzOiBmdW5jdGlvbiBhbHdheXMoKSB7CiAgICAgICAgICBkZWZlcnJlZC5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICB0aGVuOiBmdW5jdGlvbiB0aGVuKCkKICAgICAgICAvKiBmbkRvbmUsIGZuRmFpbCwgZm5Qcm9ncmVzcyAqLwogICAgICAgIHsKICAgICAgICAgIHZhciBmbnMgPSBhcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uIChuZXdEZWZlcikgewogICAgICAgICAgICBqUXVlcnkuZWFjaCh0dXBsZXMsIGZ1bmN0aW9uIChpLCB0dXBsZSkgewogICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB0dXBsZVswXSwKICAgICAgICAgICAgICAgICAgZm4gPSBqUXVlcnkuaXNGdW5jdGlvbihmbnNbaV0pICYmIGZuc1tpXTsgLy8gZGVmZXJyZWRbIGRvbmUgfCBmYWlsIHwgcHJvZ3Jlc3MgXSBmb3IgZm9yd2FyZGluZyBhY3Rpb25zIHRvIG5ld0RlZmVyCgogICAgICAgICAgICAgIGRlZmVycmVkW3R1cGxlWzFdXShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuZWQgPSBmbiAmJiBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbihyZXR1cm5lZC5wcm9taXNlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm5lZC5wcm9taXNlKCkuZG9uZShuZXdEZWZlci5yZXNvbHZlKS5mYWlsKG5ld0RlZmVyLnJlamVjdCkucHJvZ3Jlc3MobmV3RGVmZXIubm90aWZ5KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG5ld0RlZmVyW2FjdGlvbiArICJXaXRoIl0odGhpcyA9PT0gX3Byb21pc2UgPyBuZXdEZWZlci5wcm9taXNlKCkgOiB0aGlzLCBmbiA/IFtyZXR1cm5lZF0gOiBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZm5zID0gbnVsbDsKICAgICAgICAgIH0pLnByb21pc2UoKTsKICAgICAgICB9LAogICAgICAgIC8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKICAgICAgICAvLyBJZiBvYmogaXMgcHJvdmlkZWQsIHRoZSBwcm9taXNlIGFzcGVjdCBpcyBhZGRlZCB0byB0aGUgb2JqZWN0CiAgICAgICAgcHJvbWlzZTogZnVuY3Rpb24gcHJvbWlzZShvYmopIHsKICAgICAgICAgIHJldHVybiBvYmogIT0gbnVsbCA/IGpRdWVyeS5leHRlbmQob2JqLCBfcHJvbWlzZSkgOiBfcHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBkZWZlcnJlZCA9IHt9OyAvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgogICAgICBfcHJvbWlzZS5waXBlID0gX3Byb21pc2UudGhlbjsgLy8gQWRkIGxpc3Qtc3BlY2lmaWMgbWV0aG9kcwoKICAgICAgalF1ZXJ5LmVhY2godHVwbGVzLCBmdW5jdGlvbiAoaSwgdHVwbGUpIHsKICAgICAgICB2YXIgbGlzdCA9IHR1cGxlWzJdLAogICAgICAgICAgICBzdGF0ZVN0cmluZyA9IHR1cGxlWzNdOyAvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoKICAgICAgICBfcHJvbWlzZVt0dXBsZVsxXV0gPSBsaXN0LmFkZDsgLy8gSGFuZGxlIHN0YXRlCgogICAgICAgIGlmIChzdGF0ZVN0cmluZykgewogICAgICAgICAgbGlzdC5hZGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBzdGF0ZSA9IFsgcmVzb2x2ZWQgfCByZWplY3RlZCBdCiAgICAgICAgICAgIF9zdGF0ZSA9IHN0YXRlU3RyaW5nOyAvLyBbIHJlamVjdF9saXN0IHwgcmVzb2x2ZV9saXN0IF0uZGlzYWJsZTsgcHJvZ3Jlc3NfbGlzdC5sb2NrCiAgICAgICAgICB9LCB0dXBsZXNbaSBeIDFdWzJdLmRpc2FibGUsIHR1cGxlc1syXVsyXS5sb2NrKTsKICAgICAgICB9IC8vIGRlZmVycmVkWyByZXNvbHZlIHwgcmVqZWN0IHwgbm90aWZ5IF0KCgogICAgICAgIGRlZmVycmVkW3R1cGxlWzBdXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRlZmVycmVkW3R1cGxlWzBdICsgIldpdGgiXSh0aGlzID09PSBkZWZlcnJlZCA/IF9wcm9taXNlIDogdGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIGRlZmVycmVkW3R1cGxlWzBdICsgIldpdGgiXSA9IGxpc3QuZmlyZVdpdGg7CiAgICAgIH0pOyAvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCiAgICAgIF9wcm9taXNlLnByb21pc2UoZGVmZXJyZWQpOyAvLyBDYWxsIGdpdmVuIGZ1bmMgaWYgYW55CgoKICAgICAgaWYgKGZ1bmMpIHsKICAgICAgICBmdW5jLmNhbGwoZGVmZXJyZWQsIGRlZmVycmVkKTsKICAgICAgfSAvLyBBbGwgZG9uZSEKCgogICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9LAogICAgLy8gRGVmZXJyZWQgaGVscGVyCiAgICB3aGVuOiBmdW5jdGlvbiB3aGVuKHN1Ym9yZGluYXRlCiAgICAvKiAsIC4uLiwgc3Vib3JkaW5hdGVOICovCiAgICApIHsKICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgcmVzb2x2ZVZhbHVlcyA9IGNvcmVfc2xpY2UuY2FsbChhcmd1bWVudHMpLAogICAgICAgICAgbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCiAgICAgICAgICAvLyB0aGUgY291bnQgb2YgdW5jb21wbGV0ZWQgc3Vib3JkaW5hdGVzCiAgICAgIHJlbWFpbmluZyA9IGxlbmd0aCAhPT0gMSB8fCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbihzdWJvcmRpbmF0ZS5wcm9taXNlKSA/IGxlbmd0aCA6IDAsCiAgICAgICAgICAvLyB0aGUgbWFzdGVyIERlZmVycmVkLiBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KICAgICAgZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAogICAgICAgICAgLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwogICAgICB1cGRhdGVGdW5jID0gZnVuY3Rpb24gdXBkYXRlRnVuYyhpLCBjb250ZXh0cywgdmFsdWVzKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgY29udGV4dHNbaV0gPSB0aGlzOwogICAgICAgICAgdmFsdWVzW2ldID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBjb3JlX3NsaWNlLmNhbGwoYXJndW1lbnRzKSA6IHZhbHVlOwoKICAgICAgICAgIGlmICh2YWx1ZXMgPT09IHByb2dyZXNzVmFsdWVzKSB7CiAgICAgICAgICAgIGRlZmVycmVkLm5vdGlmeVdpdGgoY29udGV4dHMsIHZhbHVlcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCEgLS1yZW1haW5pbmcpIHsKICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoY29udGV4dHMsIHZhbHVlcyk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgICAgIHByb2dyZXNzVmFsdWVzLAogICAgICAgICAgcHJvZ3Jlc3NDb250ZXh0cywKICAgICAgICAgIHJlc29sdmVDb250ZXh0czsgLy8gYWRkIGxpc3RlbmVycyB0byBEZWZlcnJlZCBzdWJvcmRpbmF0ZXM7IHRyZWF0IG90aGVycyBhcyByZXNvbHZlZAoKCiAgICAgIGlmIChsZW5ndGggPiAxKSB7CiAgICAgICAgcHJvZ3Jlc3NWYWx1ZXMgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgICBwcm9ncmVzc0NvbnRleHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICAgICAgcmVzb2x2ZUNvbnRleHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChyZXNvbHZlVmFsdWVzW2ldICYmIGpRdWVyeS5pc0Z1bmN0aW9uKHJlc29sdmVWYWx1ZXNbaV0ucHJvbWlzZSkpIHsKICAgICAgICAgICAgcmVzb2x2ZVZhbHVlc1tpXS5wcm9taXNlKCkuZG9uZSh1cGRhdGVGdW5jKGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcykpLmZhaWwoZGVmZXJyZWQucmVqZWN0KS5wcm9ncmVzcyh1cGRhdGVGdW5jKGksIHByb2dyZXNzQ29udGV4dHMsIHByb2dyZXNzVmFsdWVzKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAtLXJlbWFpbmluZzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoKCiAgICAgIGlmICghcmVtYWluaW5nKSB7CiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgocmVzb2x2ZUNvbnRleHRzLCByZXNvbHZlVmFsdWVzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKICAgIH0KICB9KTsKCiAgalF1ZXJ5LnN1cHBvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc3VwcG9ydCwKICAgICAgICBhbGwsCiAgICAgICAgYSwKICAgICAgICBpbnB1dCwKICAgICAgICBzZWxlY3QsCiAgICAgICAgZnJhZ21lbnQsCiAgICAgICAgb3B0LAogICAgICAgIGV2ZW50TmFtZSwKICAgICAgICBpc1N1cHBvcnRlZCwKICAgICAgICBpLAogICAgICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOyAvLyBTZXR1cAoKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsICJ0Iik7CiAgICBkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7IC8vIFN1cHBvcnQgdGVzdHMgd29uJ3QgcnVuIGluIHNvbWUgbGltaXRlZCBvciBub24tYnJvd3NlciBlbnZpcm9ubWVudHMKCiAgICBhbGwgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTsKICAgIGEgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKVswXTsKCiAgICBpZiAoIWFsbCB8fCAhYSB8fCAhYWxsLmxlbmd0aCkgewogICAgICByZXR1cm4ge307CiAgICB9IC8vIEZpcnN0IGJhdGNoIG9mIHRlc3RzCgoKICAgIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwogICAgb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKTsKICAgIGlucHV0ID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdOwogICAgYS5zdHlsZS5jc3NUZXh0ID0gInRvcDoxcHg7ZmxvYXQ6bGVmdDtvcGFjaXR5Oi41IjsKICAgIHN1cHBvcnQgPSB7CiAgICAgIC8vIFRlc3Qgc2V0QXR0cmlidXRlIG9uIGNhbWVsQ2FzZSBjbGFzcy4gSWYgaXQgd29ya3MsIHdlIG5lZWQgYXR0ckZpeGVzIHdoZW4gZG9pbmcgZ2V0L3NldEF0dHJpYnV0ZSAoaWU2LzcpCiAgICAgIGdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gInQiLAogICAgICAvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCiAgICAgIGxlYWRpbmdXaGl0ZXNwYWNlOiBkaXYuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMywKICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGJvZHkgZWxlbWVudHMgYXJlbid0IGF1dG9tYXRpY2FsbHkgaW5zZXJ0ZWQKICAgICAgLy8gSUUgd2lsbCBpbnNlcnQgdGhlbSBpbnRvIGVtcHR5IHRhYmxlcwogICAgICB0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAogICAgICAvLyBUaGlzIHJlcXVpcmVzIGEgd3JhcHBlciBlbGVtZW50IGluIElFCiAgICAgIGh0bWxTZXJpYWxpemU6ICEhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLAogICAgICAvLyBHZXQgdGhlIHN0eWxlIGluZm9ybWF0aW9uIGZyb20gZ2V0QXR0cmlidXRlCiAgICAgIC8vIChJRSB1c2VzIC5jc3NUZXh0IGluc3RlYWQpCiAgICAgIHN0eWxlOiAvdG9wLy50ZXN0KGEuZ2V0QXR0cmlidXRlKCJzdHlsZSIpKSwKICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgVVJMcyBhcmVuJ3QgbWFuaXB1bGF0ZWQKICAgICAgLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKICAgICAgaHJlZk5vcm1hbGl6ZWQ6IGEuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIvYSIsCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGVsZW1lbnQgb3BhY2l0eSBleGlzdHMKICAgICAgLy8gKElFIHVzZXMgZmlsdGVyIGluc3RlYWQpCiAgICAgIC8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDUKICAgICAgb3BhY2l0eTogL14wLjUvLnRlc3QoYS5zdHlsZS5vcGFjaXR5KSwKICAgICAgLy8gVmVyaWZ5IHN0eWxlIGZsb2F0IGV4aXN0ZW5jZQogICAgICAvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCiAgICAgIGNzc0Zsb2F0OiAhIWEuc3R5bGUuY3NzRmxvYXQsCiAgICAgIC8vIENoZWNrIHRoZSBkZWZhdWx0IGNoZWNrYm94L3JhZGlvIHZhbHVlICgiIiBvbiBXZWJLaXQ7ICJvbiIgZWxzZXdoZXJlKQogICAgICBjaGVja09uOiAhIWlucHV0LnZhbHVlLAogICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhIHNlbGVjdGVkLWJ5LWRlZmF1bHQgb3B0aW9uIGhhcyBhIHdvcmtpbmcgc2VsZWN0ZWQgcHJvcGVydHkuCiAgICAgIC8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCiAgICAgIG9wdFNlbGVjdGVkOiBvcHQuc2VsZWN0ZWQsCiAgICAgIC8vIFRlc3RzIGZvciBlbmN0eXBlIHN1cHBvcnQgb24gYSBmb3JtICgjNjc0MykKICAgICAgZW5jdHlwZTogISFkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJmb3JtIikuZW5jdHlwZSwKICAgICAgLy8gTWFrZXMgc3VyZSBjbG9uaW5nIGFuIGh0bWw1IGVsZW1lbnQgZG9lcyBub3QgY2F1c2UgcHJvYmxlbXMKICAgICAgLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwogICAgICBodG1sNUNsb25lOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJuYXYiKS5jbG9uZU5vZGUodHJ1ZSkub3V0ZXJIVE1MICE9PSAiPDpuYXY+PC86bmF2PiIsCiAgICAgIC8vIGpRdWVyeS5zdXBwb3J0LmJveE1vZGVsIERFUFJFQ0FURUQgaW4gMS44IHNpbmNlIHdlIGRvbid0IHN1cHBvcnQgUXVpcmtzIE1vZGUKICAgICAgYm94TW9kZWw6IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJDU1MxQ29tcGF0IiwKICAgICAgLy8gV2lsbCBiZSBkZWZpbmVkIGxhdGVyCiAgICAgIGRlbGV0ZUV4cGFuZG86IHRydWUsCiAgICAgIG5vQ2xvbmVFdmVudDogdHJ1ZSwKICAgICAgaW5saW5lQmxvY2tOZWVkc0xheW91dDogZmFsc2UsCiAgICAgIHNocmlua1dyYXBCbG9ja3M6IGZhbHNlLAogICAgICByZWxpYWJsZU1hcmdpblJpZ2h0OiB0cnVlLAogICAgICBib3hTaXppbmdSZWxpYWJsZTogdHJ1ZSwKICAgICAgcGl4ZWxQb3NpdGlvbjogZmFsc2UKICAgIH07IC8vIE1ha2Ugc3VyZSBjaGVja2VkIHN0YXR1cyBpcyBwcm9wZXJseSBjbG9uZWQKCiAgICBpbnB1dC5jaGVja2VkID0gdHJ1ZTsKICAgIHN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSBpbnB1dC5jbG9uZU5vZGUodHJ1ZSkuY2hlY2tlZDsgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIG9wdGlvbnMgaW5zaWRlIGRpc2FibGVkIHNlbGVjdHMgYXJlbid0IG1hcmtlZCBhcyBkaXNhYmxlZAogICAgLy8gKFdlYktpdCBtYXJrcyB0aGVtIGFzIGRpc2FibGVkKQoKICAgIHNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CiAgICBzdXBwb3J0Lm9wdERpc2FibGVkID0gIW9wdC5kaXNhYmxlZDsgLy8gU3VwcG9ydDogSUU8OQoKICAgIHRyeSB7CiAgICAgIGRlbGV0ZSBkaXYudGVzdDsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7CiAgICB9IC8vIENoZWNrIGlmIHdlIGNhbiB0cnVzdCBnZXRBdHRyaWJ1dGUoInZhbHVlIikKCgogICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgaW5wdXQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiKTsKICAgIHN1cHBvcnQuaW5wdXQgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPT09ICIiOyAvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCiAgICBpbnB1dC52YWx1ZSA9ICJ0IjsKICAgIGlucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJyYWRpbyIpOwogICAgc3VwcG9ydC5yYWRpb1ZhbHVlID0gaW5wdXQudmFsdWUgPT09ICJ0IjsgLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCgogICAgaW5wdXQuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgInQiKTsKICAgIGlucHV0LnNldEF0dHJpYnV0ZSgibmFtZSIsICJ0Iik7CiAgICBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGlucHV0KTsgLy8gQ2hlY2sgaWYgYSBkaXNjb25uZWN0ZWQgY2hlY2tib3ggd2lsbCByZXRhaW4gaXRzIGNoZWNrZWQKICAgIC8vIHZhbHVlIG9mIHRydWUgYWZ0ZXIgYXBwZW5kZWQgdG8gdGhlIERPTSAoSUU2LzcpCgogICAgc3VwcG9ydC5hcHBlbmRDaGVja2VkID0gaW5wdXQuY2hlY2tlZDsgLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCgogICAgc3VwcG9ydC5jaGVja0Nsb25lID0gZnJhZ21lbnQuY2xvbmVOb2RlKHRydWUpLmNsb25lTm9kZSh0cnVlKS5sYXN0Q2hpbGQuY2hlY2tlZDsgLy8gU3VwcG9ydDogSUU8OQogICAgLy8gT3BlcmEgZG9lcyBub3QgY2xvbmUgZXZlbnRzIChhbmQgdHlwZW9mIGRpdi5hdHRhY2hFdmVudCA9PT0gdW5kZWZpbmVkKS4KICAgIC8vIElFOS0xMCBjbG9uZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCwgYnV0IHRoZXkgZG9uJ3QgdHJpZ2dlciB3aXRoIC5jbGljaygpCgogICAgaWYgKGRpdi5hdHRhY2hFdmVudCkgewogICAgICBkaXYuYXR0YWNoRXZlbnQoIm9uY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgc3VwcG9ydC5ub0Nsb25lRXZlbnQgPSBmYWxzZTsKICAgICAgfSk7CiAgICAgIGRpdi5jbG9uZU5vZGUodHJ1ZSkuY2xpY2soKTsKICAgIH0gLy8gU3VwcG9ydDogSUU8OSAobGFjayBzdWJtaXQvY2hhbmdlIGJ1YmJsZSksIEZpcmVmb3ggMTcrIChsYWNrIGZvY3VzaW4gZXZlbnQpCiAgICAvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKSwgdGVzdC9jc3AucGhwCgoKICAgIGZvciAoaSBpbiB7CiAgICAgIHN1Ym1pdDogdHJ1ZSwKICAgICAgY2hhbmdlOiB0cnVlLAogICAgICBmb2N1c2luOiB0cnVlCiAgICB9KSB7CiAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoZXZlbnROYW1lID0gIm9uIiArIGksICJ0Iik7CiAgICAgIHN1cHBvcnRbaSArICJCdWJibGVzIl0gPSBldmVudE5hbWUgaW4gd2luZG93IHx8IGRpdi5hdHRyaWJ1dGVzW2V2ZW50TmFtZV0uZXhwYW5kbyA9PT0gZmFsc2U7CiAgICB9CgogICAgZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKICAgIGRpdi5jbG9uZU5vZGUodHJ1ZSkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIjsKICAgIHN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlID0gZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID09PSAiY29udGVudC1ib3giOyAvLyBSdW4gdGVzdHMgdGhhdCBuZWVkIGEgYm9keSBhdCBkb2MgcmVhZHkKCiAgICBqUXVlcnkoZnVuY3Rpb24gKCkgewogICAgICB2YXIgY29udGFpbmVyLAogICAgICAgICAgbWFyZ2luRGl2LAogICAgICAgICAgdGRzLAogICAgICAgICAgZGl2UmVzZXQgPSAicGFkZGluZzowO21hcmdpbjowO2JvcmRlcjowO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7LXdlYmtpdC1ib3gtc2l6aW5nOmNvbnRlbnQtYm94OyIsCiAgICAgICAgICBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCiAgICAgIGlmICghYm9keSkgewogICAgICAgIC8vIFJldHVybiBmb3IgZnJhbWVzZXQgZG9jcyB0aGF0IGRvbid0IGhhdmUgYSBib2R5CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiOwogICAgICBib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcikuYXBwZW5kQ2hpbGQoZGl2KTsgLy8gU3VwcG9ydDogSUU4CiAgICAgIC8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CiAgICAgIC8vIHRvIGRpc3BsYXk6bm9uZSBhbmQgdGhlcmUgYXJlIHN0aWxsIG90aGVyIHZpc2libGUgdGFibGUgY2VsbHMgaW4gYQogICAgICAvLyB0YWJsZSByb3c7IGlmIHNvLCBvZmZzZXRXaWR0aC9IZWlnaHQgYXJlIG5vdCByZWxpYWJsZSBmb3IgdXNlIHdoZW4KICAgICAgLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKICAgICAgLy8gZGlzcGxheTpub25lIChpdCBpcyBzdGlsbCBzYWZlIHRvIHVzZSBvZmZzZXRzIGlmIGEgcGFyZW50IGVsZW1lbnQgaXMKICAgICAgLy8gaGlkZGVuOyBkb24gc2FmZXR5IGdvZ2dsZXMgYW5kIHNlZSBidWcgIzQ1MTIgZm9yIG1vcmUgaW5mb3JtYXRpb24pLgoKICAgICAgZGl2LmlubmVySFRNTCA9ICI8dGFibGU+PHRyPjx0ZD48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+IjsKICAgICAgdGRzID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpOwogICAgICB0ZHNbMF0uc3R5bGUuY3NzVGV4dCA9ICJwYWRkaW5nOjA7bWFyZ2luOjA7Ym9yZGVyOjA7ZGlzcGxheTpub25lIjsKICAgICAgaXNTdXBwb3J0ZWQgPSB0ZHNbMF0ub2Zmc2V0SGVpZ2h0ID09PSAwOwogICAgICB0ZHNbMF0uc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICB0ZHNbMV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsgLy8gU3VwcG9ydDogSUU4CiAgICAgIC8vIENoZWNrIGlmIGVtcHR5IHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0CgogICAgICBzdXBwb3J0LnJlbGlhYmxlSGlkZGVuT2Zmc2V0cyA9IGlzU3VwcG9ydGVkICYmIHRkc1swXS5vZmZzZXRIZWlnaHQgPT09IDA7IC8vIENoZWNrIGJveC1zaXppbmcgYW5kIG1hcmdpbiBiZWhhdmlvcgoKICAgICAgZGl2LmlubmVySFRNTCA9ICIiOwogICAgICBkaXYuc3R5bGUuY3NzVGV4dCA9ICJib3gtc2l6aW5nOmJvcmRlci1ib3g7LW1vei1ib3gtc2l6aW5nOmJvcmRlci1ib3g7LXdlYmtpdC1ib3gtc2l6aW5nOmJvcmRlci1ib3g7cGFkZGluZzoxcHg7Ym9yZGVyOjFweDtkaXNwbGF5OmJsb2NrO3dpZHRoOjRweDttYXJnaW4tdG9wOjElO3Bvc2l0aW9uOmFic29sdXRlO3RvcDoxJTsiOwogICAgICBzdXBwb3J0LmJveFNpemluZyA9IGRpdi5vZmZzZXRXaWR0aCA9PT0gNDsKICAgICAgc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCA9IGJvZHkub2Zmc2V0VG9wICE9PSAxOyAvLyBVc2Ugd2luZG93LmdldENvbXB1dGVkU3R5bGUgYmVjYXVzZSBqc2RvbSBvbiBub2RlLmpzIHdpbGwgYnJlYWsgd2l0aG91dCBpdC4KCiAgICAgIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkgewogICAgICAgIHN1cHBvcnQucGl4ZWxQb3NpdGlvbiA9ICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkaXYsIG51bGwpIHx8IHt9KS50b3AgIT09ICIxJSI7CiAgICAgICAgc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSA9ICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkaXYsIG51bGwpIHx8IHsKICAgICAgICAgIHdpZHRoOiAiNHB4IgogICAgICAgIH0pLndpZHRoID09PSAiNHB4IjsgLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQogICAgICAgIC8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lci4gKCMzMzMzKQogICAgICAgIC8vIEZhaWxzIGluIFdlYktpdCBiZWZvcmUgRmViIDIwMTEgbmlnaHRsaWVzCiAgICAgICAgLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgogICAgICAgIG1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7CiAgICAgICAgbWFyZ2luRGl2LnN0eWxlLmNzc1RleHQgPSBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0OwogICAgICAgIG1hcmdpbkRpdi5zdHlsZS5tYXJnaW5SaWdodCA9IG1hcmdpbkRpdi5zdHlsZS53aWR0aCA9ICIwIjsKICAgICAgICBkaXYuc3R5bGUud2lkdGggPSAiMXB4IjsKICAgICAgICBzdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHQgPSAhcGFyc2VGbG9hdCgod2luZG93LmdldENvbXB1dGVkU3R5bGUobWFyZ2luRGl2LCBudWxsKSB8fCB7fSkubWFyZ2luUmlnaHQpOwogICAgICB9CgogICAgICBpZiAoX3R5cGVvZihkaXYuc3R5bGUuem9vbSkgIT09IGNvcmVfc3RydW5kZWZpbmVkKSB7CiAgICAgICAgLy8gU3VwcG9ydDogSUU8OAogICAgICAgIC8vIENoZWNrIGlmIG5hdGl2ZWx5IGJsb2NrLWxldmVsIGVsZW1lbnRzIGFjdCBsaWtlIGlubGluZS1ibG9jawogICAgICAgIC8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmcKICAgICAgICAvLyB0aGVtIGxheW91dAogICAgICAgIGRpdi5pbm5lckhUTUwgPSAiIjsKICAgICAgICBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0ICsgIndpZHRoOjFweDtwYWRkaW5nOjFweDtkaXNwbGF5OmlubGluZTt6b29tOjEiOwogICAgICAgIHN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCA9IGRpdi5vZmZzZXRXaWR0aCA9PT0gMzsgLy8gU3VwcG9ydDogSUU2CiAgICAgICAgLy8gQ2hlY2sgaWYgZWxlbWVudHMgd2l0aCBsYXlvdXQgc2hyaW5rLXdyYXAgdGhlaXIgY2hpbGRyZW4KCiAgICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIGRpdi5pbm5lckhUTUwgPSAiPGRpdj48L2Rpdj4iOwogICAgICAgIGRpdi5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gIjVweCI7CiAgICAgICAgc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzID0gZGl2Lm9mZnNldFdpZHRoICE9PSAzOwoKICAgICAgICBpZiAoc3VwcG9ydC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0KSB7CiAgICAgICAgICAvLyBQcmV2ZW50IElFIDYgZnJvbSBhZmZlY3RpbmcgbGF5b3V0IGZvciBwb3NpdGlvbmVkIGVsZW1lbnRzICMxMTA0OAogICAgICAgICAgLy8gUHJldmVudCBJRSBmcm9tIHNocmlua2luZyB0aGUgYm9keSBpbiBJRSA3IG1vZGUgIzEyODY5CiAgICAgICAgICAvLyBTdXBwb3J0OiBJRTw4CiAgICAgICAgICBib2R5LnN0eWxlLnpvb20gPSAxOwogICAgICAgIH0KICAgICAgfQoKICAgICAgYm9keS5yZW1vdmVDaGlsZChjb250YWluZXIpOyAvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFCgogICAgICBjb250YWluZXIgPSBkaXYgPSB0ZHMgPSBtYXJnaW5EaXYgPSBudWxsOwogICAgfSk7IC8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUKCiAgICBhbGwgPSBzZWxlY3QgPSBmcmFnbWVudCA9IG9wdCA9IGEgPSBpbnB1dCA9IG51bGw7CiAgICByZXR1cm4gc3VwcG9ydDsKICB9KCk7CgogIHZhciByYnJhY2UgPSAvKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sCiAgICAgIHJtdWx0aURhc2ggPSAvKFtBLVpdKS9nOwoKICBmdW5jdGlvbiBpbnRlcm5hbERhdGEoZWxlbSwgbmFtZSwgZGF0YSwgcHZ0CiAgLyogSW50ZXJuYWwgVXNlIE9ubHkgKi8KICApIHsKICAgIGlmICghalF1ZXJ5LmFjY2VwdERhdGEoZWxlbSkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciB0aGlzQ2FjaGUsCiAgICAgICAgcmV0LAogICAgICAgIGludGVybmFsS2V5ID0galF1ZXJ5LmV4cGFuZG8sCiAgICAgICAgZ2V0QnlOYW1lID0gdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciLAogICAgICAgIC8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CiAgICAvLyBjYW4ndCBHQyBvYmplY3QgcmVmZXJlbmNlcyBwcm9wZXJseSBhY3Jvc3MgdGhlIERPTS1KUyBib3VuZGFyeQogICAgaXNOb2RlID0gZWxlbS5ub2RlVHlwZSwKICAgICAgICAvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwogICAgLy8gYXR0YWNoZWQgZGlyZWN0bHkgdG8gdGhlIG9iamVjdCBzbyBHQyBjYW4gb2NjdXIgYXV0b21hdGljYWxseQogICAgY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLAogICAgICAgIC8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwogICAgLy8gdGhlIGNvZGUgdG8gc2hvcnRjdXQgb24gdGhlIHNhbWUgcGF0aCBhcyBhIERPTSBub2RlIHdpdGggbm8gY2FjaGUKICAgIGlkID0gaXNOb2RlID8gZWxlbVtpbnRlcm5hbEtleV0gOiBlbGVtW2ludGVybmFsS2V5XSAmJiBpbnRlcm5hbEtleTsgLy8gQXZvaWQgZG9pbmcgYW55IG1vcmUgd29yayB0aGFuIHdlIG5lZWQgdG8gd2hlbiB0cnlpbmcgdG8gZ2V0IGRhdGEgb24gYW4KICAgIC8vIG9iamVjdCB0aGF0IGhhcyBubyBkYXRhIGF0IGFsbAoKICAgIGlmICgoIWlkIHx8ICFjYWNoZVtpZF0gfHwgIXB2dCAmJiAhY2FjaGVbaWRdLmRhdGEpICYmIGdldEJ5TmFtZSAmJiBkYXRhID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICghaWQpIHsKICAgICAgLy8gT25seSBET00gbm9kZXMgbmVlZCBhIG5ldyB1bmlxdWUgSUQgZm9yIGVhY2ggZWxlbWVudCBzaW5jZSB0aGVpciBkYXRhCiAgICAgIC8vIGVuZHMgdXAgaW4gdGhlIGdsb2JhbCBjYWNoZQogICAgICBpZiAoaXNOb2RlKSB7CiAgICAgICAgZWxlbVtpbnRlcm5hbEtleV0gPSBpZCA9IGNvcmVfZGVsZXRlZElkcy5wb3AoKSB8fCBqUXVlcnkuZ3VpZCsrOwogICAgICB9IGVsc2UgewogICAgICAgIGlkID0gaW50ZXJuYWxLZXk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIWNhY2hlW2lkXSkgewogICAgICBjYWNoZVtpZF0gPSB7fTsgLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAogICAgICAvLyBpcyBzZXJpYWxpemVkIHVzaW5nIEpTT04uc3RyaW5naWZ5CgogICAgICBpZiAoIWlzTm9kZSkgewogICAgICAgIGNhY2hlW2lkXS50b0pTT04gPSBqUXVlcnkubm9vcDsKICAgICAgfQogICAgfSAvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwogICAgLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoKCiAgICBpZiAoX3R5cGVvZihuYW1lKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgaWYgKHB2dCkgewogICAgICAgIGNhY2hlW2lkXSA9IGpRdWVyeS5leHRlbmQoY2FjaGVbaWRdLCBuYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWNoZVtpZF0uZGF0YSA9IGpRdWVyeS5leHRlbmQoY2FjaGVbaWRdLmRhdGEsIG5hbWUpOwogICAgICB9CiAgICB9CgogICAgdGhpc0NhY2hlID0gY2FjaGVbaWRdOyAvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKICAgIC8vIGNhY2hlIGluIG9yZGVyIHRvIGF2b2lkIGtleSBjb2xsaXNpb25zIGJldHdlZW4gaW50ZXJuYWwgZGF0YSBhbmQgdXNlci1kZWZpbmVkCiAgICAvLyBkYXRhLgoKICAgIGlmICghcHZ0KSB7CiAgICAgIGlmICghdGhpc0NhY2hlLmRhdGEpIHsKICAgICAgICB0aGlzQ2FjaGUuZGF0YSA9IHt9OwogICAgICB9CgogICAgICB0aGlzQ2FjaGUgPSB0aGlzQ2FjaGUuZGF0YTsKICAgIH0KCiAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXNDYWNoZVtqUXVlcnkuY2FtZWxDYXNlKG5hbWUpXSA9IGRhdGE7CiAgICB9IC8vIENoZWNrIGZvciBib3RoIGNvbnZlcnRlZC10by1jYW1lbCBhbmQgbm9uLWNvbnZlcnRlZCBkYXRhIHByb3BlcnR5IG5hbWVzCiAgICAvLyBJZiBhIGRhdGEgcHJvcGVydHkgd2FzIHNwZWNpZmllZAoKCiAgICBpZiAoZ2V0QnlOYW1lKSB7CiAgICAgIC8vIEZpcnN0IFRyeSB0byBmaW5kIGFzLWlzIHByb3BlcnR5IGRhdGEKICAgICAgcmV0ID0gdGhpc0NhY2hlW25hbWVdOyAvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgogICAgICBpZiAocmV0ID09IG51bGwpIHsKICAgICAgICAvLyBUcnkgdG8gZmluZCB0aGUgY2FtZWxDYXNlZCBwcm9wZXJ0eQogICAgICAgIHJldCA9IHRoaXNDYWNoZVtqUXVlcnkuY2FtZWxDYXNlKG5hbWUpXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0ID0gdGhpc0NhY2hlOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQoKICBmdW5jdGlvbiBpbnRlcm5hbFJlbW92ZURhdGEoZWxlbSwgbmFtZSwgcHZ0KSB7CiAgICBpZiAoIWpRdWVyeS5hY2NlcHREYXRhKGVsZW0pKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaSwKICAgICAgICBsLAogICAgICAgIHRoaXNDYWNoZSwKICAgICAgICBpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAogICAgICAgIC8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgogICAgY2FjaGUgPSBpc05vZGUgPyBqUXVlcnkuY2FjaGUgOiBlbGVtLAogICAgICAgIGlkID0gaXNOb2RlID8gZWxlbVtqUXVlcnkuZXhwYW5kb10gOiBqUXVlcnkuZXhwYW5kbzsgLy8gSWYgdGhlcmUgaXMgYWxyZWFkeSBubyBjYWNoZSBlbnRyeSBmb3IgdGhpcyBvYmplY3QsIHRoZXJlIGlzIG5vCiAgICAvLyBwdXJwb3NlIGluIGNvbnRpbnVpbmcKCiAgICBpZiAoIWNhY2hlW2lkXSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKG5hbWUpIHsKICAgICAgdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbaWRdIDogY2FjaGVbaWRdLmRhdGE7CgogICAgICBpZiAodGhpc0NhY2hlKSB7CiAgICAgICAgLy8gU3VwcG9ydCBhcnJheSBvciBzcGFjZSBzZXBhcmF0ZWQgc3RyaW5nIG5hbWVzIGZvciBkYXRhIGtleXMKICAgICAgICBpZiAoIWpRdWVyeS5pc0FycmF5KG5hbWUpKSB7CiAgICAgICAgICAvLyB0cnkgdGhlIHN0cmluZyBhcyBhIGtleSBiZWZvcmUgYW55IG1hbmlwdWxhdGlvbgogICAgICAgICAgaWYgKG5hbWUgaW4gdGhpc0NhY2hlKSB7CiAgICAgICAgICAgIG5hbWUgPSBbbmFtZV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBzcGxpdCB0aGUgY2FtZWwgY2FzZWQgdmVyc2lvbiBieSBzcGFjZXMgdW5sZXNzIGEga2V5IHdpdGggdGhlIHNwYWNlcyBleGlzdHMKICAgICAgICAgICAgbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UobmFtZSk7CgogICAgICAgICAgICBpZiAobmFtZSBpbiB0aGlzQ2FjaGUpIHsKICAgICAgICAgICAgICBuYW1lID0gW25hbWVdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCIgIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSWYgIm5hbWUiIGlzIGFuIGFycmF5IG9mIGtleXMuLi4KICAgICAgICAgIC8vIFdoZW4gZGF0YSBpcyBpbml0aWFsbHkgY3JlYXRlZCwgdmlhICgia2V5IiwgInZhbCIpIHNpZ25hdHVyZSwKICAgICAgICAgIC8vIGtleXMgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gY2FtZWxDYXNlLgogICAgICAgICAgLy8gU2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIHRlbGwgX2hvd18gYSBrZXkgd2FzIGFkZGVkLCByZW1vdmUKICAgICAgICAgIC8vIGJvdGggcGxhaW4ga2V5IGFuZCBjYW1lbENhc2Uga2V5LiAjMTI3ODYKICAgICAgICAgIC8vIFRoaXMgd2lsbCBvbmx5IHBlbmFsaXplIHRoZSBhcnJheSBhcmd1bWVudCBwYXRoLgogICAgICAgICAgbmFtZSA9IG5hbWUuY29uY2F0KGpRdWVyeS5tYXAobmFtZSwgalF1ZXJ5LmNhbWVsQ2FzZSkpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBkZWxldGUgdGhpc0NhY2hlW25hbWVbaV1dOwogICAgICAgIH0gLy8gSWYgdGhlcmUgaXMgbm8gZGF0YSBsZWZ0IGluIHRoZSBjYWNoZSwgd2Ugd2FudCB0byBjb250aW51ZQogICAgICAgIC8vIGFuZCBsZXQgdGhlIGNhY2hlIG9iamVjdCBpdHNlbGYgZ2V0IGRlc3Ryb3llZAoKCiAgICAgICAgaWYgKCEocHZ0ID8gaXNFbXB0eURhdGFPYmplY3QgOiBqUXVlcnkuaXNFbXB0eU9iamVjdCkodGhpc0NhY2hlKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBTZWUgalF1ZXJ5LmRhdGEgZm9yIG1vcmUgaW5mb3JtYXRpb24KCgogICAgaWYgKCFwdnQpIHsKICAgICAgZGVsZXRlIGNhY2hlW2lkXS5kYXRhOyAvLyBEb24ndCBkZXN0cm95IHRoZSBwYXJlbnQgY2FjaGUgdW5sZXNzIHRoZSBpbnRlcm5hbCBkYXRhIG9iamVjdAogICAgICAvLyBoYWQgYmVlbiB0aGUgb25seSB0aGluZyBsZWZ0IGluIGl0CgogICAgICBpZiAoIWlzRW1wdHlEYXRhT2JqZWN0KGNhY2hlW2lkXSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gLy8gRGVzdHJveSB0aGUgY2FjaGUKCgogICAgaWYgKGlzTm9kZSkgewogICAgICBqUXVlcnkuY2xlYW5EYXRhKFtlbGVtXSwgdHJ1ZSk7IC8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQogICAgfSBlbHNlIGlmIChqUXVlcnkuc3VwcG9ydC5kZWxldGVFeHBhbmRvIHx8IGNhY2hlICE9IGNhY2hlLndpbmRvdykgewogICAgICBkZWxldGUgY2FjaGVbaWRdOyAvLyBXaGVuIGFsbCBlbHNlIGZhaWxzLCBudWxsCiAgICB9IGVsc2UgewogICAgICBjYWNoZVtpZF0gPSBudWxsOwogICAgfQogIH0KCiAgalF1ZXJ5LmV4dGVuZCh7CiAgICBjYWNoZToge30sCiAgICAvLyBVbmlxdWUgZm9yIGVhY2ggY29weSBvZiBqUXVlcnkgb24gdGhlIHBhZ2UKICAgIC8vIE5vbi1kaWdpdHMgcmVtb3ZlZCB0byBtYXRjaCByaW5saW5lalF1ZXJ5CiAgICBleHBhbmRvOiAialF1ZXJ5IiArIChjb3JlX3ZlcnNpb24gKyBNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCAiIiksCiAgICAvLyBUaGUgZm9sbG93aW5nIGVsZW1lbnRzIHRocm93IHVuY2F0Y2hhYmxlIGV4Y2VwdGlvbnMgaWYgeW91CiAgICAvLyBhdHRlbXB0IHRvIGFkZCBleHBhbmRvIHByb3BlcnRpZXMgdG8gdGhlbS4KICAgIG5vRGF0YTogewogICAgICAiZW1iZWQiOiB0cnVlLAogICAgICAvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQogICAgICAib2JqZWN0IjogImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCIsCiAgICAgICJhcHBsZXQiOiB0cnVlCiAgICB9LAogICAgaGFzRGF0YTogZnVuY3Rpb24gaGFzRGF0YShlbGVtKSB7CiAgICAgIGVsZW0gPSBlbGVtLm5vZGVUeXBlID8galF1ZXJ5LmNhY2hlW2VsZW1balF1ZXJ5LmV4cGFuZG9dXSA6IGVsZW1balF1ZXJ5LmV4cGFuZG9dOwogICAgICByZXR1cm4gISFlbGVtICYmICFpc0VtcHR5RGF0YU9iamVjdChlbGVtKTsKICAgIH0sCiAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKGVsZW0sIG5hbWUsIF9kYXRhKSB7CiAgICAgIHJldHVybiBpbnRlcm5hbERhdGEoZWxlbSwgbmFtZSwgX2RhdGEpOwogICAgfSwKICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uIHJlbW92ZURhdGEoZWxlbSwgbmFtZSkgewogICAgICByZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKGVsZW0sIG5hbWUpOwogICAgfSwKICAgIC8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KICAgIF9kYXRhOiBmdW5jdGlvbiBfZGF0YShlbGVtLCBuYW1lLCBkYXRhKSB7CiAgICAgIHJldHVybiBpbnRlcm5hbERhdGEoZWxlbSwgbmFtZSwgZGF0YSwgdHJ1ZSk7CiAgICB9LAogICAgX3JlbW92ZURhdGE6IGZ1bmN0aW9uIF9yZW1vdmVEYXRhKGVsZW0sIG5hbWUpIHsKICAgICAgcmV0dXJuIGludGVybmFsUmVtb3ZlRGF0YShlbGVtLCBuYW1lLCB0cnVlKTsKICAgIH0sCiAgICAvLyBBIG1ldGhvZCBmb3IgZGV0ZXJtaW5pbmcgaWYgYSBET00gbm9kZSBjYW4gaGFuZGxlIHRoZSBkYXRhIGV4cGFuZG8KICAgIGFjY2VwdERhdGE6IGZ1bmN0aW9uIGFjY2VwdERhdGEoZWxlbSkgewogICAgICAvLyBEbyBub3Qgc2V0IGRhdGEgb24gbm9uLWVsZW1lbnQgYmVjYXVzZSBpdCB3aWxsIG5vdCBiZSBjbGVhcmVkICgjODMzNSkuCiAgICAgIGlmIChlbGVtLm5vZGVUeXBlICYmIGVsZW0ubm9kZVR5cGUgIT09IDEgJiYgZWxlbS5ub2RlVHlwZSAhPT0gOSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIG5vRGF0YSA9IGVsZW0ubm9kZU5hbWUgJiYgalF1ZXJ5Lm5vRGF0YVtlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldOyAvLyBub2RlcyBhY2NlcHQgZGF0YSB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZDsgcmVqZWN0aW9uIGNhbiBiZSBjb25kaXRpb25hbAoKICAgICAgcmV0dXJuICFub0RhdGEgfHwgbm9EYXRhICE9PSB0cnVlICYmIGVsZW0uZ2V0QXR0cmlidXRlKCJjbGFzc2lkIikgPT09IG5vRGF0YTsKICAgIH0KICB9KTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoa2V5LCB2YWx1ZSkgewogICAgICB2YXIgYXR0cnMsCiAgICAgICAgICBuYW1lLAogICAgICAgICAgZWxlbSA9IHRoaXNbMF0sCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGRhdGEgPSBudWxsOyAvLyBHZXRzIGFsbCB2YWx1ZXMKCiAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh0aGlzLmxlbmd0aCkgewogICAgICAgICAgZGF0YSA9IGpRdWVyeS5kYXRhKGVsZW0pOwoKICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxICYmICFqUXVlcnkuX2RhdGEoZWxlbSwgInBhcnNlZEF0dHJzIikpIHsKICAgICAgICAgICAgYXR0cnMgPSBlbGVtLmF0dHJpYnV0ZXM7CgogICAgICAgICAgICBmb3IgKDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgbmFtZSA9IGF0dHJzW2ldLm5hbWU7CgogICAgICAgICAgICAgIGlmICghbmFtZS5pbmRleE9mKCJkYXRhLSIpKSB7CiAgICAgICAgICAgICAgICBuYW1lID0galF1ZXJ5LmNhbWVsQ2FzZShuYW1lLnNsaWNlKDUpKTsKICAgICAgICAgICAgICAgIGRhdGFBdHRyKGVsZW0sIG5hbWUsIGRhdGFbbmFtZV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgalF1ZXJ5Ll9kYXRhKGVsZW0sICJwYXJzZWRBdHRycyIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0gLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCgogICAgICBpZiAoX3R5cGVvZihrZXkpID09PSAib2JqZWN0IikgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgalF1ZXJ5LmRhdGEodGhpcywga2V5KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGpRdWVyeS5hY2Nlc3ModGhpcywgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIFRyeSB0byBmZXRjaCBhbnkgaW50ZXJuYWxseSBzdG9yZWQgZGF0YSBmaXJzdAogICAgICAgICAgcmV0dXJuIGVsZW0gPyBkYXRhQXR0cihlbGVtLCBrZXksIGpRdWVyeS5kYXRhKGVsZW0sIGtleSkpIDogbnVsbDsKICAgICAgICB9CgogICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBqUXVlcnkuZGF0YSh0aGlzLCBrZXksIHZhbHVlKTsKICAgICAgICB9KTsKICAgICAgfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxLCBudWxsLCB0cnVlKTsKICAgIH0sCiAgICByZW1vdmVEYXRhOiBmdW5jdGlvbiByZW1vdmVEYXRhKGtleSkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBqUXVlcnkucmVtb3ZlRGF0YSh0aGlzLCBrZXkpOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gZGF0YUF0dHIoZWxlbSwga2V5LCBkYXRhKSB7CiAgICAvLyBJZiBub3RoaW5nIHdhcyBmb3VuZCBpbnRlcm5hbGx5LCB0cnkgdG8gZmV0Y2ggYW55CiAgICAvLyBkYXRhIGZyb20gdGhlIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGUKICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICB2YXIgbmFtZSA9ICJkYXRhLSIgKyBrZXkucmVwbGFjZShybXVsdGlEYXNoLCAiLSQxIikudG9Mb3dlckNhc2UoKTsKICAgICAgZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKG5hbWUpOwoKICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkYXRhID0gZGF0YSA9PT0gInRydWUiID8gdHJ1ZSA6IGRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6IGRhdGEgPT09ICJudWxsIiA/IG51bGwgOiAvLyBPbmx5IGNvbnZlcnQgdG8gYSBudW1iZXIgaWYgaXQgZG9lc24ndCBjaGFuZ2UgdGhlIHN0cmluZwogICAgICAgICAgK2RhdGEgKyAiIiA9PT0gZGF0YSA/ICtkYXRhIDogcmJyYWNlLnRlc3QoZGF0YSkgPyBqUXVlcnkucGFyc2VKU09OKGRhdGEpIDogZGF0YTsKICAgICAgICB9IGNhdGNoIChlKSB7fSAvLyBNYWtlIHN1cmUgd2Ugc2V0IHRoZSBkYXRhIHNvIGl0IGlzbid0IGNoYW5nZWQgbGF0ZXIKCgogICAgICAgIGpRdWVyeS5kYXRhKGVsZW0sIGtleSwgZGF0YSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBkYXRhOwogIH0gLy8gY2hlY2tzIGEgY2FjaGUgb2JqZWN0IGZvciBlbXB0aW5lc3MKCgogIGZ1bmN0aW9uIGlzRW1wdHlEYXRhT2JqZWN0KG9iaikgewogICAgdmFyIG5hbWU7CgogICAgZm9yIChuYW1lIGluIG9iaikgewogICAgICAvLyBpZiB0aGUgcHVibGljIGRhdGEgb2JqZWN0IGlzIGVtcHR5LCB0aGUgcHJpdmF0ZSBpcyBzdGlsbCBlbXB0eQogICAgICBpZiAobmFtZSA9PT0gImRhdGEiICYmIGpRdWVyeS5pc0VtcHR5T2JqZWN0KG9ialtuYW1lXSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgaWYgKG5hbWUgIT09ICJ0b0pTT04iKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBqUXVlcnkuZXh0ZW5kKHsKICAgIHF1ZXVlOiBmdW5jdGlvbiBxdWV1ZShlbGVtLCB0eXBlLCBkYXRhKSB7CiAgICAgIHZhciBxdWV1ZTsKCiAgICAgIGlmIChlbGVtKSB7CiAgICAgICAgdHlwZSA9ICh0eXBlIHx8ICJmeCIpICsgInF1ZXVlIjsKICAgICAgICBxdWV1ZSA9IGpRdWVyeS5fZGF0YShlbGVtLCB0eXBlKTsgLy8gU3BlZWQgdXAgZGVxdWV1ZSBieSBnZXR0aW5nIG91dCBxdWlja2x5IGlmIHRoaXMgaXMganVzdCBhIGxvb2t1cAoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgaWYgKCFxdWV1ZSB8fCBqUXVlcnkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgICBxdWV1ZSA9IGpRdWVyeS5fZGF0YShlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHF1ZXVlLnB1c2goZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcXVldWUgfHwgW107CiAgICAgIH0KICAgIH0sCiAgICBkZXF1ZXVlOiBmdW5jdGlvbiBkZXF1ZXVlKGVsZW0sIHR5cGUpIHsKICAgICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsKCiAgICAgIHZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZShlbGVtLCB0eXBlKSwKICAgICAgICAgIHN0YXJ0TGVuZ3RoID0gcXVldWUubGVuZ3RoLAogICAgICAgICAgZm4gPSBxdWV1ZS5zaGlmdCgpLAogICAgICAgICAgaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoZWxlbSwgdHlwZSksCiAgICAgICAgICBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICBqUXVlcnkuZGVxdWV1ZShlbGVtLCB0eXBlKTsKICAgICAgfTsgLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoKCiAgICAgIGlmIChmbiA9PT0gImlucHJvZ3Jlc3MiKSB7CiAgICAgICAgZm4gPSBxdWV1ZS5zaGlmdCgpOwogICAgICAgIHN0YXJ0TGVuZ3RoLS07CiAgICAgIH0KCiAgICAgIGhvb2tzLmN1ciA9IGZuOwoKICAgICAgaWYgKGZuKSB7CiAgICAgICAgLy8gQWRkIGEgcHJvZ3Jlc3Mgc2VudGluZWwgdG8gcHJldmVudCB0aGUgZnggcXVldWUgZnJvbSBiZWluZwogICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgZGVxdWV1ZWQKICAgICAgICBpZiAodHlwZSA9PT0gImZ4IikgewogICAgICAgICAgcXVldWUudW5zaGlmdCgiaW5wcm9ncmVzcyIpOwogICAgICAgIH0gLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoKCiAgICAgICAgZGVsZXRlIGhvb2tzLnN0b3A7CiAgICAgICAgZm4uY2FsbChlbGVtLCBuZXh0LCBob29rcyk7CiAgICAgIH0KCiAgICAgIGlmICghc3RhcnRMZW5ndGggJiYgaG9va3MpIHsKICAgICAgICBob29rcy5lbXB0eS5maXJlKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBub3QgaW50ZW5kZWQgZm9yIHB1YmxpYyBjb25zdW1wdGlvbiAtIGdlbmVyYXRlcyBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQogICAgX3F1ZXVlSG9va3M6IGZ1bmN0aW9uIF9xdWV1ZUhvb2tzKGVsZW0sIHR5cGUpIHsKICAgICAgdmFyIGtleSA9IHR5cGUgKyAicXVldWVIb29rcyI7CiAgICAgIHJldHVybiBqUXVlcnkuX2RhdGEoZWxlbSwga2V5KSB8fCBqUXVlcnkuX2RhdGEoZWxlbSwga2V5LCB7CiAgICAgICAgZW1wdHk6IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGpRdWVyeS5fcmVtb3ZlRGF0YShlbGVtLCB0eXBlICsgInF1ZXVlIik7CgogICAgICAgICAgalF1ZXJ5Ll9yZW1vdmVEYXRhKGVsZW0sIGtleSk7CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBxdWV1ZTogZnVuY3Rpb24gcXVldWUodHlwZSwgZGF0YSkgewogICAgICB2YXIgc2V0dGVyID0gMjsKCiAgICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICBkYXRhID0gdHlwZTsKICAgICAgICB0eXBlID0gImZ4IjsKICAgICAgICBzZXR0ZXItLTsKICAgICAgfQoKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCBzZXR0ZXIpIHsKICAgICAgICByZXR1cm4galF1ZXJ5LnF1ZXVlKHRoaXNbMF0sIHR5cGUpOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKHRoaXMsIHR5cGUsIGRhdGEpOyAvLyBlbnN1cmUgYSBob29rcyBmb3IgdGhpcyBxdWV1ZQoKICAgICAgICBqUXVlcnkuX3F1ZXVlSG9va3ModGhpcywgdHlwZSk7CgogICAgICAgIGlmICh0eXBlID09PSAiZngiICYmIHF1ZXVlWzBdICE9PSAiaW5wcm9ncmVzcyIpIHsKICAgICAgICAgIGpRdWVyeS5kZXF1ZXVlKHRoaXMsIHR5cGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZGVxdWV1ZTogZnVuY3Rpb24gZGVxdWV1ZSh0eXBlKSB7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGpRdWVyeS5kZXF1ZXVlKHRoaXMsIHR5cGUpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBCYXNlZCBvZmYgb2YgdGhlIHBsdWdpbiBieSBDbGludCBIZWxmZXJzLCB3aXRoIHBlcm1pc3Npb24uCiAgICAvLyBodHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvCiAgICBkZWxheTogZnVuY3Rpb24gZGVsYXkodGltZSwgdHlwZSkgewogICAgICB0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1t0aW1lXSB8fCB0aW1lIDogdGltZTsKICAgICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsKICAgICAgcmV0dXJuIHRoaXMucXVldWUodHlwZSwgZnVuY3Rpb24gKG5leHQsIGhvb2tzKSB7CiAgICAgICAgdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG5leHQsIHRpbWUpOwoKICAgICAgICBob29rcy5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyUXVldWU6IGZ1bmN0aW9uIGNsZWFyUXVldWUodHlwZSkgewogICAgICByZXR1cm4gdGhpcy5xdWV1ZSh0eXBlIHx8ICJmeCIsIFtdKTsKICAgIH0sCiAgICAvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlCiAgICAvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkKICAgIHByb21pc2U6IGZ1bmN0aW9uIHByb21pc2UodHlwZSwgb2JqKSB7CiAgICAgIHZhciB0bXAsCiAgICAgICAgICBjb3VudCA9IDEsCiAgICAgICAgICBkZWZlciA9IGpRdWVyeS5EZWZlcnJlZCgpLAogICAgICAgICAgZWxlbWVudHMgPSB0aGlzLAogICAgICAgICAgaSA9IHRoaXMubGVuZ3RoLAogICAgICAgICAgcmVzb2x2ZSA9IGZ1bmN0aW9uIHJlc29sdmUoKSB7CiAgICAgICAgaWYgKCEgLS1jb3VudCkgewogICAgICAgICAgZGVmZXIucmVzb2x2ZVdpdGgoZWxlbWVudHMsIFtlbGVtZW50c10pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICBvYmogPSB0eXBlOwogICAgICAgIHR5cGUgPSB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIHR5cGUgPSB0eXBlIHx8ICJmeCI7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdG1wID0galF1ZXJ5Ll9kYXRhKGVsZW1lbnRzW2ldLCB0eXBlICsgInF1ZXVlSG9va3MiKTsKCiAgICAgICAgaWYgKHRtcCAmJiB0bXAuZW1wdHkpIHsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICB0bXAuZW1wdHkuYWRkKHJlc29sdmUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzb2x2ZSgpOwogICAgICByZXR1cm4gZGVmZXIucHJvbWlzZShvYmopOwogICAgfQogIH0pOwogIHZhciBub2RlSG9vaywKICAgICAgYm9vbEhvb2ssCiAgICAgIHJjbGFzcyA9IC9bXHRcclxuXS9nLAogICAgICBycmV0dXJuID0gL1xyL2csCiAgICAgIHJmb2N1c2FibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSwKICAgICAgcmNsaWNrYWJsZSA9IC9eKD86YXxhcmVhKSQvaSwKICAgICAgcmJvb2xlYW4gPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWR8YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkKSQvaSwKICAgICAgcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAogICAgICBnZXRTZXRBdHRyaWJ1dGUgPSBqUXVlcnkuc3VwcG9ydC5nZXRTZXRBdHRyaWJ1dGUsCiAgICAgIGdldFNldElucHV0ID0galF1ZXJ5LnN1cHBvcnQuaW5wdXQ7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBhdHRyOiBmdW5jdGlvbiBhdHRyKG5hbWUsIHZhbHVlKSB7CiAgICAgIHJldHVybiBqUXVlcnkuYWNjZXNzKHRoaXMsIGpRdWVyeS5hdHRyLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEpOwogICAgfSwKICAgIHJlbW92ZUF0dHI6IGZ1bmN0aW9uIHJlbW92ZUF0dHIobmFtZSkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBqUXVlcnkucmVtb3ZlQXR0cih0aGlzLCBuYW1lKTsKICAgICAgfSk7CiAgICB9LAogICAgcHJvcDogZnVuY3Rpb24gcHJvcChuYW1lLCB2YWx1ZSkgewogICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBqUXVlcnkucHJvcCwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxKTsKICAgIH0sCiAgICByZW1vdmVQcm9wOiBmdW5jdGlvbiByZW1vdmVQcm9wKG5hbWUpIHsKICAgICAgbmFtZSA9IGpRdWVyeS5wcm9wRml4W25hbWVdIHx8IG5hbWU7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIC8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgZGVsZXRlIHRoaXNbbmFtZV07CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgfSk7CiAgICB9LAogICAgYWRkQ2xhc3M6IGZ1bmN0aW9uIGFkZENsYXNzKHZhbHVlKSB7CiAgICAgIHZhciBjbGFzc2VzLAogICAgICAgICAgZWxlbSwKICAgICAgICAgIGN1ciwKICAgICAgICAgIGNsYXp6LAogICAgICAgICAgaiwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgbGVuID0gdGhpcy5sZW5ndGgsCiAgICAgICAgICBwcm9jZWVkID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZTsKCiAgICAgIGlmIChqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChqKSB7CiAgICAgICAgICBqUXVlcnkodGhpcykuYWRkQ2xhc3ModmFsdWUuY2FsbCh0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAocHJvY2VlZCkgewogICAgICAgIC8vIFRoZSBkaXNqdW5jdGlvbiBoZXJlIGlzIGZvciBiZXR0ZXIgY29tcHJlc3NpYmlsaXR5IChzZWUgcmVtb3ZlQ2xhc3MpCiAgICAgICAgY2xhc3NlcyA9ICh2YWx1ZSB8fCAiIikubWF0Y2goY29yZV9ybm90d2hpdGUpIHx8IFtdOwoKICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBlbGVtID0gdGhpc1tpXTsKICAgICAgICAgIGN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKGVsZW0uY2xhc3NOYW1lID8gKCIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKSA6ICIgIik7CgogICAgICAgICAgaWYgKGN1cikgewogICAgICAgICAgICBqID0gMDsKCiAgICAgICAgICAgIHdoaWxlIChjbGF6eiA9IGNsYXNzZXNbaisrXSkgewogICAgICAgICAgICAgIGlmIChjdXIuaW5kZXhPZigiICIgKyBjbGF6eiArICIgIikgPCAwKSB7CiAgICAgICAgICAgICAgICBjdXIgKz0gY2xhenogKyAiICI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGpRdWVyeS50cmltKGN1cik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICByZW1vdmVDbGFzczogZnVuY3Rpb24gcmVtb3ZlQ2xhc3ModmFsdWUpIHsKICAgICAgdmFyIGNsYXNzZXMsCiAgICAgICAgICBlbGVtLAogICAgICAgICAgY3VyLAogICAgICAgICAgY2xhenosCiAgICAgICAgICBqLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBsZW4gPSB0aGlzLmxlbmd0aCwKICAgICAgICAgIHByb2NlZWQgPSBhcmd1bWVudHMubGVuZ3RoID09PSAwIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7CgogICAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaikgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKHZhbHVlLmNhbGwodGhpcywgaiwgdGhpcy5jbGFzc05hbWUpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHByb2NlZWQpIHsKICAgICAgICBjbGFzc2VzID0gKHZhbHVlIHx8ICIiKS5tYXRjaChjb3JlX3Jub3R3aGl0ZSkgfHwgW107CgogICAgICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGVsZW0gPSB0aGlzW2ldOyAvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoKICAgICAgICAgIGN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKGVsZW0uY2xhc3NOYW1lID8gKCIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKSA6ICIiKTsKCiAgICAgICAgICBpZiAoY3VyKSB7CiAgICAgICAgICAgIGogPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSB7CiAgICAgICAgICAgICAgLy8gUmVtb3ZlICphbGwqIGluc3RhbmNlcwogICAgICAgICAgICAgIHdoaWxlIChjdXIuaW5kZXhPZigiICIgKyBjbGF6eiArICIgIikgPj0gMCkgewogICAgICAgICAgICAgICAgY3VyID0gY3VyLnJlcGxhY2UoIiAiICsgY2xhenogKyAiICIsICIgIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IHZhbHVlID8galF1ZXJ5LnRyaW0oY3VyKSA6ICIiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uIHRvZ2dsZUNsYXNzKHZhbHVlLCBzdGF0ZVZhbCkgewogICAgICB2YXIgdHlwZSA9IF90eXBlb2YodmFsdWUpLAogICAgICAgICAgaXNCb29sID0gdHlwZW9mIHN0YXRlVmFsID09PSAiYm9vbGVhbiI7CgogICAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnRvZ2dsZUNsYXNzKHZhbHVlLmNhbGwodGhpcywgaSwgdGhpcy5jbGFzc05hbWUsIHN0YXRlVmFsKSwgc3RhdGVWYWwpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodHlwZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIC8vIHRvZ2dsZSBpbmRpdmlkdWFsIGNsYXNzIG5hbWVzCiAgICAgICAgICB2YXIgY2xhc3NOYW1lLAogICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgIHNlbGYgPSBqUXVlcnkodGhpcyksCiAgICAgICAgICAgICAgc3RhdGUgPSBzdGF0ZVZhbCwKICAgICAgICAgICAgICBjbGFzc05hbWVzID0gdmFsdWUubWF0Y2goY29yZV9ybm90d2hpdGUpIHx8IFtdOwoKICAgICAgICAgIHdoaWxlIChjbGFzc05hbWUgPSBjbGFzc05hbWVzW2krK10pIHsKICAgICAgICAgICAgLy8gY2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGFyYXRlZCBsaXN0CiAgICAgICAgICAgIHN0YXRlID0gaXNCb29sID8gc3RhdGUgOiAhc2VsZi5oYXNDbGFzcyhjbGFzc05hbWUpOwogICAgICAgICAgICBzZWxmW3N0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyJdKGNsYXNzTmFtZSk7CiAgICAgICAgICB9IC8vIFRvZ2dsZSB3aG9sZSBjbGFzcyBuYW1lCgogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgfHwgdHlwZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICBpZiAodGhpcy5jbGFzc05hbWUpIHsKICAgICAgICAgICAgLy8gc3RvcmUgY2xhc3NOYW1lIGlmIHNldAogICAgICAgICAgICBqUXVlcnkuX2RhdGEodGhpcywgIl9fY2xhc3NOYW1lX18iLCB0aGlzLmNsYXNzTmFtZSk7CiAgICAgICAgICB9IC8vIElmIHRoZSBlbGVtZW50IGhhcyBhIGNsYXNzIG5hbWUgb3IgaWYgd2UncmUgcGFzc2VkICJmYWxzZSIsCiAgICAgICAgICAvLyB0aGVuIHJlbW92ZSB0aGUgd2hvbGUgY2xhc3NuYW1lIChpZiB0aGVyZSB3YXMgb25lLCB0aGUgYWJvdmUgc2F2ZWQgaXQpLgogICAgICAgICAgLy8gT3RoZXJ3aXNlIGJyaW5nIGJhY2sgd2hhdGV2ZXIgd2FzIHByZXZpb3VzbHkgc2F2ZWQgKGlmIGFueXRoaW5nKSwKICAgICAgICAgIC8vIGZhbGxpbmcgYmFjayB0byB0aGUgZW1wdHkgc3RyaW5nIGlmIG5vdGhpbmcgd2FzIHN0b3JlZC4KCgogICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZSB8fCB2YWx1ZSA9PT0gZmFsc2UgPyAiIiA6IGpRdWVyeS5fZGF0YSh0aGlzLCAiX19jbGFzc05hbWVfXyIpIHx8ICIiOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaGFzQ2xhc3M6IGZ1bmN0aW9uIGhhc0NsYXNzKHNlbGVjdG9yKSB7CiAgICAgIHZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgbCA9IHRoaXMubGVuZ3RoOwoKICAgICAgZm9yICg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAodGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoY2xhc3NOYW1lKSA+PSAwKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICB2YWw6IGZ1bmN0aW9uIHZhbCh2YWx1ZSkgewogICAgICB2YXIgcmV0LAogICAgICAgICAgaG9va3MsCiAgICAgICAgICBpc0Z1bmN0aW9uLAogICAgICAgICAgZWxlbSA9IHRoaXNbMF07CgogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICBpZiAoZWxlbSkgewogICAgICAgICAgaG9va3MgPSBqUXVlcnkudmFsSG9va3NbZWxlbS50eXBlXSB8fCBqUXVlcnkudmFsSG9va3NbZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTsKCiAgICAgICAgICBpZiAoaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldChlbGVtLCAidmFsdWUiKSkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgICAgfQoKICAgICAgICAgIHJldCA9IGVsZW0udmFsdWU7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPyAvLyBoYW5kbGUgbW9zdCBjb21tb24gc3RyaW5nIGNhc2VzCiAgICAgICAgICByZXQucmVwbGFjZShycmV0dXJuLCAiIikgOiAvLyBoYW5kbGUgY2FzZXMgd2hlcmUgdmFsdWUgaXMgbnVsbC91bmRlZiBvciBudW1iZXIKICAgICAgICAgIHJldCA9PSBudWxsID8gIiIgOiByZXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSk7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICB2YXIgdmFsLAogICAgICAgICAgICBzZWxmID0galF1ZXJ5KHRoaXMpOwoKICAgICAgICBpZiAodGhpcy5ub2RlVHlwZSAhPT0gMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzRnVuY3Rpb24pIHsKICAgICAgICAgIHZhbCA9IHZhbHVlLmNhbGwodGhpcywgaSwgc2VsZi52YWwoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IHZhbHVlOwogICAgICAgIH0gLy8gVHJlYXQgbnVsbC91bmRlZmluZWQgYXMgIiI7IGNvbnZlcnQgbnVtYmVycyB0byBzdHJpbmcKCgogICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgdmFsID0gIiI7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAibnVtYmVyIikgewogICAgICAgICAgdmFsICs9ICIiOwogICAgICAgIH0gZWxzZSBpZiAoalF1ZXJ5LmlzQXJyYXkodmFsKSkgewogICAgICAgICAgdmFsID0galF1ZXJ5Lm1hcCh2YWwsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaG9va3MgPSBqUXVlcnkudmFsSG9va3NbdGhpcy50eXBlXSB8fCBqUXVlcnkudmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTsgLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCiAgICAgICAgaWYgKCFob29rcyB8fCAhKCJzZXQiIGluIGhvb2tzKSB8fCBob29rcy5zZXQodGhpcywgdmFsLCAidmFsdWUiKSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmV4dGVuZCh7CiAgICB2YWxIb29rczogewogICAgICBvcHRpb246IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICAvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXQKICAgICAgICAgIC8vIHVzZXMgLnZhbHVlLiBTZWUgIzY5MzIKICAgICAgICAgIHZhciB2YWwgPSBlbGVtLmF0dHJpYnV0ZXMudmFsdWU7CiAgICAgICAgICByZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNlbGVjdDogewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGVsZW0pIHsKICAgICAgICAgIHZhciB2YWx1ZSwKICAgICAgICAgICAgICBvcHRpb24sCiAgICAgICAgICAgICAgb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywKICAgICAgICAgICAgICBpbmRleCA9IGVsZW0uc2VsZWN0ZWRJbmRleCwKICAgICAgICAgICAgICBvbmUgPSBlbGVtLnR5cGUgPT09ICJzZWxlY3Qtb25lIiB8fCBpbmRleCA8IDAsCiAgICAgICAgICAgICAgdmFsdWVzID0gb25lID8gbnVsbCA6IFtdLAogICAgICAgICAgICAgIG1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoLAogICAgICAgICAgICAgIGkgPSBpbmRleCA8IDAgPyBtYXggOiBvbmUgPyBpbmRleCA6IDA7IC8vIExvb3AgdGhyb3VnaCBhbGwgdGhlIHNlbGVjdGVkIG9wdGlvbnMKCiAgICAgICAgICBmb3IgKDsgaSA8IG1heDsgaSsrKSB7CiAgICAgICAgICAgIG9wdGlvbiA9IG9wdGlvbnNbaV07IC8vIG9sZElFIGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoKICAgICAgICAgICAgaWYgKChvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXgpICYmICggLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAogICAgICAgICAgICBqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09PSBudWxsKSAmJiAoIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUob3B0aW9uLnBhcmVudE5vZGUsICJvcHRncm91cCIpKSkgewogICAgICAgICAgICAgIC8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KICAgICAgICAgICAgICB2YWx1ZSA9IGpRdWVyeShvcHRpb24pLnZhbCgpOyAvLyBXZSBkb24ndCBuZWVkIGFuIGFycmF5IGZvciBvbmUgc2VsZWN0cwoKICAgICAgICAgICAgICBpZiAob25lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgfSAvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheQoKCiAgICAgICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHZhbHVlczsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0sIHZhbHVlKSB7CiAgICAgICAgICB2YXIgdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSh2YWx1ZSk7CiAgICAgICAgICBqUXVlcnkoZWxlbSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBqUXVlcnkuaW5BcnJheShqUXVlcnkodGhpcykudmFsKCksIHZhbHVlcykgPj0gMDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghdmFsdWVzLmxlbmd0aCkgewogICAgICAgICAgICBlbGVtLnNlbGVjdGVkSW5kZXggPSAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdmFsdWVzOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGF0dHI6IGZ1bmN0aW9uIGF0dHIoZWxlbSwgbmFtZSwgdmFsdWUpIHsKICAgICAgdmFyIGhvb2tzLAogICAgICAgICAgbm90eG1sLAogICAgICAgICAgcmV0LAogICAgICAgICAgblR5cGUgPSBlbGVtLm5vZGVUeXBlOyAvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgogICAgICBpZiAoIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCgogICAgICBpZiAoX3R5cGVvZihlbGVtLmdldEF0dHJpYnV0ZSkgPT09IGNvcmVfc3RydW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGpRdWVyeS5wcm9wKGVsZW0sIG5hbWUsIHZhbHVlKTsKICAgICAgfQoKICAgICAgbm90eG1sID0gblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyhlbGVtKTsgLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZQogICAgICAvLyBHcmFiIG5lY2Vzc2FyeSBob29rIGlmIG9uZSBpcyBkZWZpbmVkCgogICAgICBpZiAobm90eG1sKSB7CiAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICBob29rcyA9IGpRdWVyeS5hdHRySG9va3NbbmFtZV0gfHwgKHJib29sZWFuLnRlc3QobmFtZSkgPyBib29sSG9vayA6IG5vZGVIb29rKTsKICAgICAgfQoKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgIGpRdWVyeS5yZW1vdmVBdHRyKGVsZW0sIG5hbWUpOwogICAgICAgIH0gZWxzZSBpZiAoaG9va3MgJiYgbm90eG1sICYmICJzZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5zZXQoZWxlbSwgdmFsdWUsIG5hbWUpKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSArICIiKTsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaG9va3MgJiYgbm90eG1sICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoZWxlbSwgbmFtZSkpICE9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJbiBJRTkrLCBGbGFzaCBvYmplY3RzIGRvbid0IGhhdmUgLmdldEF0dHJpYnV0ZSAoIzEyOTQ1KQogICAgICAgIC8vIFN1cHBvcnQ6IElFOSsKICAgICAgICBpZiAoX3R5cGVvZihlbGVtLmdldEF0dHJpYnV0ZSkgIT09IGNvcmVfc3RydW5kZWZpbmVkKSB7CiAgICAgICAgICByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgICB9IC8vIE5vbi1leGlzdGVudCBhdHRyaWJ1dGVzIHJldHVybiBudWxsLCB3ZSBub3JtYWxpemUgdG8gdW5kZWZpbmVkCgoKICAgICAgICByZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVBdHRyOiBmdW5jdGlvbiByZW1vdmVBdHRyKGVsZW0sIHZhbHVlKSB7CiAgICAgIHZhciBuYW1lLAogICAgICAgICAgcHJvcE5hbWUsCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGF0dHJOYW1lcyA9IHZhbHVlICYmIHZhbHVlLm1hdGNoKGNvcmVfcm5vdHdoaXRlKTsKCiAgICAgIGlmIChhdHRyTmFtZXMgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgIHdoaWxlIChuYW1lID0gYXR0ck5hbWVzW2krK10pIHsKICAgICAgICAgIHByb3BOYW1lID0galF1ZXJ5LnByb3BGaXhbbmFtZV0gfHwgbmFtZTsgLy8gQm9vbGVhbiBhdHRyaWJ1dGVzIGdldCBzcGVjaWFsIHRyZWF0bWVudCAoIzEwODcwKQoKICAgICAgICAgIGlmIChyYm9vbGVhbi50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgIC8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlIGZvciBib29sZWFuIGF0dHJpYnV0ZXMKICAgICAgICAgICAgLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKSBmb3IgSUU8OAogICAgICAgICAgICBpZiAoIWdldFNldEF0dHJpYnV0ZSAmJiBydXNlRGVmYXVsdC50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgZWxlbVtqUXVlcnkuY2FtZWxDYXNlKCJkZWZhdWx0LSIgKyBuYW1lKV0gPSBlbGVtW3Byb3BOYW1lXSA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGVsZW1bcHJvcE5hbWVdID0gZmFsc2U7CiAgICAgICAgICAgIH0gLy8gU2VlICM5Njk5IGZvciBleHBsYW5hdGlvbiBvZiB0aGlzIGFwcHJvYWNoIChzZXR0aW5nIGZpcnN0LCB0aGVuIHJlbW92YWwpCgogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgalF1ZXJ5LmF0dHIoZWxlbSwgbmFtZSwgIiIpOwogICAgICAgICAgfQoKICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKGdldFNldEF0dHJpYnV0ZSA/IG5hbWUgOiBwcm9wTmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYXR0ckhvb2tzOiB7CiAgICAgIHR5cGU6IHsKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSkgewogICAgICAgICAgaWYgKCFqUXVlcnkuc3VwcG9ydC5yYWRpb1ZhbHVlICYmIHZhbHVlID09PSAicmFkaW8iICYmIGpRdWVyeS5ub2RlTmFtZShlbGVtLCAiaW5wdXQiKSkgewogICAgICAgICAgICAvLyBTZXR0aW5nIHRoZSB0eXBlIG9uIGEgcmFkaW8gYnV0dG9uIGFmdGVyIHRoZSB2YWx1ZSByZXNldHMgdGhlIHZhbHVlIGluIElFNi05CiAgICAgICAgICAgIC8vIFJlc2V0IHZhbHVlIHRvIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZSBkdXJpbmcgY3JlYXRpb24KICAgICAgICAgICAgdmFyIHZhbCA9IGVsZW0udmFsdWU7CiAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCJ0eXBlIiwgdmFsdWUpOwoKICAgICAgICAgICAgaWYgKHZhbCkgewogICAgICAgICAgICAgIGVsZW0udmFsdWUgPSB2YWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBwcm9wRml4OiB7CiAgICAgIHRhYmluZGV4OiAidGFiSW5kZXgiLAogICAgICByZWFkb25seTogInJlYWRPbmx5IiwKICAgICAgImZvciI6ICJodG1sRm9yIiwKICAgICAgImNsYXNzIjogImNsYXNzTmFtZSIsCiAgICAgIG1heGxlbmd0aDogIm1heExlbmd0aCIsCiAgICAgIGNlbGxzcGFjaW5nOiAiY2VsbFNwYWNpbmciLAogICAgICBjZWxscGFkZGluZzogImNlbGxQYWRkaW5nIiwKICAgICAgcm93c3BhbjogInJvd1NwYW4iLAogICAgICBjb2xzcGFuOiAiY29sU3BhbiIsCiAgICAgIHVzZW1hcDogInVzZU1hcCIsCiAgICAgIGZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLAogICAgICBjb250ZW50ZWRpdGFibGU6ICJjb250ZW50RWRpdGFibGUiCiAgICB9LAogICAgcHJvcDogZnVuY3Rpb24gcHJvcChlbGVtLCBuYW1lLCB2YWx1ZSkgewogICAgICB2YXIgcmV0LAogICAgICAgICAgaG9va3MsCiAgICAgICAgICBub3R4bWwsCiAgICAgICAgICBuVHlwZSA9IGVsZW0ubm9kZVR5cGU7IC8vIGRvbid0IGdldC9zZXQgcHJvcGVydGllcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMKCiAgICAgIGlmICghZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbm90eG1sID0gblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyhlbGVtKTsKCiAgICAgIGlmIChub3R4bWwpIHsKICAgICAgICAvLyBGaXggbmFtZSBhbmQgYXR0YWNoIGhvb2tzCiAgICAgICAgbmFtZSA9IGpRdWVyeS5wcm9wRml4W25hbWVdIHx8IG5hbWU7CiAgICAgICAgaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzW25hbWVdOwogICAgICB9CgogICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChob29rcyAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KGVsZW0sIHZhbHVlLCBuYW1lKSkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGVsZW1bbmFtZV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoZWxlbSwgbmFtZSkpICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZWxlbVtuYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBwcm9wSG9va3M6IHsKICAgICAgdGFiSW5kZXg6IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICAvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CiAgICAgICAgICAvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0LwogICAgICAgICAgdmFyIGF0dHJpYnV0ZU5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInRhYmluZGV4Iik7CiAgICAgICAgICByZXR1cm4gYXR0cmlidXRlTm9kZSAmJiBhdHRyaWJ1dGVOb2RlLnNwZWNpZmllZCA/IHBhcnNlSW50KGF0dHJpYnV0ZU5vZGUudmFsdWUsIDEwKSA6IHJmb2N1c2FibGUudGVzdChlbGVtLm5vZGVOYW1lKSB8fCByY2xpY2thYmxlLnRlc3QoZWxlbS5ub2RlTmFtZSkgJiYgZWxlbS5ocmVmID8gMCA6IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsgLy8gSG9vayBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCgogIGJvb2xIb29rID0gewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSwgbmFtZSkgewogICAgICB2YXIgLy8gVXNlIC5wcm9wIHRvIGRldGVybWluZSBpZiB0aGlzIGF0dHJpYnV0ZSBpcyB1bmRlcnN0b29kIGFzIGJvb2xlYW4KICAgICAgcHJvcCA9IGpRdWVyeS5wcm9wKGVsZW0sIG5hbWUpLAogICAgICAgICAgLy8gRmV0Y2ggaXQgYWNjb3JkaW5nbHkKICAgICAgYXR0ciA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSksCiAgICAgICAgICBkZXRhaWwgPSB0eXBlb2YgcHJvcCA9PT0gImJvb2xlYW4iID8gZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlID8gYXR0ciAhPSBudWxsIDogLy8gb2xkSUUgZmFicmljYXRlcyBhbiBlbXB0eSBzdHJpbmcgZm9yIG1pc3NpbmcgYm9vbGVhbiBhdHRyaWJ1dGVzCiAgICAgIC8vIGFuZCBjb25mbGF0ZXMgY2hlY2tlZC9zZWxlY3RlZCBpbnRvIGF0dHJvcGVydGllcwogICAgICBydXNlRGVmYXVsdC50ZXN0KG5hbWUpID8gZWxlbVtqUXVlcnkuY2FtZWxDYXNlKCJkZWZhdWx0LSIgKyBuYW1lKV0gOiAhIWF0dHIgOiAvLyBmZXRjaCBhbiBhdHRyaWJ1dGUgbm9kZSBmb3IgcHJvcGVydGllcyBub3QgcmVjb2duaXplZCBhcyBib29sZWFuCiAgICAgIGVsZW0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKTsKICAgICAgcmV0dXJuIGRldGFpbCAmJiBkZXRhaWwudmFsdWUgIT09IGZhbHNlID8gbmFtZS50b0xvd2VyQ2FzZSgpIDogdW5kZWZpbmVkOwogICAgfSwKICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0sIHZhbHVlLCBuYW1lKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UpIHsKICAgICAgICAvLyBSZW1vdmUgYm9vbGVhbiBhdHRyaWJ1dGVzIHdoZW4gc2V0IHRvIGZhbHNlCiAgICAgICAgalF1ZXJ5LnJlbW92ZUF0dHIoZWxlbSwgbmFtZSk7CiAgICAgIH0gZWxzZSBpZiAoZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlIHx8ICFydXNlRGVmYXVsdC50ZXN0KG5hbWUpKSB7CiAgICAgICAgLy8gSUU8OCBuZWVkcyB0aGUgKnByb3BlcnR5KiBuYW1lCiAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoIWdldFNldEF0dHJpYnV0ZSAmJiBqUXVlcnkucHJvcEZpeFtuYW1lXSB8fCBuYW1lLCBuYW1lKTsgLy8gVXNlIGRlZmF1bHRDaGVja2VkIGFuZCBkZWZhdWx0U2VsZWN0ZWQgZm9yIG9sZElFCiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbVtqUXVlcnkuY2FtZWxDYXNlKCJkZWZhdWx0LSIgKyBuYW1lKV0gPSBlbGVtW25hbWVdID0gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CiAgfTsgLy8gZml4IG9sZElFIHZhbHVlIGF0dHJvcGVydHkKCiAgaWYgKCFnZXRTZXRJbnB1dCB8fCAhZ2V0U2V0QXR0cmlidXRlKSB7CiAgICBqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtLCBuYW1lKSB7CiAgICAgICAgdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKTsKICAgICAgICByZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKGVsZW0sICJpbnB1dCIpID8gLy8gSWdub3JlIHRoZSB2YWx1ZSAqcHJvcGVydHkqIGJ5IHVzaW5nIGRlZmF1bHRWYWx1ZQogICAgICAgIGVsZW0uZGVmYXVsdFZhbHVlIDogcmV0ICYmIHJldC5zcGVjaWZpZWQgPyByZXQudmFsdWUgOiB1bmRlZmluZWQ7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0sIHZhbHVlLCBuYW1lKSB7CiAgICAgICAgaWYgKGpRdWVyeS5ub2RlTmFtZShlbGVtLCAiaW5wdXQiKSkgewogICAgICAgICAgLy8gRG9lcyBub3QgcmV0dXJuIHNvIHRoYXQgc2V0QXR0cmlidXRlIGlzIGFsc28gdXNlZAogICAgICAgICAgZWxlbS5kZWZhdWx0VmFsdWUgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gVXNlIG5vZGVIb29rIGlmIGRlZmluZWQgKCMxOTU0KTsgb3RoZXJ3aXNlIHNldEF0dHJpYnV0ZSBpcyBmaW5lCiAgICAgICAgICByZXR1cm4gbm9kZUhvb2sgJiYgbm9kZUhvb2suc2V0KGVsZW0sIHZhbHVlLCBuYW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSAvLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQoKCiAgaWYgKCFnZXRTZXRBdHRyaWJ1dGUpIHsKICAgIC8vIFVzZSB0aGlzIGZvciBhbnkgYXR0cmlidXRlIGluIElFNi83CiAgICAvLyBUaGlzIGZpeGVzIGFsbW9zdCBldmVyeSBJRTYvNyBpc3N1ZQogICAgbm9kZUhvb2sgPSBqUXVlcnkudmFsSG9va3MuYnV0dG9uID0gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtLCBuYW1lKSB7CiAgICAgICAgdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKTsKICAgICAgICByZXR1cm4gcmV0ICYmIChuYW1lID09PSAiaWQiIHx8IG5hbWUgPT09ICJuYW1lIiB8fCBuYW1lID09PSAiY29vcmRzIiA/IHJldC52YWx1ZSAhPT0gIiIgOiByZXQuc3BlY2lmaWVkKSA/IHJldC52YWx1ZSA6IHVuZGVmaW5lZDsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZWxlbSwgdmFsdWUsIG5hbWUpIHsKICAgICAgICAvLyBTZXQgdGhlIGV4aXN0aW5nIG9yIGNyZWF0ZSBhIG5ldyBhdHRyaWJ1dGUgbm9kZQogICAgICAgIHZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUobmFtZSk7CgogICAgICAgIGlmICghcmV0KSB7CiAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZU5vZGUocmV0ID0gZWxlbS5vd25lckRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShuYW1lKSk7CiAgICAgICAgfQoKICAgICAgICByZXQudmFsdWUgPSB2YWx1ZSArPSAiIjsgLy8gQnJlYWsgYXNzb2NpYXRpb24gd2l0aCBjbG9uZWQgZWxlbWVudHMgYnkgYWxzbyB1c2luZyBzZXRBdHRyaWJ1dGUgKCM5NjQ2KQoKICAgICAgICByZXR1cm4gbmFtZSA9PT0gInZhbHVlIiB8fCB2YWx1ZSA9PT0gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDsKICAgICAgfQogICAgfTsgLy8gU2V0IGNvbnRlbnRlZGl0YWJsZSB0byBmYWxzZSBvbiByZW1vdmFscygjMTA0MjkpCiAgICAvLyBTZXR0aW5nIHRvIGVtcHR5IHN0cmluZyB0aHJvd3MgYW4gZXJyb3IgYXMgYW4gaW52YWxpZCB2YWx1ZQoKICAgIGpRdWVyeS5hdHRySG9va3MuY29udGVudGVkaXRhYmxlID0gewogICAgICBnZXQ6IG5vZGVIb29rLmdldCwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZWxlbSwgdmFsdWUsIG5hbWUpIHsKICAgICAgICBub2RlSG9vay5zZXQoZWxlbSwgdmFsdWUgPT09ICIiID8gZmFsc2UgOiB2YWx1ZSwgbmFtZSk7CiAgICAgIH0KICAgIH07IC8vIFNldCB3aWR0aCBhbmQgaGVpZ2h0IHRvIGF1dG8gaW5zdGVhZCBvZiAwIG9uIGVtcHR5IHN0cmluZyggQnVnICM4MTUwICkKICAgIC8vIFRoaXMgaXMgZm9yIHJlbW92YWxzCgogICAgalF1ZXJ5LmVhY2goWyJ3aWR0aCIsICJoZWlnaHQiXSwgZnVuY3Rpb24gKGksIG5hbWUpIHsKICAgICAgalF1ZXJ5LmF0dHJIb29rc1tuYW1lXSA9IGpRdWVyeS5leHRlbmQoalF1ZXJ5LmF0dHJIb29rc1tuYW1lXSwgewogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0sIHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT09ICIiKSB7CiAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKG5hbWUsICJhdXRvIik7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSAvLyBTb21lIGF0dHJpYnV0ZXMgcmVxdWlyZSBhIHNwZWNpYWwgY2FsbCBvbiBJRQogIC8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKCgogIGlmICghalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQpIHsKICAgIGpRdWVyeS5lYWNoKFsiaHJlZiIsICJzcmMiLCAid2lkdGgiLCAiaGVpZ2h0Il0sIGZ1bmN0aW9uIChpLCBuYW1lKSB7CiAgICAgIGpRdWVyeS5hdHRySG9va3NbbmFtZV0gPSBqUXVlcnkuZXh0ZW5kKGpRdWVyeS5hdHRySG9va3NbbmFtZV0sIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICB2YXIgcmV0ID0gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSwgMik7CiAgICAgICAgICByZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOyAvLyBocmVmL3NyYyBwcm9wZXJ0eSBzaG91bGQgZ2V0IHRoZSBmdWxsIG5vcm1hbGl6ZWQgVVJMICgjMTAyOTkvIzEyOTE1KQoKICAgIGpRdWVyeS5lYWNoKFsiaHJlZiIsICJzcmMiXSwgZnVuY3Rpb24gKGksIG5hbWUpIHsKICAgICAgalF1ZXJ5LnByb3BIb29rc1tuYW1lXSA9IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSwgNCk7CiAgICAgICAgfQogICAgICB9OwogICAgfSk7CiAgfQoKICBpZiAoIWpRdWVyeS5zdXBwb3J0LnN0eWxlKSB7CiAgICBqUXVlcnkuYXR0ckhvb2tzLnN0eWxlID0gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgLy8gUmV0dXJuIHVuZGVmaW5lZCBpbiB0aGUgY2FzZSBvZiBlbXB0eSBzdHJpbmcKICAgICAgICAvLyBOb3RlOiBJRSB1cHBlcmNhc2VzIGNzcyBwcm9wZXJ0eSBuYW1lcywgYnV0IGlmIHdlIHdlcmUgdG8gLnRvTG93ZXJDYXNlKCkKICAgICAgICAvLyAuY3NzVGV4dCwgdGhhdCB3b3VsZCBkZXN0cm95IGNhc2Ugc2Vuc3RpdGl2aXR5IGluIFVSTCdzLCBsaWtlIGluICJiYWNrZ3JvdW5kIgogICAgICAgIHJldHVybiBlbGVtLnN0eWxlLmNzc1RleHQgfHwgdW5kZWZpbmVkOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSkgewogICAgICAgIHJldHVybiBlbGVtLnN0eWxlLmNzc1RleHQgPSB2YWx1ZSArICIiOwogICAgICB9CiAgICB9OwogIH0gLy8gU2FmYXJpIG1pcy1yZXBvcnRzIHRoZSBkZWZhdWx0IHNlbGVjdGVkIHByb3BlcnR5IG9mIGFuIG9wdGlvbgogIC8vIEFjY2Vzc2luZyB0aGUgcGFyZW50J3Mgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eSBmaXhlcyBpdAoKCiAgaWYgKCFqUXVlcnkuc3VwcG9ydC5vcHRTZWxlY3RlZCkgewogICAgalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IGpRdWVyeS5leHRlbmQoalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCiAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgcGFyZW50LnNlbGVjdGVkSW5kZXg7IC8vIE1ha2Ugc3VyZSB0aGF0IGl0IGFsc28gd29ya3Mgd2l0aCBvcHRncm91cHMsIHNlZSAjNTcwMQoKICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50Tm9kZSkgewogICAgICAgICAgICBwYXJlbnQucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0pOwogIH0gLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCgoKICBpZiAoIWpRdWVyeS5zdXBwb3J0LmVuY3R5cGUpIHsKICAgIGpRdWVyeS5wcm9wRml4LmVuY3R5cGUgPSAiZW5jb2RpbmciOwogIH0gLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKCgogIGlmICghalF1ZXJ5LnN1cHBvcnQuY2hlY2tPbikgewogICAgalF1ZXJ5LmVhY2goWyJyYWRpbyIsICJjaGVja2JveCJdLCBmdW5jdGlvbiAoKSB7CiAgICAgIGpRdWVyeS52YWxIb29rc1t0aGlzXSA9IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgaW4gV2Via2l0ICIiIGlzIHJldHVybmVkIGluc3RlYWQgb2YgIm9uIiBpZiBhIHZhbHVlIGlzbid0IHNwZWNpZmllZAogICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CiAgICAgICAgfQogICAgICB9OwogICAgfSk7CiAgfQoKICBqUXVlcnkuZWFjaChbInJhZGlvIiwgImNoZWNrYm94Il0sIGZ1bmN0aW9uICgpIHsKICAgIGpRdWVyeS52YWxIb29rc1t0aGlzXSA9IGpRdWVyeS5leHRlbmQoalF1ZXJ5LnZhbEhvb2tzW3RoaXNdLCB7CiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0sIHZhbHVlKSB7CiAgICAgICAgaWYgKGpRdWVyeS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgcmV0dXJuIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KGpRdWVyeShlbGVtKS52YWwoKSwgdmFsdWUpID49IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9KTsKICB2YXIgcmZvcm1FbGVtcyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhKSQvaSwKICAgICAgcmtleUV2ZW50ID0gL15rZXkvLAogICAgICBybW91c2VFdmVudCA9IC9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLywKICAgICAgcmZvY3VzTW9ycGggPSAvXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sCiAgICAgIHJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkkLzsKCiAgZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIC8qDQogICAqIEhlbHBlciBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIGV2ZW50cyAtLSBub3QgcGFydCBvZiB0aGUgcHVibGljIGludGVyZmFjZS4NCiAgICogUHJvcHMgdG8gRGVhbiBFZHdhcmRzJyBhZGRFdmVudCBsaWJyYXJ5IGZvciBtYW55IG9mIHRoZSBpZGVhcy4NCiAgICovCgoKICBqUXVlcnkuZXZlbnQgPSB7CiAgICBnbG9iYWw6IHt9LAogICAgYWRkOiBmdW5jdGlvbiBhZGQoZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yKSB7CiAgICAgIHZhciB0bXAsCiAgICAgICAgICBldmVudHMsCiAgICAgICAgICB0LAogICAgICAgICAgaGFuZGxlT2JqSW4sCiAgICAgICAgICBzcGVjaWFsLAogICAgICAgICAgZXZlbnRIYW5kbGUsCiAgICAgICAgICBoYW5kbGVPYmosCiAgICAgICAgICBoYW5kbGVycywKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBuYW1lc3BhY2VzLAogICAgICAgICAgb3JpZ1R5cGUsCiAgICAgICAgICBlbGVtRGF0YSA9IGpRdWVyeS5fZGF0YShlbGVtKTsgLy8gRG9uJ3QgYXR0YWNoIGV2ZW50cyB0byBub0RhdGEgb3IgdGV4dC9jb21tZW50IG5vZGVzIChidXQgYWxsb3cgcGxhaW4gb2JqZWN0cykKCgogICAgICBpZiAoIWVsZW1EYXRhKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENhbGxlciBjYW4gcGFzcyBpbiBhbiBvYmplY3Qgb2YgY3VzdG9tIGRhdGEgaW4gbGlldSBvZiB0aGUgaGFuZGxlcgoKCiAgICAgIGlmIChoYW5kbGVyLmhhbmRsZXIpIHsKICAgICAgICBoYW5kbGVPYmpJbiA9IGhhbmRsZXI7CiAgICAgICAgaGFuZGxlciA9IGhhbmRsZU9iakluLmhhbmRsZXI7CiAgICAgICAgc2VsZWN0b3IgPSBoYW5kbGVPYmpJbi5zZWxlY3RvcjsKICAgICAgfSAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXIKCgogICAgICBpZiAoIWhhbmRsZXIuZ3VpZCkgewogICAgICAgIGhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CiAgICAgIH0gLy8gSW5pdCB0aGUgZWxlbWVudCdzIGV2ZW50IHN0cnVjdHVyZSBhbmQgbWFpbiBoYW5kbGVyLCBpZiB0aGlzIGlzIHRoZSBmaXJzdAoKCiAgICAgIGlmICghKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykpIHsKICAgICAgICBldmVudHMgPSBlbGVtRGF0YS5ldmVudHMgPSB7fTsKICAgICAgfQoKICAgICAgaWYgKCEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpKSB7CiAgICAgICAgZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKICAgICAgICAgIC8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKICAgICAgICAgIHJldHVybiBfdHlwZW9mKGpRdWVyeSkgIT09IGNvcmVfc3RydW5kZWZpbmVkICYmICghZSB8fCBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUpID8galF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KGV2ZW50SGFuZGxlLmVsZW0sIGFyZ3VtZW50cykgOiB1bmRlZmluZWQ7CiAgICAgICAgfTsgLy8gQWRkIGVsZW0gYXMgYSBwcm9wZXJ0eSBvZiB0aGUgaGFuZGxlIGZuIHRvIHByZXZlbnQgYSBtZW1vcnkgbGVhayB3aXRoIElFIG5vbi1uYXRpdmUgZXZlbnRzCgoKICAgICAgICBldmVudEhhbmRsZS5lbGVtID0gZWxlbTsKICAgICAgfSAvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCiAgICAgIC8vIGpRdWVyeSguLi4pLmJpbmQoIm1vdXNlb3ZlciBtb3VzZW91dCIsIGZuKTsKCgogICAgICB0eXBlcyA9ICh0eXBlcyB8fCAiIikubWF0Y2goY29yZV9ybm90d2hpdGUpIHx8IFsiIl07CiAgICAgIHQgPSB0eXBlcy5sZW5ndGg7CgogICAgICB3aGlsZSAodC0tKSB7CiAgICAgICAgdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyh0eXBlc1t0XSkgfHwgW107CiAgICAgICAgdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwogICAgICAgIG5hbWVzcGFjZXMgPSAodG1wWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKTsgLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgogICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fTsgLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgogICAgICAgIHR5cGUgPSAoc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUpIHx8IHR5cGU7IC8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCiAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsW3R5cGVdIHx8IHt9OyAvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoKICAgICAgICBoYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICBvcmlnVHlwZTogb3JpZ1R5cGUsCiAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgaGFuZGxlcjogaGFuZGxlciwKICAgICAgICAgIGd1aWQ6IGhhbmRsZXIuZ3VpZCwKICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3RvciwKICAgICAgICAgIG5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3Qoc2VsZWN0b3IpLAogICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2VzLmpvaW4oIi4iKQogICAgICAgIH0sIGhhbmRsZU9iakluKTsgLy8gSW5pdCB0aGUgZXZlbnQgaGFuZGxlciBxdWV1ZSBpZiB3ZSdyZSB0aGUgZmlyc3QKCiAgICAgICAgaWYgKCEoaGFuZGxlcnMgPSBldmVudHNbdHlwZV0pKSB7CiAgICAgICAgICBoYW5kbGVycyA9IGV2ZW50c1t0eXBlXSA9IFtdOwogICAgICAgICAgaGFuZGxlcnMuZGVsZWdhdGVDb3VudCA9IDA7IC8vIE9ubHkgdXNlIGFkZEV2ZW50TGlzdGVuZXIvYXR0YWNoRXZlbnQgaWYgdGhlIHNwZWNpYWwgZXZlbnRzIGhhbmRsZXIgcmV0dXJucyBmYWxzZQoKICAgICAgICAgIGlmICghc3BlY2lhbC5zZXR1cCB8fCBzcGVjaWFsLnNldHVwLmNhbGwoZWxlbSwgZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUpID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAogICAgICAgICAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5hdHRhY2hFdmVudCkgewogICAgICAgICAgICAgIGVsZW0uYXR0YWNoRXZlbnQoIm9uIiArIHR5cGUsIGV2ZW50SGFuZGxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNwZWNpYWwuYWRkKSB7CiAgICAgICAgICBzcGVjaWFsLmFkZC5jYWxsKGVsZW0sIGhhbmRsZU9iaik7CgogICAgICAgICAgaWYgKCFoYW5kbGVPYmouaGFuZGxlci5ndWlkKSB7CiAgICAgICAgICAgIGhhbmRsZU9iai5oYW5kbGVyLmd1aWQgPSBoYW5kbGVyLmd1aWQ7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgdG8gdGhlIGVsZW1lbnQncyBoYW5kbGVyIGxpc3QsIGRlbGVnYXRlcyBpbiBmcm9udAoKCiAgICAgICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgICAgICBoYW5kbGVycy5zcGxpY2UoaGFuZGxlcnMuZGVsZWdhdGVDb3VudCsrLCAwLCBoYW5kbGVPYmopOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoYW5kbGVycy5wdXNoKGhhbmRsZU9iaik7CiAgICAgICAgfSAvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGV2ZW50cyBoYXZlIGV2ZXIgYmVlbiB1c2VkLCBmb3IgZXZlbnQgb3B0aW1pemF0aW9uCgoKICAgICAgICBqUXVlcnkuZXZlbnQuZ2xvYmFsW3R5cGVdID0gdHJ1ZTsKICAgICAgfSAvLyBOdWxsaWZ5IGVsZW0gdG8gcHJldmVudCBtZW1vcnkgbGVha3MgaW4gSUUKCgogICAgICBlbGVtID0gbnVsbDsKICAgIH0sCiAgICAvLyBEZXRhY2ggYW4gZXZlbnQgb3Igc2V0IG9mIGV2ZW50cyBmcm9tIGFuIGVsZW1lbnQKICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBzZWxlY3RvciwgbWFwcGVkVHlwZXMpIHsKICAgICAgdmFyIGosCiAgICAgICAgICBoYW5kbGVPYmosCiAgICAgICAgICB0bXAsCiAgICAgICAgICBvcmlnQ291bnQsCiAgICAgICAgICB0LAogICAgICAgICAgZXZlbnRzLAogICAgICAgICAgc3BlY2lhbCwKICAgICAgICAgIGhhbmRsZXJzLAogICAgICAgICAgdHlwZSwKICAgICAgICAgIG5hbWVzcGFjZXMsCiAgICAgICAgICBvcmlnVHlwZSwKICAgICAgICAgIGVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoZWxlbSkgJiYgalF1ZXJ5Ll9kYXRhKGVsZW0pOwoKICAgICAgaWYgKCFlbGVtRGF0YSB8fCAhKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAoKCiAgICAgIHR5cGVzID0gKHR5cGVzIHx8ICIiKS5tYXRjaChjb3JlX3Jub3R3aGl0ZSkgfHwgWyIiXTsKICAgICAgdCA9IHR5cGVzLmxlbmd0aDsKCiAgICAgIHdoaWxlICh0LS0pIHsKICAgICAgICB0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKHR5cGVzW3RdKSB8fCBbXTsKICAgICAgICB0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CiAgICAgICAgbmFtZXNwYWNlcyA9ICh0bXBbMl0gfHwgIiIpLnNwbGl0KCIuIikuc29ydCgpOyAvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCiAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICBmb3IgKHR5cGUgaW4gZXZlbnRzKSB7CiAgICAgICAgICAgIGpRdWVyeS5ldmVudC5yZW1vdmUoZWxlbSwgdHlwZSArIHR5cGVzW3RdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbdHlwZV0gfHwge307CiAgICAgICAgdHlwZSA9IChzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSkgfHwgdHlwZTsKICAgICAgICBoYW5kbGVycyA9IGV2ZW50c1t0eXBlXSB8fCBbXTsKICAgICAgICB0bXAgPSB0bXBbMl0gJiYgbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIik7IC8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMKCiAgICAgICAgb3JpZ0NvdW50ID0gaiA9IGhhbmRsZXJzLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgaGFuZGxlT2JqID0gaGFuZGxlcnNbal07CgogICAgICAgICAgaWYgKChtYXBwZWRUeXBlcyB8fCBvcmlnVHlwZSA9PT0gaGFuZGxlT2JqLm9yaWdUeXBlKSAmJiAoIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCkgJiYgKCF0bXAgfHwgdG1wLnRlc3QoaGFuZGxlT2JqLm5hbWVzcGFjZSkpICYmICghc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09IGhhbmRsZU9iai5zZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gIioqIiAmJiBoYW5kbGVPYmouc2VsZWN0b3IpKSB7CiAgICAgICAgICAgIGhhbmRsZXJzLnNwbGljZShqLCAxKTsKCiAgICAgICAgICAgIGlmIChoYW5kbGVPYmouc2VsZWN0b3IpIHsKICAgICAgICAgICAgICBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LS07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzcGVjaWFsLnJlbW92ZSkgewogICAgICAgICAgICAgIHNwZWNpYWwucmVtb3ZlLmNhbGwoZWxlbSwgaGFuZGxlT2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAogICAgICAgIC8vIChhdm9pZHMgcG90ZW50aWFsIGZvciBlbmRsZXNzIHJlY3Vyc2lvbiBkdXJpbmcgcmVtb3ZhbCBvZiBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzKQoKCiAgICAgICAgaWYgKG9yaWdDb3VudCAmJiAhaGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoIXNwZWNpYWwudGVhcmRvd24gfHwgc3BlY2lhbC50ZWFyZG93bi5jYWxsKGVsZW0sIG5hbWVzcGFjZXMsIGVsZW1EYXRhLmhhbmRsZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudChlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGRlbGV0ZSBldmVudHNbdHlwZV07CiAgICAgICAgfQogICAgICB9IC8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgoKICAgICAgaWYgKGpRdWVyeS5pc0VtcHR5T2JqZWN0KGV2ZW50cykpIHsKICAgICAgICBkZWxldGUgZWxlbURhdGEuaGFuZGxlOyAvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQogICAgICAgIC8vIHNvIHVzZSBpdCBpbnN0ZWFkIG9mIGRlbGV0ZQoKICAgICAgICBqUXVlcnkuX3JlbW92ZURhdGEoZWxlbSwgImV2ZW50cyIpOwogICAgICB9CiAgICB9LAogICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcihldmVudCwgZGF0YSwgZWxlbSwgb25seUhhbmRsZXJzKSB7CiAgICAgIHZhciBoYW5kbGUsCiAgICAgICAgICBvbnR5cGUsCiAgICAgICAgICBjdXIsCiAgICAgICAgICBidWJibGVUeXBlLAogICAgICAgICAgc3BlY2lhbCwKICAgICAgICAgIHRtcCwKICAgICAgICAgIGksCiAgICAgICAgICBldmVudFBhdGggPSBbZWxlbSB8fCBkb2N1bWVudF0sCiAgICAgICAgICB0eXBlID0gY29yZV9oYXNPd24uY2FsbChldmVudCwgInR5cGUiKSA/IGV2ZW50LnR5cGUgOiBldmVudCwKICAgICAgICAgIG5hbWVzcGFjZXMgPSBjb3JlX2hhc093bi5jYWxsKGV2ZW50LCAibmFtZXNwYWNlIikgPyBldmVudC5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOwogICAgICBjdXIgPSB0bXAgPSBlbGVtID0gZWxlbSB8fCBkb2N1bWVudDsgLy8gRG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCiAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAzIHx8IGVsZW0ubm9kZVR5cGUgPT09IDgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gZm9jdXMvYmx1ciBtb3JwaHMgdG8gZm9jdXNpbi9vdXQ7IGVuc3VyZSB3ZSdyZSBub3QgZmlyaW5nIHRoZW0gcmlnaHQgbm93CgoKICAgICAgaWYgKHJmb2N1c01vcnBoLnRlc3QodHlwZSArIGpRdWVyeS5ldmVudC50cmlnZ2VyZWQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodHlwZS5pbmRleE9mKCIuIikgPj0gMCkgewogICAgICAgIC8vIE5hbWVzcGFjZWQgdHJpZ2dlcjsgY3JlYXRlIGEgcmVnZXhwIHRvIG1hdGNoIGV2ZW50IHR5cGUgaW4gaGFuZGxlKCkKICAgICAgICBuYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwogICAgICAgIHR5cGUgPSBuYW1lc3BhY2VzLnNoaWZ0KCk7CiAgICAgICAgbmFtZXNwYWNlcy5zb3J0KCk7CiAgICAgIH0KCiAgICAgIG9udHlwZSA9IHR5cGUuaW5kZXhPZigiOiIpIDwgMCAmJiAib24iICsgdHlwZTsgLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGEgalF1ZXJ5LkV2ZW50IG9iamVjdCwgT2JqZWN0LCBvciBqdXN0IGFuIGV2ZW50IHR5cGUgc3RyaW5nCgogICAgICBldmVudCA9IGV2ZW50W2pRdWVyeS5leHBhbmRvXSA/IGV2ZW50IDogbmV3IGpRdWVyeS5FdmVudCh0eXBlLCBfdHlwZW9mKGV2ZW50KSA9PT0gIm9iamVjdCIgJiYgZXZlbnQpOwogICAgICBldmVudC5pc1RyaWdnZXIgPSB0cnVlOwogICAgICBldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oIi4iKTsKICAgICAgZXZlbnQubmFtZXNwYWNlX3JlID0gZXZlbnQubmFtZXNwYWNlID8gbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIikgOiBudWxsOyAvLyBDbGVhbiB1cCB0aGUgZXZlbnQgaW4gY2FzZSBpdCBpcyBiZWluZyByZXVzZWQKCiAgICAgIGV2ZW50LnJlc3VsdCA9IHVuZGVmaW5lZDsKCiAgICAgIGlmICghZXZlbnQudGFyZ2V0KSB7CiAgICAgICAgZXZlbnQudGFyZ2V0ID0gZWxlbTsKICAgICAgfSAvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgoKICAgICAgZGF0YSA9IGRhdGEgPT0gbnVsbCA/IFtldmVudF0gOiBqUXVlcnkubWFrZUFycmF5KGRhdGEsIFtldmVudF0pOyAvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgogICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbdHlwZV0gfHwge307CgogICAgICBpZiAoIW9ubHlIYW5kbGVycyAmJiBzcGVjaWFsLnRyaWdnZXIgJiYgc3BlY2lhbC50cmlnZ2VyLmFwcGx5KGVsZW0sIGRhdGEpID09PSBmYWxzZSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBEZXRlcm1pbmUgZXZlbnQgcHJvcGFnYXRpb24gcGF0aCBpbiBhZHZhbmNlLCBwZXIgVzNDIGV2ZW50cyBzcGVjICgjOTk1MSkKICAgICAgLy8gQnViYmxlIHVwIHRvIGRvY3VtZW50LCB0aGVuIHRvIHdpbmRvdzsgd2F0Y2ggZm9yIGEgZ2xvYmFsIG93bmVyRG9jdW1lbnQgdmFyICgjOTcyNCkKCgogICAgICBpZiAoIW9ubHlIYW5kbGVycyAmJiAhc3BlY2lhbC5ub0J1YmJsZSAmJiAhalF1ZXJ5LmlzV2luZG93KGVsZW0pKSB7CiAgICAgICAgYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgogICAgICAgIGlmICghcmZvY3VzTW9ycGgudGVzdChidWJibGVUeXBlICsgdHlwZSkpIHsKICAgICAgICAgIGN1ciA9IGN1ci5wYXJlbnROb2RlOwogICAgICAgIH0KCiAgICAgICAgZm9yICg7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUpIHsKICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKGN1cik7CiAgICAgICAgICB0bXAgPSBjdXI7CiAgICAgICAgfSAvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKCgogICAgICAgIGlmICh0bXAgPT09IChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpKSB7CiAgICAgICAgICBldmVudFBhdGgucHVzaCh0bXAuZGVmYXVsdFZpZXcgfHwgdG1wLnBhcmVudFdpbmRvdyB8fCB3aW5kb3cpOwogICAgICAgIH0KICAgICAgfSAvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgoKICAgICAgaSA9IDA7CgogICAgICB3aGlsZSAoKGN1ciA9IGV2ZW50UGF0aFtpKytdKSAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgewogICAgICAgIGV2ZW50LnR5cGUgPSBpID4gMSA/IGJ1YmJsZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGU7IC8vIGpRdWVyeSBoYW5kbGVyCgogICAgICAgIGhhbmRsZSA9IChqUXVlcnkuX2RhdGEoY3VyLCAiZXZlbnRzIikgfHwge30pW2V2ZW50LnR5cGVdICYmIGpRdWVyeS5fZGF0YShjdXIsICJoYW5kbGUiKTsKCiAgICAgICAgaWYgKGhhbmRsZSkgewogICAgICAgICAgaGFuZGxlLmFwcGx5KGN1ciwgZGF0YSk7CiAgICAgICAgfSAvLyBOYXRpdmUgaGFuZGxlcgoKCiAgICAgICAgaGFuZGxlID0gb250eXBlICYmIGN1cltvbnR5cGVdOwoKICAgICAgICBpZiAoaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKGN1cikgJiYgaGFuZGxlLmFwcGx5ICYmIGhhbmRsZS5hcHBseShjdXIsIGRhdGEpID09PSBmYWxzZSkgewogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGV2ZW50LnR5cGUgPSB0eXBlOyAvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgogICAgICBpZiAoIW9ubHlIYW5kbGVycyAmJiAhZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsKICAgICAgICBpZiAoKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoZWxlbS5vd25lckRvY3VtZW50LCBkYXRhKSA9PT0gZmFsc2UpICYmICEodHlwZSA9PT0gImNsaWNrIiAmJiBqUXVlcnkubm9kZU5hbWUoZWxlbSwgImEiKSkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoZWxlbSkpIHsKICAgICAgICAgIC8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KICAgICAgICAgIC8vIENhbid0IHVzZSBhbiAuaXNGdW5jdGlvbigpIGNoZWNrIGhlcmUgYmVjYXVzZSBJRTYvNyBmYWlscyB0aGF0IHRlc3QuCiAgICAgICAgICAvLyBEb24ndCBkbyBkZWZhdWx0IGFjdGlvbnMgb24gd2luZG93LCB0aGF0J3Mgd2hlcmUgZ2xvYmFsIHZhcmlhYmxlcyBiZSAoIzYxNzApCiAgICAgICAgICBpZiAob250eXBlICYmIGVsZW1bdHlwZV0gJiYgIWpRdWVyeS5pc1dpbmRvdyhlbGVtKSkgewogICAgICAgICAgICAvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCiAgICAgICAgICAgIHRtcCA9IGVsZW1bb250eXBlXTsKCiAgICAgICAgICAgIGlmICh0bXApIHsKICAgICAgICAgICAgICBlbGVtW29udHlwZV0gPSBudWxsOwogICAgICAgICAgICB9IC8vIFByZXZlbnQgcmUtdHJpZ2dlcmluZyBvZiB0aGUgc2FtZSBldmVudCwgc2luY2Ugd2UgYWxyZWFkeSBidWJibGVkIGl0IGFib3ZlCgoKICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCA9IHR5cGU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGVsZW1bdHlwZV0oKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgey8vIElFPDkgZGllcyBvbiBmb2N1cy9ibHVyIHRvIGhpZGRlbiBlbGVtZW50ICgjMTQ4NiwjMTI1MTgpCiAgICAgICAgICAgICAgLy8gb25seSByZXByb2R1Y2libGUgb24gd2luWFAgSUU4IG5hdGl2ZSwgbm90IElFOSBpbiBJRTggbW9kZQogICAgICAgICAgICB9CgogICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgaWYgKHRtcCkgewogICAgICAgICAgICAgIGVsZW1bb250eXBlXSA9IHRtcDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGV2ZW50LnJlc3VsdDsKICAgIH0sCiAgICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2goZXZlbnQpIHsKICAgICAgLy8gTWFrZSBhIHdyaXRhYmxlIGpRdWVyeS5FdmVudCBmcm9tIHRoZSBuYXRpdmUgZXZlbnQgb2JqZWN0CiAgICAgIGV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeChldmVudCk7CiAgICAgIHZhciBpLAogICAgICAgICAgcmV0LAogICAgICAgICAgaGFuZGxlT2JqLAogICAgICAgICAgbWF0Y2hlZCwKICAgICAgICAgIGosCiAgICAgICAgICBoYW5kbGVyUXVldWUgPSBbXSwKICAgICAgICAgIGFyZ3MgPSBjb3JlX3NsaWNlLmNhbGwoYXJndW1lbnRzKSwKICAgICAgICAgIGhhbmRsZXJzID0gKGpRdWVyeS5fZGF0YSh0aGlzLCAiZXZlbnRzIikgfHwge30pW2V2ZW50LnR5cGVdIHx8IFtdLAogICAgICAgICAgc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsW2V2ZW50LnR5cGVdIHx8IHt9OyAvLyBVc2UgdGhlIGZpeC1lZCBqUXVlcnkuRXZlbnQgcmF0aGVyIHRoYW4gdGhlIChyZWFkLW9ubHkpIG5hdGl2ZSBldmVudAoKICAgICAgYXJnc1swXSA9IGV2ZW50OwogICAgICBldmVudC5kZWxlZ2F0ZVRhcmdldCA9IHRoaXM7IC8vIENhbGwgdGhlIHByZURpc3BhdGNoIGhvb2sgZm9yIHRoZSBtYXBwZWQgdHlwZSwgYW5kIGxldCBpdCBiYWlsIGlmIGRlc2lyZWQKCiAgICAgIGlmIChzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCh0aGlzLCBldmVudCkgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIERldGVybWluZSBoYW5kbGVycwoKCiAgICAgIGhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsIGV2ZW50LCBoYW5kbGVycyk7IC8vIFJ1biBkZWxlZ2F0ZXMgZmlyc3Q7IHRoZXkgbWF5IHdhbnQgdG8gc3RvcCBwcm9wYWdhdGlvbiBiZW5lYXRoIHVzCgogICAgICBpID0gMDsKCiAgICAgIHdoaWxlICgobWF0Y2hlZCA9IGhhbmRsZXJRdWV1ZVtpKytdKSAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgewogICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CiAgICAgICAgaiA9IDA7CgogICAgICAgIHdoaWxlICgoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1tqKytdKSAmJiAhZXZlbnQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgewogICAgICAgICAgLy8gVHJpZ2dlcmVkIGV2ZW50IG11c3QgZWl0aGVyIDEpIGhhdmUgbm8gbmFtZXNwYWNlLCBvcgogICAgICAgICAgLy8gMikgaGF2ZSBuYW1lc3BhY2UocykgYSBzdWJzZXQgb3IgZXF1YWwgdG8gdGhvc2UgaW4gdGhlIGJvdW5kIGV2ZW50IChib3RoIGNhbiBoYXZlIG5vIG5hbWVzcGFjZSkuCiAgICAgICAgICBpZiAoIWV2ZW50Lm5hbWVzcGFjZV9yZSB8fCBldmVudC5uYW1lc3BhY2VfcmUudGVzdChoYW5kbGVPYmoubmFtZXNwYWNlKSkgewogICAgICAgICAgICBldmVudC5oYW5kbGVPYmogPSBoYW5kbGVPYmo7CiAgICAgICAgICAgIGV2ZW50LmRhdGEgPSBoYW5kbGVPYmouZGF0YTsKICAgICAgICAgICAgcmV0ID0gKChqUXVlcnkuZXZlbnQuc3BlY2lhbFtoYW5kbGVPYmoub3JpZ1R5cGVdIHx8IHt9KS5oYW5kbGUgfHwgaGFuZGxlT2JqLmhhbmRsZXIpLmFwcGx5KG1hdGNoZWQuZWxlbSwgYXJncyk7CgogICAgICAgICAgICBpZiAocmV0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAoKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENhbGwgdGhlIHBvc3REaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUKCgogICAgICBpZiAoc3BlY2lhbC5wb3N0RGlzcGF0Y2gpIHsKICAgICAgICBzcGVjaWFsLnBvc3REaXNwYXRjaC5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGV2ZW50LnJlc3VsdDsKICAgIH0sCiAgICBoYW5kbGVyczogZnVuY3Rpb24gaGFuZGxlcnMoZXZlbnQsIF9oYW5kbGVycykgewogICAgICB2YXIgc2VsLAogICAgICAgICAgaGFuZGxlT2JqLAogICAgICAgICAgbWF0Y2hlcywKICAgICAgICAgIGksCiAgICAgICAgICBoYW5kbGVyUXVldWUgPSBbXSwKICAgICAgICAgIGRlbGVnYXRlQ291bnQgPSBfaGFuZGxlcnMuZGVsZWdhdGVDb3VudCwKICAgICAgICAgIGN1ciA9IGV2ZW50LnRhcmdldDsgLy8gRmluZCBkZWxlZ2F0ZSBoYW5kbGVycwogICAgICAvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQogICAgICAvLyBBdm9pZCBub24tbGVmdC1jbGljayBidWJibGluZyBpbiBGaXJlZm94ICgjMzg2MSkKCiAgICAgIGlmIChkZWxlZ2F0ZUNvdW50ICYmIGN1ci5ub2RlVHlwZSAmJiAoIWV2ZW50LmJ1dHRvbiB8fCBldmVudC50eXBlICE9PSAiY2xpY2siKSkgewogICAgICAgIGZvciAoOyBjdXIgIT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcykgewogICAgICAgICAgLy8gRG9uJ3QgY2hlY2sgbm9uLWVsZW1lbnRzICgjMTMyMDgpCiAgICAgICAgICAvLyBEb24ndCBwcm9jZXNzIGNsaWNrcyBvbiBkaXNhYmxlZCBlbGVtZW50cyAoIzY5MTEsICM4MTY1LCAjMTEzODIsICMxMTc2NCkKICAgICAgICAgIGlmIChjdXIubm9kZVR5cGUgPT09IDEgJiYgKGN1ci5kaXNhYmxlZCAhPT0gdHJ1ZSB8fCBldmVudC50eXBlICE9PSAiY2xpY2siKSkgewogICAgICAgICAgICBtYXRjaGVzID0gW107CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgaGFuZGxlT2JqID0gX2hhbmRsZXJzW2ldOyAvLyBEb24ndCBjb25mbGljdCB3aXRoIE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoIzEzMjAzKQoKICAgICAgICAgICAgICBzZWwgPSBoYW5kbGVPYmouc2VsZWN0b3IgKyAiICI7CgogICAgICAgICAgICAgIGlmIChtYXRjaGVzW3NlbF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgbWF0Y2hlc1tzZWxdID0gaGFuZGxlT2JqLm5lZWRzQ29udGV4dCA/IGpRdWVyeShzZWwsIHRoaXMpLmluZGV4KGN1cikgPj0gMCA6IGpRdWVyeS5maW5kKHNlbCwgdGhpcywgbnVsbCwgW2N1cl0pLmxlbmd0aDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChtYXRjaGVzW3NlbF0pIHsKICAgICAgICAgICAgICAgIG1hdGNoZXMucHVzaChoYW5kbGVPYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaGFuZGxlclF1ZXVlLnB1c2goewogICAgICAgICAgICAgICAgZWxlbTogY3VyLAogICAgICAgICAgICAgICAgaGFuZGxlcnM6IG1hdGNoZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBBZGQgdGhlIHJlbWFpbmluZyAoZGlyZWN0bHktYm91bmQpIGhhbmRsZXJzCgoKICAgICAgaWYgKGRlbGVnYXRlQ291bnQgPCBfaGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgICAgaGFuZGxlclF1ZXVlLnB1c2goewogICAgICAgICAgZWxlbTogdGhpcywKICAgICAgICAgIGhhbmRsZXJzOiBfaGFuZGxlcnMuc2xpY2UoZGVsZWdhdGVDb3VudCkKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhbmRsZXJRdWV1ZTsKICAgIH0sCiAgICBmaXg6IGZ1bmN0aW9uIGZpeChldmVudCkgewogICAgICBpZiAoZXZlbnRbalF1ZXJ5LmV4cGFuZG9dKSB7CiAgICAgICAgcmV0dXJuIGV2ZW50OwogICAgICB9IC8vIENyZWF0ZSBhIHdyaXRhYmxlIGNvcHkgb2YgdGhlIGV2ZW50IG9iamVjdCBhbmQgbm9ybWFsaXplIHNvbWUgcHJvcGVydGllcwoKCiAgICAgIHZhciBpLAogICAgICAgICAgcHJvcCwKICAgICAgICAgIGNvcHksCiAgICAgICAgICB0eXBlID0gZXZlbnQudHlwZSwKICAgICAgICAgIG9yaWdpbmFsRXZlbnQgPSBldmVudCwKICAgICAgICAgIGZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzW3R5cGVdOwoKICAgICAgaWYgKCFmaXhIb29rKSB7CiAgICAgICAgdGhpcy5maXhIb29rc1t0eXBlXSA9IGZpeEhvb2sgPSBybW91c2VFdmVudC50ZXN0KHR5cGUpID8gdGhpcy5tb3VzZUhvb2tzIDogcmtleUV2ZW50LnRlc3QodHlwZSkgPyB0aGlzLmtleUhvb2tzIDoge307CiAgICAgIH0KCiAgICAgIGNvcHkgPSBmaXhIb29rLnByb3BzID8gdGhpcy5wcm9wcy5jb25jYXQoZml4SG9vay5wcm9wcykgOiB0aGlzLnByb3BzOwogICAgICBldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQob3JpZ2luYWxFdmVudCk7CiAgICAgIGkgPSBjb3B5Lmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBwcm9wID0gY29weVtpXTsKICAgICAgICBldmVudFtwcm9wXSA9IG9yaWdpbmFsRXZlbnRbcHJvcF07CiAgICAgIH0gLy8gU3VwcG9ydDogSUU8OQogICAgICAvLyBGaXggdGFyZ2V0IHByb3BlcnR5ICgjMTkyNSkKCgogICAgICBpZiAoIWV2ZW50LnRhcmdldCkgewogICAgICAgIGV2ZW50LnRhcmdldCA9IG9yaWdpbmFsRXZlbnQuc3JjRWxlbWVudCB8fCBkb2N1bWVudDsKICAgICAgfSAvLyBTdXBwb3J0OiBDaHJvbWUgMjMrLCBTYWZhcmk/CiAgICAgIC8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgoKICAgICAgaWYgKGV2ZW50LnRhcmdldC5ub2RlVHlwZSA9PT0gMykgewogICAgICAgIGV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwogICAgICB9IC8vIFN1cHBvcnQ6IElFPDkKICAgICAgLy8gRm9yIG1vdXNlL2tleSBldmVudHMsIG1ldGFLZXk9PWZhbHNlIGlmIGl0J3MgdW5kZWZpbmVkICgjMzM2OCwgIzExMzI4KQoKCiAgICAgIGV2ZW50Lm1ldGFLZXkgPSAhIWV2ZW50Lm1ldGFLZXk7CiAgICAgIHJldHVybiBmaXhIb29rLmZpbHRlciA/IGZpeEhvb2suZmlsdGVyKGV2ZW50LCBvcmlnaW5hbEV2ZW50KSA6IGV2ZW50OwogICAgfSwKICAgIC8vIEluY2x1ZGVzIHNvbWUgZXZlbnQgcHJvcHMgc2hhcmVkIGJ5IEtleUV2ZW50IGFuZCBNb3VzZUV2ZW50CiAgICBwcm9wczogImFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaCIuc3BsaXQoIiAiKSwKICAgIGZpeEhvb2tzOiB7fSwKICAgIGtleUhvb2tzOiB7CiAgICAgIHByb3BzOiAiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZSIuc3BsaXQoIiAiKSwKICAgICAgZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXIoZXZlbnQsIG9yaWdpbmFsKSB7CiAgICAgICAgLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzCiAgICAgICAgaWYgKGV2ZW50LndoaWNoID09IG51bGwpIHsKICAgICAgICAgIGV2ZW50LndoaWNoID0gb3JpZ2luYWwuY2hhckNvZGUgIT0gbnVsbCA/IG9yaWdpbmFsLmNoYXJDb2RlIDogb3JpZ2luYWwua2V5Q29kZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBldmVudDsKICAgICAgfQogICAgfSwKICAgIG1vdXNlSG9va3M6IHsKICAgICAgcHJvcHM6ICJidXR0b24gYnV0dG9ucyBjbGllbnRYIGNsaWVudFkgZnJvbUVsZW1lbnQgb2Zmc2V0WCBvZmZzZXRZIHBhZ2VYIHBhZ2VZIHNjcmVlblggc2NyZWVuWSB0b0VsZW1lbnQiLnNwbGl0KCIgIiksCiAgICAgIGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKGV2ZW50LCBvcmlnaW5hbCkgewogICAgICAgIHZhciBib2R5LAogICAgICAgICAgICBldmVudERvYywKICAgICAgICAgICAgZG9jLAogICAgICAgICAgICBidXR0b24gPSBvcmlnaW5hbC5idXR0b24sCiAgICAgICAgICAgIGZyb21FbGVtZW50ID0gb3JpZ2luYWwuZnJvbUVsZW1lbnQ7IC8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCiAgICAgICAgaWYgKGV2ZW50LnBhZ2VYID09IG51bGwgJiYgb3JpZ2luYWwuY2xpZW50WCAhPSBudWxsKSB7CiAgICAgICAgICBldmVudERvYyA9IGV2ZW50LnRhcmdldC5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50OwogICAgICAgICAgZG9jID0gZXZlbnREb2MuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgYm9keSA9IGV2ZW50RG9jLmJvZHk7CiAgICAgICAgICBldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDApIC0gKGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwKTsKICAgICAgICAgIGV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArIChkb2MgJiYgZG9jLnNjcm9sbFRvcCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wIHx8IDApIC0gKGRvYyAmJiBkb2MuY2xpZW50VG9wIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgfHwgMCk7CiAgICAgICAgfSAvLyBBZGQgcmVsYXRlZFRhcmdldCwgaWYgbmVjZXNzYXJ5CgoKICAgICAgICBpZiAoIWV2ZW50LnJlbGF0ZWRUYXJnZXQgJiYgZnJvbUVsZW1lbnQpIHsKICAgICAgICAgIGV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8gb3JpZ2luYWwudG9FbGVtZW50IDogZnJvbUVsZW1lbnQ7CiAgICAgICAgfSAvLyBBZGQgd2hpY2ggZm9yIGNsaWNrOiAxID09PSBsZWZ0OyAyID09PSBtaWRkbGU7IDMgPT09IHJpZ2h0CiAgICAgICAgLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQKCgogICAgICAgIGlmICghZXZlbnQud2hpY2ggJiYgYnV0dG9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGV2ZW50LndoaWNoID0gYnV0dG9uICYgMSA/IDEgOiBidXR0b24gJiAyID8gMyA6IGJ1dHRvbiAmIDQgPyAyIDogMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBldmVudDsKICAgICAgfQogICAgfSwKICAgIHNwZWNpYWw6IHsKICAgICAgbG9hZDogewogICAgICAgIC8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWQKICAgICAgICBub0J1YmJsZTogdHJ1ZQogICAgICB9LAogICAgICBjbGljazogewogICAgICAgIC8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CiAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcigpIHsKICAgICAgICAgIGlmIChqUXVlcnkubm9kZU5hbWUodGhpcywgImlucHV0IikgJiYgdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2spIHsKICAgICAgICAgICAgdGhpcy5jbGljaygpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBmb2N1czogewogICAgICAgIC8vIEZpcmUgbmF0aXZlIGV2ZW50IGlmIHBvc3NpYmxlIHNvIGJsdXIvZm9jdXMgc2VxdWVuY2UgaXMgY29ycmVjdAogICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uIHRyaWdnZXIoKSB7CiAgICAgICAgICBpZiAodGhpcyAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiB0aGlzLmZvY3VzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdGhpcy5mb2N1cygpOwogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgey8vIFN1cHBvcnQ6IElFPDkKICAgICAgICAgICAgICAvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCiAgICAgICAgICAgICAgLy8gbGV0IC50cmlnZ2VyKCkgcnVuIHRoZSBoYW5kbGVycwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkZWxlZ2F0ZVR5cGU6ICJmb2N1c2luIgogICAgICB9LAogICAgICBibHVyOiB7CiAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcigpIHsKICAgICAgICAgIGlmICh0aGlzID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuYmx1cikgewogICAgICAgICAgICB0aGlzLmJsdXIoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGVsZWdhdGVUeXBlOiAiZm9jdXNvdXQiCiAgICAgIH0sCiAgICAgIGJlZm9yZXVubG9hZDogewogICAgICAgIHBvc3REaXNwYXRjaDogZnVuY3Rpb24gcG9zdERpc3BhdGNoKGV2ZW50KSB7CiAgICAgICAgICAvLyBFdmVuIHdoZW4gcmV0dXJuVmFsdWUgZXF1YWxzIHRvIHVuZGVmaW5lZCBGaXJlZm94IHdpbGwgc3RpbGwgc2hvdyBhbGVydAogICAgICAgICAgaWYgKGV2ZW50LnJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBldmVudC5yZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2ltdWxhdGU6IGZ1bmN0aW9uIHNpbXVsYXRlKHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUpIHsKICAgICAgLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lLgogICAgICAvLyBGYWtlIG9yaWdpbmFsRXZlbnQgdG8gYXZvaWQgZG9ub3IncyBzdG9wUHJvcGFnYXRpb24sIGJ1dCBpZiB0aGUKICAgICAgLy8gc2ltdWxhdGVkIGV2ZW50IHByZXZlbnRzIGRlZmF1bHQgdGhlbiB3ZSBkbyB0aGUgc2FtZSBvbiB0aGUgZG9ub3IuCiAgICAgIHZhciBlID0galF1ZXJ5LmV4dGVuZChuZXcgalF1ZXJ5LkV2ZW50KCksIGV2ZW50LCB7CiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBpc1NpbXVsYXRlZDogdHJ1ZSwKICAgICAgICBvcmlnaW5hbEV2ZW50OiB7fQogICAgICB9KTsKCiAgICAgIGlmIChidWJibGUpIHsKICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcihlLCBudWxsLCBlbGVtKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbChlbGVtLCBlKTsKICAgICAgfQoKICAgICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9CiAgfTsKICBqUXVlcnkucmVtb3ZlRXZlbnQgPSBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyID8gZnVuY3Rpb24gKGVsZW0sIHR5cGUsIGhhbmRsZSkgewogICAgaWYgKGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcikgewogICAgICBlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlLCBmYWxzZSk7CiAgICB9CiAgfSA6IGZ1bmN0aW9uIChlbGVtLCB0eXBlLCBoYW5kbGUpIHsKICAgIHZhciBuYW1lID0gIm9uIiArIHR5cGU7CgogICAgaWYgKGVsZW0uZGV0YWNoRXZlbnQpIHsKICAgICAgLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAogICAgICAvLyBkZXRhY2hFdmVudCBuZWVkZWQgcHJvcGVydHkgb24gZWxlbWVudCwgYnkgbmFtZSBvZiB0aGF0IGV2ZW50LCB0byBwcm9wZXJseSBleHBvc2UgaXQgdG8gR0MKICAgICAgaWYgKF90eXBlb2YoZWxlbVtuYW1lXSkgPT09IGNvcmVfc3RydW5kZWZpbmVkKSB7CiAgICAgICAgZWxlbVtuYW1lXSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGVsZW0uZGV0YWNoRXZlbnQobmFtZSwgaGFuZGxlKTsKICAgIH0KICB9OwoKICBqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiAoc3JjLCBwcm9wcykgewogICAgLy8gQWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IHRoZSAnbmV3JyBrZXl3b3JkCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSkgewogICAgICByZXR1cm4gbmV3IGpRdWVyeS5FdmVudChzcmMsIHByb3BzKTsKICAgIH0gLy8gRXZlbnQgb2JqZWN0CgoKICAgIGlmIChzcmMgJiYgc3JjLnR5cGUpIHsKICAgICAgdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwogICAgICB0aGlzLnR5cGUgPSBzcmMudHlwZTsgLy8gRXZlbnRzIGJ1YmJsaW5nIHVwIHRoZSBkb2N1bWVudCBtYXkgaGF2ZSBiZWVuIG1hcmtlZCBhcyBwcmV2ZW50ZWQKICAgICAgLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgogICAgICB0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwgc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpID8gcmV0dXJuVHJ1ZSA6IHJldHVybkZhbHNlOyAvLyBFdmVudCB0eXBlCiAgICB9IGVsc2UgewogICAgICB0aGlzLnR5cGUgPSBzcmM7CiAgICB9IC8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0CgoKICAgIGlmIChwcm9wcykgewogICAgICBqUXVlcnkuZXh0ZW5kKHRoaXMsIHByb3BzKTsKICAgIH0gLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUKCgogICAgdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7IC8vIE1hcmsgaXQgYXMgZml4ZWQKCiAgICB0aGlzW2pRdWVyeS5leHBhbmRvXSA9IHRydWU7CiAgfTsgLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nCiAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCgoKICBqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewogICAgaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwKICAgIGlzUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKICAgIGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKICAgIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHsKICAgICAgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7CiAgICAgIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuVHJ1ZTsKCiAgICAgIGlmICghZSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBJZiBwcmV2ZW50RGVmYXVsdCBleGlzdHMsIHJ1biBpdCBvbiB0aGUgb3JpZ2luYWwgZXZlbnQKCgogICAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gU3VwcG9ydDogSUUKICAgICAgICAvLyBPdGhlcndpc2Ugc2V0IHRoZSByZXR1cm5WYWx1ZSBwcm9wZXJ0eSBvZiB0aGUgb3JpZ2luYWwgZXZlbnQgdG8gZmFsc2UKICAgICAgfSBlbHNlIHsKICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbigpIHsKICAgICAgdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7CiAgICAgIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSByZXR1cm5UcnVlOwoKICAgICAgaWYgKCFlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIElmIHN0b3BQcm9wYWdhdGlvbiBleGlzdHMsIHJ1biBpdCBvbiB0aGUgb3JpZ2luYWwgZXZlbnQKCgogICAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9IC8vIFN1cHBvcnQ6IElFCiAgICAgIC8vIFNldCB0aGUgY2FuY2VsQnViYmxlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byB0cnVlCgoKICAgICAgZS5jYW5jZWxCdWJibGUgPSB0cnVlOwogICAgfSwKICAgIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24gc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkgewogICAgICB0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKICAgICAgdGhpcy5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICB9OyAvLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKCiAgalF1ZXJ5LmVhY2goewogICAgbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsCiAgICBtb3VzZWxlYXZlOiAibW91c2VvdXQiCiAgfSwgZnVuY3Rpb24gKG9yaWcsIGZpeCkgewogICAgalF1ZXJ5LmV2ZW50LnNwZWNpYWxbb3JpZ10gPSB7CiAgICAgIGRlbGVnYXRlVHlwZTogZml4LAogICAgICBiaW5kVHlwZTogZml4LAogICAgICBoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZShldmVudCkgewogICAgICAgIHZhciByZXQsCiAgICAgICAgICAgIHRhcmdldCA9IHRoaXMsCiAgICAgICAgICAgIHJlbGF0ZWQgPSBldmVudC5yZWxhdGVkVGFyZ2V0LAogICAgICAgICAgICBoYW5kbGVPYmogPSBldmVudC5oYW5kbGVPYmo7IC8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KICAgICAgICAvLyBOQjogTm8gcmVsYXRlZFRhcmdldCBpZiB0aGUgbW91c2UgbGVmdC9lbnRlcmVkIHRoZSBicm93c2VyIHdpbmRvdwoKICAgICAgICBpZiAoIXJlbGF0ZWQgfHwgcmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnModGFyZ2V0LCByZWxhdGVkKSkgewogICAgICAgICAgZXZlbnQudHlwZSA9IGhhbmRsZU9iai5vcmlnVHlwZTsKICAgICAgICAgIHJldCA9IGhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICBldmVudC50eXBlID0gZml4OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfQogICAgfTsKICB9KTsgLy8gSUUgc3VibWl0IGRlbGVnYXRpb24KCiAgaWYgKCFqUXVlcnkuc3VwcG9ydC5zdWJtaXRCdWJibGVzKSB7CiAgICBqUXVlcnkuZXZlbnQuc3BlY2lhbC5zdWJtaXQgPSB7CiAgICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cCgpIHsKICAgICAgICAvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cwogICAgICAgIGlmIChqUXVlcnkubm9kZU5hbWUodGhpcywgImZvcm0iKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gLy8gTGF6eS1hZGQgYSBzdWJtaXQgaGFuZGxlciB3aGVuIGEgZGVzY2VuZGFudCBmb3JtIG1heSBwb3RlbnRpYWxseSBiZSBzdWJtaXR0ZWQKCgogICAgICAgIGpRdWVyeS5ldmVudC5hZGQodGhpcywgImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAvLyBOb2RlIG5hbWUgY2hlY2sgYXZvaWRzIGEgVk1MLXJlbGF0ZWQgY3Jhc2ggaW4gSUUgKCM5ODA3KQogICAgICAgICAgdmFyIGVsZW0gPSBlLnRhcmdldCwKICAgICAgICAgICAgICBmb3JtID0galF1ZXJ5Lm5vZGVOYW1lKGVsZW0sICJpbnB1dCIpIHx8IGpRdWVyeS5ub2RlTmFtZShlbGVtLCAiYnV0dG9uIikgPyBlbGVtLmZvcm0gOiB1bmRlZmluZWQ7CgogICAgICAgICAgaWYgKGZvcm0gJiYgIWpRdWVyeS5fZGF0YShmb3JtLCAic3VibWl0QnViYmxlcyIpKSB7CiAgICAgICAgICAgIGpRdWVyeS5ldmVudC5hZGQoZm9ybSwgInN1Ym1pdC5fc3VibWl0IiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgZXZlbnQuX3N1Ym1pdF9idWJibGUgPSB0cnVlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGpRdWVyeS5fZGF0YShmb3JtLCAic3VibWl0QnViYmxlcyIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0pOyAvLyByZXR1cm4gdW5kZWZpbmVkIHNpbmNlIHdlIGRvbid0IG5lZWQgYW4gZXZlbnQgbGlzdGVuZXIKICAgICAgfSwKICAgICAgcG9zdERpc3BhdGNoOiBmdW5jdGlvbiBwb3N0RGlzcGF0Y2goZXZlbnQpIHsKICAgICAgICAvLyBJZiBmb3JtIHdhcyBzdWJtaXR0ZWQgYnkgdGhlIHVzZXIsIGJ1YmJsZSB0aGUgZXZlbnQgdXAgdGhlIHRyZWUKICAgICAgICBpZiAoZXZlbnQuX3N1Ym1pdF9idWJibGUpIHsKICAgICAgICAgIGRlbGV0ZSBldmVudC5fc3VibWl0X2J1YmJsZTsKCiAgICAgICAgICBpZiAodGhpcy5wYXJlbnROb2RlICYmICFldmVudC5pc1RyaWdnZXIpIHsKICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiB0ZWFyZG93bigpIHsKICAgICAgICAvLyBPbmx5IG5lZWQgdGhpcyBmb3IgZGVsZWdhdGVkIGZvcm0gc3VibWl0IGV2ZW50cwogICAgICAgIGlmIChqUXVlcnkubm9kZU5hbWUodGhpcywgImZvcm0iKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgoKICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKHRoaXMsICIuX3N1Ym1pdCIpOwogICAgICB9CiAgICB9OwogIH0gLy8gSUUgY2hhbmdlIGRlbGVnYXRpb24gYW5kIGNoZWNrYm94L3JhZGlvIGZpeAoKCiAgaWYgKCFqUXVlcnkuc3VwcG9ydC5jaGFuZ2VCdWJibGVzKSB7CiAgICBqUXVlcnkuZXZlbnQuc3BlY2lhbC5jaGFuZ2UgPSB7CiAgICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cCgpIHsKICAgICAgICBpZiAocmZvcm1FbGVtcy50ZXN0KHRoaXMubm9kZU5hbWUpKSB7CiAgICAgICAgICAvLyBJRSBkb2Vzbid0IGZpcmUgY2hhbmdlIG9uIGEgY2hlY2svcmFkaW8gdW50aWwgYmx1cjsgdHJpZ2dlciBpdCBvbiBjbGljawogICAgICAgICAgLy8gYWZ0ZXIgYSBwcm9wZXJ0eWNoYW5nZS4gRWF0IHRoZSBibHVyLWNoYW5nZSBpbiBzcGVjaWFsLmNoYW5nZS5oYW5kbGUuCiAgICAgICAgICAvLyBUaGlzIHN0aWxsIGZpcmVzIG9uY2hhbmdlIGEgc2Vjb25kIHRpbWUgZm9yIGNoZWNrL3JhZGlvIGFmdGVyIGJsdXIuCiAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAiY2hlY2tib3giIHx8IHRoaXMudHlwZSA9PT0gInJhZGlvIikgewogICAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKHRoaXMsICJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2p1c3RfY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZCh0aGlzLCAiY2xpY2suX2NoYW5nZSIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9qdXN0X2NoYW5nZWQgJiYgIWV2ZW50LmlzVHJpZ2dlcikgewogICAgICAgICAgICAgICAgdGhpcy5fanVzdF9jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgfSAvLyBBbGxvdyB0cmlnZ2VyZWQsIHNpbXVsYXRlZCBjaGFuZ2UgZXZlbnRzICgjMTE1MDApCgoKICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoImNoYW5nZSIsIHRoaXMsIGV2ZW50LCB0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgoKICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBlbGVtID0gZS50YXJnZXQ7CgogICAgICAgICAgaWYgKHJmb3JtRWxlbXMudGVzdChlbGVtLm5vZGVOYW1lKSAmJiAhalF1ZXJ5Ll9kYXRhKGVsZW0sICJjaGFuZ2VCdWJibGVzIikpIHsKICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZChlbGVtLCAiY2hhbmdlLl9jaGFuZ2UiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5wYXJlbnROb2RlICYmICFldmVudC5pc1NpbXVsYXRlZCAmJiAhZXZlbnQuaXNUcmlnZ2VyKSB7CiAgICAgICAgICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBqUXVlcnkuX2RhdGEoZWxlbSwgImNoYW5nZUJ1YmJsZXMiLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoZXZlbnQpIHsKICAgICAgICB2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsgLy8gU3dhbGxvdyBuYXRpdmUgY2hhbmdlIGV2ZW50cyBmcm9tIGNoZWNrYm94L3JhZGlvLCB3ZSBhbHJlYWR5IHRyaWdnZXJlZCB0aGVtIGFib3ZlCgogICAgICAgIGlmICh0aGlzICE9PSBlbGVtIHx8IGV2ZW50LmlzU2ltdWxhdGVkIHx8IGV2ZW50LmlzVHJpZ2dlciB8fCBlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSB7CiAgICAgICAgICByZXR1cm4gZXZlbnQuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiB0ZWFyZG93bigpIHsKICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKHRoaXMsICIuX2NoYW5nZSIpOwogICAgICAgIHJldHVybiAhcmZvcm1FbGVtcy50ZXN0KHRoaXMubm9kZU5hbWUpOwogICAgICB9CiAgICB9OwogIH0gLy8gQ3JlYXRlICJidWJibGluZyIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzCgoKICBpZiAoIWpRdWVyeS5zdXBwb3J0LmZvY3VzaW5CdWJibGVzKSB7CiAgICBqUXVlcnkuZWFjaCh7CiAgICAgIGZvY3VzOiAiZm9jdXNpbiIsCiAgICAgIGJsdXI6ICJmb2N1c291dCIKICAgIH0sIGZ1bmN0aW9uIChvcmlnLCBmaXgpIHsKICAgICAgLy8gQXR0YWNoIGEgc2luZ2xlIGNhcHR1cmluZyBoYW5kbGVyIHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAogICAgICB2YXIgYXR0YWNoZXMgPSAwLAogICAgICAgICAgaGFuZGxlciA9IGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQpIHsKICAgICAgICBqUXVlcnkuZXZlbnQuc2ltdWxhdGUoZml4LCBldmVudC50YXJnZXQsIGpRdWVyeS5ldmVudC5maXgoZXZlbnQpLCB0cnVlKTsKICAgICAgfTsKCiAgICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsW2ZpeF0gPSB7CiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uIHNldHVwKCkgewogICAgICAgICAgaWYgKGF0dGFjaGVzKysgPT09IDApIHsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihvcmlnLCBoYW5kbGVyLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiB0ZWFyZG93bigpIHsKICAgICAgICAgIGlmICgtLWF0dGFjaGVzID09PSAwKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIob3JpZywgaGFuZGxlciwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSk7CiAgfQoKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIG9uOiBmdW5jdGlvbiBvbih0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLAogICAgLypJTlRFUk5BTCovCiAgICBvbmUpIHsKICAgICAgdmFyIHR5cGUsIG9yaWdGbjsgLy8gVHlwZXMgY2FuIGJlIGEgbWFwIG9mIHR5cGVzL2hhbmRsZXJzCgogICAgICBpZiAoX3R5cGVvZih0eXBlcykgPT09ICJvYmplY3QiKSB7CiAgICAgICAgLy8gKCB0eXBlcy1PYmplY3QsIHNlbGVjdG9yLCBkYXRhICkKICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIikgewogICAgICAgICAgLy8gKCB0eXBlcy1PYmplY3QsIGRhdGEgKQogICAgICAgICAgZGF0YSA9IGRhdGEgfHwgc2VsZWN0b3I7CiAgICAgICAgICBzZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgICAgICB9CgogICAgICAgIGZvciAodHlwZSBpbiB0eXBlcykgewogICAgICAgICAgdGhpcy5vbih0eXBlLCBzZWxlY3RvciwgZGF0YSwgdHlwZXNbdHlwZV0sIG9uZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgaWYgKGRhdGEgPT0gbnVsbCAmJiBmbiA9PSBudWxsKSB7CiAgICAgICAgLy8gKCB0eXBlcywgZm4gKQogICAgICAgIGZuID0gc2VsZWN0b3I7CiAgICAgICAgZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwogICAgICB9IGVsc2UgaWYgKGZuID09IG51bGwpIHsKICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIikgewogICAgICAgICAgLy8gKCB0eXBlcywgc2VsZWN0b3IsIGZuICkKICAgICAgICAgIGZuID0gZGF0YTsKICAgICAgICAgIGRhdGEgPSB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vICggdHlwZXMsIGRhdGEsIGZuICkKICAgICAgICAgIGZuID0gZGF0YTsKICAgICAgICAgIGRhdGEgPSBzZWxlY3RvcjsKICAgICAgICAgIHNlbGVjdG9yID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGZuID09PSBmYWxzZSkgewogICAgICAgIGZuID0gcmV0dXJuRmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoIWZuKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGlmIChvbmUgPT09IDEpIHsKICAgICAgICBvcmlnRm4gPSBmbjsKCiAgICAgICAgZm4gPSBmdW5jdGlvbiBmbihldmVudCkgewogICAgICAgICAgLy8gQ2FuIHVzZSBhbiBlbXB0eSBzZXQsIHNpbmNlIGV2ZW50IGNvbnRhaW5zIHRoZSBpbmZvCiAgICAgICAgICBqUXVlcnkoKS5vZmYoZXZlbnQpOwogICAgICAgICAgcmV0dXJuIG9yaWdGbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH07IC8vIFVzZSBzYW1lIGd1aWQgc28gY2FsbGVyIGNhbiByZW1vdmUgdXNpbmcgb3JpZ0ZuCgoKICAgICAgICBmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKG9yaWdGbi5ndWlkID0galF1ZXJ5Lmd1aWQrKyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGpRdWVyeS5ldmVudC5hZGQodGhpcywgdHlwZXMsIGZuLCBkYXRhLCBzZWxlY3Rvcik7CiAgICAgIH0pOwogICAgfSwKICAgIG9uZTogZnVuY3Rpb24gb25lKHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4pIHsKICAgICAgcmV0dXJuIHRoaXMub24odHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgMSk7CiAgICB9LAogICAgb2ZmOiBmdW5jdGlvbiBvZmYodHlwZXMsIHNlbGVjdG9yLCBmbikgewogICAgICB2YXIgaGFuZGxlT2JqLCB0eXBlOwoKICAgICAgaWYgKHR5cGVzICYmIHR5cGVzLnByZXZlbnREZWZhdWx0ICYmIHR5cGVzLmhhbmRsZU9iaikgewogICAgICAgIC8vICggZXZlbnQgKSAgZGlzcGF0Y2hlZCBqUXVlcnkuRXZlbnQKICAgICAgICBoYW5kbGVPYmogPSB0eXBlcy5oYW5kbGVPYmo7CiAgICAgICAgalF1ZXJ5KHR5cGVzLmRlbGVnYXRlVGFyZ2V0KS5vZmYoaGFuZGxlT2JqLm5hbWVzcGFjZSA/IGhhbmRsZU9iai5vcmlnVHlwZSArICIuIiArIGhhbmRsZU9iai5uYW1lc3BhY2UgOiBoYW5kbGVPYmoub3JpZ1R5cGUsIGhhbmRsZU9iai5zZWxlY3RvciwgaGFuZGxlT2JqLmhhbmRsZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBpZiAoX3R5cGVvZih0eXBlcykgPT09ICJvYmplY3QiKSB7CiAgICAgICAgLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKICAgICAgICBmb3IgKHR5cGUgaW4gdHlwZXMpIHsKICAgICAgICAgIHRoaXMub2ZmKHR5cGUsIHNlbGVjdG9yLCB0eXBlc1t0eXBlXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgaWYgKHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAvLyAoIHR5cGVzIFssIGZuXSApCiAgICAgICAgZm4gPSBzZWxlY3RvcjsKICAgICAgICBzZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgaWYgKGZuID09PSBmYWxzZSkgewogICAgICAgIGZuID0gcmV0dXJuRmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGpRdWVyeS5ldmVudC5yZW1vdmUodGhpcywgdHlwZXMsIGZuLCBzZWxlY3Rvcik7CiAgICAgIH0pOwogICAgfSwKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQodHlwZXMsIGRhdGEsIGZuKSB7CiAgICAgIHJldHVybiB0aGlzLm9uKHR5cGVzLCBudWxsLCBkYXRhLCBmbik7CiAgICB9LAogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQodHlwZXMsIGZuKSB7CiAgICAgIHJldHVybiB0aGlzLm9mZih0eXBlcywgbnVsbCwgZm4pOwogICAgfSwKICAgIGRlbGVnYXRlOiBmdW5jdGlvbiBkZWxlZ2F0ZShzZWxlY3RvciwgdHlwZXMsIGRhdGEsIGZuKSB7CiAgICAgIHJldHVybiB0aGlzLm9uKHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4pOwogICAgfSwKICAgIHVuZGVsZWdhdGU6IGZ1bmN0aW9uIHVuZGVsZWdhdGUoc2VsZWN0b3IsIHR5cGVzLCBmbikgewogICAgICAvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gdGhpcy5vZmYoc2VsZWN0b3IsICIqKiIpIDogdGhpcy5vZmYodHlwZXMsIHNlbGVjdG9yIHx8ICIqKiIsIGZuKTsKICAgIH0sCiAgICB0cmlnZ2VyOiBmdW5jdGlvbiB0cmlnZ2VyKHR5cGUsIGRhdGEpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXIodHlwZSwgZGF0YSwgdGhpcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbiB0cmlnZ2VySGFuZGxlcih0eXBlLCBkYXRhKSB7CiAgICAgIHZhciBlbGVtID0gdGhpc1swXTsKCiAgICAgIGlmIChlbGVtKSB7CiAgICAgICAgcmV0dXJuIGpRdWVyeS5ldmVudC50cmlnZ2VyKHR5cGUsIGRhdGEsIGVsZW0sIHRydWUpOwogICAgICB9CiAgICB9CiAgfSk7CiAgLyohDQogICAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lDQogICAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMNCiAgICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlDQogICAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vDQogICAqLwoKICAoZnVuY3Rpb24gKHdpbmRvdywgdW5kZWZpbmVkKSB7CiAgICB2YXIgaSwKICAgICAgICBjYWNoZWRydW5zLAogICAgICAgIEV4cHIsCiAgICAgICAgZ2V0VGV4dCwKICAgICAgICBpc1hNTCwKICAgICAgICBjb21waWxlLAogICAgICAgIGhhc0R1cGxpY2F0ZSwKICAgICAgICBvdXRlcm1vc3RDb250ZXh0LAogICAgICAgIC8vIExvY2FsIGRvY3VtZW50IHZhcnMKICAgIHNldERvY3VtZW50LAogICAgICAgIGRvY3VtZW50LAogICAgICAgIGRvY0VsZW0sCiAgICAgICAgZG9jdW1lbnRJc1hNTCwKICAgICAgICByYnVnZ3lRU0EsCiAgICAgICAgcmJ1Z2d5TWF0Y2hlcywKICAgICAgICBtYXRjaGVzLAogICAgICAgIGNvbnRhaW5zLAogICAgICAgIHNvcnRPcmRlciwKICAgICAgICAvLyBJbnN0YW5jZS1zcGVjaWZpYyBkYXRhCiAgICBleHBhbmRvID0gInNpenpsZSIgKyAtbmV3IERhdGUoKSwKICAgICAgICBwcmVmZXJyZWREb2MgPSB3aW5kb3cuZG9jdW1lbnQsCiAgICAgICAgc3VwcG9ydCA9IHt9LAogICAgICAgIGRpcnJ1bnMgPSAwLAogICAgICAgIGRvbmUgPSAwLAogICAgICAgIGNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAogICAgICAgIHRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAogICAgICAgIGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAogICAgICAgIC8vIEdlbmVyYWwtcHVycG9zZSBjb25zdGFudHMKICAgIHN0cnVuZGVmaW5lZCA9IF90eXBlb2YodW5kZWZpbmVkKSwKICAgICAgICBNQVhfTkVHQVRJVkUgPSAxIDw8IDMxLAogICAgICAgIC8vIEFycmF5IG1ldGhvZHMKICAgIGFyciA9IFtdLAogICAgICAgIHBvcCA9IGFyci5wb3AsCiAgICAgICAgcHVzaCA9IGFyci5wdXNoLAogICAgICAgIHNsaWNlID0gYXJyLnNsaWNlLAogICAgICAgIC8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBpZiB3ZSBjYW4ndCB1c2UgYSBuYXRpdmUgb25lCiAgICBpbmRleE9mID0gYXJyLmluZGV4T2YgfHwgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgbGVuID0gdGhpcy5sZW5ndGg7CgogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXNbaV0gPT09IGVsZW0pIHsKICAgICAgICAgIHJldHVybiBpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfSwKICAgICAgICAvLyBSZWd1bGFyIGV4cHJlc3Npb25zCiAgICAvLyBXaGl0ZXNwYWNlIGNoYXJhY3RlcnMgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2UKICAgIHdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCiAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zeW50YXgvI2NoYXJhY3RlcnMKICAgIGNoYXJhY3RlckVuY29kaW5nID0gIig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIiwKICAgICAgICAvLyBMb29zZWx5IG1vZGVsZWQgb24gQ1NTIGlkZW50aWZpZXIgY2hhcmFjdGVycwogICAgLy8gQW4gdW5xdW90ZWQgdmFsdWUgc2hvdWxkIGJlIGEgQ1NTIGlkZW50aWZpZXIgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKICAgIC8vIFByb3BlciBzeW50YXg6IGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCN2YWx1ZS1kZWYtaWRlbnRpZmllcgogICAgaWRlbnRpZmllciA9IGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoInciLCAidyMiKSwKICAgICAgICAvLyBBY2NlcHRhYmxlIG9wZXJhdG9ycyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKICAgIG9wZXJhdG9ycyA9ICIoWypeJHwhfl0/PSkiLAogICAgICAgIGF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKyB3aGl0ZXNwYWNlICsgIiooPzoiICsgb3BlcmF0b3JzICsgd2hpdGVzcGFjZSArICIqKD86KFsnXCJdKSgoPzpcXFxcLnxbXlxcXFxdKSo/KVxcM3woIiArIGlkZW50aWZpZXIgKyAiKXwpfCkiICsgd2hpdGVzcGFjZSArICIqXFxdIiwKICAgICAgICAvLyBQcmVmZXIgYXJndW1lbnRzIHF1b3RlZCwKICAgIC8vICAgdGhlbiBub3QgY29udGFpbmluZyBwc2V1ZG9zL2JyYWNrZXRzLAogICAgLy8gICB0aGVuIGF0dHJpYnV0ZSBzZWxlY3RvcnMvbm9uLXBhcmVudGhldGljYWwgZXhwcmVzc2lvbnMsCiAgICAvLyAgIHRoZW4gYW55dGhpbmcgZWxzZQogICAgLy8gVGhlc2UgcHJlZmVyZW5jZXMgYXJlIGhlcmUgdG8gcmVkdWNlIHRoZSBudW1iZXIgb2Ygc2VsZWN0b3JzCiAgICAvLyAgIG5lZWRpbmcgdG9rZW5pemUgaW4gdGhlIFBTRVVETyBwcmVGaWx0ZXIKICAgIHBzZXVkb3MgPSAiOigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OlxcKCgoWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgoPzpcXFxcLnxbXlxcXFwoKVtcXF1dfCIgKyBhdHRyaWJ1dGVzLnJlcGxhY2UoMywgOCkgKyAiKSopfC4qKVxcKXwpIiwKICAgICAgICAvLyBMZWFkaW5nIGFuZCBub24tZXNjYXBlZCB0cmFpbGluZyB3aGl0ZXNwYWNlLCBjYXB0dXJpbmcgc29tZSBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXJzIHByZWNlZGluZyB0aGUgbGF0dGVyCiAgICBydHJpbSA9IG5ldyBSZWdFeHAoIl4iICsgd2hpdGVzcGFjZSArICIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiICsgd2hpdGVzcGFjZSArICIrJCIsICJnIiksCiAgICAgICAgcmNvbW1hID0gbmV3IFJlZ0V4cCgiXiIgKyB3aGl0ZXNwYWNlICsgIiosIiArIHdoaXRlc3BhY2UgKyAiKiIpLAogICAgICAgIHJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoIl4iICsgd2hpdGVzcGFjZSArICIqKFtcXHgyMFxcdFxcclxcblxcZj4rfl0pIiArIHdoaXRlc3BhY2UgKyAiKiIpLAogICAgICAgIHJwc2V1ZG8gPSBuZXcgUmVnRXhwKHBzZXVkb3MpLAogICAgICAgIHJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCgiXiIgKyBpZGVudGlmaWVyICsgIiQiKSwKICAgICAgICBtYXRjaEV4cHIgPSB7CiAgICAgICJJRCI6IG5ldyBSZWdFeHAoIl4jKCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpIiksCiAgICAgICJDTEFTUyI6IG5ldyBSZWdFeHAoIl5cXC4oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiKSwKICAgICAgIk5BTUUiOiBuZXcgUmVnRXhwKCJeXFxbbmFtZT1bJ1wiXT8oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIilbJ1wiXT9cXF0iKSwKICAgICAgIlRBRyI6IG5ldyBSZWdFeHAoIl4oIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoInciLCAidyoiKSArICIpIiksCiAgICAgICJBVFRSIjogbmV3IFJlZ0V4cCgiXiIgKyBhdHRyaWJ1dGVzKSwKICAgICAgIlBTRVVETyI6IG5ldyBSZWdFeHAoIl4iICsgcHNldWRvcyksCiAgICAgICJDSElMRCI6IG5ldyBSZWdFeHAoIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIgKyB3aGl0ZXNwYWNlICsgIiooZXZlbnxvZGR8KChbKy1dfCkoXFxkKilufCkiICsgd2hpdGVzcGFjZSArICIqKD86KFsrLV18KSIgKyB3aGl0ZXNwYWNlICsgIiooXFxkKyl8KSkiICsgd2hpdGVzcGFjZSArICIqXFwpfCkiLCAiaSIpLAogICAgICAvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKICAgICAgLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAogICAgICAibmVlZHNDb250ZXh0IjogbmV3IFJlZ0V4cCgiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKyB3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiKQogICAgfSwKICAgICAgICByc2libGluZyA9IC9bXHgyMFx0XHJcblxmXSpbK35dLywKICAgICAgICBybmF0aXZlID0gL15bXntdK1x7XHMqXFtuYXRpdmUgY29kZS8sCiAgICAgICAgLy8gRWFzaWx5LXBhcnNlYWJsZS9yZXRyaWV2YWJsZSBJRCBvciBUQUcgb3IgQ0xBU1Mgc2VsZWN0b3JzCiAgICBycXVpY2tFeHByID0gL14oPzojKFtcdy1dKyl8KFx3Kyl8XC4oW1x3LV0rKSkkLywKICAgICAgICByaW5wdXRzID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKICAgICAgICByaGVhZGVyID0gL15oXGQkL2ksCiAgICAgICAgcmVzY2FwZSA9IC8nfFxcL2csCiAgICAgICAgcmF0dHJpYnV0ZVF1b3RlcyA9IC9cPVtceDIwXHRcclxuXGZdKihbXiciXF1dKilbXHgyMFx0XHJcblxmXSpcXS9nLAogICAgICAgIC8vIENTUyBlc2NhcGVzIGh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIxL3N5bmRhdGEuaHRtbCNlc2NhcGVkLWNoYXJhY3RlcnMKICAgIHJ1bmVzY2FwZSA9IC9cXChbXGRhLWZBLUZdezEsNn1bXHgyMFx0XHJcblxmXT98LikvZywKICAgICAgICBmdW5lc2NhcGUgPSBmdW5jdGlvbiBmdW5lc2NhcGUoXywgZXNjYXBlZCkgewogICAgICB2YXIgaGlnaCA9ICIweCIgKyBlc2NhcGVkIC0gMHgxMDAwMDsgLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCiAgICAgIHJldHVybiBoaWdoICE9PSBoaWdoID8gZXNjYXBlZCA6IC8vIEJNUCBjb2RlcG9pbnQKICAgICAgaGlnaCA8IDAgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGhpZ2ggKyAweDEwMDAwKSA6IC8vIFN1cHBsZW1lbnRhbCBQbGFuZSBjb2RlcG9pbnQgKHN1cnJvZ2F0ZSBwYWlyKQogICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlKGhpZ2ggPj4gMTAgfCAweEQ4MDAsIGhpZ2ggJiAweDNGRiB8IDB4REMwMCk7CiAgICB9OyAvLyBVc2UgYSBzdHJpcHBlZC1kb3duIHNsaWNlIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUKCgogICAgdHJ5IHsKICAgICAgc2xpY2UuY2FsbChwcmVmZXJyZWREb2MuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsIDApWzBdLm5vZGVUeXBlOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzbGljZSA9IGZ1bmN0aW9uIHNsaWNlKGkpIHsKICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgICAgcmVzdWx0cyA9IFtdOwoKICAgICAgICB3aGlsZSAoZWxlbSA9IHRoaXNbaSsrXSkgewogICAgICAgICAgcmVzdWx0cy5wdXNoKGVsZW0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgIH07CiAgICB9CiAgICAvKioNCiAgICAgKiBGb3IgZmVhdHVyZSBkZXRlY3Rpb24NCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gdGVzdCBmb3IgbmF0aXZlIHN1cHBvcnQNCiAgICAgKi8KCgogICAgZnVuY3Rpb24gaXNOYXRpdmUoZm4pIHsKICAgICAgcmV0dXJuIHJuYXRpdmUudGVzdChmbiArICIiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBrZXktdmFsdWUgY2FjaGVzIG9mIGxpbWl0ZWQgc2l6ZQ0KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgNCiAgICAgKglwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKQ0KICAgICAqCWRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnkNCiAgICAgKi8KCgogICAgZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7CiAgICAgIHZhciBfY2FjaGUsCiAgICAgICAgICBrZXlzID0gW107CgogICAgICByZXR1cm4gX2NhY2hlID0gZnVuY3Rpb24gY2FjaGUoa2V5LCB2YWx1ZSkgewogICAgICAgIC8vIFVzZSAoa2V5ICsgIiAiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KQogICAgICAgIGlmIChrZXlzLnB1c2goa2V5ICs9ICIgIikgPiBFeHByLmNhY2hlTGVuZ3RoKSB7CiAgICAgICAgICAvLyBPbmx5IGtlZXAgdGhlIG1vc3QgcmVjZW50IGVudHJpZXMKICAgICAgICAgIGRlbGV0ZSBfY2FjaGVba2V5cy5zaGlmdCgpXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY2FjaGVba2V5XSA9IHZhbHVlOwogICAgICB9OwogICAgfQogICAgLyoqDQogICAgICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUNCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gbWFyaw0KICAgICAqLwoKCiAgICBmdW5jdGlvbiBtYXJrRnVuY3Rpb24oZm4pIHsKICAgICAgZm5bZXhwYW5kb10gPSB0cnVlOwogICAgICByZXR1cm4gZm47CiAgICB9CiAgICAvKioNCiAgICAgKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudA0KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdA0KICAgICAqLwoKCiAgICBmdW5jdGlvbiBhc3NlcnQoZm4pIHsKICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZm4oZGl2KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQogICAgICAgIGRpdiA9IG51bGw7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBTaXp6bGUoc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpIHsKICAgICAgdmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSwgLy8gUVNBIHZhcnMKICAgICAgaSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7CgogICAgICBpZiAoKGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYykgIT09IGRvY3VtZW50KSB7CiAgICAgICAgc2V0RG9jdW1lbnQoY29udGV4dCk7CiAgICAgIH0KCiAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwogICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsKCiAgICAgIGlmICghc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICB9CgogICAgICBpZiAoKG5vZGVUeXBlID0gY29udGV4dC5ub2RlVHlwZSkgIT09IDEgJiYgbm9kZVR5cGUgIT09IDkpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIGlmICghZG9jdW1lbnRJc1hNTCAmJiAhc2VlZCkgewogICAgICAgIC8vIFNob3J0Y3V0cwogICAgICAgIGlmIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyhzZWxlY3RvcikpIHsKICAgICAgICAgIC8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCiAgICAgICAgICBpZiAobSA9IG1hdGNoWzFdKSB7CiAgICAgICAgICAgIGlmIChub2RlVHlwZSA9PT0gOSkgewogICAgICAgICAgICAgIGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKG0pOyAvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwogICAgICAgICAgICAgIC8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCiAgICAgICAgICAgICAgaWYgKGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUsIE9wZXJhLCBhbmQgV2Via2l0IHJldHVybiBpdGVtcwogICAgICAgICAgICAgICAgLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECiAgICAgICAgICAgICAgICBpZiAoZWxlbS5pZCA9PT0gbSkgewogICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZWxlbSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gQ29udGV4dCBpcyBub3QgYSBkb2N1bWVudAogICAgICAgICAgICAgIGlmIChjb250ZXh0Lm93bmVyRG9jdW1lbnQgJiYgKGVsZW0gPSBjb250ZXh0Lm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobSkpICYmIGNvbnRhaW5zKGNvbnRleHQsIGVsZW0pICYmIGVsZW0uaWQgPT09IG0pIHsKICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChlbGVtKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBTcGVlZC11cDogU2l6emxlKCJUQUciKQoKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hbMl0pIHsKICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoc2VsZWN0b3IpLCAwKSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzOyAvLyBTcGVlZC11cDogU2l6emxlKCIuQ0xBU1MiKQogICAgICAgICAgfSBlbHNlIGlmICgobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEJ5Q2xhc3NOYW1lICYmIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSkgewogICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIHNsaWNlLmNhbGwoY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKG0pLCAwKSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUVNBIHBhdGgKCgogICAgICAgIGlmIChzdXBwb3J0LnFzYSAmJiAhcmJ1Z2d5UVNBLnRlc3Qoc2VsZWN0b3IpKSB7CiAgICAgICAgICBvbGQgPSB0cnVlOwogICAgICAgICAgbmlkID0gZXhwYW5kbzsKICAgICAgICAgIG5ld0NvbnRleHQgPSBjb250ZXh0OwogICAgICAgICAgbmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjsgLy8gcVNBIHdvcmtzIHN0cmFuZ2VseSBvbiBFbGVtZW50LXJvb3RlZCBxdWVyaWVzCiAgICAgICAgICAvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CiAgICAgICAgICAvLyBhbmQgd29ya2luZyB1cCBmcm9tIHRoZXJlIChUaGFua3MgdG8gQW5kcmV3IER1cG9udCBmb3IgdGhlIHRlY2huaXF1ZSkKICAgICAgICAgIC8vIElFIDggZG9lc24ndCB3b3JrIG9uIG9iamVjdCBlbGVtZW50cwoKICAgICAgICAgIGlmIChub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIGdyb3VwcyA9IHRva2VuaXplKHNlbGVjdG9yKTsKCiAgICAgICAgICAgIGlmIChvbGQgPSBjb250ZXh0LmdldEF0dHJpYnV0ZSgiaWQiKSkgewogICAgICAgICAgICAgIG5pZCA9IG9sZC5yZXBsYWNlKHJlc2NhcGUsICJcXCQmIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGV4dC5zZXRBdHRyaWJ1dGUoImlkIiwgbmlkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwogICAgICAgICAgICBpID0gZ3JvdXBzLmxlbmd0aDsKCiAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICBncm91cHNbaV0gPSBuaWQgKyB0b1NlbGVjdG9yKGdyb3Vwc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5ld0NvbnRleHQgPSByc2libGluZy50ZXN0KHNlbGVjdG9yKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dDsKICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBncm91cHMuam9pbigiLCIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChuZXdTZWxlY3RvcikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHB1c2guYXBwbHkocmVzdWx0cywgc2xpY2UuY2FsbChuZXdDb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwobmV3U2VsZWN0b3IpLCAwKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICAgIH0gY2F0Y2ggKHFzYUVycm9yKSB7fSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAoIW9sZCkgewogICAgICAgICAgICAgICAgY29udGV4dC5yZW1vdmVBdHRyaWJ1dGUoImlkIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIEFsbCBvdGhlcnMKCgogICAgICByZXR1cm4gc2VsZWN0KHNlbGVjdG9yLnJlcGxhY2UocnRyaW0sICIkMSIpLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkKTsKICAgIH0KICAgIC8qKg0KICAgICAqIERldGVjdCB4bWwNCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudA0KICAgICAqLwoKCiAgICBpc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgIC8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3QKICAgICAgLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCiAgICAgIHZhciBkb2N1bWVudEVsZW1lbnQgPSBlbGVtICYmIChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSkuZG9jdW1lbnRFbGVtZW50OwogICAgICByZXR1cm4gZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICE9PSAiSFRNTCIgOiBmYWxzZTsKICAgIH07CiAgICAvKioNCiAgICAgKiBTZXRzIGRvY3VtZW50LXJlbGF0ZWQgdmFyaWFibGVzIG9uY2UgYmFzZWQgb24gdGhlIGN1cnJlbnQgZG9jdW1lbnQNCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudA0KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGN1cnJlbnQgZG9jdW1lbnQNCiAgICAgKi8KCgogICAgc2V0RG9jdW1lbnQgPSBTaXp6bGUuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbiAobm9kZSkgewogICAgICB2YXIgZG9jID0gbm9kZSA/IG5vZGUub3duZXJEb2N1bWVudCB8fCBub2RlIDogcHJlZmVycmVkRG9jOyAvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuCgogICAgICBpZiAoZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQ7CiAgICAgIH0gLy8gU2V0IG91ciBkb2N1bWVudAoKCiAgICAgIGRvY3VtZW50ID0gZG9jOwogICAgICBkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsgLy8gU3VwcG9ydCB0ZXN0cwoKICAgICAgZG9jdW1lbnRJc1hNTCA9IGlzWE1MKGRvYyk7IC8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzCgogICAgICBzdXBwb3J0LnRhZ05hbWVOb0NvbW1lbnRzID0gYXNzZXJ0KGZ1bmN0aW9uIChkaXYpIHsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZUNvbW1lbnQoIiIpKTsKICAgICAgICByZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKICAgICAgfSk7IC8vIENoZWNrIGlmIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIHJldHJpZXZlZCBieSBhdHRyaWJ1dGUgbm9kZXMKCiAgICAgIHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiAoZGl2KSB7CiAgICAgICAgZGl2LmlubmVySFRNTCA9ICI8c2VsZWN0Pjwvc2VsZWN0PiI7CgogICAgICAgIHZhciB0eXBlID0gX3R5cGVvZihkaXYubGFzdENoaWxkLmdldEF0dHJpYnV0ZSgibXVsdGlwbGUiKSk7IC8vIElFOCByZXR1cm5zIGEgc3RyaW5nIGZvciBzb21lIGF0dHJpYnV0ZXMgZXZlbiB3aGVuIG5vdCBwcmVzZW50CgoKICAgICAgICByZXR1cm4gdHlwZSAhPT0gImJvb2xlYW4iICYmIHR5cGUgIT09ICJzdHJpbmciOwogICAgICB9KTsgLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBjYW4gYmUgdHJ1c3RlZAoKICAgICAgc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSA9IGFzc2VydChmdW5jdGlvbiAoZGl2KSB7CiAgICAgICAgLy8gT3BlcmEgY2FuJ3QgZmluZCBhIHNlY29uZCBjbGFzc25hbWUgKGluIDkuNikKICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxkaXYgY2xhc3M9J2hpZGRlbiBlJz48L2Rpdj48ZGl2IGNsYXNzPSdoaWRkZW4nPjwvZGl2PiI7CgogICAgICAgIGlmICghZGl2LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgfHwgIWRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSAvLyBTYWZhcmkgMy4yIGNhY2hlcyBjbGFzcyBhdHRyaWJ1dGVzIGFuZCBkb2Vzbid0IGNhdGNoIGNoYW5nZXMKCgogICAgICAgIGRpdi5sYXN0Q2hpbGQuY2xhc3NOYW1lID0gImUiOwogICAgICAgIHJldHVybiBkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCA9PT0gMjsKICAgICAgfSk7IC8vIENoZWNrIGlmIGdldEVsZW1lbnRCeUlkIHJldHVybnMgZWxlbWVudHMgYnkgbmFtZQogICAgICAvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5TmFtZSBwcml2aWxlZ2VzIGZvcm0gY29udHJvbHMgb3IgcmV0dXJucyBlbGVtZW50cyBieSBJRAoKICAgICAgc3VwcG9ydC5nZXRCeU5hbWUgPSBhc3NlcnQoZnVuY3Rpb24gKGRpdikgewogICAgICAgIC8vIEluamVjdCBjb250ZW50CiAgICAgICAgZGl2LmlkID0gZXhwYW5kbyArIDA7CiAgICAgICAgZGl2LmlubmVySFRNTCA9ICI8YSBuYW1lPSciICsgZXhwYW5kbyArICInPjwvYT48ZGl2IG5hbWU9JyIgKyBleHBhbmRvICsgIic+PC9kaXY+IjsKICAgICAgICBkb2NFbGVtLmluc2VydEJlZm9yZShkaXYsIGRvY0VsZW0uZmlyc3RDaGlsZCk7IC8vIFRlc3QKCiAgICAgICAgdmFyIHBhc3MgPSBkb2MuZ2V0RWxlbWVudHNCeU5hbWUgJiYgLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gZmV3ZXIgdGhhbiB0aGUgY29ycmVjdCAyCiAgICAgICAgZG9jLmdldEVsZW1lbnRzQnlOYW1lKGV4cGFuZG8pLmxlbmd0aCA9PT0gMiArIC8vIGJ1Z2d5IGJyb3dzZXJzIHdpbGwgcmV0dXJuIG1vcmUgdGhhbiB0aGUgY29ycmVjdCAwCiAgICAgICAgZG9jLmdldEVsZW1lbnRzQnlOYW1lKGV4cGFuZG8gKyAwKS5sZW5ndGg7CiAgICAgICAgc3VwcG9ydC5nZXRJZE5vdE5hbWUgPSAhZG9jLmdldEVsZW1lbnRCeUlkKGV4cGFuZG8pOyAvLyBDbGVhbnVwCgogICAgICAgIGRvY0VsZW0ucmVtb3ZlQ2hpbGQoZGl2KTsKICAgICAgICByZXR1cm4gcGFzczsKICAgICAgfSk7IC8vIElFNi83IHJldHVybiBtb2RpZmllZCBhdHRyaWJ1dGVzCgogICAgICBFeHByLmF0dHJIYW5kbGUgPSBhc3NlcnQoZnVuY3Rpb24gKGRpdikgewogICAgICAgIGRpdi5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIyc+PC9hPiI7CiAgICAgICAgcmV0dXJuIGRpdi5maXJzdENoaWxkICYmIF90eXBlb2YoZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKSAhPT0gc3RydW5kZWZpbmVkICYmIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiIyI7CiAgICAgIH0pID8ge30gOiB7CiAgICAgICAgImhyZWYiOiBmdW5jdGlvbiBocmVmKGVsZW0pIHsKICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaHJlZiIsIDIpOwogICAgICAgIH0sCiAgICAgICAgInR5cGUiOiBmdW5jdGlvbiB0eXBlKGVsZW0pIHsKICAgICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwogICAgICAgIH0KICAgICAgfTsgLy8gSUQgZmluZCBhbmQgZmlsdGVyCgogICAgICBpZiAoc3VwcG9ydC5nZXRJZE5vdE5hbWUpIHsKICAgICAgICBFeHByLmZpbmRbIklEIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHsKICAgICAgICAgIGlmIChfdHlwZW9mKGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQpICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwpIHsKICAgICAgICAgICAgdmFyIG0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKGlkKTsgLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKICAgICAgICAgICAgLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2MwoKICAgICAgICAgICAgcmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgRXhwci5maWx0ZXJbIklEIl0gPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgIHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IGF0dHJJZDsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBFeHByLmZpbmRbIklEIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHsKICAgICAgICAgIGlmIChfdHlwZW9mKGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQpICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwpIHsKICAgICAgICAgICAgdmFyIG0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgcmV0dXJuIG0gPyBtLmlkID09PSBpZCB8fCBfdHlwZW9mKG0uZ2V0QXR0cmlidXRlTm9kZSkgIT09IHN0cnVuZGVmaW5lZCAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWUgPT09IGlkID8gW21dIDogdW5kZWZpbmVkIDogW107CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgRXhwci5maWx0ZXJbIklEIl0gPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgIHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICB2YXIgbm9kZSA9IF90eXBlb2YoZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKSAhPT0gc3RydW5kZWZpbmVkICYmIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTsKICAgICAgICAgICAgcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwogICAgICAgICAgfTsKICAgICAgICB9OwogICAgICB9IC8vIFRhZwoKCiAgICAgIEV4cHIuZmluZFsiVEFHIl0gPSBzdXBwb3J0LnRhZ05hbWVOb0NvbW1lbnRzID8gZnVuY3Rpb24gKHRhZywgY29udGV4dCkgewogICAgICAgIGlmIChfdHlwZW9mKGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUpICE9PSBzdHJ1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZyk7CiAgICAgICAgfQogICAgICB9IDogZnVuY3Rpb24gKHRhZywgY29udGV4dCkgewogICAgICAgIHZhciBlbGVtLAogICAgICAgICAgICB0bXAgPSBbXSwKICAgICAgICAgICAgaSA9IDAsCiAgICAgICAgICAgIHJlc3VsdHMgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZyk7IC8vIEZpbHRlciBvdXQgcG9zc2libGUgY29tbWVudHMKCiAgICAgICAgaWYgKHRhZyA9PT0gIioiKSB7CiAgICAgICAgICB3aGlsZSAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgewogICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRtcC5wdXNoKGVsZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRtcDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICB9OyAvLyBOYW1lCgogICAgICBFeHByLmZpbmRbIk5BTUUiXSA9IHN1cHBvcnQuZ2V0QnlOYW1lICYmIGZ1bmN0aW9uICh0YWcsIGNvbnRleHQpIHsKICAgICAgICBpZiAoX3R5cGVvZihjb250ZXh0LmdldEVsZW1lbnRzQnlOYW1lKSAhPT0gc3RydW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5TmFtZShuYW1lKTsKICAgICAgICB9CiAgICAgIH07IC8vIENsYXNzCgoKICAgICAgRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiAoY2xhc3NOYW1lLCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF90eXBlb2YoY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSAhPT0gc3RydW5kZWZpbmVkICYmICFkb2N1bWVudElzWE1MKSB7CiAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgfQogICAgICB9OyAvLyBRU0EgYW5kIG1hdGNoZXNTZWxlY3RvciBzdXBwb3J0CiAgICAgIC8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCgoKICAgICAgcmJ1Z2d5TWF0Y2hlcyA9IFtdOyAvLyBxU2EoOmZvY3VzKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoQ2hyb21lIDIxKSwKICAgICAgLy8gbm8gbmVlZCB0byBhbHNvIGFkZCB0byBidWdneU1hdGNoZXMgc2luY2UgbWF0Y2hlcyBjaGVja3MgYnVnZ3lRU0EKICAgICAgLy8gQSBzdXBwb3J0IHRlc3Qgd291bGQgcmVxdWlyZSB0b28gbXVjaCBjb2RlICh3b3VsZCBpbmNsdWRlIGRvY3VtZW50IHJlYWR5KQoKICAgICAgcmJ1Z2d5UVNBID0gWyI6Zm9jdXMiXTsKCiAgICAgIGlmIChzdXBwb3J0LnFzYSA9IGlzTmF0aXZlKGRvYy5xdWVyeVNlbGVjdG9yQWxsKSkgewogICAgICAgIC8vIEJ1aWxkIFFTQSByZWdleAogICAgICAgIC8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmkKICAgICAgICBhc3NlcnQoZnVuY3Rpb24gKGRpdikgewogICAgICAgICAgLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZQogICAgICAgICAgLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWN0bHkKICAgICAgICAgIC8vIHNldHRpbmcgYSBib29sZWFuIGNvbnRlbnQgYXR0cmlidXRlLAogICAgICAgICAgLy8gc2luY2UgaXRzIHByZXNlbmNlIHNob3VsZCBiZSBlbm91Z2gKICAgICAgICAgIC8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CiAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxzZWxlY3Q+PG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOyAvLyBJRTggLSBTb21lIGJvb2xlYW4gYXR0cmlidXRlcyBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgogICAgICAgICAgaWYgKCFkaXYucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aCkgewogICAgICAgICAgICByYnVnZ3lRU0EucHVzaCgiXFxbIiArIHdoaXRlc3BhY2UgKyAiKig/OmNoZWNrZWR8ZGlzYWJsZWR8aXNtYXB8bXVsdGlwbGV8cmVhZG9ubHl8c2VsZWN0ZWR8dmFsdWUpIik7CiAgICAgICAgICB9IC8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCiAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZAogICAgICAgICAgLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCgogICAgICAgICAgaWYgKCFkaXYucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGgpIHsKICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goIjpjaGVja2VkIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgYXNzZXJ0KGZ1bmN0aW9uIChkaXYpIHsKICAgICAgICAgIC8vIE9wZXJhIDEwLTEyL0lFOCAtIF49ICQ9ICo9IGFuZCBlbXB0eSB2YWx1ZXMKICAgICAgICAgIC8vIFNob3VsZCBub3Qgc2VsZWN0IGFueXRoaW5nCiAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGk9JycvPiI7CgogICAgICAgICAgaWYgKGRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbaV49JyddIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCJbKl4kXT0iICsgd2hpdGVzcGFjZSArICIqKD86XCJcInwnJykiKTsKICAgICAgICAgIH0gLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKICAgICAgICAgIC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgoKICAgICAgICAgIGlmICghZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKTsKICAgICAgICAgIH0gLy8gT3BlcmEgMTAtMTEgZG9lcyBub3QgdGhyb3cgb24gcG9zdC1jb21tYSBpbnZhbGlkIHBzZXVkb3MKCgogICAgICAgICAgZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKTsKICAgICAgICAgIHJidWdneVFTQS5wdXNoKCIsLio6Iik7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciA9IGlzTmF0aXZlKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwgZG9jRWxlbS5tc01hdGNoZXNTZWxlY3RvcikpIHsKICAgICAgICBhc3NlcnQoZnVuY3Rpb24gKGRpdikgewogICAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZG8gbWF0Y2hlc1NlbGVjdG9yCiAgICAgICAgICAvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQogICAgICAgICAgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCA9IG1hdGNoZXMuY2FsbChkaXYsICJkaXYiKTsgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvbgogICAgICAgICAgLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAoKICAgICAgICAgIG1hdGNoZXMuY2FsbChkaXYsICJbcyE9JyddOngiKTsKICAgICAgICAgIHJidWdneU1hdGNoZXMucHVzaCgiIT0iLCBwc2V1ZG9zKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmJ1Z2d5UVNBID0gbmV3IFJlZ0V4cChyYnVnZ3lRU0Euam9pbigifCIpKTsKICAgICAgcmJ1Z2d5TWF0Y2hlcyA9IG5ldyBSZWdFeHAocmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikpOyAvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXIKICAgICAgLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAogICAgICAvLyBBcyBpbiwgYW4gZWxlbWVudCBkb2VzIG5vdCBjb250YWluIGl0c2VsZgoKICAgICAgY29udGFpbnMgPSBpc05hdGl2ZShkb2NFbGVtLmNvbnRhaW5zKSB8fCBkb2NFbGVtLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYWRvd24gPSBhLm5vZGVUeXBlID09PSA5ID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhLAogICAgICAgICAgICBidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKICAgICAgICByZXR1cm4gYSA9PT0gYnVwIHx8ICEhKGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKGFkb3duLmNvbnRhaW5zID8gYWRvd24uY29udGFpbnMoYnVwKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihidXApICYgMTYpKTsKICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGIpIHsKICAgICAgICAgIHdoaWxlIChiID0gYi5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGlmIChiID09PSBhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsgLy8gRG9jdW1lbnQgb3JkZXIgc29ydGluZwoKICAgICAgc29ydE9yZGVyID0gZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGNvbXBhcmU7CgogICAgICAgIGlmIChhID09PSBiKSB7CiAgICAgICAgICBoYXNEdXBsaWNhdGUgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29tcGFyZSA9IGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpKSB7CiAgICAgICAgICBpZiAoY29tcGFyZSAmIDEgfHwgYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMTEpIHsKICAgICAgICAgICAgaWYgKGEgPT09IGRvYyB8fCBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYiA9PT0gZG9jIHx8IGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikpIHsKICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAtMSA6IDE7CiAgICAgIH0gOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjdXIsCiAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICBhdXAgPSBhLnBhcmVudE5vZGUsCiAgICAgICAgICAgIGJ1cCA9IGIucGFyZW50Tm9kZSwKICAgICAgICAgICAgYXAgPSBbYV0sCiAgICAgICAgICAgIGJwID0gW2JdOyAvLyBFeGl0IGVhcmx5IGlmIHRoZSBub2RlcyBhcmUgaWRlbnRpY2FsCgogICAgICAgIGlmIChhID09PSBiKSB7CiAgICAgICAgICBoYXNEdXBsaWNhdGUgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIDA7IC8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCiAgICAgICAgfSBlbHNlIGlmICghYXVwIHx8ICFidXApIHsKICAgICAgICAgIHJldHVybiBhID09PSBkb2MgPyAtMSA6IGIgPT09IGRvYyA/IDEgOiBhdXAgPyAtMSA6IGJ1cCA/IDEgOiAwOyAvLyBJZiB0aGUgbm9kZXMgYXJlIHNpYmxpbmdzLCB3ZSBjYW4gZG8gYSBxdWljayBjaGVjawogICAgICAgIH0gZWxzZSBpZiAoYXVwID09PSBidXApIHsKICAgICAgICAgIHJldHVybiBzaWJsaW5nQ2hlY2soYSwgYik7CiAgICAgICAgfSAvLyBPdGhlcndpc2Ugd2UgbmVlZCBmdWxsIGxpc3RzIG9mIHRoZWlyIGFuY2VzdG9ycyBmb3IgY29tcGFyaXNvbgoKCiAgICAgICAgY3VyID0gYTsKCiAgICAgICAgd2hpbGUgKGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7CiAgICAgICAgICBhcC51bnNoaWZ0KGN1cik7CiAgICAgICAgfQoKICAgICAgICBjdXIgPSBiOwoKICAgICAgICB3aGlsZSAoY3VyID0gY3VyLnBhcmVudE5vZGUpIHsKICAgICAgICAgIGJwLnVuc2hpZnQoY3VyKTsKICAgICAgICB9IC8vIFdhbGsgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5CgoKICAgICAgICB3aGlsZSAoYXBbaV0gPT09IGJwW2ldKSB7CiAgICAgICAgICBpKys7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaSA/IC8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvcgogICAgICAgIHNpYmxpbmdDaGVjayhhcFtpXSwgYnBbaV0pIDogLy8gT3RoZXJ3aXNlIG5vZGVzIGluIG91ciBkb2N1bWVudCBzb3J0IGZpcnN0CiAgICAgICAgYXBbaV0gPT09IHByZWZlcnJlZERvYyA/IC0xIDogYnBbaV0gPT09IHByZWZlcnJlZERvYyA/IDEgOiAwOwogICAgICB9OyAvLyBBbHdheXMgYXNzdW1lIHRoZSBwcmVzZW5jZSBvZiBkdXBsaWNhdGVzIGlmIHNvcnQgZG9lc24ndAogICAgICAvLyBwYXNzIHRoZW0gdG8gb3VyIGNvbXBhcmlzb24gZnVuY3Rpb24gKGFzIGluIEdvb2dsZSBDaHJvbWUpLgoKICAgICAgaGFzRHVwbGljYXRlID0gZmFsc2U7CiAgICAgIFswLCAwXS5zb3J0KHNvcnRPcmRlcik7CiAgICAgIHN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlcyA9IGhhc0R1cGxpY2F0ZTsKICAgICAgcmV0dXJuIGRvY3VtZW50OwogICAgfTsKCiAgICBTaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChleHByLCBlbGVtZW50cykgewogICAgICByZXR1cm4gU2l6emxlKGV4cHIsIG51bGwsIG51bGwsIGVsZW1lbnRzKTsKICAgIH07CgogICAgU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uIChlbGVtLCBleHByKSB7CiAgICAgIC8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAogICAgICBpZiAoKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKSAhPT0gZG9jdW1lbnQpIHsKICAgICAgICBzZXREb2N1bWVudChlbGVtKTsKICAgICAgfSAvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWQKCgogICAgICBleHByID0gZXhwci5yZXBsYWNlKHJhdHRyaWJ1dGVRdW90ZXMsICI9JyQxJ10iKTsgLy8gcmJ1Z2d5UVNBIGFsd2F5cyBjb250YWlucyA6Zm9jdXMsIHNvIG5vIG5lZWQgZm9yIGFuIGV4aXN0ZW5jZSBjaGVjawoKICAgICAgaWYgKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yICYmICFkb2N1bWVudElzWE1MICYmICghcmJ1Z2d5TWF0Y2hlcyB8fCAhcmJ1Z2d5TWF0Y2hlcy50ZXN0KGV4cHIpKSAmJiAhcmJ1Z2d5UVNBLnRlc3QoZXhwcikpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHJldCA9IG1hdGNoZXMuY2FsbChlbGVtLCBleHByKTsgLy8gSUUgOSdzIG1hdGNoZXNTZWxlY3RvciByZXR1cm5zIGZhbHNlIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwoKICAgICAgICAgIGlmIChyZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fCAvLyBBcyB3ZWxsLCBkaXNjb25uZWN0ZWQgbm9kZXMgYXJlIHNhaWQgdG8gYmUgaW4gYSBkb2N1bWVudAogICAgICAgICAgLy8gZnJhZ21lbnQgaW4gSUUgOQogICAgICAgICAgZWxlbS5kb2N1bWVudCAmJiBlbGVtLmRvY3VtZW50Lm5vZGVUeXBlICE9PSAxMSkgewogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgIH0KCiAgICAgIHJldHVybiBTaXp6bGUoZXhwciwgZG9jdW1lbnQsIG51bGwsIFtlbGVtXSkubGVuZ3RoID4gMDsKICAgIH07CgogICAgU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGNvbnRleHQsIGVsZW0pIHsKICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCiAgICAgIGlmICgoY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQpICE9PSBkb2N1bWVudCkgewogICAgICAgIHNldERvY3VtZW50KGNvbnRleHQpOwogICAgICB9CgogICAgICByZXR1cm4gY29udGFpbnMoY29udGV4dCwgZWxlbSk7CiAgICB9OwoKICAgIFNpenpsZS5hdHRyID0gZnVuY3Rpb24gKGVsZW0sIG5hbWUpIHsKICAgICAgdmFyIHZhbDsgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCgogICAgICBpZiAoKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKSAhPT0gZG9jdW1lbnQpIHsKICAgICAgICBzZXREb2N1bWVudChlbGVtKTsKICAgICAgfQoKICAgICAgaWYgKCFkb2N1bWVudElzWE1MKSB7CiAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgfQoKICAgICAgaWYgKHZhbCA9IEV4cHIuYXR0ckhhbmRsZVtuYW1lXSkgewogICAgICAgIHJldHVybiB2YWwoZWxlbSk7CiAgICAgIH0KCiAgICAgIGlmIChkb2N1bWVudElzWE1MIHx8IHN1cHBvcnQuYXR0cmlidXRlcykgewogICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgfQoKICAgICAgcmV0dXJuICgodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSB8fCBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKSkgJiYgZWxlbVtuYW1lXSA9PT0gdHJ1ZSA/IG5hbWUgOiB2YWwgJiYgdmFsLnNwZWNpZmllZCA/IHZhbC52YWx1ZSA6IG51bGw7CiAgICB9OwoKICAgIFNpenpsZS5lcnJvciA9IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgbXNnKTsKICAgIH07IC8vIERvY3VtZW50IHNvcnRpbmcgYW5kIHJlbW92aW5nIGR1cGxpY2F0ZXMKCgogICAgU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAocmVzdWx0cykgewogICAgICB2YXIgZWxlbSwKICAgICAgICAgIGR1cGxpY2F0ZXMgPSBbXSwKICAgICAgICAgIGkgPSAxLAogICAgICAgICAgaiA9IDA7IC8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCiAgICAgIGhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7CiAgICAgIHJlc3VsdHMuc29ydChzb3J0T3JkZXIpOwoKICAgICAgaWYgKGhhc0R1cGxpY2F0ZSkgewogICAgICAgIGZvciAoOyBlbGVtID0gcmVzdWx0c1tpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoZWxlbSA9PT0gcmVzdWx0c1tpIC0gMV0pIHsKICAgICAgICAgICAgaiA9IGR1cGxpY2F0ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgIHJlc3VsdHMuc3BsaWNlKGR1cGxpY2F0ZXNbal0sIDEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9OwoKICAgIGZ1bmN0aW9uIHNpYmxpbmdDaGVjayhhLCBiKSB7CiAgICAgIHZhciBjdXIgPSBiICYmIGEsCiAgICAgICAgICBkaWZmID0gY3VyICYmICh+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUpIC0gKH5hLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSk7IC8vIFVzZSBJRSBzb3VyY2VJbmRleCBpZiBhdmFpbGFibGUgb24gYm90aCBub2RlcwoKICAgICAgaWYgKGRpZmYpIHsKICAgICAgICByZXR1cm4gZGlmZjsKICAgICAgfSAvLyBDaGVjayBpZiBiIGZvbGxvd3MgYQoKCiAgICAgIGlmIChjdXIpIHsKICAgICAgICB3aGlsZSAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSB7CiAgICAgICAgICBpZiAoY3VyID09PSBiKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBhID8gMSA6IC0xOwogICAgfSAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKHR5cGUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSB0eXBlOwogICAgICB9OwogICAgfSAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGJ1dHRvbnMKCgogICAgZnVuY3Rpb24gY3JlYXRlQnV0dG9uUHNldWRvKHR5cGUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7CiAgICAgIH07CiAgICB9IC8vIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgcG9zaXRpb25hbHMKCgogICAgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmbikgewogICAgICByZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChhcmd1bWVudCkgewogICAgICAgIGFyZ3VtZW50ID0gK2FyZ3VtZW50OwogICAgICAgIHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKHNlZWQsIG1hdGNoZXMpIHsKICAgICAgICAgIHZhciBqLAogICAgICAgICAgICAgIG1hdGNoSW5kZXhlcyA9IGZuKFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQpLAogICAgICAgICAgICAgIGkgPSBtYXRjaEluZGV4ZXMubGVuZ3RoOyAvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCiAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgIGlmIChzZWVkW2ogPSBtYXRjaEluZGV4ZXNbaV1dKSB7CiAgICAgICAgICAgICAgc2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXMNCiAgICAgKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0NCiAgICAgKi8KCgogICAgZ2V0VGV4dCA9IFNpenpsZS5nZXRUZXh0ID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgdmFyIG5vZGUsCiAgICAgICAgICByZXQgPSAiIiwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKICAgICAgaWYgKCFub2RlVHlwZSkgewogICAgICAgIC8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CiAgICAgICAgZm9yICg7IG5vZGUgPSBlbGVtW2ldOyBpKyspIHsKICAgICAgICAgIC8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCiAgICAgICAgICByZXQgKz0gZ2V0VGV4dChub2RlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExKSB7CiAgICAgICAgLy8gVXNlIHRleHRDb250ZW50IGZvciBlbGVtZW50cwogICAgICAgIC8vIGlubmVyVGV4dCB1c2FnZSByZW1vdmVkIGZvciBjb25zaXN0ZW5jeSBvZiBuZXcgbGluZXMgKHNlZSAjMTExNTMpCiAgICAgICAgaWYgKHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIikgewogICAgICAgICAgcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFRyYXZlcnNlIGl0cyBjaGlsZHJlbgogICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykgewogICAgICAgICAgICByZXQgKz0gZ2V0VGV4dChlbGVtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQpIHsKICAgICAgICByZXR1cm4gZWxlbS5ub2RlVmFsdWU7CiAgICAgIH0gLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoKICAgICAgcmV0dXJuIHJldDsKICAgIH07CgogICAgRXhwciA9IFNpenpsZS5zZWxlY3RvcnMgPSB7CiAgICAgIC8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgogICAgICBjYWNoZUxlbmd0aDogNTAsCiAgICAgIGNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAogICAgICBtYXRjaDogbWF0Y2hFeHByLAogICAgICBmaW5kOiB7fSwKICAgICAgcmVsYXRpdmU6IHsKICAgICAgICAiPiI6IHsKICAgICAgICAgIGRpcjogInBhcmVudE5vZGUiLAogICAgICAgICAgZmlyc3Q6IHRydWUKICAgICAgICB9LAogICAgICAgICIgIjogewogICAgICAgICAgZGlyOiAicGFyZW50Tm9kZSIKICAgICAgICB9LAogICAgICAgICIrIjogewogICAgICAgICAgZGlyOiAicHJldmlvdXNTaWJsaW5nIiwKICAgICAgICAgIGZpcnN0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICAifiI6IHsKICAgICAgICAgIGRpcjogInByZXZpb3VzU2libGluZyIKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByZUZpbHRlcjogewogICAgICAgICJBVFRSIjogZnVuY3Rpb24gQVRUUihtYXRjaCkgewogICAgICAgICAgbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsgLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCiAgICAgICAgICBtYXRjaFszXSA9IChtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIikucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSk7CgogICAgICAgICAgaWYgKG1hdGNoWzJdID09PSAifj0iKSB7CiAgICAgICAgICAgIG1hdGNoWzNdID0gIiAiICsgbWF0Y2hbM10gKyAiICI7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKDAsIDQpOwogICAgICAgIH0sCiAgICAgICAgIkNISUxEIjogZnVuY3Rpb24gQ0hJTEQobWF0Y2gpIHsKICAgICAgICAgIC8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0NCiAgICAgICAgICAgICAgMSB0eXBlIChvbmx5fG50aHwuLi4pDQogICAgICAgICAgICAgIDIgd2hhdCAoY2hpbGR8b2YtdHlwZSkNCiAgICAgICAgICAgICAgMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikNCiAgICAgICAgICAgICAgNCB4bi1jb21wb25lbnQgb2YgeG4reSBhcmd1bWVudCAoWystXT9cZCpufCkNCiAgICAgICAgICAgICAgNSBzaWduIG9mIHhuLWNvbXBvbmVudA0KICAgICAgICAgICAgICA2IHggb2YgeG4tY29tcG9uZW50DQogICAgICAgICAgICAgIDcgc2lnbiBvZiB5LWNvbXBvbmVudA0KICAgICAgICAgICAgICA4IHkgb2YgeS1jb21wb25lbnQNCiAgICAgICAgICAqLwogICAgICAgICAgbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgIGlmIChtYXRjaFsxXS5zbGljZSgwLCAzKSA9PT0gIm50aCIpIHsKICAgICAgICAgICAgLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKICAgICAgICAgICAgaWYgKCFtYXRjaFszXSkgewogICAgICAgICAgICAgIFNpenpsZS5lcnJvcihtYXRjaFswXSk7CiAgICAgICAgICAgIH0gLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxECiAgICAgICAgICAgIC8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCgogICAgICAgICAgICBtYXRjaFs0XSA9ICsobWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAobWF0Y2hbM10gPT09ICJldmVuIiB8fCBtYXRjaFszXSA9PT0gIm9kZCIpKTsKICAgICAgICAgICAgbWF0Y2hbNV0gPSArKG1hdGNoWzddICsgbWF0Y2hbOF0gfHwgbWF0Y2hbM10gPT09ICJvZGQiKTsgLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzCiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoWzNdKSB7CiAgICAgICAgICAgIFNpenpsZS5lcnJvcihtYXRjaFswXSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgIH0sCiAgICAgICAgIlBTRVVETyI6IGZ1bmN0aW9uIFBTRVVETyhtYXRjaCkgewogICAgICAgICAgdmFyIGV4Y2VzcywKICAgICAgICAgICAgICB1bnF1b3RlZCA9ICFtYXRjaFs1XSAmJiBtYXRjaFsyXTsKCiAgICAgICAgICBpZiAobWF0Y2hFeHByWyJDSElMRCJdLnRlc3QobWF0Y2hbMF0pKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfSAvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcwoKCiAgICAgICAgICBpZiAobWF0Y2hbNF0pIHsKICAgICAgICAgICAgbWF0Y2hbMl0gPSBtYXRjaFs0XTsgLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKICAgICAgICAgIH0gZWxzZSBpZiAodW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KHVucXVvdGVkKSAmJiAoIC8vIEdldCBleGNlc3MgZnJvbSB0b2tlbml6ZSAocmVjdXJzaXZlbHkpCiAgICAgICAgICBleGNlc3MgPSB0b2tlbml6ZSh1bnF1b3RlZCwgdHJ1ZSkpICYmICggLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCiAgICAgICAgICBleGNlc3MgPSB1bnF1b3RlZC5pbmRleE9mKCIpIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzKSAtIHVucXVvdGVkLmxlbmd0aCkpIHsKICAgICAgICAgICAgLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKICAgICAgICAgICAgbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSgwLCBleGNlc3MpOwogICAgICAgICAgICBtYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKDAsIGV4Y2Vzcyk7CiAgICAgICAgICB9IC8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoKCiAgICAgICAgICByZXR1cm4gbWF0Y2guc2xpY2UoMCwgMyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmaWx0ZXI6IHsKICAgICAgICAiVEFHIjogZnVuY3Rpb24gVEFHKG5vZGVOYW1lKSB7CiAgICAgICAgICBpZiAobm9kZU5hbWUgPT09ICIqIikgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIG5vZGVOYW1lID0gbm9kZU5hbWUucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGVOYW1lOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgICJDTEFTUyI6IGZ1bmN0aW9uIENMQVNTKGNsYXNzTmFtZSkgewogICAgICAgICAgdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlW2NsYXNzTmFtZSArICIgIl07CiAgICAgICAgICByZXR1cm4gcGF0dGVybiB8fCAocGF0dGVybiA9IG5ldyBSZWdFeHAoIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiKSkgJiYgY2xhc3NDYWNoZShjbGFzc05hbWUsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIHJldHVybiBwYXR0ZXJuLnRlc3QoZWxlbS5jbGFzc05hbWUgfHwgX3R5cGVvZihlbGVtLmdldEF0dHJpYnV0ZSkgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIik7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgICJBVFRSIjogZnVuY3Rpb24gQVRUUihuYW1lLCBvcGVyYXRvciwgY2hlY2spIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gU2l6emxlLmF0dHIoZWxlbSwgbmFtZSk7CgogICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghb3BlcmF0b3IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ICs9ICIiOwogICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09ICI9IiA/IHJlc3VsdCA9PT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIl49IiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKGNoZWNrKSA9PT0gMCA6IG9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoY2hlY2spID4gLTEgOiBvcGVyYXRvciA9PT0gIiQ9IiA/IGNoZWNrICYmIHJlc3VsdC5zbGljZSgtY2hlY2subGVuZ3RoKSA9PT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIn49IiA/ICgiICIgKyByZXN1bHQgKyAiICIpLmluZGV4T2YoY2hlY2spID4gLTEgOiBvcGVyYXRvciA9PT0gInw9IiA/IHJlc3VsdCA9PT0gY2hlY2sgfHwgcmVzdWx0LnNsaWNlKDAsIGNoZWNrLmxlbmd0aCArIDEpID09PSBjaGVjayArICItIiA6IGZhbHNlOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgICJDSElMRCI6IGZ1bmN0aW9uIENISUxEKHR5cGUsIHdoYXQsIGFyZ3VtZW50LCBmaXJzdCwgbGFzdCkgewogICAgICAgICAgdmFyIHNpbXBsZSA9IHR5cGUuc2xpY2UoMCwgMykgIT09ICJudGgiLAogICAgICAgICAgICAgIGZvcndhcmQgPSB0eXBlLnNsaWNlKC00KSAhPT0gImxhc3QiLAogICAgICAgICAgICAgIG9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKICAgICAgICAgIHJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8gLy8gU2hvcnRjdXQgZm9yIDpudGgtKihuKQogICAgICAgICAgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOwogICAgICAgICAgfSA6IGZ1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHsKICAgICAgICAgICAgdmFyIGNhY2hlLAogICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSwKICAgICAgICAgICAgICAgIG5vZGUsCiAgICAgICAgICAgICAgICBkaWZmLAogICAgICAgICAgICAgICAgbm9kZUluZGV4LAogICAgICAgICAgICAgICAgc3RhcnQsCiAgICAgICAgICAgICAgICBkaXIgPSBzaW1wbGUgIT09IGZvcndhcmQgPyAibmV4dFNpYmxpbmciIDogInByZXZpb3VzU2libGluZyIsCiAgICAgICAgICAgICAgICBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsCiAgICAgICAgICAgICAgICBuYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIHVzZUNhY2hlID0gIXhtbCAmJiAhb2ZUeXBlOwoKICAgICAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgICAgIC8vIDooZmlyc3R8bGFzdHxvbmx5KS0oY2hpbGR8b2YtdHlwZSkKICAgICAgICAgICAgICBpZiAoc2ltcGxlKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoZGlyKSB7CiAgICAgICAgICAgICAgICAgIG5vZGUgPSBlbGVtOwoKICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSBub2RlW2Rpcl0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSAvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykKCgogICAgICAgICAgICAgICAgICBzdGFydCA9IGRpciA9IHR5cGUgPT09ICJvbmx5IiAmJiAhc3RhcnQgJiYgIm5leHRTaWJsaW5nIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0YXJ0ID0gW2ZvcndhcmQgPyBwYXJlbnQuZmlyc3RDaGlsZCA6IHBhcmVudC5sYXN0Q2hpbGRdOyAvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoKICAgICAgICAgICAgICBpZiAoZm9yd2FyZCAmJiB1c2VDYWNoZSkgewogICAgICAgICAgICAgICAgLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CiAgICAgICAgICAgICAgICBvdXRlckNhY2hlID0gcGFyZW50W2V4cGFuZG9dIHx8IChwYXJlbnRbZXhwYW5kb10gPSB7fSk7CiAgICAgICAgICAgICAgICBjYWNoZSA9IG91dGVyQ2FjaGVbdHlwZV0gfHwgW107CiAgICAgICAgICAgICAgICBub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTsKICAgICAgICAgICAgICAgIGRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTsKICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbbm9kZUluZGV4XTsKCiAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVtkaXJdIHx8ICggLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKICAgICAgICAgICAgICAgIGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgewogICAgICAgICAgICAgICAgICAvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVhawogICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiArK2RpZmYgJiYgbm9kZSA9PT0gZWxlbSkgewogICAgICAgICAgICAgICAgICAgIG91dGVyQ2FjaGVbdHlwZV0gPSBbZGlycnVucywgbm9kZUluZGV4LCBkaWZmXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKCiAgICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVtleHBhbmRvXSB8fCAoZWxlbVtleHBhbmRvXSA9IHt9KSlbdHlwZV0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zKSB7CiAgICAgICAgICAgICAgICBkaWZmID0gY2FjaGVbMV07IC8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydAogICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbZGlyXSB8fCAoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSB7CiAgICAgICAgICAgICAgICAgIGlmICgob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkgJiYgKytkaWZmKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FjaGUgdGhlIGluZGV4IG9mIGVhY2ggZW5jb3VudGVyZWQgZWxlbWVudAogICAgICAgICAgICAgICAgICAgIGlmICh1c2VDYWNoZSkgewogICAgICAgICAgICAgICAgICAgICAgKG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSkpW3R5cGVdID0gW2RpcnJ1bnMsIGRpZmZdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUgPT09IGVsZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemUKCgogICAgICAgICAgICAgIGRpZmYgLT0gbGFzdDsKICAgICAgICAgICAgICByZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgIlBTRVVETyI6IGZ1bmN0aW9uIFBTRVVETyhwc2V1ZG8sIGFyZ3VtZW50KSB7CiAgICAgICAgICAvLyBwc2V1ZG8tY2xhc3MgbmFtZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUKICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKICAgICAgICAgIC8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCiAgICAgICAgICAvLyBSZW1lbWJlciB0aGF0IHNldEZpbHRlcnMgaW5oZXJpdHMgZnJvbSBwc2V1ZG9zCiAgICAgICAgICB2YXIgYXJncywKICAgICAgICAgICAgICBmbiA9IEV4cHIucHNldWRvc1twc2V1ZG9dIHx8IEV4cHIuc2V0RmlsdGVyc1twc2V1ZG8udG9Mb3dlckNhc2UoKV0gfHwgU2l6emxlLmVycm9yKCJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8pOyAvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CiAgICAgICAgICAvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvbgogICAgICAgICAgLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoKICAgICAgICAgIGlmIChmbltleHBhbmRvXSkgewogICAgICAgICAgICByZXR1cm4gZm4oYXJndW1lbnQpOwogICAgICAgICAgfSAvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCgogICAgICAgICAgaWYgKGZuLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgYXJncyA9IFtwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50XTsKICAgICAgICAgICAgcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShwc2V1ZG8udG9Mb3dlckNhc2UoKSkgPyBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKHNlZWQsIG1hdGNoZXMpIHsKICAgICAgICAgICAgICB2YXIgaWR4LAogICAgICAgICAgICAgICAgICBtYXRjaGVkID0gZm4oc2VlZCwgYXJndW1lbnQpLAogICAgICAgICAgICAgICAgICBpID0gbWF0Y2hlZC5sZW5ndGg7CgogICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4T2YuY2FsbChzZWVkLCBtYXRjaGVkW2ldKTsKICAgICAgICAgICAgICAgIHNlZWRbaWR4XSA9ICEobWF0Y2hlc1tpZHhdID0gbWF0Y2hlZFtpXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSA6IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuKGVsZW0sIDAsIGFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmbjsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBzZXVkb3M6IHsKICAgICAgICAvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKICAgICAgICAibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICAgICAgLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKICAgICAgICAgIC8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCiAgICAgICAgICAvLyBzcGFjZXMgYXMgY29tYmluYXRvcnMKICAgICAgICAgIHZhciBpbnB1dCA9IFtdLAogICAgICAgICAgICAgIHJlc3VsdHMgPSBbXSwKICAgICAgICAgICAgICBtYXRjaGVyID0gY29tcGlsZShzZWxlY3Rvci5yZXBsYWNlKHJ0cmltLCAiJDEiKSk7CiAgICAgICAgICByZXR1cm4gbWF0Y2hlcltleHBhbmRvXSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sKSB7CiAgICAgICAgICAgIHZhciBlbGVtLAogICAgICAgICAgICAgICAgdW5tYXRjaGVkID0gbWF0Y2hlcihzZWVkLCBudWxsLCB4bWwsIFtdKSwKICAgICAgICAgICAgICAgIGkgPSBzZWVkLmxlbmd0aDsgLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgIGlmIChlbGVtID0gdW5tYXRjaGVkW2ldKSB7CiAgICAgICAgICAgICAgICBzZWVkW2ldID0gIShtYXRjaGVzW2ldID0gZWxlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KSA6IGZ1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHsKICAgICAgICAgICAgaW5wdXRbMF0gPSBlbGVtOwogICAgICAgICAgICBtYXRjaGVyKGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMpOwogICAgICAgICAgICByZXR1cm4gIXJlc3VsdHMucG9wKCk7CiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgICJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgcmV0dXJuIFNpenpsZShzZWxlY3RvciwgZWxlbSkubGVuZ3RoID4gMDsKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImNvbnRhaW5zIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgcmV0dXJuIChlbGVtLnRleHRDb250ZW50IHx8IGVsZW0uaW5uZXJUZXh0IHx8IGdldFRleHQoZWxlbSkpLmluZGV4T2YodGV4dCkgPiAtMTsKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKICAgICAgICAvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZQogICAgICAgIC8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsCiAgICAgICAgLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCiAgICAgICAgLy8gVGhlIG1hdGNoaW5nIG9mIEMgYWdhaW5zdCB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlIGlzIHBlcmZvcm1lZCBjYXNlLWluc2Vuc2l0aXZlbHkuCiAgICAgICAgLy8gVGhlIGlkZW50aWZpZXIgQyBkb2VzIG5vdCBoYXZlIHRvIGJlIGEgdmFsaWQgbGFuZ3VhZ2UgbmFtZS4iCiAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwogICAgICAgICJsYW5nIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChsYW5nKSB7CiAgICAgICAgICAvLyBsYW5nIHZhbHVlIG11c3QgYmUgYSB2YWxpZCBpZGVudGlmaWRlcgogICAgICAgICAgaWYgKCFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpKSB7CiAgICAgICAgICAgIFNpenpsZS5lcnJvcigidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcpOwogICAgICAgICAgfQoKICAgICAgICAgIGxhbmcgPSBsYW5nLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgdmFyIGVsZW1MYW5nOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGlmIChlbGVtTGFuZyA9IGRvY3VtZW50SXNYTUwgPyBlbGVtLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgibGFuZyIpIDogZWxlbS5sYW5nKSB7CiAgICAgICAgICAgICAgICBlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZihsYW5nICsgIi0iKSA9PT0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gd2hpbGUgKChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxKTsKCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgLy8gTWlzY2VsbGFuZW91cwogICAgICAgICJ0YXJnZXQiOiBmdW5jdGlvbiB0YXJnZXQoZWxlbSkgewogICAgICAgICAgdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24gJiYgd2luZG93LmxvY2F0aW9uLmhhc2g7CiAgICAgICAgICByZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKDEpID09PSBlbGVtLmlkOwogICAgICAgIH0sCiAgICAgICAgInJvb3QiOiBmdW5jdGlvbiByb290KGVsZW0pIHsKICAgICAgICAgIHJldHVybiBlbGVtID09PSBkb2NFbGVtOwogICAgICAgIH0sCiAgICAgICAgImZvY3VzIjogZnVuY3Rpb24gZm9jdXMoZWxlbSkgewogICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTsKICAgICAgICB9LAogICAgICAgIC8vIEJvb2xlYW4gcHJvcGVydGllcwogICAgICAgICJlbmFibGVkIjogZnVuY3Rpb24gZW5hYmxlZChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICAiZGlzYWJsZWQiOiBmdW5jdGlvbiBkaXNhYmxlZChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKICAgICAgICB9LAogICAgICAgICJjaGVja2VkIjogZnVuY3Rpb24gY2hlY2tlZChlbGVtKSB7CiAgICAgICAgICAvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gbm9kZU5hbWUgPT09ICJpbnB1dCIgJiYgISFlbGVtLmNoZWNrZWQgfHwgbm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZDsKICAgICAgICB9LAogICAgICAgICJzZWxlY3RlZCI6IGZ1bmN0aW9uIHNlbGVjdGVkKGVsZW0pIHsKICAgICAgICAgIC8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKICAgICAgICAgIC8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CiAgICAgICAgfSwKICAgICAgICAvLyBDb250ZW50cwogICAgICAgICJlbXB0eSI6IGZ1bmN0aW9uIGVtcHR5KGVsZW0pIHsKICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jZW1wdHktcHNldWRvCiAgICAgICAgICAvLyA6ZW1wdHkgaXMgb25seSBhZmZlY3RlZCBieSBlbGVtZW50IG5vZGVzIGFuZCBjb250ZW50IG5vZGVzKGluY2x1ZGluZyB0ZXh0KDMpLCBjZGF0YSg0KSksCiAgICAgICAgICAvLyAgIG5vdCBjb21tZW50LCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucywgb3Igb3RoZXJzCiAgICAgICAgICAvLyBUaGFua3MgdG8gRGllZ28gUGVyaW5pIGZvciB0aGUgbm9kZU5hbWUgc2hvcnRjdXQKICAgICAgICAgIC8vICAgR3JlYXRlciB0aGFuICJAIiBtZWFucyBhbHBoYSBjaGFyYWN0ZXJzIChzcGVjaWZpY2FsbHkgbm90IHN0YXJ0aW5nIHdpdGggIiMiIG9yICI/IikKICAgICAgICAgIGZvciAoZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcpIHsKICAgICAgICAgICAgaWYgKGVsZW0ubm9kZU5hbWUgPiAiQCIgfHwgZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKICAgICAgICAicGFyZW50IjogZnVuY3Rpb24gcGFyZW50KGVsZW0pIHsKICAgICAgICAgIHJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKGVsZW0pOwogICAgICAgIH0sCiAgICAgICAgLy8gRWxlbWVudC9pbnB1dCB0eXBlcwogICAgICAgICJoZWFkZXIiOiBmdW5jdGlvbiBoZWFkZXIoZWxlbSkgewogICAgICAgICAgcmV0dXJuIHJoZWFkZXIudGVzdChlbGVtLm5vZGVOYW1lKTsKICAgICAgICB9LAogICAgICAgICJpbnB1dCI6IGZ1bmN0aW9uIGlucHV0KGVsZW0pIHsKICAgICAgICAgIHJldHVybiByaW5wdXRzLnRlc3QoZWxlbS5ub2RlTmFtZSk7CiAgICAgICAgfSwKICAgICAgICAiYnV0dG9uIjogZnVuY3Rpb24gYnV0dG9uKGVsZW0pIHsKICAgICAgICAgIHZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSAiYnV0dG9uIiB8fCBuYW1lID09PSAiYnV0dG9uIjsKICAgICAgICB9LAogICAgICAgICJ0ZXh0IjogZnVuY3Rpb24gdGV4dChlbGVtKSB7CiAgICAgICAgICB2YXIgYXR0cjsgLy8gSUU2IGFuZCA3IHdpbGwgbWFwIGVsZW0udHlwZSB0byAndGV4dCcgZm9yIG5ldyBIVE1MNSB0eXBlcyAoc2VhcmNoLCBldGMpCiAgICAgICAgICAvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2UKCiAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gInRleHQiICYmICgoYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIikpID09IG51bGwgfHwgYXR0ci50b0xvd2VyQ2FzZSgpID09PSBlbGVtLnR5cGUpOwogICAgICAgIH0sCiAgICAgICAgLy8gUG9zaXRpb24taW4tY29sbGVjdGlvbgogICAgICAgICJmaXJzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFswXTsKICAgICAgICB9KSwKICAgICAgICAibGFzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKG1hdGNoSW5kZXhlcywgbGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gW2xlbmd0aCAtIDFdOwogICAgICAgIH0pLAogICAgICAgICJlcSI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCkgewogICAgICAgICAgcmV0dXJuIFthcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50XTsKICAgICAgICB9KSwKICAgICAgICAiZXZlbiI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKG1hdGNoSW5kZXhlcywgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgZm9yICg7IGkgPCBsZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBtYXRjaEluZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbWF0Y2hJbmRleGVzOwogICAgICAgIH0pLAogICAgICAgICJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uIChtYXRjaEluZGV4ZXMsIGxlbmd0aCkgewogICAgICAgICAgdmFyIGkgPSAxOwoKICAgICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAgICAgbWF0Y2hJbmRleGVzLnB1c2goaSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hdGNoSW5kZXhlczsKICAgICAgICB9KSwKICAgICAgICAibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uIChtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQpIHsKICAgICAgICAgIHZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCiAgICAgICAgICBmb3IgKDsgLS1pID49IDA7KSB7CiAgICAgICAgICAgIG1hdGNoSW5kZXhlcy5wdXNoKGkpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBtYXRjaEluZGV4ZXM7CiAgICAgICAgfSksCiAgICAgICAgImd0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiAobWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50KSB7CiAgICAgICAgICB2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CgogICAgICAgICAgZm9yICg7ICsraSA8IGxlbmd0aDspIHsKICAgICAgICAgICAgbWF0Y2hJbmRleGVzLnB1c2goaSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hdGNoSW5kZXhlczsKICAgICAgICB9KQogICAgICB9CiAgICB9OyAvLyBBZGQgYnV0dG9uL2lucHV0IHR5cGUgcHNldWRvcwoKICAgIGZvciAoaSBpbiB7CiAgICAgIHJhZGlvOiB0cnVlLAogICAgICBjaGVja2JveDogdHJ1ZSwKICAgICAgZmlsZTogdHJ1ZSwKICAgICAgcGFzc3dvcmQ6IHRydWUsCiAgICAgIGltYWdlOiB0cnVlCiAgICB9KSB7CiAgICAgIEV4cHIucHNldWRvc1tpXSA9IGNyZWF0ZUlucHV0UHNldWRvKGkpOwogICAgfQoKICAgIGZvciAoaSBpbiB7CiAgICAgIHN1Ym1pdDogdHJ1ZSwKICAgICAgcmVzZXQ6IHRydWUKICAgIH0pIHsKICAgICAgRXhwci5wc2V1ZG9zW2ldID0gY3JlYXRlQnV0dG9uUHNldWRvKGkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRva2VuaXplKHNlbGVjdG9yLCBwYXJzZU9ubHkpIHsKICAgICAgdmFyIG1hdGNoZWQsCiAgICAgICAgICBtYXRjaCwKICAgICAgICAgIHRva2VucywKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBzb0ZhciwKICAgICAgICAgIGdyb3VwcywKICAgICAgICAgIHByZUZpbHRlcnMsCiAgICAgICAgICBjYWNoZWQgPSB0b2tlbkNhY2hlW3NlbGVjdG9yICsgIiAiXTsKCiAgICAgIGlmIChjYWNoZWQpIHsKICAgICAgICByZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSgwKTsKICAgICAgfQoKICAgICAgc29GYXIgPSBzZWxlY3RvcjsKICAgICAgZ3JvdXBzID0gW107CiAgICAgIHByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCiAgICAgIHdoaWxlIChzb0ZhcikgewogICAgICAgIC8vIENvbW1hIGFuZCBmaXJzdCBydW4KICAgICAgICBpZiAoIW1hdGNoZWQgfHwgKG1hdGNoID0gcmNvbW1hLmV4ZWMoc29GYXIpKSkgewogICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgIC8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCiAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UobWF0Y2hbMF0ubGVuZ3RoKSB8fCBzb0ZhcjsKICAgICAgICAgIH0KCiAgICAgICAgICBncm91cHMucHVzaCh0b2tlbnMgPSBbXSk7CiAgICAgICAgfQoKICAgICAgICBtYXRjaGVkID0gZmFsc2U7IC8vIENvbWJpbmF0b3JzCgogICAgICAgIGlmIChtYXRjaCA9IHJjb21iaW5hdG9ycy5leGVjKHNvRmFyKSkgewogICAgICAgICAgbWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7CiAgICAgICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVkLAogICAgICAgICAgICAvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKICAgICAgICAgICAgdHlwZTogbWF0Y2hbMF0ucmVwbGFjZShydHJpbSwgIiAiKQogICAgICAgICAgfSk7CiAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoZWQubGVuZ3RoKTsKICAgICAgICB9IC8vIEZpbHRlcnMKCgogICAgICAgIGZvciAodHlwZSBpbiBFeHByLmZpbHRlcikgewogICAgICAgICAgaWYgKChtYXRjaCA9IG1hdGNoRXhwclt0eXBlXS5leGVjKHNvRmFyKSkgJiYgKCFwcmVGaWx0ZXJzW3R5cGVdIHx8IChtYXRjaCA9IHByZUZpbHRlcnNbdHlwZV0obWF0Y2gpKSkpIHsKICAgICAgICAgICAgbWF0Y2hlZCA9IG1hdGNoLnNoaWZ0KCk7CiAgICAgICAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICAgICAgICB2YWx1ZTogbWF0Y2hlZCwKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoZWQubGVuZ3RoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghbWF0Y2hlZCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IC8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwogICAgICAvLyBpZiB3ZSdyZSBqdXN0IHBhcnNpbmcKICAgICAgLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvciBvciByZXR1cm4gdG9rZW5zCgoKICAgICAgcmV0dXJuIHBhcnNlT25seSA/IHNvRmFyLmxlbmd0aCA6IHNvRmFyID8gU2l6emxlLmVycm9yKHNlbGVjdG9yKSA6IC8vIENhY2hlIHRoZSB0b2tlbnMKICAgICAgdG9rZW5DYWNoZShzZWxlY3RvciwgZ3JvdXBzKS5zbGljZSgwKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b1NlbGVjdG9yKHRva2VucykgewogICAgICB2YXIgaSA9IDAsCiAgICAgICAgICBsZW4gPSB0b2tlbnMubGVuZ3RoLAogICAgICAgICAgc2VsZWN0b3IgPSAiIjsKCiAgICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBzZWxlY3RvciArPSB0b2tlbnNbaV0udmFsdWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWxlY3RvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRDb21iaW5hdG9yKG1hdGNoZXIsIGNvbWJpbmF0b3IsIGJhc2UpIHsKICAgICAgdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAogICAgICAgICAgY2hlY2tOb25FbGVtZW50cyA9IGJhc2UgJiYgZGlyID09PSAicGFyZW50Tm9kZSIsCiAgICAgICAgICBkb25lTmFtZSA9IGRvbmUrKzsKICAgICAgcmV0dXJuIGNvbWJpbmF0b3IuZmlyc3QgPyAvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKICAgICAgZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkgewogICAgICAgIHdoaWxlIChlbGVtID0gZWxlbVtkaXJdKSB7CiAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IDogLy8gQ2hlY2sgYWdhaW5zdCBhbGwgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnRzCiAgICAgIGZ1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHsKICAgICAgICB2YXIgZGF0YSwKICAgICAgICAgICAgY2FjaGUsCiAgICAgICAgICAgIG91dGVyQ2FjaGUsCiAgICAgICAgICAgIGRpcmtleSA9IGRpcnJ1bnMgKyAiICIgKyBkb25lTmFtZTsgLy8gV2UgY2FuJ3Qgc2V0IGFyYml0cmFyeSBkYXRhIG9uIFhNTCBub2Rlcywgc28gdGhleSBkb24ndCBiZW5lZml0IGZyb20gZGlyIGNhY2hpbmcKCiAgICAgICAgaWYgKHhtbCkgewogICAgICAgICAgd2hpbGUgKGVsZW0gPSBlbGVtW2Rpcl0pIHsKICAgICAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cykgewogICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGlsZSAoZWxlbSA9IGVsZW1bZGlyXSkgewogICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7CiAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IGVsZW1bZXhwYW5kb10gfHwgKGVsZW1bZXhwYW5kb10gPSB7fSk7CgogICAgICAgICAgICAgIGlmICgoY2FjaGUgPSBvdXRlckNhY2hlW2Rpcl0pICYmIGNhY2hlWzBdID09PSBkaXJrZXkpIHsKICAgICAgICAgICAgICAgIGlmICgoZGF0YSA9IGNhY2hlWzFdKSA9PT0gdHJ1ZSB8fCBkYXRhID09PSBjYWNoZWRydW5zKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhID09PSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjYWNoZSA9IG91dGVyQ2FjaGVbZGlyXSA9IFtkaXJrZXldOwogICAgICAgICAgICAgICAgY2FjaGVbMV0gPSBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkgfHwgY2FjaGVkcnVuczsKCiAgICAgICAgICAgICAgICBpZiAoY2FjaGVbMV0gPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSB7CiAgICAgIHJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8gZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkgewogICAgICAgIHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBpZiAoIW1hdGNoZXJzW2ldKGVsZW0sIGNvbnRleHQsIHhtbCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gOiBtYXRjaGVyc1swXTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb25kZW5zZSh1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwpIHsKICAgICAgdmFyIGVsZW0sCiAgICAgICAgICBuZXdVbm1hdGNoZWQgPSBbXSwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKICAgICAgICAgIG1hcHBlZCA9IG1hcCAhPSBudWxsOwoKICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChlbGVtID0gdW5tYXRjaGVkW2ldKSB7CiAgICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoZWxlbSwgY29udGV4dCwgeG1sKSkgewogICAgICAgICAgICBuZXdVbm1hdGNoZWQucHVzaChlbGVtKTsKCiAgICAgICAgICAgIGlmIChtYXBwZWQpIHsKICAgICAgICAgICAgICBtYXAucHVzaChpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ld1VubWF0Y2hlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRNYXRjaGVyKHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvcikgewogICAgICBpZiAocG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlcltleHBhbmRvXSkgewogICAgICAgIHBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKHBvc3RGaWx0ZXIpOwogICAgICB9CgogICAgICBpZiAocG9zdEZpbmRlciAmJiAhcG9zdEZpbmRlcltleHBhbmRvXSkgewogICAgICAgIHBvc3RGaW5kZXIgPSBzZXRNYXRjaGVyKHBvc3RGaW5kZXIsIHBvc3RTZWxlY3Rvcik7CiAgICAgIH0KCiAgICAgIHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKHNlZWQsIHJlc3VsdHMsIGNvbnRleHQsIHhtbCkgewogICAgICAgIHZhciB0ZW1wLAogICAgICAgICAgICBpLAogICAgICAgICAgICBlbGVtLAogICAgICAgICAgICBwcmVNYXAgPSBbXSwKICAgICAgICAgICAgcG9zdE1hcCA9IFtdLAogICAgICAgICAgICBwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAogICAgICAgICAgICAvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dAogICAgICAgIGVsZW1zID0gc2VlZCB8fCBtdWx0aXBsZUNvbnRleHRzKHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFtjb250ZXh0XSA6IGNvbnRleHQsIFtdKSwKICAgICAgICAgICAgLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCiAgICAgICAgbWF0Y2hlckluID0gcHJlRmlsdGVyICYmIChzZWVkIHx8ICFzZWxlY3RvcikgPyBjb25kZW5zZShlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCkgOiBlbGVtcywKICAgICAgICAgICAgbWF0Y2hlck91dCA9IG1hdGNoZXIgPyAvLyBJZiB3ZSBoYXZlIGEgcG9zdEZpbmRlciwgb3IgZmlsdGVyZWQgc2VlZCwgb3Igbm9uLXNlZWQgcG9zdEZpbHRlciBvciBwcmVleGlzdGluZyByZXN1bHRzLAogICAgICAgIHBvc3RGaW5kZXIgfHwgKHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyKSA/IC8vIC4uLmludGVybWVkaWF0ZSBwcm9jZXNzaW5nIGlzIG5lY2Vzc2FyeQogICAgICAgIFtdIDogLy8gLi4ub3RoZXJ3aXNlIHVzZSByZXN1bHRzIGRpcmVjdGx5CiAgICAgICAgcmVzdWx0cyA6IG1hdGNoZXJJbjsgLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMKCiAgICAgICAgaWYgKG1hdGNoZXIpIHsKICAgICAgICAgIG1hdGNoZXIobWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwpOwogICAgICAgIH0gLy8gQXBwbHkgcG9zdEZpbHRlcgoKCiAgICAgICAgaWYgKHBvc3RGaWx0ZXIpIHsKICAgICAgICAgIHRlbXAgPSBjb25kZW5zZShtYXRjaGVyT3V0LCBwb3N0TWFwKTsKICAgICAgICAgIHBvc3RGaWx0ZXIodGVtcCwgW10sIGNvbnRleHQsIHhtbCk7IC8vIFVuLW1hdGNoIGZhaWxpbmcgZWxlbWVudHMgYnkgbW92aW5nIHRoZW0gYmFjayB0byBtYXRjaGVySW4KCiAgICAgICAgICBpID0gdGVtcC5sZW5ndGg7CgogICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICBpZiAoZWxlbSA9IHRlbXBbaV0pIHsKICAgICAgICAgICAgICBtYXRjaGVyT3V0W3Bvc3RNYXBbaV1dID0gIShtYXRjaGVySW5bcG9zdE1hcFtpXV0gPSBlbGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNlZWQpIHsKICAgICAgICAgIGlmIChwb3N0RmluZGVyIHx8IHByZUZpbHRlcikgewogICAgICAgICAgICBpZiAocG9zdEZpbmRlcikgewogICAgICAgICAgICAgIC8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwogICAgICAgICAgICAgIHRlbXAgPSBbXTsKICAgICAgICAgICAgICBpID0gbWF0Y2hlck91dC5sZW5ndGg7CgogICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgIGlmIChlbGVtID0gbWF0Y2hlck91dFtpXSkgewogICAgICAgICAgICAgICAgICAvLyBSZXN0b3JlIG1hdGNoZXJJbiBzaW5jZSBlbGVtIGlzIG5vdCB5ZXQgYSBmaW5hbCBtYXRjaAogICAgICAgICAgICAgICAgICB0ZW1wLnB1c2gobWF0Y2hlckluW2ldID0gZWxlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIG1hdGNoZXJPdXQgPSBbXSwgdGVtcCwgeG1sKTsKICAgICAgICAgICAgfSAvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZAoKCiAgICAgICAgICAgIGkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCiAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICBpZiAoKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSAmJiAodGVtcCA9IHBvc3RGaW5kZXIgPyBpbmRleE9mLmNhbGwoc2VlZCwgZWxlbSkgOiBwcmVNYXBbaV0pID4gLTEpIHsKICAgICAgICAgICAgICAgIHNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gQWRkIGVsZW1lbnRzIHRvIHJlc3VsdHMsIHRocm91Z2ggcG9zdEZpbmRlciBpZiBkZWZpbmVkCgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRjaGVyT3V0ID0gY29uZGVuc2UobWF0Y2hlck91dCA9PT0gcmVzdWx0cyA/IG1hdGNoZXJPdXQuc3BsaWNlKHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCkgOiBtYXRjaGVyT3V0KTsKCiAgICAgICAgICBpZiAocG9zdEZpbmRlcikgewogICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG1hdGNoZXJPdXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hlckZyb21Ub2tlbnModG9rZW5zKSB7CiAgICAgIHZhciBjaGVja0NvbnRleHQsCiAgICAgICAgICBtYXRjaGVyLAogICAgICAgICAgaiwKICAgICAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsCiAgICAgICAgICBsZWFkaW5nUmVsYXRpdmUgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1swXS50eXBlXSwKICAgICAgICAgIGltcGxpY2l0UmVsYXRpdmUgPSBsZWFkaW5nUmVsYXRpdmUgfHwgRXhwci5yZWxhdGl2ZVsiICJdLAogICAgICAgICAgaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAogICAgICAgICAgLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocykKICAgICAgbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIHJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7CiAgICAgIH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUpLAogICAgICAgICAgbWF0Y2hBbnlDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIHJldHVybiBpbmRleE9mLmNhbGwoY2hlY2tDb250ZXh0LCBlbGVtKSA+IC0xOwogICAgICB9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlKSwKICAgICAgICAgIG1hdGNoZXJzID0gW2Z1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHsKICAgICAgICByZXR1cm4gIWxlYWRpbmdSZWxhdGl2ZSAmJiAoeG1sIHx8IGNvbnRleHQgIT09IG91dGVybW9zdENvbnRleHQpIHx8ICgoY2hlY2tDb250ZXh0ID0gY29udGV4dCkubm9kZVR5cGUgPyBtYXRjaENvbnRleHQoZWxlbSwgY29udGV4dCwgeG1sKSA6IG1hdGNoQW55Q29udGV4dChlbGVtLCBjb250ZXh0LCB4bWwpKTsKICAgICAgfV07CgogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1tpXS50eXBlXSkgewogICAgICAgICAgbWF0Y2hlcnMgPSBbYWRkQ29tYmluYXRvcihlbGVtZW50TWF0Y2hlcihtYXRjaGVycyksIG1hdGNoZXIpXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0Y2hlciA9IEV4cHIuZmlsdGVyW3Rva2Vuc1tpXS50eXBlXS5hcHBseShudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyk7IC8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyCgogICAgICAgICAgaWYgKG1hdGNoZXJbZXhwYW5kb10pIHsKICAgICAgICAgICAgLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nCiAgICAgICAgICAgIGogPSArK2k7CgogICAgICAgICAgICBmb3IgKDsgaiA8IGxlbjsgaisrKSB7CiAgICAgICAgICAgICAgaWYgKEV4cHIucmVsYXRpdmVbdG9rZW5zW2pdLnR5cGVdKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZXRNYXRjaGVyKGkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSwgaSA+IDEgJiYgdG9TZWxlY3Rvcih0b2tlbnMuc2xpY2UoMCwgaSAtIDEpKS5yZXBsYWNlKHJ0cmltLCAiJDEiKSwgbWF0Y2hlciwgaSA8IGogJiYgbWF0Y2hlckZyb21Ub2tlbnModG9rZW5zLnNsaWNlKGksIGopKSwgaiA8IGxlbiAmJiBtYXRjaGVyRnJvbVRva2Vucyh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoaikpLCBqIDwgbGVuICYmIHRvU2VsZWN0b3IodG9rZW5zKSk7CiAgICAgICAgICB9CgogICAgICAgICAgbWF0Y2hlcnMucHVzaChtYXRjaGVyKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBlbGVtZW50TWF0Y2hlcihtYXRjaGVycyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMpIHsKICAgICAgLy8gQSBjb3VudGVyIHRvIHNwZWNpZnkgd2hpY2ggZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgbWF0Y2hlZAogICAgICB2YXIgbWF0Y2hlckNhY2hlZFJ1bnMgPSAwLAogICAgICAgICAgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAogICAgICAgICAgYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsCiAgICAgICAgICBzdXBlck1hdGNoZXIgPSBmdW5jdGlvbiBzdXBlck1hdGNoZXIoc2VlZCwgY29udGV4dCwgeG1sLCByZXN1bHRzLCBleHBhbmRDb250ZXh0KSB7CiAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgIGosCiAgICAgICAgICAgIG1hdGNoZXIsCiAgICAgICAgICAgIHNldE1hdGNoZWQgPSBbXSwKICAgICAgICAgICAgbWF0Y2hlZENvdW50ID0gMCwKICAgICAgICAgICAgaSA9ICIwIiwKICAgICAgICAgICAgdW5tYXRjaGVkID0gc2VlZCAmJiBbXSwKICAgICAgICAgICAgb3V0ZXJtb3N0ID0gZXhwYW5kQ29udGV4dCAhPSBudWxsLAogICAgICAgICAgICBjb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKICAgICAgICAgICAgLy8gV2UgbXVzdCBhbHdheXMgaGF2ZSBlaXRoZXIgc2VlZCBlbGVtZW50cyBvciBjb250ZXh0CiAgICAgICAgZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCIqIiwgZXhwYW5kQ29udGV4dCAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dCksCiAgICAgICAgICAgIC8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCiAgICAgICAgZGlycnVuc1VuaXF1ZSA9IGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xOwoKICAgICAgICBpZiAob3V0ZXJtb3N0KSB7CiAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCAhPT0gZG9jdW1lbnQgJiYgY29udGV4dDsKICAgICAgICAgIGNhY2hlZHJ1bnMgPSBtYXRjaGVyQ2FjaGVkUnVuczsKICAgICAgICB9IC8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCiAgICAgICAgLy8gS2VlcCBgaWAgYSBzdHJpbmcgaWYgdGhlcmUgYXJlIG5vIGVsZW1lbnRzIHNvIGBtYXRjaGVkQ291bnRgIHdpbGwgYmUgIjAwIiBiZWxvdwoKCiAgICAgICAgZm9yICg7IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKykgewogICAgICAgICAgaWYgKGJ5RWxlbWVudCAmJiBlbGVtKSB7CiAgICAgICAgICAgIGogPSAwOwoKICAgICAgICAgICAgd2hpbGUgKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgewogICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChlbGVtKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG91dGVybW9zdCkgewogICAgICAgICAgICAgIGRpcnJ1bnMgPSBkaXJydW5zVW5pcXVlOwogICAgICAgICAgICAgIGNhY2hlZHJ1bnMgPSArK21hdGNoZXJDYWNoZWRSdW5zOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCgogICAgICAgICAgaWYgKGJ5U2V0KSB7CiAgICAgICAgICAgIC8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnMKICAgICAgICAgICAgaWYgKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSB7CiAgICAgICAgICAgICAgbWF0Y2hlZENvdW50LS07CiAgICAgICAgICAgIH0gLy8gTGVuZ3RoZW4gdGhlIGFycmF5IGZvciBldmVyeSBlbGVtZW50LCBtYXRjaGVkIG9yIG5vdAoKCiAgICAgICAgICAgIGlmIChzZWVkKSB7CiAgICAgICAgICAgICAgdW5tYXRjaGVkLnB1c2goZWxlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vIEFwcGx5IHNldCBmaWx0ZXJzIHRvIHVubWF0Y2hlZCBlbGVtZW50cwoKCiAgICAgICAgbWF0Y2hlZENvdW50ICs9IGk7CgogICAgICAgIGlmIChieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQpIHsKICAgICAgICAgIGogPSAwOwoKICAgICAgICAgIHdoaWxlIChtYXRjaGVyID0gc2V0TWF0Y2hlcnNbaisrXSkgewogICAgICAgICAgICBtYXRjaGVyKHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VlZCkgewogICAgICAgICAgICAvLyBSZWludGVncmF0ZSBlbGVtZW50IG1hdGNoZXMgdG8gZWxpbWluYXRlIHRoZSBuZWVkIGZvciBzb3J0aW5nCiAgICAgICAgICAgIGlmIChtYXRjaGVkQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgaWYgKCEodW5tYXRjaGVkW2ldIHx8IHNldE1hdGNoZWRbaV0pKSB7CiAgICAgICAgICAgICAgICAgIHNldE1hdGNoZWRbaV0gPSBwb3AuY2FsbChyZXN1bHRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCgogICAgICAgICAgICBzZXRNYXRjaGVkID0gY29uZGVuc2Uoc2V0TWF0Y2hlZCk7CiAgICAgICAgICB9IC8vIEFkZCBtYXRjaGVzIHRvIHJlc3VsdHMKCgogICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzZXRNYXRjaGVkKTsgLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgogICAgICAgICAgaWYgKG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYgbWF0Y2hlZENvdW50ICsgc2V0TWF0Y2hlcnMubGVuZ3RoID4gMSkgewogICAgICAgICAgICBTaXp6bGUudW5pcXVlU29ydChyZXN1bHRzKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIE92ZXJyaWRlIG1hbmlwdWxhdGlvbiBvZiBnbG9iYWxzIGJ5IG5lc3RlZCBtYXRjaGVycwoKCiAgICAgICAgaWYgKG91dGVybW9zdCkgewogICAgICAgICAgZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CiAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB1bm1hdGNoZWQ7CiAgICAgIH07CgogICAgICByZXR1cm4gYnlTZXQgPyBtYXJrRnVuY3Rpb24oc3VwZXJNYXRjaGVyKSA6IHN1cGVyTWF0Y2hlcjsKICAgIH0KCiAgICBjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIGdyb3VwCiAgICAvKiBJbnRlcm5hbCBVc2UgT25seSAqLwogICAgKSB7CiAgICAgIHZhciBpLAogICAgICAgICAgc2V0TWF0Y2hlcnMgPSBbXSwKICAgICAgICAgIGVsZW1lbnRNYXRjaGVycyA9IFtdLAogICAgICAgICAgY2FjaGVkID0gY29tcGlsZXJDYWNoZVtzZWxlY3RvciArICIgIl07CgogICAgICBpZiAoIWNhY2hlZCkgewogICAgICAgIC8vIEdlbmVyYXRlIGEgZnVuY3Rpb24gb2YgcmVjdXJzaXZlIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoZWNrIGVhY2ggZWxlbWVudAogICAgICAgIGlmICghZ3JvdXApIHsKICAgICAgICAgIGdyb3VwID0gdG9rZW5pemUoc2VsZWN0b3IpOwogICAgICAgIH0KCiAgICAgICAgaSA9IGdyb3VwLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoZ3JvdXBbaV0pOwoKICAgICAgICAgIGlmIChjYWNoZWRbZXhwYW5kb10pIHsKICAgICAgICAgICAgc2V0TWF0Y2hlcnMucHVzaChjYWNoZWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWxlbWVudE1hdGNoZXJzLnB1c2goY2FjaGVkKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIENhY2hlIHRoZSBjb21waWxlZCBmdW5jdGlvbgoKCiAgICAgICAgY2FjaGVkID0gY29tcGlsZXJDYWNoZShzZWxlY3RvciwgbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNhY2hlZDsKICAgIH07CgogICAgZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyhzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMpIHsKICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgbGVuID0gY29udGV4dHMubGVuZ3RoOwoKICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgIFNpenpsZShzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3Qoc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpIHsKICAgICAgdmFyIGksCiAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICB0b2tlbiwKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBmaW5kLAogICAgICAgICAgbWF0Y2ggPSB0b2tlbml6ZShzZWxlY3Rvcik7CgogICAgICBpZiAoIXNlZWQpIHsKICAgICAgICAvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBncm91cAogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIC8vIFRha2UgYSBzaG9ydGN1dCBhbmQgc2V0IHRoZSBjb250ZXh0IGlmIHRoZSByb290IHNlbGVjdG9yIGlzIGFuIElECiAgICAgICAgICB0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKDApOwoKICAgICAgICAgIGlmICh0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09ICJJRCIgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiAhZG9jdW1lbnRJc1hNTCAmJiBFeHByLnJlbGF0aXZlW3Rva2Vuc1sxXS50eXBlXSkgewogICAgICAgICAgICBjb250ZXh0ID0gRXhwci5maW5kWyJJRCJdKHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSksIGNvbnRleHQpWzBdOwoKICAgICAgICAgICAgaWYgKCFjb250ZXh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UodG9rZW5zLnNoaWZ0KCkudmFsdWUubGVuZ3RoKTsKICAgICAgICAgIH0gLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoKCiAgICAgICAgICBpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KHNlbGVjdG9yKSA/IDAgOiB0b2tlbnMubGVuZ3RoOwoKICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbnNbaV07IC8vIEFib3J0IGlmIHdlIGhpdCBhIGNvbWJpbmF0b3IKCiAgICAgICAgICAgIGlmIChFeHByLnJlbGF0aXZlW3R5cGUgPSB0b2tlbi50eXBlXSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZmluZCA9IEV4cHIuZmluZFt0eXBlXSkgewogICAgICAgICAgICAgIC8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwogICAgICAgICAgICAgIGlmIChzZWVkID0gZmluZCh0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCByc2libGluZy50ZXN0KHRva2Vuc1swXS50eXBlKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dCkpIHsKICAgICAgICAgICAgICAgIC8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQogICAgICAgICAgICAgICAgdG9rZW5zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3Rvcih0b2tlbnMpOwoKICAgICAgICAgICAgICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzbGljZS5jYWxsKHNlZWQsIDApKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24KICAgICAgLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZQoKCiAgICAgIGNvbXBpbGUoc2VsZWN0b3IsIG1hdGNoKShzZWVkLCBjb250ZXh0LCBkb2N1bWVudElzWE1MLCByZXN1bHRzLCByc2libGluZy50ZXN0KHNlbGVjdG9yKSk7CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSAvLyBEZXByZWNhdGVkCgoKICAgIEV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07IC8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwoKICAgIGZ1bmN0aW9uIHNldEZpbHRlcnMoKSB7fQoKICAgIEV4cHIuZmlsdGVycyA9IHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5wc2V1ZG9zOwogICAgRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTsgLy8gSW5pdGlhbGl6ZSB3aXRoIHRoZSBkZWZhdWx0IGRvY3VtZW50CgogICAgc2V0RG9jdW1lbnQoKTsgLy8gT3ZlcnJpZGUgc2l6emxlIGF0dHJpYnV0ZSByZXRyaWV2YWwKCiAgICBTaXp6bGUuYXR0ciA9IGpRdWVyeS5hdHRyOwogICAgalF1ZXJ5LmZpbmQgPSBTaXp6bGU7CiAgICBqUXVlcnkuZXhwciA9IFNpenpsZS5zZWxlY3RvcnM7CiAgICBqUXVlcnkuZXhwclsiOiJdID0galF1ZXJ5LmV4cHIucHNldWRvczsKICAgIGpRdWVyeS51bmlxdWUgPSBTaXp6bGUudW5pcXVlU29ydDsKICAgIGpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7CiAgICBqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CiAgICBqUXVlcnkuY29udGFpbnMgPSBTaXp6bGUuY29udGFpbnM7CiAgfSkod2luZG93KTsKCiAgdmFyIHJ1bnRpbCA9IC9VbnRpbCQvLAogICAgICBycGFyZW50c3ByZXYgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywKICAgICAgaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAogICAgICBybmVlZHNDb250ZXh0ID0galF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LAogICAgICAvLyBtZXRob2RzIGd1YXJhbnRlZWQgdG8gcHJvZHVjZSBhIHVuaXF1ZSBzZXQgd2hlbiBzdGFydGluZyBmcm9tIGEgdW5pcXVlIHNldAogIGd1YXJhbnRlZWRVbmlxdWUgPSB7CiAgICBjaGlsZHJlbjogdHJ1ZSwKICAgIGNvbnRlbnRzOiB0cnVlLAogICAgbmV4dDogdHJ1ZSwKICAgIHByZXY6IHRydWUKICB9OwogIGpRdWVyeS5mbi5leHRlbmQoewogICAgZmluZDogZnVuY3Rpb24gZmluZChzZWxlY3RvcikgewogICAgICB2YXIgaSwKICAgICAgICAgIHJldCwKICAgICAgICAgIHNlbGYsCiAgICAgICAgICBsZW4gPSB0aGlzLmxlbmd0aDsKCiAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciKSB7CiAgICAgICAgc2VsZiA9IHRoaXM7CiAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGpRdWVyeShzZWxlY3RvcikuZmlsdGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAoalF1ZXJ5LmNvbnRhaW5zKHNlbGZbaV0sIHRoaXMpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldCA9IFtdOwoKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgalF1ZXJ5LmZpbmQoc2VsZWN0b3IsIHRoaXNbaV0sIHJldCk7CiAgICAgIH0gLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgoKICAgICAgcmV0ID0gdGhpcy5wdXNoU3RhY2sobGVuID4gMSA/IGpRdWVyeS51bmlxdWUocmV0KSA6IHJldCk7CiAgICAgIHJldC5zZWxlY3RvciA9ICh0aGlzLnNlbGVjdG9yID8gdGhpcy5zZWxlY3RvciArICIgIiA6ICIiKSArIHNlbGVjdG9yOwogICAgICByZXR1cm4gcmV0OwogICAgfSwKICAgIGhhczogZnVuY3Rpb24gaGFzKHRhcmdldCkgewogICAgICB2YXIgaSwKICAgICAgICAgIHRhcmdldHMgPSBqUXVlcnkodGFyZ2V0LCB0aGlzKSwKICAgICAgICAgIGxlbiA9IHRhcmdldHMubGVuZ3RoOwogICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgaWYgKGpRdWVyeS5jb250YWlucyh0aGlzLCB0YXJnZXRzW2ldKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIG5vdDogZnVuY3Rpb24gbm90KHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh3aW5ub3codGhpcywgc2VsZWN0b3IsIGZhbHNlKSk7CiAgICB9LAogICAgZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXIoc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSkpOwogICAgfSwKICAgIGlzOiBmdW5jdGlvbiBpcyhzZWxlY3RvcikgewogICAgICByZXR1cm4gISFzZWxlY3RvciAmJiAodHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA/IC8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQKICAgICAgLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgogICAgICBybmVlZHNDb250ZXh0LnRlc3Qoc2VsZWN0b3IpID8galF1ZXJ5KHNlbGVjdG9yLCB0aGlzLmNvbnRleHQpLmluZGV4KHRoaXNbMF0pID49IDAgOiBqUXVlcnkuZmlsdGVyKHNlbGVjdG9yLCB0aGlzKS5sZW5ndGggPiAwIDogdGhpcy5maWx0ZXIoc2VsZWN0b3IpLmxlbmd0aCA+IDApOwogICAgfSwKICAgIGNsb3Nlc3Q6IGZ1bmN0aW9uIGNsb3Nlc3Qoc2VsZWN0b3JzLCBjb250ZXh0KSB7CiAgICAgIHZhciBjdXIsCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGwgPSB0aGlzLmxlbmd0aCwKICAgICAgICAgIHJldCA9IFtdLAogICAgICAgICAgcG9zID0gcm5lZWRzQ29udGV4dC50ZXN0KHNlbGVjdG9ycykgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPyBqUXVlcnkoc2VsZWN0b3JzLCBjb250ZXh0IHx8IHRoaXMuY29udGV4dCkgOiAwOwoKICAgICAgZm9yICg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjdXIgPSB0aGlzW2ldOwoKICAgICAgICB3aGlsZSAoY3VyICYmIGN1ci5vd25lckRvY3VtZW50ICYmIGN1ciAhPT0gY29udGV4dCAmJiBjdXIubm9kZVR5cGUgIT09IDExKSB7CiAgICAgICAgICBpZiAocG9zID8gcG9zLmluZGV4KGN1cikgPiAtMSA6IGpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihjdXIsIHNlbGVjdG9ycykpIHsKICAgICAgICAgICAgcmV0LnB1c2goY3VyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY3VyID0gY3VyLnBhcmVudE5vZGU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2socmV0Lmxlbmd0aCA+IDEgPyBqUXVlcnkudW5pcXVlKHJldCkgOiByZXQpOwogICAgfSwKICAgIC8vIERldGVybWluZSB0aGUgcG9zaXRpb24gb2YgYW4gZWxlbWVudCB3aXRoaW4KICAgIC8vIHRoZSBtYXRjaGVkIHNldCBvZiBlbGVtZW50cwogICAgaW5kZXg6IGZ1bmN0aW9uIGluZGV4KGVsZW0pIHsKICAgICAgLy8gTm8gYXJndW1lbnQsIHJldHVybiBpbmRleCBpbiBwYXJlbnQKICAgICAgaWYgKCFlbGVtKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlID8gdGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGggOiAtMTsKICAgICAgfSAvLyBpbmRleCBpbiBzZWxlY3RvcgoKCiAgICAgIGlmICh0eXBlb2YgZWxlbSA9PT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4galF1ZXJ5LmluQXJyYXkodGhpc1swXSwgalF1ZXJ5KGVsZW0pKTsKICAgICAgfSAvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCgogICAgICByZXR1cm4galF1ZXJ5LmluQXJyYXkoIC8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAogICAgICBlbGVtLmpxdWVyeSA/IGVsZW1bMF0gOiBlbGVtLCB0aGlzKTsKICAgIH0sCiAgICBhZGQ6IGZ1bmN0aW9uIGFkZChzZWxlY3RvciwgY29udGV4dCkgewogICAgICB2YXIgc2V0ID0gdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA/IGpRdWVyeShzZWxlY3RvciwgY29udGV4dCkgOiBqUXVlcnkubWFrZUFycmF5KHNlbGVjdG9yICYmIHNlbGVjdG9yLm5vZGVUeXBlID8gW3NlbGVjdG9yXSA6IHNlbGVjdG9yKSwKICAgICAgICAgIGFsbCA9IGpRdWVyeS5tZXJnZSh0aGlzLmdldCgpLCBzZXQpOwogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soalF1ZXJ5LnVuaXF1ZShhbGwpKTsKICAgIH0sCiAgICBhZGRCYWNrOiBmdW5jdGlvbiBhZGRCYWNrKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLmFkZChzZWxlY3RvciA9PSBudWxsID8gdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihzZWxlY3RvcikpOwogICAgfQogIH0pOwogIGpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7CgogIGZ1bmN0aW9uIHNpYmxpbmcoY3VyLCBkaXIpIHsKICAgIGRvIHsKICAgICAgY3VyID0gY3VyW2Rpcl07CiAgICB9IHdoaWxlIChjdXIgJiYgY3VyLm5vZGVUeXBlICE9PSAxKTsKCiAgICByZXR1cm4gY3VyOwogIH0KCiAgalF1ZXJ5LmVhY2goewogICAgcGFyZW50OiBmdW5jdGlvbiBwYXJlbnQoZWxlbSkgewogICAgICB2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwogICAgICByZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwogICAgfSwKICAgIHBhcmVudHM6IGZ1bmN0aW9uIHBhcmVudHMoZWxlbSkgewogICAgICByZXR1cm4galF1ZXJ5LmRpcihlbGVtLCAicGFyZW50Tm9kZSIpOwogICAgfSwKICAgIHBhcmVudHNVbnRpbDogZnVuY3Rpb24gcGFyZW50c1VudGlsKGVsZW0sIGksIHVudGlsKSB7CiAgICAgIHJldHVybiBqUXVlcnkuZGlyKGVsZW0sICJwYXJlbnROb2RlIiwgdW50aWwpOwogICAgfSwKICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoZWxlbSkgewogICAgICByZXR1cm4gc2libGluZyhlbGVtLCAibmV4dFNpYmxpbmciKTsKICAgIH0sCiAgICBwcmV2OiBmdW5jdGlvbiBwcmV2KGVsZW0pIHsKICAgICAgcmV0dXJuIHNpYmxpbmcoZWxlbSwgInByZXZpb3VzU2libGluZyIpOwogICAgfSwKICAgIG5leHRBbGw6IGZ1bmN0aW9uIG5leHRBbGwoZWxlbSkgewogICAgICByZXR1cm4galF1ZXJ5LmRpcihlbGVtLCAibmV4dFNpYmxpbmciKTsKICAgIH0sCiAgICBwcmV2QWxsOiBmdW5jdGlvbiBwcmV2QWxsKGVsZW0pIHsKICAgICAgcmV0dXJuIGpRdWVyeS5kaXIoZWxlbSwgInByZXZpb3VzU2libGluZyIpOwogICAgfSwKICAgIG5leHRVbnRpbDogZnVuY3Rpb24gbmV4dFVudGlsKGVsZW0sIGksIHVudGlsKSB7CiAgICAgIHJldHVybiBqUXVlcnkuZGlyKGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsKTsKICAgIH0sCiAgICBwcmV2VW50aWw6IGZ1bmN0aW9uIHByZXZVbnRpbChlbGVtLCBpLCB1bnRpbCkgewogICAgICByZXR1cm4galF1ZXJ5LmRpcihlbGVtLCAicHJldmlvdXNTaWJsaW5nIiwgdW50aWwpOwogICAgfSwKICAgIHNpYmxpbmdzOiBmdW5jdGlvbiBzaWJsaW5ncyhlbGVtKSB7CiAgICAgIHJldHVybiBqUXVlcnkuc2libGluZygoZWxlbS5wYXJlbnROb2RlIHx8IHt9KS5maXJzdENoaWxkLCBlbGVtKTsKICAgIH0sCiAgICBjaGlsZHJlbjogZnVuY3Rpb24gY2hpbGRyZW4oZWxlbSkgewogICAgICByZXR1cm4galF1ZXJ5LnNpYmxpbmcoZWxlbS5maXJzdENoaWxkKTsKICAgIH0sCiAgICBjb250ZW50czogZnVuY3Rpb24gY29udGVudHMoZWxlbSkgewogICAgICByZXR1cm4galF1ZXJ5Lm5vZGVOYW1lKGVsZW0sICJpZnJhbWUiKSA/IGVsZW0uY29udGVudERvY3VtZW50IHx8IGVsZW0uY29udGVudFdpbmRvdy5kb2N1bWVudCA6IGpRdWVyeS5tZXJnZShbXSwgZWxlbS5jaGlsZE5vZGVzKTsKICAgIH0KICB9LCBmdW5jdGlvbiAobmFtZSwgZm4pIHsKICAgIGpRdWVyeS5mbltuYW1lXSA9IGZ1bmN0aW9uICh1bnRpbCwgc2VsZWN0b3IpIHsKICAgICAgdmFyIHJldCA9IGpRdWVyeS5tYXAodGhpcywgZm4sIHVudGlsKTsKCiAgICAgIGlmICghcnVudGlsLnRlc3QobmFtZSkpIHsKICAgICAgICBzZWxlY3RvciA9IHVudGlsOwogICAgICB9CgogICAgICBpZiAoc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIikgewogICAgICAgIHJldCA9IGpRdWVyeS5maWx0ZXIoc2VsZWN0b3IsIHJldCk7CiAgICAgIH0KCiAgICAgIHJldCA9IHRoaXMubGVuZ3RoID4gMSAmJiAhZ3VhcmFudGVlZFVuaXF1ZVtuYW1lXSA/IGpRdWVyeS51bmlxdWUocmV0KSA6IHJldDsKCiAgICAgIGlmICh0aGlzLmxlbmd0aCA+IDEgJiYgcnBhcmVudHNwcmV2LnRlc3QobmFtZSkpIHsKICAgICAgICByZXQgPSByZXQucmV2ZXJzZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2socmV0KTsKICAgIH07CiAgfSk7CiAgalF1ZXJ5LmV4dGVuZCh7CiAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcihleHByLCBlbGVtcywgbm90KSB7CiAgICAgIGlmIChub3QpIHsKICAgICAgICBleHByID0gIjpub3QoIiArIGV4cHIgKyAiKSI7CiAgICAgIH0KCiAgICAgIHJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgPyBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoZWxlbXNbMF0sIGV4cHIpID8gW2VsZW1zWzBdXSA6IFtdIDogalF1ZXJ5LmZpbmQubWF0Y2hlcyhleHByLCBlbGVtcyk7CiAgICB9LAogICAgZGlyOiBmdW5jdGlvbiBkaXIoZWxlbSwgX2RpciwgdW50aWwpIHsKICAgICAgdmFyIG1hdGNoZWQgPSBbXSwKICAgICAgICAgIGN1ciA9IGVsZW1bX2Rpcl07CgogICAgICB3aGlsZSAoY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gOSAmJiAodW50aWwgPT09IHVuZGVmaW5lZCB8fCBjdXIubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeShjdXIpLmlzKHVudGlsKSkpIHsKICAgICAgICBpZiAoY3VyLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICBtYXRjaGVkLnB1c2goY3VyKTsKICAgICAgICB9CgogICAgICAgIGN1ciA9IGN1cltfZGlyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1hdGNoZWQ7CiAgICB9LAogICAgc2libGluZzogZnVuY3Rpb24gc2libGluZyhuLCBlbGVtKSB7CiAgICAgIHZhciByID0gW107CgogICAgICBmb3IgKDsgbjsgbiA9IG4ubmV4dFNpYmxpbmcpIHsKICAgICAgICBpZiAobi5ub2RlVHlwZSA9PT0gMSAmJiBuICE9PSBlbGVtKSB7CiAgICAgICAgICByLnB1c2gobik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KICB9KTsgLy8gSW1wbGVtZW50IHRoZSBpZGVudGljYWwgZnVuY3Rpb25hbGl0eSBmb3IgZmlsdGVyIGFuZCBub3QKCiAgZnVuY3Rpb24gd2lubm93KGVsZW1lbnRzLCBxdWFsaWZpZXIsIGtlZXApIHsKICAgIC8vIENhbid0IHBhc3MgbnVsbCBvciB1bmRlZmluZWQgdG8gaW5kZXhPZiBpbiBGaXJlZm94IDQKICAgIC8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrCiAgICBxdWFsaWZpZXIgPSBxdWFsaWZpZXIgfHwgMDsKCiAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24ocXVhbGlmaWVyKSkgewogICAgICByZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtLCBpKSB7CiAgICAgICAgdmFyIHJldFZhbCA9ICEhcXVhbGlmaWVyLmNhbGwoZWxlbSwgaSwgZWxlbSk7CiAgICAgICAgcmV0dXJuIHJldFZhbCA9PT0ga2VlcDsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHF1YWxpZmllci5ub2RlVHlwZSkgewogICAgICByZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgcmV0dXJuIGVsZW0gPT09IHF1YWxpZmllciA9PT0ga2VlcDsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBxdWFsaWZpZXIgPT09ICJzdHJpbmciKSB7CiAgICAgIHZhciBmaWx0ZXJlZCA9IGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIHJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwogICAgICB9KTsKCiAgICAgIGlmIChpc1NpbXBsZS50ZXN0KHF1YWxpZmllcikpIHsKICAgICAgICByZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkLCAha2VlcCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgcmV0dXJuIGpRdWVyeS5pbkFycmF5KGVsZW0sIHF1YWxpZmllcikgPj0gMCA9PT0ga2VlcDsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlU2FmZUZyYWdtZW50KGRvY3VtZW50KSB7CiAgICB2YXIgbGlzdCA9IG5vZGVOYW1lcy5zcGxpdCgifCIpLAogICAgICAgIHNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKICAgIGlmIChzYWZlRnJhZy5jcmVhdGVFbGVtZW50KSB7CiAgICAgIHdoaWxlIChsaXN0Lmxlbmd0aCkgewogICAgICAgIHNhZmVGcmFnLmNyZWF0ZUVsZW1lbnQobGlzdC5wb3AoKSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc2FmZUZyYWc7CiAgfQoKICB2YXIgbm9kZU5hbWVzID0gImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xiZGl8Y2FudmFzfGRhdGF8ZGF0YWxpc3R8ZGV0YWlsc3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8IiArICJoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsCiAgICAgIHJpbmxpbmVqUXVlcnkgPSAvIGpRdWVyeVxkKz0iKD86bnVsbHxcZCspIi9nLAogICAgICBybm9zaGltY2FjaGUgPSBuZXcgUmVnRXhwKCI8KD86IiArIG5vZGVOYW1lcyArICIpW1xccy8+XSIsICJpIiksCiAgICAgIHJsZWFkaW5nV2hpdGVzcGFjZSA9IC9eXHMrLywKICAgICAgcnhodG1sVGFnID0gLzwoPyFhcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSgoW1x3Ol0rKVtePl0qKVwvPi9naSwKICAgICAgcnRhZ05hbWUgPSAvPChbXHc6XSspLywKICAgICAgcnRib2R5ID0gLzx0Ym9keS9pLAogICAgICByaHRtbCA9IC88fCYjP1x3KzsvLAogICAgICBybm9Jbm5lcmh0bWwgPSAvPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLAogICAgICBtYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwKICAgICAgLy8gY2hlY2tlZD0iY2hlY2tlZCIgb3IgY2hlY2tlZAogIHJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCiAgICAgIHJzY3JpcHRUeXBlID0gL14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLAogICAgICByc2NyaXB0VHlwZU1hc2tlZCA9IC9edHJ1ZVwvKC4qKS8sCiAgICAgIHJjbGVhblNjcmlwdCA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKICAgICAgLy8gV2UgaGF2ZSB0byBjbG9zZSB0aGVzZSB0YWdzIHRvIHN1cHBvcnQgWEhUTUwgKCMxMzIwMCkKICB3cmFwTWFwID0gewogICAgb3B0aW9uOiBbMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+Il0sCiAgICBsZWdlbmQ6IFsxLCAiPGZpZWxkc2V0PiIsICI8L2ZpZWxkc2V0PiJdLAogICAgYXJlYTogWzEsICI8bWFwPiIsICI8L21hcD4iXSwKICAgIHBhcmFtOiBbMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiJdLAogICAgdGhlYWQ6IFsxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiJdLAogICAgdHI6IFsyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiJdLAogICAgY29sOiBbMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iXSwKICAgIHRkOiBbMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iXSwKICAgIC8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCiAgICAvLyB1bmxlc3Mgd3JhcHBlZCBpbiBhIGRpdiB3aXRoIG5vbi1icmVha2luZyBjaGFyYWN0ZXJzIGluIGZyb250IG9mIGl0LgogICAgX2RlZmF1bHQ6IGpRdWVyeS5zdXBwb3J0Lmh0bWxTZXJpYWxpemUgPyBbMCwgIiIsICIiXSA6IFsxLCAiWDxkaXY+IiwgIjwvZGl2PiJdCiAgfSwKICAgICAgc2FmZUZyYWdtZW50ID0gY3JlYXRlU2FmZUZyYWdtZW50KGRvY3VtZW50KSwKICAgICAgZnJhZ21lbnREaXYgPSBzYWZlRnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpOwogIHdyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKICB3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwogIHdyYXBNYXAudGggPSB3cmFwTWFwLnRkOwogIGpRdWVyeS5mbi5leHRlbmQoewogICAgdGV4dDogZnVuY3Rpb24gdGV4dCh2YWx1ZSkgewogICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IGpRdWVyeS50ZXh0KHRoaXMpIDogdGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKHZhbHVlKSk7CiAgICAgIH0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0sCiAgICB3cmFwQWxsOiBmdW5jdGlvbiB3cmFwQWxsKGh0bWwpIHsKICAgICAgaWYgKGpRdWVyeS5pc0Z1bmN0aW9uKGh0bWwpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLndyYXBBbGwoaHRtbC5jYWxsKHRoaXMsIGkpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXNbMF0pIHsKICAgICAgICAvLyBUaGUgZWxlbWVudHMgdG8gd3JhcCB0aGUgdGFyZ2V0IGFyb3VuZAogICAgICAgIHZhciB3cmFwID0galF1ZXJ5KGh0bWwsIHRoaXNbMF0ub3duZXJEb2N1bWVudCkuZXEoMCkuY2xvbmUodHJ1ZSk7CgogICAgICAgIGlmICh0aGlzWzBdLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pOwogICAgICAgIH0KCiAgICAgICAgd3JhcC5tYXAoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGVsZW0gPSB0aGlzOwoKICAgICAgICAgIHdoaWxlIChlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGVsZW07CiAgICAgICAgfSkuYXBwZW5kKHRoaXMpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICB3cmFwSW5uZXI6IGZ1bmN0aW9uIHdyYXBJbm5lcihodG1sKSB7CiAgICAgIGlmIChqUXVlcnkuaXNGdW5jdGlvbihodG1sKSkgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIGpRdWVyeSh0aGlzKS53cmFwSW5uZXIoaHRtbC5jYWxsKHRoaXMsIGkpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSBqUXVlcnkodGhpcyksCiAgICAgICAgICAgIGNvbnRlbnRzID0gc2VsZi5jb250ZW50cygpOwoKICAgICAgICBpZiAoY29udGVudHMubGVuZ3RoKSB7CiAgICAgICAgICBjb250ZW50cy53cmFwQWxsKGh0bWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWxmLmFwcGVuZChodG1sKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHdyYXA6IGZ1bmN0aW9uIHdyYXAoaHRtbCkgewogICAgICB2YXIgaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKGh0bWwpOwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgalF1ZXJ5KHRoaXMpLndyYXBBbGwoaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwpOwogICAgICB9KTsKICAgIH0sCiAgICB1bndyYXA6IGZ1bmN0aW9uIHVud3JhcCgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFqUXVlcnkubm9kZU5hbWUodGhpcywgImJvZHkiKSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyk7CiAgICAgICAgfQogICAgICB9KS5lbmQoKTsKICAgIH0sCiAgICBhcHBlbmQ6IGZ1bmN0aW9uIGFwcGVuZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIGlmICh0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkpIHsKICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoZWxlbSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBwcmVwZW5kOiBmdW5jdGlvbiBwcmVwZW5kKCkgewogICAgICByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIHRydWUsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgaWYgKHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSkgewogICAgICAgICAgdGhpcy5pbnNlcnRCZWZvcmUoZWxlbSwgdGhpcy5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGJlZm9yZTogZnVuY3Rpb24gYmVmb3JlKCkgewogICAgICByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIGZhbHNlLCBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIGlmICh0aGlzLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBhZnRlcjogZnVuY3Rpb24gYWZ0ZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSkgewogICAgICAgICAgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtLCB0aGlzLm5leHRTaWJsaW5nKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vIGtlZXBEYXRhIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS0tZG8gbm90IGRvY3VtZW50CiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZShzZWxlY3Rvciwga2VlcERhdGEpIHsKICAgICAgdmFyIGVsZW0sCiAgICAgICAgICBpID0gMDsKCiAgICAgIGZvciAoOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKykgewogICAgICAgIGlmICghc2VsZWN0b3IgfHwgalF1ZXJ5LmZpbHRlcihzZWxlY3RvciwgW2VsZW1dKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBpZiAoIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgalF1ZXJ5LmNsZWFuRGF0YShnZXRBbGwoZWxlbSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgaWYgKGtlZXBEYXRhICYmIGpRdWVyeS5jb250YWlucyhlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0pKSB7CiAgICAgICAgICAgICAgc2V0R2xvYmFsRXZhbChnZXRBbGwoZWxlbSwgInNjcmlwdCIpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgZW1wdHk6IGZ1bmN0aW9uIGVtcHR5KCkgewogICAgICB2YXIgZWxlbSwKICAgICAgICAgIGkgPSAwOwoKICAgICAgZm9yICg7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrKSB7CiAgICAgICAgLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCiAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgIGpRdWVyeS5jbGVhbkRhdGEoZ2V0QWxsKGVsZW0sIGZhbHNlKSk7CiAgICAgICAgfSAvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoKCiAgICAgICAgd2hpbGUgKGVsZW0uZmlyc3RDaGlsZCkgewogICAgICAgICAgZWxlbS5yZW1vdmVDaGlsZChlbGVtLmZpcnN0Q2hpbGQpOwogICAgICAgIH0gLy8gSWYgdGhpcyBpcyBhIHNlbGVjdCwgZW5zdXJlIHRoYXQgaXQgZGlzcGxheXMgZW1wdHkgKCMxMjMzNikKICAgICAgICAvLyBTdXBwb3J0OiBJRTw5CgoKICAgICAgICBpZiAoZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZShlbGVtLCAic2VsZWN0IikpIHsKICAgICAgICAgIGVsZW0ub3B0aW9ucy5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzKSB7CiAgICAgIGRhdGFBbmRFdmVudHMgPSBkYXRhQW5kRXZlbnRzID09IG51bGwgPyBmYWxzZSA6IGRhdGFBbmRFdmVudHM7CiAgICAgIGRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4galF1ZXJ5LmNsb25lKHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzKTsKICAgICAgfSk7CiAgICB9LAogICAgaHRtbDogZnVuY3Rpb24gaHRtbCh2YWx1ZSkgewogICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCiAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICBsID0gdGhpcy5sZW5ndGg7CgogICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMSA/IGVsZW0uaW5uZXJIVE1MLnJlcGxhY2UocmlubGluZWpRdWVyeSwgIiIpIDogdW5kZWZpbmVkOwogICAgICAgIH0gLy8gU2VlIGlmIHdlIGNhbiB0YWtlIGEgc2hvcnRjdXQgYW5kIGp1c3QgdXNlIGlubmVySFRNTAoKCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgIXJub0lubmVyaHRtbC50ZXN0KHZhbHVlKSAmJiAoalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSB8fCAhcm5vc2hpbWNhY2hlLnRlc3QodmFsdWUpKSAmJiAoalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgfHwgIXJsZWFkaW5nV2hpdGVzcGFjZS50ZXN0KHZhbHVlKSkgJiYgIXdyYXBNYXBbKHJ0YWdOYW1lLmV4ZWModmFsdWUpIHx8IFsiIiwgIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKHJ4aHRtbFRhZywgIjwkMT48LyQyPiIpOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCiAgICAgICAgICAgICAgZWxlbSA9IHRoaXNbaV0gfHwge307CgogICAgICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKGdldEFsbChlbGVtLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsZW0gPSAwOyAvLyBJZiB1c2luZyBpbm5lckhUTUwgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgdXNlIHRoZSBmYWxsYmFjayBtZXRob2QKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQoKICAgICAgICBpZiAoZWxlbSkgewogICAgICAgICAgdGhpcy5lbXB0eSgpLmFwcGVuZCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCk7CiAgICB9LAogICAgcmVwbGFjZVdpdGg6IGZ1bmN0aW9uIHJlcGxhY2VXaXRoKHZhbHVlKSB7CiAgICAgIHZhciBpc0Z1bmMgPSBqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSk7IC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBlbGVtZW50cyBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBET00gYmVmb3JlIHRoZXkgYXJlIGluc2VydGVkCiAgICAgIC8vIHRoaXMgY2FuIGhlbHAgZml4IHJlcGxhY2luZyBhIHBhcmVudCB3aXRoIGNoaWxkIGVsZW1lbnRzCgogICAgICBpZiAoIWlzRnVuYyAmJiB0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgdmFsdWUgPSBqUXVlcnkodmFsdWUpLm5vdCh0aGlzKS5kZXRhY2goKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZG9tTWFuaXAoW3ZhbHVlXSwgdHJ1ZSwgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICB2YXIgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmcsCiAgICAgICAgICAgIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTsKCiAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShlbGVtLCBuZXh0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGRldGFjaDogZnVuY3Rpb24gZGV0YWNoKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnJlbW92ZShzZWxlY3RvciwgdHJ1ZSk7CiAgICB9LAogICAgZG9tTWFuaXA6IGZ1bmN0aW9uIGRvbU1hbmlwKGFyZ3MsIHRhYmxlLCBjYWxsYmFjaykgewogICAgICAvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCiAgICAgIGFyZ3MgPSBjb3JlX2NvbmNhdC5hcHBseShbXSwgYXJncyk7CiAgICAgIHZhciBmaXJzdCwKICAgICAgICAgIG5vZGUsCiAgICAgICAgICBoYXNTY3JpcHRzLAogICAgICAgICAgc2NyaXB0cywKICAgICAgICAgIGRvYywKICAgICAgICAgIGZyYWdtZW50LAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBsID0gdGhpcy5sZW5ndGgsCiAgICAgICAgICBzZXQgPSB0aGlzLAogICAgICAgICAgaU5vQ2xvbmUgPSBsIC0gMSwKICAgICAgICAgIHZhbHVlID0gYXJnc1swXSwKICAgICAgICAgIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbih2YWx1ZSk7IC8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoKICAgICAgaWYgKGlzRnVuY3Rpb24gfHwgIShsIDw9IDEgfHwgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiB8fCBqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KHZhbHVlKSkpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgdmFyIHNlbGYgPSBzZXQuZXEoaW5kZXgpOwoKICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKSB7CiAgICAgICAgICAgIGFyZ3NbMF0gPSB2YWx1ZS5jYWxsKHRoaXMsIGluZGV4LCB0YWJsZSA/IHNlbGYuaHRtbCgpIDogdW5kZWZpbmVkKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZWxmLmRvbU1hbmlwKGFyZ3MsIHRhYmxlLCBjYWxsYmFjayk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChsKSB7CiAgICAgICAgZnJhZ21lbnQgPSBqUXVlcnkuYnVpbGRGcmFnbWVudChhcmdzLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQsIGZhbHNlLCB0aGlzKTsKICAgICAgICBmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgogICAgICAgIGlmIChmcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgZnJhZ21lbnQgPSBmaXJzdDsKICAgICAgICB9CgogICAgICAgIGlmIChmaXJzdCkgewogICAgICAgICAgdGFibGUgPSB0YWJsZSAmJiBqUXVlcnkubm9kZU5hbWUoZmlyc3QsICJ0ciIpOwogICAgICAgICAgc2NyaXB0cyA9IGpRdWVyeS5tYXAoZ2V0QWxsKGZyYWdtZW50LCAic2NyaXB0IiksIGRpc2FibGVTY3JpcHQpOwogICAgICAgICAgaGFzU2NyaXB0cyA9IHNjcmlwdHMubGVuZ3RoOyAvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAogICAgICAgICAgLy8gYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseSBpbiBjZXJ0YWluIHNpdHVhdGlvbnMgKCM4MDcwKS4KCiAgICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICBub2RlID0gZnJhZ21lbnQ7CgogICAgICAgICAgICBpZiAoaSAhPT0gaU5vQ2xvbmUpIHsKICAgICAgICAgICAgICBub2RlID0galF1ZXJ5LmNsb25lKG5vZGUsIHRydWUsIHRydWUpOyAvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uCgogICAgICAgICAgICAgIGlmIChoYXNTY3JpcHRzKSB7CiAgICAgICAgICAgICAgICBqUXVlcnkubWVyZ2Uoc2NyaXB0cywgZ2V0QWxsKG5vZGUsICJzY3JpcHQiKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRhYmxlICYmIGpRdWVyeS5ub2RlTmFtZSh0aGlzW2ldLCAidGFibGUiKSA/IGZpbmRPckFwcGVuZCh0aGlzW2ldLCAidGJvZHkiKSA6IHRoaXNbaV0sIG5vZGUsIGkpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoYXNTY3JpcHRzKSB7CiAgICAgICAgICAgIGRvYyA9IHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5vd25lckRvY3VtZW50OyAvLyBSZWVuYWJsZSBzY3JpcHRzCgogICAgICAgICAgICBqUXVlcnkubWFwKHNjcmlwdHMsIHJlc3RvcmVTY3JpcHQpOyAvLyBFdmFsdWF0ZSBleGVjdXRhYmxlIHNjcmlwdHMgb24gZmlyc3QgZG9jdW1lbnQgaW5zZXJ0aW9uCgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGFzU2NyaXB0czsgaSsrKSB7CiAgICAgICAgICAgICAgbm9kZSA9IHNjcmlwdHNbaV07CgogICAgICAgICAgICAgIGlmIChyc2NyaXB0VHlwZS50ZXN0KG5vZGUudHlwZSB8fCAiIikgJiYgIWpRdWVyeS5fZGF0YShub2RlLCAiZ2xvYmFsRXZhbCIpICYmIGpRdWVyeS5jb250YWlucyhkb2MsIG5vZGUpKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5zcmMpIHsKICAgICAgICAgICAgICAgICAgLy8gSG9wZSBhamF4IGlzIGF2YWlsYWJsZS4uLgogICAgICAgICAgICAgICAgICBqUXVlcnkuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBub2RlLnNyYywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogInNjcmlwdCIsCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGdsb2JhbDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgInRocm93cyI6IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBqUXVlcnkuZ2xvYmFsRXZhbCgobm9kZS50ZXh0IHx8IG5vZGUudGV4dENvbnRlbnQgfHwgbm9kZS5pbm5lckhUTUwgfHwgIiIpLnJlcGxhY2UocmNsZWFuU2NyaXB0LCAiIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBGaXggIzExODA5OiBBdm9pZCBsZWFraW5nIG1lbW9yeQoKCiAgICAgICAgICBmcmFnbWVudCA9IGZpcnN0ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0pOwoKICBmdW5jdGlvbiBmaW5kT3JBcHBlbmQoZWxlbSwgdGFnKSB7CiAgICByZXR1cm4gZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpWzBdIHx8IGVsZW0uYXBwZW5kQ2hpbGQoZWxlbS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKSk7CiAgfSAvLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCgoKICBmdW5jdGlvbiBkaXNhYmxlU2NyaXB0KGVsZW0pIHsKICAgIHZhciBhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJ0eXBlIik7CiAgICBlbGVtLnR5cGUgPSAoYXR0ciAmJiBhdHRyLnNwZWNpZmllZCkgKyAiLyIgKyBlbGVtLnR5cGU7CiAgICByZXR1cm4gZWxlbTsKICB9CgogIGZ1bmN0aW9uIHJlc3RvcmVTY3JpcHQoZWxlbSkgewogICAgdmFyIG1hdGNoID0gcnNjcmlwdFR5cGVNYXNrZWQuZXhlYyhlbGVtLnR5cGUpOwoKICAgIGlmIChtYXRjaCkgewogICAgICBlbGVtLnR5cGUgPSBtYXRjaFsxXTsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIik7CiAgICB9CgogICAgcmV0dXJuIGVsZW07CiAgfSAvLyBNYXJrIHNjcmlwdHMgYXMgaGF2aW5nIGFscmVhZHkgYmVlbiBldmFsdWF0ZWQKCgogIGZ1bmN0aW9uIHNldEdsb2JhbEV2YWwoZWxlbXMsIHJlZkVsZW1lbnRzKSB7CiAgICB2YXIgZWxlbSwKICAgICAgICBpID0gMDsKCiAgICBmb3IgKDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrKSB7CiAgICAgIGpRdWVyeS5fZGF0YShlbGVtLCAiZ2xvYmFsRXZhbCIsICFyZWZFbGVtZW50cyB8fCBqUXVlcnkuX2RhdGEocmVmRWxlbWVudHNbaV0sICJnbG9iYWxFdmFsIikpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2xvbmVDb3B5RXZlbnQoc3JjLCBkZXN0KSB7CiAgICBpZiAoZGVzdC5ub2RlVHlwZSAhPT0gMSB8fCAhalF1ZXJ5Lmhhc0RhdGEoc3JjKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHR5cGUsCiAgICAgICAgaSwKICAgICAgICBsLAogICAgICAgIG9sZERhdGEgPSBqUXVlcnkuX2RhdGEoc3JjKSwKICAgICAgICBjdXJEYXRhID0galF1ZXJ5Ll9kYXRhKGRlc3QsIG9sZERhdGEpLAogICAgICAgIGV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKICAgIGlmIChldmVudHMpIHsKICAgICAgZGVsZXRlIGN1ckRhdGEuaGFuZGxlOwogICAgICBjdXJEYXRhLmV2ZW50cyA9IHt9OwoKICAgICAgZm9yICh0eXBlIGluIGV2ZW50cykgewogICAgICAgIGZvciAoaSA9IDAsIGwgPSBldmVudHNbdHlwZV0ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBqUXVlcnkuZXZlbnQuYWRkKGRlc3QsIHR5cGUsIGV2ZW50c1t0eXBlXVtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIG1ha2UgdGhlIGNsb25lZCBwdWJsaWMgZGF0YSBvYmplY3QgYSBjb3B5IGZyb20gdGhlIG9yaWdpbmFsCgoKICAgIGlmIChjdXJEYXRhLmRhdGEpIHsKICAgICAgY3VyRGF0YS5kYXRhID0galF1ZXJ5LmV4dGVuZCh7fSwgY3VyRGF0YS5kYXRhKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpeENsb25lTm9kZUlzc3VlcyhzcmMsIGRlc3QpIHsKICAgIHZhciBub2RlTmFtZSwgZSwgZGF0YTsgLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoKICAgIGlmIChkZXN0Lm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsgLy8gSUU2LTggY29waWVzIGV2ZW50cyBib3VuZCB2aWEgYXR0YWNoRXZlbnQgd2hlbiB1c2luZyBjbG9uZU5vZGUuCgogICAgaWYgKCFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lRXZlbnQgJiYgZGVzdFtqUXVlcnkuZXhwYW5kb10pIHsKICAgICAgZGF0YSA9IGpRdWVyeS5fZGF0YShkZXN0KTsKCiAgICAgIGZvciAoZSBpbiBkYXRhLmV2ZW50cykgewogICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudChkZXN0LCBlLCBkYXRhLmhhbmRsZSk7CiAgICAgIH0gLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8gZ2V0cyBjb3BpZWQgdG9vCgoKICAgICAgZGVzdC5yZW1vdmVBdHRyaWJ1dGUoalF1ZXJ5LmV4cGFuZG8pOwogICAgfSAvLyBJRSBibGFua3MgY29udGVudHMgd2hlbiBjbG9uaW5nIHNjcmlwdHMsIGFuZCB0cmllcyB0byBldmFsdWF0ZSBuZXdseS1zZXQgdGV4dAoKCiAgICBpZiAobm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQpIHsKICAgICAgZGlzYWJsZVNjcmlwdChkZXN0KS50ZXh0ID0gc3JjLnRleHQ7CiAgICAgIHJlc3RvcmVTY3JpcHQoZGVzdCk7IC8vIElFNi0xMCBpbXByb3Blcmx5IGNsb25lcyBjaGlsZHJlbiBvZiBvYmplY3QgZWxlbWVudHMgdXNpbmcgY2xhc3NpZC4KICAgICAgLy8gSUUxMCB0aHJvd3MgTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3IgaWYgcGFyZW50IGlzIG51bGwsICMxMjEzMi4KICAgIH0gZWxzZSBpZiAobm9kZU5hbWUgPT09ICJvYmplY3QiKSB7CiAgICAgIGlmIChkZXN0LnBhcmVudE5vZGUpIHsKICAgICAgICBkZXN0Lm91dGVySFRNTCA9IHNyYy5vdXRlckhUTUw7CiAgICAgIH0gLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAogICAgICAvLyBlbGVtZW50IGluIElFOSwgdGhlIG91dGVySFRNTCBzdHJhdGVneSBhYm92ZSBpcyBub3Qgc3VmZmljaWVudC4KICAgICAgLy8gSWYgdGhlIHNyYyBoYXMgaW5uZXJIVE1MIGFuZCB0aGUgZGVzdGluYXRpb24gZG9lcyBub3QsCiAgICAgIC8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoKCiAgICAgIGlmIChqUXVlcnkuc3VwcG9ydC5odG1sNUNsb25lICYmIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKGRlc3QuaW5uZXJIVE1MKSkgewogICAgICAgIGRlc3QuaW5uZXJIVE1MID0gc3JjLmlubmVySFRNTDsKICAgICAgfQogICAgfSBlbHNlIGlmIChub2RlTmFtZSA9PT0gImlucHV0IiAmJiBtYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUudGVzdChzcmMudHlwZSkpIHsKICAgICAgLy8gSUU2LTggZmFpbHMgdG8gcGVyc2lzdCB0aGUgY2hlY2tlZCBzdGF0ZSBvZiBhIGNsb25lZCBjaGVja2JveAogICAgICAvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CiAgICAgIC8vIGEgY2hlY2tlZCBhcHBlYXJhbmNlIGlmIHRoZSBkZWZhdWx0Q2hlY2tlZCB2YWx1ZSBpc24ndCBhbHNvIHNldAogICAgICBkZXN0LmRlZmF1bHRDaGVja2VkID0gZGVzdC5jaGVja2VkID0gc3JjLmNoZWNrZWQ7IC8vIElFNi03IGdldCBjb25mdXNlZCBhbmQgZW5kIHVwIHNldHRpbmcgdGhlIHZhbHVlIG9mIGEgY2xvbmVkCiAgICAgIC8vIGNoZWNrYm94L3JhZGlvIGJ1dHRvbiB0byBhbiBlbXB0eSBzdHJpbmcgaW5zdGVhZCBvZiAib24iCgogICAgICBpZiAoZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlKSB7CiAgICAgICAgZGVzdC52YWx1ZSA9IHNyYy52YWx1ZTsKICAgICAgfSAvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAogICAgICAvLyBzdGF0ZSB3aGVuIGNsb25pbmcgb3B0aW9ucwoKICAgIH0gZWxzZSBpZiAobm9kZU5hbWUgPT09ICJvcHRpb24iKSB7CiAgICAgIGRlc3QuZGVmYXVsdFNlbGVjdGVkID0gZGVzdC5zZWxlY3RlZCA9IHNyYy5kZWZhdWx0U2VsZWN0ZWQ7IC8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KICAgICAgLy8gY2xvbmluZyBvdGhlciB0eXBlcyBvZiBpbnB1dCBmaWVsZHMKICAgIH0gZWxzZSBpZiAobm9kZU5hbWUgPT09ICJpbnB1dCIgfHwgbm9kZU5hbWUgPT09ICJ0ZXh0YXJlYSIpIHsKICAgICAgZGVzdC5kZWZhdWx0VmFsdWUgPSBzcmMuZGVmYXVsdFZhbHVlOwogICAgfQogIH0KCiAgalF1ZXJ5LmVhY2goewogICAgYXBwZW5kVG86ICJhcHBlbmQiLAogICAgcHJlcGVuZFRvOiAicHJlcGVuZCIsCiAgICBpbnNlcnRCZWZvcmU6ICJiZWZvcmUiLAogICAgaW5zZXJ0QWZ0ZXI6ICJhZnRlciIsCiAgICByZXBsYWNlQWxsOiAicmVwbGFjZVdpdGgiCiAgfSwgZnVuY3Rpb24gKG5hbWUsIG9yaWdpbmFsKSB7CiAgICBqUXVlcnkuZm5bbmFtZV0gPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHsKICAgICAgdmFyIGVsZW1zLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICByZXQgPSBbXSwKICAgICAgICAgIGluc2VydCA9IGpRdWVyeShzZWxlY3RvciksCiAgICAgICAgICBsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDE7CgogICAgICBmb3IgKDsgaSA8PSBsYXN0OyBpKyspIHsKICAgICAgICBlbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSh0cnVlKTsKICAgICAgICBqUXVlcnkoaW5zZXJ0W2ldKVtvcmlnaW5hbF0oZWxlbXMpOyAvLyBNb2Rlcm4gYnJvd3NlcnMgY2FuIGFwcGx5IGpRdWVyeSBjb2xsZWN0aW9ucyBhcyBhcnJheXMsIGJ1dCBvbGRJRSBuZWVkcyBhIC5nZXQoKQoKICAgICAgICBjb3JlX3B1c2guYXBwbHkocmV0LCBlbGVtcy5nZXQoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhyZXQpOwogICAgfTsKICB9KTsKCiAgZnVuY3Rpb24gZ2V0QWxsKGNvbnRleHQsIHRhZykgewogICAgdmFyIGVsZW1zLAogICAgICAgIGVsZW0sCiAgICAgICAgaSA9IDAsCiAgICAgICAgZm91bmQgPSBfdHlwZW9mKGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUpICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnIHx8ICIqIikgOiBfdHlwZW9mKGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCkgIT09IGNvcmVfc3RydW5kZWZpbmVkID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKHRhZyB8fCAiKiIpIDogdW5kZWZpbmVkOwoKICAgIGlmICghZm91bmQpIHsKICAgICAgZm9yIChmb3VuZCA9IFtdLCBlbGVtcyA9IGNvbnRleHQuY2hpbGROb2RlcyB8fCBjb250ZXh0OyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKyspIHsKICAgICAgICBpZiAoIXRhZyB8fCBqUXVlcnkubm9kZU5hbWUoZWxlbSwgdGFnKSkgewogICAgICAgICAgZm91bmQucHVzaChlbGVtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgalF1ZXJ5Lm1lcmdlKGZvdW5kLCBnZXRBbGwoZWxlbSwgdGFnKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhZyA9PT0gdW5kZWZpbmVkIHx8IHRhZyAmJiBqUXVlcnkubm9kZU5hbWUoY29udGV4dCwgdGFnKSA/IGpRdWVyeS5tZXJnZShbY29udGV4dF0sIGZvdW5kKSA6IGZvdW5kOwogIH0gLy8gVXNlZCBpbiBidWlsZEZyYWdtZW50LCBmaXhlcyB0aGUgZGVmYXVsdENoZWNrZWQgcHJvcGVydHkKCgogIGZ1bmN0aW9uIGZpeERlZmF1bHRDaGVja2VkKGVsZW0pIHsKICAgIGlmIChtYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUudGVzdChlbGVtLnR5cGUpKSB7CiAgICAgIGVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7CiAgICB9CiAgfQoKICBqUXVlcnkuZXh0ZW5kKHsKICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZShlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cykgewogICAgICB2YXIgZGVzdEVsZW1lbnRzLAogICAgICAgICAgbm9kZSwKICAgICAgICAgIGNsb25lLAogICAgICAgICAgaSwKICAgICAgICAgIHNyY0VsZW1lbnRzLAogICAgICAgICAgaW5QYWdlID0galF1ZXJ5LmNvbnRhaW5zKGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSk7CgogICAgICBpZiAoalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoZWxlbSkgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCI8IiArIGVsZW0ubm9kZU5hbWUgKyAiPiIpKSB7CiAgICAgICAgY2xvbmUgPSBlbGVtLmNsb25lTm9kZSh0cnVlKTsgLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwogICAgICB9IGVsc2UgewogICAgICAgIGZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwogICAgICAgIGZyYWdtZW50RGl2LnJlbW92ZUNoaWxkKGNsb25lID0gZnJhZ21lbnREaXYuZmlyc3RDaGlsZCk7CiAgICAgIH0KCiAgICAgIGlmICgoIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCB8fCAhalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUNoZWNrZWQpICYmIChlbGVtLm5vZGVUeXBlID09PSAxIHx8IGVsZW0ubm9kZVR5cGUgPT09IDExKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pKSB7CiAgICAgICAgLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKICAgICAgICBkZXN0RWxlbWVudHMgPSBnZXRBbGwoY2xvbmUpOwogICAgICAgIHNyY0VsZW1lbnRzID0gZ2V0QWxsKGVsZW0pOyAvLyBGaXggYWxsIElFIGNsb25pbmcgaXNzdWVzCgogICAgICAgIGZvciAoaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7ICsraSkgewogICAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CiAgICAgICAgICBpZiAoZGVzdEVsZW1lbnRzW2ldKSB7CiAgICAgICAgICAgIGZpeENsb25lTm9kZUlzc3Vlcyhub2RlLCBkZXN0RWxlbWVudHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgoKICAgICAgaWYgKGRhdGFBbmRFdmVudHMpIHsKICAgICAgICBpZiAoZGVlcERhdGFBbmRFdmVudHMpIHsKICAgICAgICAgIHNyY0VsZW1lbnRzID0gc3JjRWxlbWVudHMgfHwgZ2V0QWxsKGVsZW0pOwogICAgICAgICAgZGVzdEVsZW1lbnRzID0gZGVzdEVsZW1lbnRzIHx8IGdldEFsbChjbG9uZSk7CgogICAgICAgICAgZm9yIChpID0gMDsgKG5vZGUgPSBzcmNFbGVtZW50c1tpXSkgIT0gbnVsbDsgaSsrKSB7CiAgICAgICAgICAgIGNsb25lQ29weUV2ZW50KG5vZGUsIGRlc3RFbGVtZW50c1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNsb25lQ29weUV2ZW50KGVsZW0sIGNsb25lKTsKICAgICAgICB9CiAgICAgIH0gLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoKCiAgICAgIGRlc3RFbGVtZW50cyA9IGdldEFsbChjbG9uZSwgInNjcmlwdCIpOwoKICAgICAgaWYgKGRlc3RFbGVtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgc2V0R2xvYmFsRXZhbChkZXN0RWxlbWVudHMsICFpblBhZ2UgJiYgZ2V0QWxsKGVsZW0sICJzY3JpcHQiKSk7CiAgICAgIH0KCiAgICAgIGRlc3RFbGVtZW50cyA9IHNyY0VsZW1lbnRzID0gbm9kZSA9IG51bGw7IC8vIFJldHVybiB0aGUgY2xvbmVkIHNldAoKICAgICAgcmV0dXJuIGNsb25lOwogICAgfSwKICAgIGJ1aWxkRnJhZ21lbnQ6IGZ1bmN0aW9uIGJ1aWxkRnJhZ21lbnQoZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbikgewogICAgICB2YXIgaiwKICAgICAgICAgIGVsZW0sCiAgICAgICAgICBjb250YWlucywKICAgICAgICAgIHRtcCwKICAgICAgICAgIHRhZywKICAgICAgICAgIHRib2R5LAogICAgICAgICAgd3JhcCwKICAgICAgICAgIGwgPSBlbGVtcy5sZW5ndGgsCiAgICAgICAgICAvLyBFbnN1cmUgYSBzYWZlIGZyYWdtZW50CiAgICAgIHNhZmUgPSBjcmVhdGVTYWZlRnJhZ21lbnQoY29udGV4dCksCiAgICAgICAgICBub2RlcyA9IFtdLAogICAgICAgICAgaSA9IDA7CgogICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgIGVsZW0gPSBlbGVtc1tpXTsKCiAgICAgICAgaWYgKGVsZW0gfHwgZWxlbSA9PT0gMCkgewogICAgICAgICAgLy8gQWRkIG5vZGVzIGRpcmVjdGx5CiAgICAgICAgICBpZiAoalF1ZXJ5LnR5cGUoZWxlbSkgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIGpRdWVyeS5tZXJnZShub2RlcywgZWxlbS5ub2RlVHlwZSA/IFtlbGVtXSA6IGVsZW0pOyAvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUKICAgICAgICAgIH0gZWxzZSBpZiAoIXJodG1sLnRlc3QoZWxlbSkpIHsKICAgICAgICAgICAgbm9kZXMucHVzaChjb250ZXh0LmNyZWF0ZVRleHROb2RlKGVsZW0pKTsgLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0bXAgPSB0bXAgfHwgc2FmZS5hcHBlbmRDaGlsZChjb250ZXh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsgLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoKICAgICAgICAgICAgdGFnID0gKHJ0YWdOYW1lLmV4ZWMoZWxlbSkgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHdyYXAgPSB3cmFwTWFwW3RhZ10gfHwgd3JhcE1hcC5fZGVmYXVsdDsKICAgICAgICAgICAgdG1wLmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtLnJlcGxhY2UocnhodG1sVGFnLCAiPCQxPjwvJDI+IikgKyB3cmFwWzJdOyAvLyBEZXNjZW5kIHRocm91Z2ggd3JhcHBlcnMgdG8gdGhlIHJpZ2h0IGNvbnRlbnQKCiAgICAgICAgICAgIGogPSB3cmFwWzBdOwoKICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgIHRtcCA9IHRtcC5sYXN0Q2hpbGQ7CiAgICAgICAgICAgIH0gLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgoKICAgICAgICAgICAgaWYgKCFqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSAmJiBybGVhZGluZ1doaXRlc3BhY2UudGVzdChlbGVtKSkgewogICAgICAgICAgICAgIG5vZGVzLnB1c2goY29udGV4dC5jcmVhdGVUZXh0Tm9kZShybGVhZGluZ1doaXRlc3BhY2UuZXhlYyhlbGVtKVswXSkpOwogICAgICAgICAgICB9IC8vIFJlbW92ZSBJRSdzIGF1dG9pbnNlcnRlZCA8dGJvZHk+IGZyb20gdGFibGUgZnJhZ21lbnRzCgoKICAgICAgICAgICAgaWYgKCFqUXVlcnkuc3VwcG9ydC50Ym9keSkgewogICAgICAgICAgICAgIC8vIFN0cmluZyB3YXMgYSA8dGFibGU+LCAqbWF5KiBoYXZlIHNwdXJpb3VzIDx0Ym9keT4KICAgICAgICAgICAgICBlbGVtID0gdGFnID09PSAidGFibGUiICYmICFydGJvZHkudGVzdChlbGVtKSA/IHRtcC5maXJzdENoaWxkIDogLy8gU3RyaW5nIHdhcyBhIGJhcmUgPHRoZWFkPiBvciA8dGZvb3Q+CiAgICAgICAgICAgICAgd3JhcFsxXSA9PT0gIjx0YWJsZT4iICYmICFydGJvZHkudGVzdChlbGVtKSA/IHRtcCA6IDA7CiAgICAgICAgICAgICAgaiA9IGVsZW0gJiYgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsKCiAgICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgICAgaWYgKGpRdWVyeS5ub2RlTmFtZSh0Ym9keSA9IGVsZW0uY2hpbGROb2Rlc1tqXSwgInRib2R5IikgJiYgIXRib2R5LmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQ2hpbGQodGJvZHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgalF1ZXJ5Lm1lcmdlKG5vZGVzLCB0bXAuY2hpbGROb2Rlcyk7IC8vIEZpeCAjMTIzOTIgZm9yIFdlYktpdCBhbmQgSUUgPiA5CgogICAgICAgICAgICB0bXAudGV4dENvbnRlbnQgPSAiIjsgLy8gRml4ICMxMjM5MiBmb3Igb2xkSUUKCiAgICAgICAgICAgIHdoaWxlICh0bXAuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgIHRtcC5yZW1vdmVDaGlsZCh0bXAuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgIH0gLy8gUmVtZW1iZXIgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgZm9yIHByb3BlciBjbGVhbnVwCgoKICAgICAgICAgICAgdG1wID0gc2FmZS5sYXN0Q2hpbGQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIEZpeCAjMTEzNTY6IENsZWFyIGVsZW1lbnRzIGZyb20gZnJhZ21lbnQKCgogICAgICBpZiAodG1wKSB7CiAgICAgICAgc2FmZS5yZW1vdmVDaGlsZCh0bXApOwogICAgICB9IC8vIFJlc2V0IGRlZmF1bHRDaGVja2VkIGZvciBhbnkgcmFkaW9zIGFuZCBjaGVja2JveGVzCiAgICAgIC8vIGFib3V0IHRvIGJlIGFwcGVuZGVkIHRvIHRoZSBET00gaW4gSUUgNi83ICgjODA2MCkKCgogICAgICBpZiAoIWpRdWVyeS5zdXBwb3J0LmFwcGVuZENoZWNrZWQpIHsKICAgICAgICBqUXVlcnkuZ3JlcChnZXRBbGwobm9kZXMsICJpbnB1dCIpLCBmaXhEZWZhdWx0Q2hlY2tlZCk7CiAgICAgIH0KCiAgICAgIGkgPSAwOwoKICAgICAgd2hpbGUgKGVsZW0gPSBub2Rlc1tpKytdKSB7CiAgICAgICAgLy8gIzQwODcgLSBJZiBvcmlnaW4gYW5kIGRlc3RpbmF0aW9uIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgYW5kIHRoaXMgaXMKICAgICAgICAvLyB0aGF0IGVsZW1lbnQsIGRvIG5vdCBkbyBhbnl0aGluZwogICAgICAgIGlmIChzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoZWxlbSwgc2VsZWN0aW9uKSAhPT0gLTEpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgY29udGFpbnMgPSBqUXVlcnkuY29udGFpbnMoZWxlbS5vd25lckRvY3VtZW50LCBlbGVtKTsgLy8gQXBwZW5kIHRvIGZyYWdtZW50CgogICAgICAgIHRtcCA9IGdldEFsbChzYWZlLmFwcGVuZENoaWxkKGVsZW0pLCAic2NyaXB0Iik7IC8vIFByZXNlcnZlIHNjcmlwdCBldmFsdWF0aW9uIGhpc3RvcnkKCiAgICAgICAgaWYgKGNvbnRhaW5zKSB7CiAgICAgICAgICBzZXRHbG9iYWxFdmFsKHRtcCk7CiAgICAgICAgfSAvLyBDYXB0dXJlIGV4ZWN1dGFibGVzCgoKICAgICAgICBpZiAoc2NyaXB0cykgewogICAgICAgICAgaiA9IDA7CgogICAgICAgICAgd2hpbGUgKGVsZW0gPSB0bXBbaisrXSkgewogICAgICAgICAgICBpZiAocnNjcmlwdFR5cGUudGVzdChlbGVtLnR5cGUgfHwgIiIpKSB7CiAgICAgICAgICAgICAgc2NyaXB0cy5wdXNoKGVsZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0bXAgPSBudWxsOwogICAgICByZXR1cm4gc2FmZTsKICAgIH0sCiAgICBjbGVhbkRhdGE6IGZ1bmN0aW9uIGNsZWFuRGF0YShlbGVtcywKICAgIC8qIGludGVybmFsICovCiAgICBhY2NlcHREYXRhKSB7CiAgICAgIHZhciBlbGVtLAogICAgICAgICAgdHlwZSwKICAgICAgICAgIGlkLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKICAgICAgICAgIGNhY2hlID0galF1ZXJ5LmNhY2hlLAogICAgICAgICAgZGVsZXRlRXhwYW5kbyA9IGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sCiAgICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWw7CgogICAgICBmb3IgKDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrKSB7CiAgICAgICAgaWYgKGFjY2VwdERhdGEgfHwgalF1ZXJ5LmFjY2VwdERhdGEoZWxlbSkpIHsKICAgICAgICAgIGlkID0gZWxlbVtpbnRlcm5hbEtleV07CiAgICAgICAgICBkYXRhID0gaWQgJiYgY2FjaGVbaWRdOwoKICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgIGlmIChkYXRhLmV2ZW50cykgewogICAgICAgICAgICAgIGZvciAodHlwZSBpbiBkYXRhLmV2ZW50cykgewogICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxbdHlwZV0pIHsKICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnJlbW92ZShlbGVtLCB0eXBlKTsgLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgalF1ZXJ5LnJlbW92ZUV2ZW50KGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gUmVtb3ZlIGNhY2hlIG9ubHkgaWYgaXQgd2FzIG5vdCBhbHJlYWR5IHJlbW92ZWQgYnkgalF1ZXJ5LmV2ZW50LnJlbW92ZQoKCiAgICAgICAgICAgIGlmIChjYWNoZVtpZF0pIHsKICAgICAgICAgICAgICBkZWxldGUgY2FjaGVbaWRdOyAvLyBJRSBkb2VzIG5vdCBhbGxvdyB1cyB0byBkZWxldGUgZXhwYW5kbyBwcm9wZXJ0aWVzIGZyb20gbm9kZXMsCiAgICAgICAgICAgICAgLy8gbm9yIGRvZXMgaXQgaGF2ZSBhIHJlbW92ZUF0dHJpYnV0ZSBmdW5jdGlvbiBvbiBEb2N1bWVudCBub2RlczsKICAgICAgICAgICAgICAvLyB3ZSBtdXN0IGhhbmRsZSBhbGwgb2YgdGhlc2UgY2FzZXMKCiAgICAgICAgICAgICAgaWYgKGRlbGV0ZUV4cGFuZG8pIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBlbGVtW2ludGVybmFsS2V5XTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKF90eXBlb2YoZWxlbS5yZW1vdmVBdHRyaWJ1dGUpICE9PSBjb3JlX3N0cnVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoaW50ZXJuYWxLZXkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbGVtW2ludGVybmFsS2V5XSA9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb3JlX2RlbGV0ZWRJZHMucHVzaChpZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKICB2YXIgaWZyYW1lLAogICAgICBnZXRTdHlsZXMsCiAgICAgIGN1ckNTUywKICAgICAgcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCiAgICAgIHJvcGFjaXR5ID0gL29wYWNpdHlccyo9XHMqKFteKV0qKS8sCiAgICAgIHJwb3NpdGlvbiA9IC9eKHRvcHxyaWdodHxib3R0b218bGVmdCkkLywKICAgICAgLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQgInRhYmxlIiwgInRhYmxlLWNlbGwiLCBvciAidGFibGUtY2FwdGlvbiIKICAvLyBzZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKICByZGlzcGxheXN3YXAgPSAvXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sCiAgICAgIHJtYXJnaW4gPSAvXm1hcmdpbi8sCiAgICAgIHJudW1zcGxpdCA9IG5ldyBSZWdFeHAoIl4oIiArIGNvcmVfcG51bSArICIpKC4qKSQiLCAiaSIpLAogICAgICBybnVtbm9ucHggPSBuZXcgUmVnRXhwKCJeKCIgKyBjb3JlX3BudW0gKyAiKSg/IXB4KVthLXolXSskIiwgImkiKSwKICAgICAgcnJlbE51bSA9IG5ldyBSZWdFeHAoIl4oWystXSk9KCIgKyBjb3JlX3BudW0gKyAiKSIsICJpIiksCiAgICAgIGVsZW1kaXNwbGF5ID0gewogICAgQk9EWTogImJsb2NrIgogIH0sCiAgICAgIGNzc1Nob3cgPSB7CiAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgIHZpc2liaWxpdHk6ICJoaWRkZW4iLAogICAgZGlzcGxheTogImJsb2NrIgogIH0sCiAgICAgIGNzc05vcm1hbFRyYW5zZm9ybSA9IHsKICAgIGxldHRlclNwYWNpbmc6IDAsCiAgICBmb250V2VpZ2h0OiA0MDAKICB9LAogICAgICBjc3NFeHBhbmQgPSBbIlRvcCIsICJSaWdodCIsICJCb3R0b20iLCAiTGVmdCJdLAogICAgICBjc3NQcmVmaXhlcyA9IFsiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIl07IC8vIHJldHVybiBhIGNzcyBwcm9wZXJ0eSBtYXBwZWQgdG8gYSBwb3RlbnRpYWxseSB2ZW5kb3IgcHJlZml4ZWQgcHJvcGVydHkKCiAgZnVuY3Rpb24gdmVuZG9yUHJvcE5hbWUoc3R5bGUsIG5hbWUpIHsKICAgIC8vIHNob3J0Y3V0IGZvciBuYW1lcyB0aGF0IGFyZSBub3QgdmVuZG9yIHByZWZpeGVkCiAgICBpZiAobmFtZSBpbiBzdHlsZSkgewogICAgICByZXR1cm4gbmFtZTsKICAgIH0gLy8gY2hlY2sgZm9yIHZlbmRvciBwcmVmaXhlZCBuYW1lcwoKCiAgICB2YXIgY2FwTmFtZSA9IG5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpLAogICAgICAgIG9yaWdOYW1lID0gbmFtZSwKICAgICAgICBpID0gY3NzUHJlZml4ZXMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgbmFtZSA9IGNzc1ByZWZpeGVzW2ldICsgY2FwTmFtZTsKCiAgICAgIGlmIChuYW1lIGluIHN0eWxlKSB7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb3JpZ05hbWU7CiAgfQoKICBmdW5jdGlvbiBpc0hpZGRlbihlbGVtLCBlbCkgewogICAgLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKICAgIC8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAogICAgZWxlbSA9IGVsIHx8IGVsZW07CiAgICByZXR1cm4galF1ZXJ5LmNzcyhlbGVtLCAiZGlzcGxheSIpID09PSAibm9uZSIgfHwgIWpRdWVyeS5jb250YWlucyhlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0pOwogIH0KCiAgZnVuY3Rpb24gc2hvd0hpZGUoZWxlbWVudHMsIHNob3cpIHsKICAgIHZhciBkaXNwbGF5LAogICAgICAgIGVsZW0sCiAgICAgICAgaGlkZGVuLAogICAgICAgIHZhbHVlcyA9IFtdLAogICAgICAgIGluZGV4ID0gMCwKICAgICAgICBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7CgogICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIGVsZW0gPSBlbGVtZW50c1tpbmRleF07CgogICAgICBpZiAoIWVsZW0uc3R5bGUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgdmFsdWVzW2luZGV4XSA9IGpRdWVyeS5fZGF0YShlbGVtLCAib2xkZGlzcGxheSIpOwogICAgICBkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICAvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCiAgICAgICAgLy8gYmVpbmcgaGlkZGVuIGJ5IGNhc2NhZGVkIHJ1bGVzIG9yIG5vdAogICAgICAgIGlmICghdmFsdWVzW2luZGV4XSAmJiBkaXNwbGF5ID09PSAibm9uZSIpIHsKICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgIH0gLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQogICAgICAgIC8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCiAgICAgICAgLy8gZm9yIHN1Y2ggYW4gZWxlbWVudAoKCiAgICAgICAgaWYgKGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgJiYgaXNIaWRkZW4oZWxlbSkpIHsKICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSBqUXVlcnkuX2RhdGEoZWxlbSwgIm9sZGRpc3BsYXkiLCBjc3NfZGVmYXVsdERpc3BsYXkoZWxlbS5ub2RlTmFtZSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXZhbHVlc1tpbmRleF0pIHsKICAgICAgICAgIGhpZGRlbiA9IGlzSGlkZGVuKGVsZW0pOwoKICAgICAgICAgIGlmIChkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICJub25lIiB8fCAhaGlkZGVuKSB7CiAgICAgICAgICAgIGpRdWVyeS5fZGF0YShlbGVtLCAib2xkZGlzcGxheSIsIGhpZGRlbiA/IGRpc3BsYXkgOiBqUXVlcnkuY3NzKGVsZW0sICJkaXNwbGF5IikpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBTZXQgdGhlIGRpc3BsYXkgb2YgbW9zdCBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAogICAgLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoKCiAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHsKICAgICAgZWxlbSA9IGVsZW1lbnRzW2luZGV4XTsKCiAgICAgIGlmICghZWxlbS5zdHlsZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZiAoIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIikgewogICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbaW5kZXhdIHx8ICIiIDogIm5vbmUiOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGVsZW1lbnRzOwogIH0KCiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBjc3M6IGZ1bmN0aW9uIGNzcyhuYW1lLCB2YWx1ZSkgewogICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAoZWxlbSwgbmFtZSwgdmFsdWUpIHsKICAgICAgICB2YXIgbGVuLAogICAgICAgICAgICBzdHlsZXMsCiAgICAgICAgICAgIG1hcCA9IHt9LAogICAgICAgICAgICBpID0gMDsKCiAgICAgICAgaWYgKGpRdWVyeS5pc0FycmF5KG5hbWUpKSB7CiAgICAgICAgICBzdHlsZXMgPSBnZXRTdHlsZXMoZWxlbSk7CiAgICAgICAgICBsZW4gPSBuYW1lLmxlbmd0aDsKCiAgICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIG1hcFtuYW1lW2ldXSA9IGpRdWVyeS5jc3MoZWxlbSwgbmFtZVtpXSwgZmFsc2UsIHN0eWxlcyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8galF1ZXJ5LnN0eWxlKGVsZW0sIG5hbWUsIHZhbHVlKSA6IGpRdWVyeS5jc3MoZWxlbSwgbmFtZSk7CiAgICAgIH0sIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSk7CiAgICB9LAogICAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHsKICAgICAgcmV0dXJuIHNob3dIaWRlKHRoaXMsIHRydWUpOwogICAgfSwKICAgIGhpZGU6IGZ1bmN0aW9uIGhpZGUoKSB7CiAgICAgIHJldHVybiBzaG93SGlkZSh0aGlzKTsKICAgIH0sCiAgICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZShzdGF0ZSkgewogICAgICB2YXIgYm9vbCA9IHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iOwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoYm9vbCA/IHN0YXRlIDogaXNIaWRkZW4odGhpcykpIHsKICAgICAgICAgIGpRdWVyeSh0aGlzKS5zaG93KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGpRdWVyeSh0aGlzKS5oaWRlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKICBqUXVlcnkuZXh0ZW5kKHsKICAgIC8vIEFkZCBpbiBzdHlsZSBwcm9wZXJ0eSBob29rcyBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdAogICAgLy8gYmVoYXZpb3Igb2YgZ2V0dGluZyBhbmQgc2V0dGluZyBhIHN0eWxlIHByb3BlcnR5CiAgICBjc3NIb29rczogewogICAgICBvcGFjaXR5OiB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSwgY29tcHV0ZWQpIHsKICAgICAgICAgIGlmIChjb21wdXRlZCkgewogICAgICAgICAgICAvLyBXZSBzaG91bGQgYWx3YXlzIGdldCBhIG51bWJlciBiYWNrIGZyb20gb3BhY2l0eQogICAgICAgICAgICB2YXIgcmV0ID0gY3VyQ1NTKGVsZW0sICJvcGFjaXR5Iik7CiAgICAgICAgICAgIHJldHVybiByZXQgPT09ICIiID8gIjEiIDogcmV0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIEV4Y2x1ZGUgdGhlIGZvbGxvd2luZyBjc3MgcHJvcGVydGllcyB0byBhZGQgcHgKICAgIGNzc051bWJlcjogewogICAgICAiY29sdW1uQ291bnQiOiB0cnVlLAogICAgICAiZmlsbE9wYWNpdHkiOiB0cnVlLAogICAgICAiZm9udFdlaWdodCI6IHRydWUsCiAgICAgICJsaW5lSGVpZ2h0IjogdHJ1ZSwKICAgICAgIm9wYWNpdHkiOiB0cnVlLAogICAgICAib3JwaGFucyI6IHRydWUsCiAgICAgICJ3aWRvd3MiOiB0cnVlLAogICAgICAiekluZGV4IjogdHJ1ZSwKICAgICAgInpvb20iOiB0cnVlCiAgICB9LAogICAgLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQogICAgLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQogICAgY3NzUHJvcHM6IHsKICAgICAgLy8gbm9ybWFsaXplIGZsb2F0IGNzcyBwcm9wZXJ0eQogICAgICAiZmxvYXQiOiBqUXVlcnkuc3VwcG9ydC5jc3NGbG9hdCA/ICJjc3NGbG9hdCIgOiAic3R5bGVGbG9hdCIKICAgIH0sCiAgICAvLyBHZXQgYW5kIHNldCB0aGUgc3R5bGUgcHJvcGVydHkgb24gYSBET00gTm9kZQogICAgc3R5bGU6IGZ1bmN0aW9uIHN0eWxlKGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSkgewogICAgICAvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKICAgICAgaWYgKCFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBNYWtlIHN1cmUgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggdGhlIHJpZ2h0IG5hbWUKCgogICAgICB2YXIgcmV0LAogICAgICAgICAgdHlwZSwKICAgICAgICAgIGhvb2tzLAogICAgICAgICAgb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKG5hbWUpLAogICAgICAgICAgc3R5bGUgPSBlbGVtLnN0eWxlOwogICAgICBuYW1lID0galF1ZXJ5LmNzc1Byb3BzW29yaWdOYW1lXSB8fCAoalF1ZXJ5LmNzc1Byb3BzW29yaWdOYW1lXSA9IHZlbmRvclByb3BOYW1lKHN0eWxlLCBvcmlnTmFtZSkpOyAvLyBnZXRzIGhvb2sgZm9yIHRoZSBwcmVmaXhlZCB2ZXJzaW9uCiAgICAgIC8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCiAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzW25hbWVdIHx8IGpRdWVyeS5jc3NIb29rc1tvcmlnTmFtZV07IC8vIENoZWNrIGlmIHdlJ3JlIHNldHRpbmcgYSB2YWx1ZQoKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0eXBlID0gX3R5cGVvZih2YWx1ZSk7IC8vIGNvbnZlcnQgcmVsYXRpdmUgbnVtYmVyIHN0cmluZ3MgKCs9IG9yIC09KSB0byByZWxhdGl2ZSBudW1iZXJzLiAjNzM0NQoKICAgICAgICBpZiAodHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyh2YWx1ZSkpKSB7CiAgICAgICAgICB2YWx1ZSA9IChyZXRbMV0gKyAxKSAqIHJldFsyXSArIHBhcnNlRmxvYXQoalF1ZXJ5LmNzcyhlbGVtLCBuYW1lKSk7IC8vIEZpeGVzIGJ1ZyAjOTIzNwoKICAgICAgICAgIHR5cGUgPSAibnVtYmVyIjsKICAgICAgICB9IC8vIE1ha2Ugc3VyZSB0aGF0IE5hTiBhbmQgbnVsbCB2YWx1ZXMgYXJlbid0IHNldC4gU2VlOiAjNzExNgoKCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdHlwZSA9PT0gIm51bWJlciIgJiYgaXNOYU4odmFsdWUpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBJZiBhIG51bWJlciB3YXMgcGFzc2VkIGluLCBhZGQgJ3B4JyB0byB0aGUgKGV4Y2VwdCBmb3IgY2VydGFpbiBDU1MgcHJvcGVydGllcykKCgogICAgICAgIGlmICh0eXBlID09PSAibnVtYmVyIiAmJiAhalF1ZXJ5LmNzc051bWJlcltvcmlnTmFtZV0pIHsKICAgICAgICAgIHZhbHVlICs9ICJweCI7CiAgICAgICAgfSAvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCiAgICAgICAgLy8gYnV0IGl0IHdvdWxkIG1lYW4gdG8gZGVmaW5lIGVpZ2h0IChmb3IgZXZlcnkgcHJvYmxlbWF0aWMgcHJvcGVydHkpIGlkZW50aWNhbCBmdW5jdGlvbnMKCgogICAgICAgIGlmICghalF1ZXJ5LnN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoImJhY2tncm91bmQiKSA9PT0gMCkgewogICAgICAgICAgc3R5bGVbbmFtZV0gPSAiaW5oZXJpdCI7CiAgICAgICAgfSAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCgogICAgICAgIGlmICghaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KGVsZW0sIHZhbHVlLCBleHRyYSkpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIFdyYXBwZWQgdG8gcHJldmVudCBJRSBmcm9tIHRocm93aW5nIGVycm9ycyB3aGVuICdpbnZhbGlkJyB2YWx1ZXMgYXJlIHByb3ZpZGVkCiAgICAgICAgICAvLyBGaXhlcyBidWcgIzU1MDkKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0eWxlW25hbWVdID0gdmFsdWU7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgbm9uLWNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKICAgICAgICBpZiAoaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldChlbGVtLCBmYWxzZSwgZXh0cmEpKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gLy8gT3RoZXJ3aXNlIGp1c3QgZ2V0IHRoZSB2YWx1ZSBmcm9tIHRoZSBzdHlsZSBvYmplY3QKCgogICAgICAgIHJldHVybiBzdHlsZVtuYW1lXTsKICAgICAgfQogICAgfSwKICAgIGNzczogZnVuY3Rpb24gY3NzKGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMpIHsKICAgICAgdmFyIG51bSwKICAgICAgICAgIHZhbCwKICAgICAgICAgIGhvb2tzLAogICAgICAgICAgb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKG5hbWUpOyAvLyBNYWtlIHN1cmUgdGhhdCB3ZSdyZSB3b3JraW5nIHdpdGggdGhlIHJpZ2h0IG5hbWUKCiAgICAgIG5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbb3JpZ05hbWVdIHx8IChqUXVlcnkuY3NzUHJvcHNbb3JpZ05hbWVdID0gdmVuZG9yUHJvcE5hbWUoZWxlbS5zdHlsZSwgb3JpZ05hbWUpKTsgLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgogICAgICAvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uCgogICAgICBob29rcyA9IGpRdWVyeS5jc3NIb29rc1tuYW1lXSB8fCBqUXVlcnkuY3NzSG9va3Nbb3JpZ05hbWVdOyAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZQoKICAgICAgaWYgKGhvb2tzICYmICJnZXQiIGluIGhvb2tzKSB7CiAgICAgICAgdmFsID0gaG9va3MuZ2V0KGVsZW0sIHRydWUsIGV4dHJhKTsKICAgICAgfSAvLyBPdGhlcndpc2UsIGlmIGEgd2F5IHRvIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZXhpc3RzLCB1c2UgdGhhdAoKCiAgICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbCA9IGN1ckNTUyhlbGVtLCBuYW1lLCBzdHlsZXMpOwogICAgICB9IC8vY29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQoKCiAgICAgIGlmICh2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtKSB7CiAgICAgICAgdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtW25hbWVdOwogICAgICB9IC8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCgogICAgICBpZiAoZXh0cmEgPT09ICIiIHx8IGV4dHJhKSB7CiAgICAgICAgbnVtID0gcGFyc2VGbG9hdCh2YWwpOwogICAgICAgIHJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKG51bSkgPyBudW0gfHwgMCA6IHZhbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbDsKICAgIH0sCiAgICAvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCiAgICBzd2FwOiBmdW5jdGlvbiBzd2FwKGVsZW0sIG9wdGlvbnMsIGNhbGxiYWNrLCBhcmdzKSB7CiAgICAgIHZhciByZXQsCiAgICAgICAgICBuYW1lLAogICAgICAgICAgb2xkID0ge307IC8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcwoKICAgICAgZm9yIChuYW1lIGluIG9wdGlvbnMpIHsKICAgICAgICBvbGRbbmFtZV0gPSBlbGVtLnN0eWxlW25hbWVdOwogICAgICAgIGVsZW0uc3R5bGVbbmFtZV0gPSBvcHRpb25zW25hbWVdOwogICAgICB9CgogICAgICByZXQgPSBjYWxsYmFjay5hcHBseShlbGVtLCBhcmdzIHx8IFtdKTsgLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzCgogICAgICBmb3IgKG5hbWUgaW4gb3B0aW9ucykgewogICAgICAgIGVsZW0uc3R5bGVbbmFtZV0gPSBvbGRbbmFtZV07CiAgICAgIH0KCiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgfSk7IC8vIE5PVEU6IHdlJ3ZlIGluY2x1ZGVkIHRoZSAid2luZG93IiBpbiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQogIC8vIGJlY2F1c2UganNkb20gb24gbm9kZS5qcyB3aWxsIGJyZWFrIHdpdGhvdXQgaXQuCgogIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkgewogICAgZ2V0U3R5bGVzID0gZnVuY3Rpb24gZ2V0U3R5bGVzKGVsZW0pIHsKICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW0sIG51bGwpOwogICAgfTsKCiAgICBjdXJDU1MgPSBmdW5jdGlvbiBjdXJDU1MoZWxlbSwgbmFtZSwgX2NvbXB1dGVkKSB7CiAgICAgIHZhciB3aWR0aCwKICAgICAgICAgIG1pbldpZHRoLAogICAgICAgICAgbWF4V2lkdGgsCiAgICAgICAgICBjb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoZWxlbSksCiAgICAgICAgICAvLyBnZXRQcm9wZXJ0eVZhbHVlIGlzIG9ubHkgbmVlZGVkIGZvciAuY3NzKCdmaWx0ZXInKSBpbiBJRTksIHNlZSAjMTI1MzcKICAgICAgcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZC5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpIHx8IGNvbXB1dGVkW25hbWVdIDogdW5kZWZpbmVkLAogICAgICAgICAgc3R5bGUgPSBlbGVtLnN0eWxlOwoKICAgICAgaWYgKGNvbXB1dGVkKSB7CiAgICAgICAgaWYgKHJldCA9PT0gIiIgJiYgIWpRdWVyeS5jb250YWlucyhlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0pKSB7CiAgICAgICAgICByZXQgPSBqUXVlcnkuc3R5bGUoZWxlbSwgbmFtZSk7CiAgICAgICAgfSAvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgogICAgICAgIC8vIENocm9tZSA8IDE3IGFuZCBTYWZhcmkgNS4wIHVzZXMgImNvbXB1dGVkIHZhbHVlIiBpbnN0ZWFkIG9mICJ1c2VkIHZhbHVlIiBmb3IgbWFyZ2luLXJpZ2h0CiAgICAgICAgLy8gU2FmYXJpIDUuMS43IChhdCBsZWFzdCkgcmV0dXJucyBwZXJjZW50YWdlIGZvciBhIGxhcmdlciBzZXQgb2YgdmFsdWVzLCBidXQgd2lkdGggc2VlbXMgdG8gYmUgcmVsaWFibHkgcGl4ZWxzCiAgICAgICAgLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOiBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgoKICAgICAgICBpZiAocm51bW5vbnB4LnRlc3QocmV0KSAmJiBybWFyZ2luLnRlc3QobmFtZSkpIHsKICAgICAgICAgIC8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKICAgICAgICAgIHdpZHRoID0gc3R5bGUud2lkdGg7CiAgICAgICAgICBtaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwogICAgICAgICAgbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsgLy8gUHV0IGluIHRoZSBuZXcgdmFsdWVzIHRvIGdldCBhIGNvbXB1dGVkIHZhbHVlIG91dAoKICAgICAgICAgIHN0eWxlLm1pbldpZHRoID0gc3R5bGUubWF4V2lkdGggPSBzdHlsZS53aWR0aCA9IHJldDsKICAgICAgICAgIHJldCA9IGNvbXB1dGVkLndpZHRoOyAvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgogICAgICAgICAgc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgICAgIHN0eWxlLm1pbldpZHRoID0gbWluV2lkdGg7CiAgICAgICAgICBzdHlsZS5tYXhXaWR0aCA9IG1heFdpZHRoOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJldDsKICAgIH07CiAgfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlKSB7CiAgICBnZXRTdHlsZXMgPSBmdW5jdGlvbiBnZXRTdHlsZXMoZWxlbSkgewogICAgICByZXR1cm4gZWxlbS5jdXJyZW50U3R5bGU7CiAgICB9OwoKICAgIGN1ckNTUyA9IGZ1bmN0aW9uIGN1ckNTUyhlbGVtLCBuYW1lLCBfY29tcHV0ZWQpIHsKICAgICAgdmFyIGxlZnQsCiAgICAgICAgICBycywKICAgICAgICAgIHJzTGVmdCwKICAgICAgICAgIGNvbXB1dGVkID0gX2NvbXB1dGVkIHx8IGdldFN0eWxlcyhlbGVtKSwKICAgICAgICAgIHJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWRbbmFtZV0gOiB1bmRlZmluZWQsCiAgICAgICAgICBzdHlsZSA9IGVsZW0uc3R5bGU7IC8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCiAgICAgIC8vIHNvIHdlIGRvbid0IGRlZmF1bHQgdG8gYXV0bwoKCiAgICAgIGlmIChyZXQgPT0gbnVsbCAmJiBzdHlsZSAmJiBzdHlsZVtuYW1lXSkgewogICAgICAgIHJldCA9IHN0eWxlW25hbWVdOwogICAgICB9IC8vIEZyb20gdGhlIGF3ZXNvbWUgaGFjayBieSBEZWFuIEVkd2FyZHMKICAgICAgLy8gaHR0cDovL2VyaWsuZWFlLm5ldC9hcmNoaXZlcy8yMDA3LzA3LzI3LzE4LjU0LjE1LyNjb21tZW50LTEwMjI5MQogICAgICAvLyBJZiB3ZSdyZSBub3QgZGVhbGluZyB3aXRoIGEgcmVndWxhciBwaXhlbCBudW1iZXIKICAgICAgLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCiAgICAgIC8vIGJ1dCBub3QgcG9zaXRpb24gY3NzIGF0dHJpYnV0ZXMsIGFzIHRob3NlIGFyZSBwcm9wb3J0aW9uYWwgdG8gdGhlIHBhcmVudCBlbGVtZW50IGluc3RlYWQKICAgICAgLy8gYW5kIHdlIGNhbid0IG1lYXN1cmUgdGhlIHBhcmVudCBpbnN0ZWFkIGJlY2F1c2UgaXQgbWlnaHQgdHJpZ2dlciBhICJzdGFja2luZyBkb2xscyIgcHJvYmxlbQoKCiAgICAgIGlmIChybnVtbm9ucHgudGVzdChyZXQpICYmICFycG9zaXRpb24udGVzdChuYW1lKSkgewogICAgICAgIC8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKICAgICAgICBsZWZ0ID0gc3R5bGUubGVmdDsKICAgICAgICBycyA9IGVsZW0ucnVudGltZVN0eWxlOwogICAgICAgIHJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7IC8vIFB1dCBpbiB0aGUgbmV3IHZhbHVlcyB0byBnZXQgYSBjb21wdXRlZCB2YWx1ZSBvdXQKCiAgICAgICAgaWYgKHJzTGVmdCkgewogICAgICAgICAgcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CiAgICAgICAgfQoKICAgICAgICBzdHlsZS5sZWZ0ID0gbmFtZSA9PT0gImZvbnRTaXplIiA/ICIxZW0iIDogcmV0OwogICAgICAgIHJldCA9IHN0eWxlLnBpeGVsTGVmdCArICJweCI7IC8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCiAgICAgICAgc3R5bGUubGVmdCA9IGxlZnQ7CgogICAgICAgIGlmIChyc0xlZnQpIHsKICAgICAgICAgIHJzLmxlZnQgPSByc0xlZnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmV0ID09PSAiIiA/ICJhdXRvIiA6IHJldDsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlcihlbGVtLCB2YWx1ZSwgc3VidHJhY3QpIHsKICAgIHZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWModmFsdWUpOwogICAgcmV0dXJuIG1hdGNoZXMgPyAvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKICAgIE1hdGgubWF4KDAsIG1hdGNoZXNbMV0gLSAoc3VidHJhY3QgfHwgMCkpICsgKG1hdGNoZXNbMl0gfHwgInB4IikgOiB2YWx1ZTsKICB9CgogIGZ1bmN0aW9uIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KGVsZW0sIG5hbWUsIGV4dHJhLCBpc0JvcmRlckJveCwgc3R5bGVzKSB7CiAgICB2YXIgaSA9IGV4dHJhID09PSAoaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IikgPyAvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KICAgIDQgOiAvLyBPdGhlcndpc2UgaW5pdGlhbGl6ZSBmb3IgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBwcm9wZXJ0aWVzCiAgICBuYW1lID09PSAid2lkdGgiID8gMSA6IDAsCiAgICAgICAgdmFsID0gMDsKCiAgICBmb3IgKDsgaSA8IDQ7IGkgKz0gMikgewogICAgICAvLyBib3RoIGJveCBtb2RlbHMgZXhjbHVkZSBtYXJnaW4sIHNvIGFkZCBpdCBpZiB3ZSB3YW50IGl0CiAgICAgIGlmIChleHRyYSA9PT0gIm1hcmdpbiIpIHsKICAgICAgICB2YWwgKz0galF1ZXJ5LmNzcyhlbGVtLCBleHRyYSArIGNzc0V4cGFuZFtpXSwgdHJ1ZSwgc3R5bGVzKTsKICAgICAgfQoKICAgICAgaWYgKGlzQm9yZGVyQm94KSB7CiAgICAgICAgLy8gYm9yZGVyLWJveCBpbmNsdWRlcyBwYWRkaW5nLCBzbyByZW1vdmUgaXQgaWYgd2Ugd2FudCBjb250ZW50CiAgICAgICAgaWYgKGV4dHJhID09PSAiY29udGVudCIpIHsKICAgICAgICAgIHZhbCAtPSBqUXVlcnkuY3NzKGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFtpXSwgdHJ1ZSwgc3R5bGVzKTsKICAgICAgICB9IC8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGJvcmRlciBub3IgbWFyZ2luLCBzbyByZW1vdmUgYm9yZGVyCgoKICAgICAgICBpZiAoZXh0cmEgIT09ICJtYXJnaW4iKSB7CiAgICAgICAgICB2YWwgLT0galF1ZXJ5LmNzcyhlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFtpXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQsIHNvIGFkZCBwYWRkaW5nCiAgICAgICAgdmFsICs9IGpRdWVyeS5jc3MoZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kW2ldLCB0cnVlLCBzdHlsZXMpOyAvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBjb250ZW50IG5vciBwYWRkaW5nLCBzbyBhZGQgYm9yZGVyCgogICAgICAgIGlmIChleHRyYSAhPT0gInBhZGRpbmciKSB7CiAgICAgICAgICB2YWwgKz0galF1ZXJ5LmNzcyhlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFtpXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHZhbDsKICB9CgogIGZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoZWxlbSwgbmFtZSwgZXh0cmEpIHsKICAgIC8vIFN0YXJ0IHdpdGggb2Zmc2V0IHByb3BlcnR5LCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBib3JkZXItYm94IHZhbHVlCiAgICB2YXIgdmFsdWVJc0JvcmRlckJveCA9IHRydWUsCiAgICAgICAgdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKICAgICAgICBzdHlsZXMgPSBnZXRTdHlsZXMoZWxlbSksCiAgICAgICAgaXNCb3JkZXJCb3ggPSBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyhlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcykgPT09ICJib3JkZXItYm94IjsgLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCiAgICAvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKICAgIC8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoKICAgIGlmICh2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCkgewogICAgICAvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKICAgICAgdmFsID0gY3VyQ1NTKGVsZW0sIG5hbWUsIHN0eWxlcyk7CgogICAgICBpZiAodmFsIDwgMCB8fCB2YWwgPT0gbnVsbCkgewogICAgICAgIHZhbCA9IGVsZW0uc3R5bGVbbmFtZV07CiAgICAgIH0gLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCgogICAgICBpZiAocm51bW5vbnB4LnRlc3QodmFsKSkgewogICAgICAgIHJldHVybiB2YWw7CiAgICAgIH0gLy8gd2UgbmVlZCB0aGUgY2hlY2sgZm9yIHN0eWxlIGluIGNhc2UgYSBicm93c2VyIHdoaWNoIHJldHVybnMgdW5yZWxpYWJsZSB2YWx1ZXMKICAgICAgLy8gZm9yIGdldENvbXB1dGVkU3R5bGUgc2lsZW50bHkgZmFsbHMgYmFjayB0byB0aGUgcmVsaWFibGUgZWxlbS5zdHlsZQoKCiAgICAgIHZhbHVlSXNCb3JkZXJCb3ggPSBpc0JvcmRlckJveCAmJiAoalF1ZXJ5LnN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgfHwgdmFsID09PSBlbGVtLnN0eWxlW25hbWVdKTsgLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmEKCiAgICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKSB8fCAwOwogICAgfSAvLyB1c2UgdGhlIGFjdGl2ZSBib3gtc2l6aW5nIG1vZGVsIHRvIGFkZC9zdWJ0cmFjdCBpcnJlbGV2YW50IHN0eWxlcwoKCiAgICByZXR1cm4gdmFsICsgYXVnbWVudFdpZHRoT3JIZWlnaHQoZWxlbSwgbmFtZSwgZXh0cmEgfHwgKGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIpLCB2YWx1ZUlzQm9yZGVyQm94LCBzdHlsZXMpICsgInB4IjsKICB9IC8vIFRyeSB0byBkZXRlcm1pbmUgdGhlIGRlZmF1bHQgZGlzcGxheSB2YWx1ZSBvZiBhbiBlbGVtZW50CgoKICBmdW5jdGlvbiBjc3NfZGVmYXVsdERpc3BsYXkobm9kZU5hbWUpIHsKICAgIHZhciBkb2MgPSBkb2N1bWVudCwKICAgICAgICBkaXNwbGF5ID0gZWxlbWRpc3BsYXlbbm9kZU5hbWVdOwoKICAgIGlmICghZGlzcGxheSkgewogICAgICBkaXNwbGF5ID0gYWN0dWFsRGlzcGxheShub2RlTmFtZSwgZG9jKTsgLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lCgogICAgICBpZiAoZGlzcGxheSA9PT0gIm5vbmUiIHx8ICFkaXNwbGF5KSB7CiAgICAgICAgLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCiAgICAgICAgaWZyYW1lID0gKGlmcmFtZSB8fCBqUXVlcnkoIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKS5jc3MoImNzc1RleHQiLCAiZGlzcGxheTpibG9jayAhaW1wb3J0YW50IikpLmFwcGVuZFRvKGRvYy5kb2N1bWVudEVsZW1lbnQpOyAvLyBBbHdheXMgd3JpdGUgYSBuZXcgSFRNTCBza2VsZXRvbiBzbyBXZWJraXQgYW5kIEZpcmVmb3ggZG9uJ3QgY2hva2Ugb24gcmV1c2UKCiAgICAgICAgZG9jID0gKGlmcmFtZVswXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQpLmRvY3VtZW50OwogICAgICAgIGRvYy53cml0ZSgiPCFkb2N0eXBlIGh0bWw+PGh0bWw+PGJvZHk+Iik7CiAgICAgICAgZG9jLmNsb3NlKCk7CiAgICAgICAgZGlzcGxheSA9IGFjdHVhbERpc3BsYXkobm9kZU5hbWUsIGRvYyk7CiAgICAgICAgaWZyYW1lLmRldGFjaCgpOwogICAgICB9IC8vIFN0b3JlIHRoZSBjb3JyZWN0IGRlZmF1bHQgZGlzcGxheQoKCiAgICAgIGVsZW1kaXNwbGF5W25vZGVOYW1lXSA9IGRpc3BsYXk7CiAgICB9CgogICAgcmV0dXJuIGRpc3BsYXk7CiAgfSAvLyBDYWxsZWQgT05MWSBmcm9tIHdpdGhpbiBjc3NfZGVmYXVsdERpc3BsYXkKCgogIGZ1bmN0aW9uIGFjdHVhbERpc3BsYXkobmFtZSwgZG9jKSB7CiAgICB2YXIgZWxlbSA9IGpRdWVyeShkb2MuY3JlYXRlRWxlbWVudChuYW1lKSkuYXBwZW5kVG8oZG9jLmJvZHkpLAogICAgICAgIGRpc3BsYXkgPSBqUXVlcnkuY3NzKGVsZW1bMF0sICJkaXNwbGF5Iik7CiAgICBlbGVtLnJlbW92ZSgpOwogICAgcmV0dXJuIGRpc3BsYXk7CiAgfQoKICBqUXVlcnkuZWFjaChbImhlaWdodCIsICJ3aWR0aCJdLCBmdW5jdGlvbiAoaSwgbmFtZSkgewogICAgalF1ZXJ5LmNzc0hvb2tzW25hbWVdID0gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtLCBjb21wdXRlZCwgZXh0cmEpIHsKICAgICAgICBpZiAoY29tcHV0ZWQpIHsKICAgICAgICAgIC8vIGNlcnRhaW4gZWxlbWVudHMgY2FuIGhhdmUgZGltZW5zaW9uIGluZm8gaWYgd2UgaW52aXNpYmx5IHNob3cgdGhlbQogICAgICAgICAgLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKICAgICAgICAgIHJldHVybiBlbGVtLm9mZnNldFdpZHRoID09PSAwICYmIHJkaXNwbGF5c3dhcC50ZXN0KGpRdWVyeS5jc3MoZWxlbSwgImRpc3BsYXkiKSkgPyBqUXVlcnkuc3dhcChlbGVtLCBjc3NTaG93LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRXaWR0aE9ySGVpZ2h0KGVsZW0sIG5hbWUsIGV4dHJhKTsKICAgICAgICAgIH0pIDogZ2V0V2lkdGhPckhlaWdodChlbGVtLCBuYW1lLCBleHRyYSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSwgZXh0cmEpIHsKICAgICAgICB2YXIgc3R5bGVzID0gZXh0cmEgJiYgZ2V0U3R5bGVzKGVsZW0pOwogICAgICAgIHJldHVybiBzZXRQb3NpdGl2ZU51bWJlcihlbGVtLCB2YWx1ZSwgZXh0cmEgPyBhdWdtZW50V2lkdGhPckhlaWdodChlbGVtLCBuYW1lLCBleHRyYSwgalF1ZXJ5LnN1cHBvcnQuYm94U2l6aW5nICYmIGpRdWVyeS5jc3MoZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMpID09PSAiYm9yZGVyLWJveCIsIHN0eWxlcykgOiAwKTsKICAgICAgfQogICAgfTsKICB9KTsKCiAgaWYgKCFqUXVlcnkuc3VwcG9ydC5vcGFjaXR5KSB7CiAgICBqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSwgY29tcHV0ZWQpIHsKICAgICAgICAvLyBJRSB1c2VzIGZpbHRlcnMgZm9yIG9wYWNpdHkKICAgICAgICByZXR1cm4gcm9wYWNpdHkudGVzdCgoY29tcHV0ZWQgJiYgZWxlbS5jdXJyZW50U3R5bGUgPyBlbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOiBlbGVtLnN0eWxlLmZpbHRlcikgfHwgIiIpID8gMC4wMSAqIHBhcnNlRmxvYXQoUmVnRXhwLiQxKSArICIiIDogY29tcHV0ZWQgPyAiMSIgOiAiIjsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZWxlbSwgdmFsdWUpIHsKICAgICAgICB2YXIgc3R5bGUgPSBlbGVtLnN0eWxlLAogICAgICAgICAgICBjdXJyZW50U3R5bGUgPSBlbGVtLmN1cnJlbnRTdHlsZSwKICAgICAgICAgICAgb3BhY2l0eSA9IGpRdWVyeS5pc051bWVyaWModmFsdWUpID8gImFscGhhKG9wYWNpdHk9IiArIHZhbHVlICogMTAwICsgIikiIDogIiIsCiAgICAgICAgICAgIGZpbHRlciA9IGN1cnJlbnRTdHlsZSAmJiBjdXJyZW50U3R5bGUuZmlsdGVyIHx8IHN0eWxlLmZpbHRlciB8fCAiIjsgLy8gSUUgaGFzIHRyb3VibGUgd2l0aCBvcGFjaXR5IGlmIGl0IGRvZXMgbm90IGhhdmUgbGF5b3V0CiAgICAgICAgLy8gRm9yY2UgaXQgYnkgc2V0dGluZyB0aGUgem9vbSBsZXZlbAoKICAgICAgICBzdHlsZS56b29tID0gMTsgLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0gYXR0ZW1wdCB0byByZW1vdmUgZmlsdGVyIGF0dHJpYnV0ZSAjNjY1MgogICAgICAgIC8vIGlmIHZhbHVlID09PSAiIiwgdGhlbiByZW1vdmUgaW5saW5lIG9wYWNpdHkgIzEyNjg1CgogICAgICAgIGlmICgodmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIpICYmIGpRdWVyeS50cmltKGZpbHRlci5yZXBsYWNlKHJhbHBoYSwgIiIpKSA9PT0gIiIgJiYgc3R5bGUucmVtb3ZlQXR0cmlidXRlKSB7CiAgICAgICAgICAvLyBTZXR0aW5nIHN0eWxlLmZpbHRlciB0byBudWxsLCAiIiAmICIgIiBzdGlsbCBsZWF2ZSAiZmlsdGVyOiIgaW4gdGhlIGNzc1RleHQKICAgICAgICAgIC8vIGlmICJmaWx0ZXI6IiBpcyBwcmVzZW50IGF0IGFsbCwgY2xlYXJUeXBlIGlzIGRpc2FibGVkLCB3ZSB3YW50IHRvIGF2b2lkIHRoaXMKICAgICAgICAgIC8vIHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSBpcyBJRSBPbmx5LCBidXQgc28gYXBwYXJlbnRseSBpcyB0aGlzIGNvZGUgcGF0aC4uLgogICAgICAgICAgc3R5bGUucmVtb3ZlQXR0cmlidXRlKCJmaWx0ZXIiKTsgLy8gaWYgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCiAgICAgICAgICBpZiAodmFsdWUgPT09ICIiIHx8IGN1cnJlbnRTdHlsZSAmJiAhY3VycmVudFN0eWxlLmZpbHRlcikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBvdGhlcndpc2UsIHNldCBuZXcgZmlsdGVyIHZhbHVlcwoKCiAgICAgICAgc3R5bGUuZmlsdGVyID0gcmFscGhhLnRlc3QoZmlsdGVyKSA/IGZpbHRlci5yZXBsYWNlKHJhbHBoYSwgb3BhY2l0eSkgOiBmaWx0ZXIgKyAiICIgKyBvcGFjaXR5OwogICAgICB9CiAgICB9OwogIH0gLy8gVGhlc2UgaG9va3MgY2Fubm90IGJlIGFkZGVkIHVudGlsIERPTSByZWFkeSBiZWNhdXNlIHRoZSBzdXBwb3J0IHRlc3QKICAvLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHkKCgogIGpRdWVyeShmdW5jdGlvbiAoKSB7CiAgICBpZiAoIWpRdWVyeS5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHQpIHsKICAgICAgalF1ZXJ5LmNzc0hvb2tzLm1hcmdpblJpZ2h0ID0gewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGVsZW0sIGNvbXB1dGVkKSB7CiAgICAgICAgICBpZiAoY29tcHV0ZWQpIHsKICAgICAgICAgICAgLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CiAgICAgICAgICAgIC8vIFdvcmsgYXJvdW5kIGJ5IHRlbXBvcmFyaWx5IHNldHRpbmcgZWxlbWVudCBkaXNwbGF5IHRvIGlubGluZS1ibG9jawogICAgICAgICAgICByZXR1cm4galF1ZXJ5LnN3YXAoZWxlbSwgewogICAgICAgICAgICAgICJkaXNwbGF5IjogImlubGluZS1ibG9jayIKICAgICAgICAgICAgfSwgY3VyQ1NTLCBbZWxlbSwgIm1hcmdpblJpZ2h0Il0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0gLy8gV2Via2l0IGJ1ZzogaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTI5MDg0CiAgICAvLyBnZXRDb21wdXRlZFN0eWxlIHJldHVybnMgcGVyY2VudCB3aGVuIHNwZWNpZmllZCBmb3IgdG9wL2xlZnQvYm90dG9tL3JpZ2h0CiAgICAvLyByYXRoZXIgdGhhbiBtYWtlIHRoZSBjc3MgbW9kdWxlIGRlcGVuZCBvbiB0aGUgb2Zmc2V0IG1vZHVsZSwgd2UganVzdCBjaGVjayBmb3IgaXQgaGVyZQoKCiAgICBpZiAoIWpRdWVyeS5zdXBwb3J0LnBpeGVsUG9zaXRpb24gJiYgalF1ZXJ5LmZuLnBvc2l0aW9uKSB7CiAgICAgIGpRdWVyeS5lYWNoKFsidG9wIiwgImxlZnQiXSwgZnVuY3Rpb24gKGksIHByb3ApIHsKICAgICAgICBqUXVlcnkuY3NzSG9va3NbcHJvcF0gPSB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtLCBjb21wdXRlZCkgewogICAgICAgICAgICBpZiAoY29tcHV0ZWQpIHsKICAgICAgICAgICAgICBjb21wdXRlZCA9IGN1ckNTUyhlbGVtLCBwcm9wKTsgLy8gaWYgY3VyQ1NTIHJldHVybnMgcGVyY2VudGFnZSwgZmFsbGJhY2sgdG8gb2Zmc2V0CgogICAgICAgICAgICAgIHJldHVybiBybnVtbm9ucHgudGVzdChjb21wdXRlZCkgPyBqUXVlcnkoZWxlbSkucG9zaXRpb24oKVtwcm9wXSArICJweCIgOiBjb21wdXRlZDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pOwogICAgfQogIH0pOwoKICBpZiAoalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycykgewogICAgalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiAoZWxlbSkgewogICAgICAvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgogICAgICAvLyBPcGVyYSByZXBvcnRzIG9mZnNldFdpZHRocyBhbmQgb2Zmc2V0SGVpZ2h0cyBsZXNzIHRoYW4gemVybyBvbiBzb21lIGVsZW1lbnRzCiAgICAgIHJldHVybiBlbGVtLm9mZnNldFdpZHRoIDw9IDAgJiYgZWxlbS5vZmZzZXRIZWlnaHQgPD0gMCB8fCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVIaWRkZW5PZmZzZXRzICYmIChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSB8fCBqUXVlcnkuY3NzKGVsZW0sICJkaXNwbGF5IikpID09PSAibm9uZSI7CiAgICB9OwoKICAgIGpRdWVyeS5leHByLmZpbHRlcnMudmlzaWJsZSA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgIHJldHVybiAhalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4oZWxlbSk7CiAgICB9OwogIH0gLy8gVGhlc2UgaG9va3MgYXJlIHVzZWQgYnkgYW5pbWF0ZSB0byBleHBhbmQgcHJvcGVydGllcwoKCiAgalF1ZXJ5LmVhY2goewogICAgbWFyZ2luOiAiIiwKICAgIHBhZGRpbmc6ICIiLAogICAgYm9yZGVyOiAiV2lkdGgiCiAgfSwgZnVuY3Rpb24gKHByZWZpeCwgc3VmZml4KSB7CiAgICBqUXVlcnkuY3NzSG9va3NbcHJlZml4ICsgc3VmZml4XSA9IHsKICAgICAgZXhwYW5kOiBmdW5jdGlvbiBleHBhbmQodmFsdWUpIHsKICAgICAgICB2YXIgaSA9IDAsCiAgICAgICAgICAgIGV4cGFuZGVkID0ge30sCiAgICAgICAgICAgIC8vIGFzc3VtZXMgYSBzaW5nbGUgbnVtYmVyIGlmIG5vdCBhIHN0cmluZwogICAgICAgIHBhcnRzID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlLnNwbGl0KCIgIikgOiBbdmFsdWVdOwoKICAgICAgICBmb3IgKDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgZXhwYW5kZWRbcHJlZml4ICsgY3NzRXhwYW5kW2ldICsgc3VmZml4XSA9IHBhcnRzW2ldIHx8IHBhcnRzW2kgLSAyXSB8fCBwYXJ0c1swXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBleHBhbmRlZDsKICAgICAgfQogICAgfTsKCiAgICBpZiAoIXJtYXJnaW4udGVzdChwcmVmaXgpKSB7CiAgICAgIGpRdWVyeS5jc3NIb29rc1twcmVmaXggKyBzdWZmaXhdLnNldCA9IHNldFBvc2l0aXZlTnVtYmVyOwogICAgfQogIH0pOwogIHZhciByMjAgPSAvJTIwL2csCiAgICAgIHJicmFja2V0ID0gL1xbXF0kLywKICAgICAgckNSTEYgPSAvXHI/XG4vZywKICAgICAgcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAogICAgICByc3VibWl0dGFibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uIHNlcmlhbGl6ZSgpIHsKICAgICAgcmV0dXJuIGpRdWVyeS5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpOwogICAgfSwKICAgIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbiBzZXJpYWxpemVBcnJheSgpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBDYW4gYWRkIHByb3BIb29rIGZvciAiZWxlbWVudHMiIHRvIGZpbHRlciBvciBhZGQgZm9ybSBlbGVtZW50cwogICAgICAgIHZhciBlbGVtZW50cyA9IGpRdWVyeS5wcm9wKHRoaXMsICJlbGVtZW50cyIpOwogICAgICAgIHJldHVybiBlbGVtZW50cyA/IGpRdWVyeS5tYWtlQXJyYXkoZWxlbWVudHMpIDogdGhpczsKICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdHlwZSA9IHRoaXMudHlwZTsgLy8gVXNlIC5pcygiOmRpc2FibGVkIikgc28gdGhhdCBmaWVsZHNldFtkaXNhYmxlZF0gd29ya3MKCiAgICAgICAgcmV0dXJuIHRoaXMubmFtZSAmJiAhalF1ZXJ5KHRoaXMpLmlzKCI6ZGlzYWJsZWQiKSAmJiByc3VibWl0dGFibGUudGVzdCh0aGlzLm5vZGVOYW1lKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QodHlwZSkgJiYgKHRoaXMuY2hlY2tlZCB8fCAhbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlLnRlc3QodHlwZSkpOwogICAgICB9KS5tYXAoZnVuY3Rpb24gKGksIGVsZW0pIHsKICAgICAgICB2YXIgdmFsID0galF1ZXJ5KHRoaXMpLnZhbCgpOwogICAgICAgIHJldHVybiB2YWwgPT0gbnVsbCA/IG51bGwgOiBqUXVlcnkuaXNBcnJheSh2YWwpID8galF1ZXJ5Lm1hcCh2YWwsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG5hbWU6IGVsZW0ubmFtZSwKICAgICAgICAgICAgdmFsdWU6IHZhbC5yZXBsYWNlKHJDUkxGLCAiXHJcbiIpCiAgICAgICAgICB9OwogICAgICAgIH0pIDogewogICAgICAgICAgbmFtZTogZWxlbS5uYW1lLAogICAgICAgICAgdmFsdWU6IHZhbC5yZXBsYWNlKHJDUkxGLCAiXHJcbiIpCiAgICAgICAgfTsKICAgICAgfSkuZ2V0KCk7CiAgICB9CiAgfSk7IC8vU2VyaWFsaXplIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMgb3IgYSBzZXQgb2YKICAvL2tleS92YWx1ZXMgaW50byBhIHF1ZXJ5IHN0cmluZwoKICBqUXVlcnkucGFyYW0gPSBmdW5jdGlvbiAoYSwgdHJhZGl0aW9uYWwpIHsKICAgIHZhciBwcmVmaXgsCiAgICAgICAgcyA9IFtdLAogICAgICAgIGFkZCA9IGZ1bmN0aW9uIGFkZChrZXksIHZhbHVlKSB7CiAgICAgIC8vIElmIHZhbHVlIGlzIGEgZnVuY3Rpb24sIGludm9rZSBpdCBhbmQgcmV0dXJuIGl0cyB2YWx1ZQogICAgICB2YWx1ZSA9IGpRdWVyeS5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlKCkgOiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZTsKICAgICAgc1tzLmxlbmd0aF0gPSBlbmNvZGVVUklDb21wb25lbnQoa2V5KSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7CiAgICB9OyAvLyBTZXQgdHJhZGl0aW9uYWwgdG8gdHJ1ZSBmb3IgalF1ZXJ5IDw9IDEuMy4yIGJlaGF2aW9yLgoKCiAgICBpZiAodHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCkgewogICAgICB0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKICAgIH0gLy8gSWYgYW4gYXJyYXkgd2FzIHBhc3NlZCBpbiwgYXNzdW1lIHRoYXQgaXQgaXMgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cy4KCgogICAgaWYgKGpRdWVyeS5pc0FycmF5KGEpIHx8IGEuanF1ZXJ5ICYmICFqUXVlcnkuaXNQbGFpbk9iamVjdChhKSkgewogICAgICAvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKICAgICAgalF1ZXJ5LmVhY2goYSwgZnVuY3Rpb24gKCkgewogICAgICAgIGFkZCh0aGlzLm5hbWUsIHRoaXMudmFsdWUpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIElmIHRyYWRpdGlvbmFsLCBlbmNvZGUgdGhlICJvbGQiIHdheSAodGhlIHdheSAxLjMuMiBvciBvbGRlcgogICAgICAvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KICAgICAgZm9yIChwcmVmaXggaW4gYSkgewogICAgICAgIGJ1aWxkUGFyYW1zKHByZWZpeCwgYVtwcmVmaXhdLCB0cmFkaXRpb25hbCwgYWRkKTsKICAgICAgfQogICAgfSAvLyBSZXR1cm4gdGhlIHJlc3VsdGluZyBzZXJpYWxpemF0aW9uCgoKICAgIHJldHVybiBzLmpvaW4oIiYiKS5yZXBsYWNlKHIyMCwgIisiKTsKICB9OwoKICBmdW5jdGlvbiBidWlsZFBhcmFtcyhwcmVmaXgsIG9iaiwgdHJhZGl0aW9uYWwsIGFkZCkgewogICAgdmFyIG5hbWU7CgogICAgaWYgKGpRdWVyeS5pc0FycmF5KG9iaikpIHsKICAgICAgLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uCiAgICAgIGpRdWVyeS5lYWNoKG9iaiwgZnVuY3Rpb24gKGksIHYpIHsKICAgICAgICBpZiAodHJhZGl0aW9uYWwgfHwgcmJyYWNrZXQudGVzdChwcmVmaXgpKSB7CiAgICAgICAgICAvLyBUcmVhdCBlYWNoIGFycmF5IGl0ZW0gYXMgYSBzY2FsYXIuCiAgICAgICAgICBhZGQocHJlZml4LCB2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzIG51bWVyaWMgaW5kZXguCiAgICAgICAgICBidWlsZFBhcmFtcyhwcmVmaXggKyAiWyIgKyAoX3R5cGVvZih2KSA9PT0gIm9iamVjdCIgPyBpIDogIiIpICsgIl0iLCB2LCB0cmFkaXRpb25hbCwgYWRkKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmICghdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUob2JqKSA9PT0gIm9iamVjdCIpIHsKICAgICAgLy8gU2VyaWFsaXplIG9iamVjdCBpdGVtLgogICAgICBmb3IgKG5hbWUgaW4gb2JqKSB7CiAgICAgICAgYnVpbGRQYXJhbXMocHJlZml4ICsgIlsiICsgbmFtZSArICJdIiwgb2JqW25hbWVdLCB0cmFkaXRpb25hbCwgYWRkKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gU2VyaWFsaXplIHNjYWxhciBpdGVtLgogICAgICBhZGQocHJlZml4LCBvYmopOwogICAgfQogIH0KCiAgalF1ZXJ5LmVhY2goKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayAiICsgIm1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlICIgKyAiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uIChpLCBuYW1lKSB7CiAgICAvLyBIYW5kbGUgZXZlbnQgYmluZGluZwogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKGRhdGEsIGZuKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMCA/IHRoaXMub24obmFtZSwgbnVsbCwgZGF0YSwgZm4pIDogdGhpcy50cmlnZ2VyKG5hbWUpOwogICAgfTsKICB9KTsKCiAgalF1ZXJ5LmZuLmhvdmVyID0gZnVuY3Rpb24gKGZuT3ZlciwgZm5PdXQpIHsKICAgIHJldHVybiB0aGlzLm1vdXNlZW50ZXIoZm5PdmVyKS5tb3VzZWxlYXZlKGZuT3V0IHx8IGZuT3Zlcik7CiAgfTsKCiAgdmFyIC8vIERvY3VtZW50IGxvY2F0aW9uCiAgYWpheExvY1BhcnRzLAogICAgICBhamF4TG9jYXRpb24sCiAgICAgIGFqYXhfbm9uY2UgPSBqUXVlcnkubm93KCksCiAgICAgIGFqYXhfcnF1ZXJ5ID0gL1w/LywKICAgICAgcmhhc2ggPSAvIy4qJC8sCiAgICAgIHJ0cyA9IC8oWz8mXSlfPVteJl0qLywKICAgICAgcmhlYWRlcnMgPSAvXiguKj8pOlsgXHRdKihbXlxyXG5dKilccj8kL21nLAogICAgICAvLyBJRSBsZWF2ZXMgYW4gXHIgY2hhcmFjdGVyIGF0IEVPTAogIC8vICM3NjUzLCAjODEyNSwgIzgxNTI6IGxvY2FsIHByb3RvY29sIGRldGVjdGlvbgogIHJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCiAgICAgIHJub0NvbnRlbnQgPSAvXig/OkdFVHxIRUFEKSQvLAogICAgICBycHJvdG9jb2wgPSAvXlwvXC8vLAogICAgICBydXJsID0gL14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLAogICAgICAvLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kCiAgX2xvYWQgPSBqUXVlcnkuZm4ubG9hZCwKCiAgLyogUHJlZmlsdGVycw0KICAgKiAxKSBUaGV5IGFyZSB1c2VmdWwgdG8gaW50cm9kdWNlIGN1c3RvbSBkYXRhVHlwZXMgKHNlZSBhamF4L2pzb25wLmpzIGZvciBhbiBleGFtcGxlKQ0KICAgKiAyKSBUaGVzZSBhcmUgY2FsbGVkOg0KICAgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0DQogICAqICAgIC0gQUZURVIgcGFyYW0gc2VyaWFsaXphdGlvbiAocy5kYXRhIGlzIGEgc3RyaW5nIGlmIHMucHJvY2Vzc0RhdGEgaXMgdHJ1ZSkNCiAgICogMykga2V5IGlzIHRoZSBkYXRhVHlwZQ0KICAgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZA0KICAgKiA1KSBleGVjdXRpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBjb250aW51ZSBkb3duIHRvICIqIiBpZiBuZWVkZWQNCiAgICovCiAgcHJlZmlsdGVycyA9IHt9LAoKICAvKiBUcmFuc3BvcnRzIGJpbmRpbmdzDQogICAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUNCiAgICogMikgdGhlIGNhdGNoYWxsIHN5bWJvbCAiKiIgY2FuIGJlIHVzZWQNCiAgICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gIioiIGlmIG5lZWRlZA0KICAgKi8KICB0cmFuc3BvcnRzID0ge30sCiAgICAgIC8vIEF2b2lkIGNvbW1lbnQtcHJvbG9nIGNoYXIgc2VxdWVuY2UgKCMxMDA5OCk7IG11c3QgYXBwZWFzZSBsaW50IGFuZCBldmFkZSBjb21wcmVzc2lvbgogIGFsbFR5cGVzID0gIiovIi5jb25jYXQoIioiKTsgLy8gIzgxMzgsIElFIG1heSB0aHJvdyBhbiBleGNlcHRpb24gd2hlbiBhY2Nlc3NpbmcKICAvLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKCiAgdHJ5IHsKICAgIGFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7CiAgfSBjYXRjaCAoZSkgewogICAgLy8gVXNlIHRoZSBocmVmIGF0dHJpYnV0ZSBvZiBhbiBBIGVsZW1lbnQKICAgIC8vIHNpbmNlIElFIHdpbGwgbW9kaWZ5IGl0IGdpdmVuIGRvY3VtZW50LmxvY2F0aW9uCiAgICBhamF4TG9jYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICBhamF4TG9jYXRpb24uaHJlZiA9ICIiOwogICAgYWpheExvY2F0aW9uID0gYWpheExvY2F0aW9uLmhyZWY7CiAgfSAvLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKCgogIGFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyhhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSkgfHwgW107IC8vIEJhc2UgImNvbnN0cnVjdG9yIiBmb3IgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIgYW5kIGpRdWVyeS5hamF4VHJhbnNwb3J0CgogIGZ1bmN0aW9uIGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyhzdHJ1Y3R1cmUpIHsKICAgIC8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gIioiCiAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGFUeXBlRXhwcmVzc2lvbiwgZnVuYykgewogICAgICBpZiAodHlwZW9mIGRhdGFUeXBlRXhwcmVzc2lvbiAhPT0gInN0cmluZyIpIHsKICAgICAgICBmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwogICAgICAgIGRhdGFUeXBlRXhwcmVzc2lvbiA9ICIqIjsKICAgICAgfQoKICAgICAgdmFyIGRhdGFUeXBlLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaChjb3JlX3Jub3R3aGl0ZSkgfHwgW107CgogICAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24oZnVuYykpIHsKICAgICAgICAvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCiAgICAgICAgd2hpbGUgKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pIHsKICAgICAgICAgIC8vIFByZXBlbmQgaWYgcmVxdWVzdGVkCiAgICAgICAgICBpZiAoZGF0YVR5cGVbMF0gPT09ICIrIikgewogICAgICAgICAgICBkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKDEpIHx8ICIqIjsKICAgICAgICAgICAgKHN0cnVjdHVyZVtkYXRhVHlwZV0gPSBzdHJ1Y3R1cmVbZGF0YVR5cGVdIHx8IFtdKS51bnNoaWZ0KGZ1bmMpOyAvLyBPdGhlcndpc2UgYXBwZW5kCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAoc3RydWN0dXJlW2RhdGFUeXBlXSA9IHN0cnVjdHVyZVtkYXRhVHlwZV0gfHwgW10pLnB1c2goZnVuYyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0gLy8gQmFzZSBpbnNwZWN0aW9uIGZ1bmN0aW9uIGZvciBwcmVmaWx0ZXJzIGFuZCB0cmFuc3BvcnRzCgoKICBmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyhzdHJ1Y3R1cmUsIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIpIHsKICAgIHZhciBpbnNwZWN0ZWQgPSB7fSwKICAgICAgICBzZWVraW5nVHJhbnNwb3J0ID0gc3RydWN0dXJlID09PSB0cmFuc3BvcnRzOwoKICAgIGZ1bmN0aW9uIGluc3BlY3QoZGF0YVR5cGUpIHsKICAgICAgdmFyIHNlbGVjdGVkOwogICAgICBpbnNwZWN0ZWRbZGF0YVR5cGVdID0gdHJ1ZTsKICAgICAgalF1ZXJ5LmVhY2goc3RydWN0dXJlW2RhdGFUeXBlXSB8fCBbXSwgZnVuY3Rpb24gKF8sIHByZWZpbHRlck9yRmFjdG9yeSkgewogICAgICAgIHZhciBkYXRhVHlwZU9yVHJhbnNwb3J0ID0gcHJlZmlsdGVyT3JGYWN0b3J5KG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIpOwoKICAgICAgICBpZiAodHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbZGF0YVR5cGVPclRyYW5zcG9ydF0pIHsKICAgICAgICAgIG9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoZGF0YVR5cGVPclRyYW5zcG9ydCk7CiAgICAgICAgICBpbnNwZWN0KGRhdGFUeXBlT3JUcmFuc3BvcnQpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoc2Vla2luZ1RyYW5zcG9ydCkgewogICAgICAgICAgcmV0dXJuICEoc2VsZWN0ZWQgPSBkYXRhVHlwZU9yVHJhbnNwb3J0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gc2VsZWN0ZWQ7CiAgICB9CgogICAgcmV0dXJuIGluc3BlY3Qob3B0aW9ucy5kYXRhVHlwZXNbMF0pIHx8ICFpbnNwZWN0ZWRbIioiXSAmJiBpbnNwZWN0KCIqIik7CiAgfSAvLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKICAvLyB0aGF0IHRha2VzICJmbGF0IiBvcHRpb25zIChub3QgdG8gYmUgZGVlcCBleHRlbmRlZCkKICAvLyBGaXhlcyAjOTg4NwoKCiAgZnVuY3Rpb24gYWpheEV4dGVuZCh0YXJnZXQsIHNyYykgewogICAgdmFyIGRlZXAsCiAgICAgICAga2V5LAogICAgICAgIGZsYXRPcHRpb25zID0galF1ZXJ5LmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9ucyB8fCB7fTsKCiAgICBmb3IgKGtleSBpbiBzcmMpIHsKICAgICAgaWYgKHNyY1trZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAoZmxhdE9wdGlvbnNba2V5XSA/IHRhcmdldCA6IGRlZXAgfHwgKGRlZXAgPSB7fSkpW2tleV0gPSBzcmNba2V5XTsKICAgICAgfQogICAgfQoKICAgIGlmIChkZWVwKSB7CiAgICAgIGpRdWVyeS5leHRlbmQodHJ1ZSwgdGFyZ2V0LCBkZWVwKTsKICAgIH0KCiAgICByZXR1cm4gdGFyZ2V0OwogIH0KCiAgalF1ZXJ5LmZuLmxvYWQgPSBmdW5jdGlvbiAodXJsLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICBpZiAodHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQpIHsKICAgICAgcmV0dXJuIF9sb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgdmFyIHNlbGVjdG9yLAogICAgICAgIHJlc3BvbnNlLAogICAgICAgIHR5cGUsCiAgICAgICAgc2VsZiA9IHRoaXMsCiAgICAgICAgb2ZmID0gdXJsLmluZGV4T2YoIiAiKTsKCiAgICBpZiAob2ZmID49IDApIHsKICAgICAgc2VsZWN0b3IgPSB1cmwuc2xpY2Uob2ZmLCB1cmwubGVuZ3RoKTsKICAgICAgdXJsID0gdXJsLnNsaWNlKDAsIG9mZik7CiAgICB9IC8vIElmIGl0J3MgYSBmdW5jdGlvbgoKCiAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24ocGFyYW1zKSkgewogICAgICAvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawogICAgICBjYWxsYmFjayA9IHBhcmFtczsKICAgICAgcGFyYW1zID0gdW5kZWZpbmVkOyAvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCiAgICB9IGVsc2UgaWYgKHBhcmFtcyAmJiBfdHlwZW9mKHBhcmFtcykgPT09ICJvYmplY3QiKSB7CiAgICAgIHR5cGUgPSAiUE9TVCI7CiAgICB9IC8vIElmIHdlIGhhdmUgZWxlbWVudHMgdG8gbW9kaWZ5LCBtYWtlIHRoZSByZXF1ZXN0CgoKICAgIGlmIChzZWxmLmxlbmd0aCA+IDApIHsKICAgICAgalF1ZXJ5LmFqYXgoewogICAgICAgIHVybDogdXJsLAogICAgICAgIC8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAogICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgZGF0YVR5cGU6ICJodG1sIiwKICAgICAgICBkYXRhOiBwYXJhbXMKICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CiAgICAgICAgLy8gU2F2ZSByZXNwb25zZSBmb3IgdXNlIGluIGNvbXBsZXRlIGNhbGxiYWNrCiAgICAgICAgcmVzcG9uc2UgPSBhcmd1bWVudHM7CiAgICAgICAgc2VsZi5odG1sKHNlbGVjdG9yID8gLy8gSWYgYSBzZWxlY3RvciB3YXMgc3BlY2lmaWVkLCBsb2NhdGUgdGhlIHJpZ2h0IGVsZW1lbnRzIGluIGEgZHVtbXkgZGl2CiAgICAgICAgLy8gRXhjbHVkZSBzY3JpcHRzIHRvIGF2b2lkIElFICdQZXJtaXNzaW9uIERlbmllZCcgZXJyb3JzCiAgICAgICAgalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZChqUXVlcnkucGFyc2VIVE1MKHJlc3BvbnNlVGV4dCkpLmZpbmQoc2VsZWN0b3IpIDogLy8gT3RoZXJ3aXNlIHVzZSB0aGUgZnVsbCByZXN1bHQKICAgICAgICByZXNwb25zZVRleHQpOwogICAgICB9KS5jb21wbGV0ZShjYWxsYmFjayAmJiBmdW5jdGlvbiAoanFYSFIsIHN0YXR1cykgewogICAgICAgIHNlbGYuZWFjaChjYWxsYmFjaywgcmVzcG9uc2UgfHwgW2pxWEhSLnJlc3BvbnNlVGV4dCwgc3RhdHVzLCBqcVhIUl0pOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OyAvLyBBdHRhY2ggYSBidW5jaCBvZiBmdW5jdGlvbnMgZm9yIGhhbmRsaW5nIGNvbW1vbiBBSkFYIGV2ZW50cwoKCiAgalF1ZXJ5LmVhY2goWyJhamF4U3RhcnQiLCAiYWpheFN0b3AiLCAiYWpheENvbXBsZXRlIiwgImFqYXhFcnJvciIsICJhamF4U3VjY2VzcyIsICJhamF4U2VuZCJdLCBmdW5jdGlvbiAoaSwgdHlwZSkgewogICAgalF1ZXJ5LmZuW3R5cGVdID0gZnVuY3Rpb24gKGZuKSB7CiAgICAgIHJldHVybiB0aGlzLm9uKHR5cGUsIGZuKTsKICAgIH07CiAgfSk7CiAgalF1ZXJ5LmVhY2goWyJnZXQiLCAicG9zdCJdLCBmdW5jdGlvbiAoaSwgbWV0aG9kKSB7CiAgICBqUXVlcnlbbWV0aG9kXSA9IGZ1bmN0aW9uICh1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlKSB7CiAgICAgIC8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCiAgICAgIGlmIChqUXVlcnkuaXNGdW5jdGlvbihkYXRhKSkgewogICAgICAgIHR5cGUgPSB0eXBlIHx8IGNhbGxiYWNrOwogICAgICAgIGNhbGxiYWNrID0gZGF0YTsKICAgICAgICBkYXRhID0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICByZXR1cm4galF1ZXJ5LmFqYXgoewogICAgICAgIHVybDogdXJsLAogICAgICAgIHR5cGU6IG1ldGhvZCwKICAgICAgICBkYXRhVHlwZTogdHlwZSwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIHN1Y2Nlc3M6IGNhbGxiYWNrCiAgICAgIH0pOwogICAgfTsKICB9KTsKICBqUXVlcnkuZXh0ZW5kKHsKICAgIC8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwogICAgYWN0aXZlOiAwLAogICAgLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdAogICAgbGFzdE1vZGlmaWVkOiB7fSwKICAgIGV0YWc6IHt9LAogICAgYWpheFNldHRpbmdzOiB7CiAgICAgIHVybDogYWpheExvY2F0aW9uLAogICAgICB0eXBlOiAiR0VUIiwKICAgICAgaXNMb2NhbDogcmxvY2FsUHJvdG9jb2wudGVzdChhamF4TG9jUGFydHNbMV0pLAogICAgICBnbG9iYWw6IHRydWUsCiAgICAgIHByb2Nlc3NEYXRhOiB0cnVlLAogICAgICBhc3luYzogdHJ1ZSwKICAgICAgY29udGVudFR5cGU6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgiLAoKICAgICAgLyoNCiAgICAgIHRpbWVvdXQ6IDAsDQogICAgICBkYXRhOiBudWxsLA0KICAgICAgZGF0YVR5cGU6IG51bGwsDQogICAgICB1c2VybmFtZTogbnVsbCwNCiAgICAgIHBhc3N3b3JkOiBudWxsLA0KICAgICAgY2FjaGU6IG51bGwsDQogICAgICB0aHJvd3M6IGZhbHNlLA0KICAgICAgdHJhZGl0aW9uYWw6IGZhbHNlLA0KICAgICAgaGVhZGVyczoge30sDQogICAgICAqLwogICAgICBhY2NlcHRzOiB7CiAgICAgICAgIioiOiBhbGxUeXBlcywKICAgICAgICB0ZXh0OiAidGV4dC9wbGFpbiIsCiAgICAgICAgaHRtbDogInRleHQvaHRtbCIsCiAgICAgICAgeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsCiAgICAgICAganNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKICAgICAgfSwKICAgICAgY29udGVudHM6IHsKICAgICAgICB4bWw6IC94bWwvLAogICAgICAgIGh0bWw6IC9odG1sLywKICAgICAgICBqc29uOiAvanNvbi8KICAgICAgfSwKICAgICAgcmVzcG9uc2VGaWVsZHM6IHsKICAgICAgICB4bWw6ICJyZXNwb25zZVhNTCIsCiAgICAgICAgdGV4dDogInJlc3BvbnNlVGV4dCIKICAgICAgfSwKICAgICAgLy8gRGF0YSBjb252ZXJ0ZXJzCiAgICAgIC8vIEtleXMgc2VwYXJhdGUgc291cmNlIChvciBjYXRjaGFsbCAiKiIpIGFuZCBkZXN0aW5hdGlvbiB0eXBlcyB3aXRoIGEgc2luZ2xlIHNwYWNlCiAgICAgIGNvbnZlcnRlcnM6IHsKICAgICAgICAvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKICAgICAgICAiKiB0ZXh0Ijogd2luZG93LlN0cmluZywKICAgICAgICAvLyBUZXh0IHRvIGh0bWwgKHRydWUgPSBubyB0cmFuc2Zvcm1hdGlvbikKICAgICAgICAidGV4dCBodG1sIjogdHJ1ZSwKICAgICAgICAvLyBFdmFsdWF0ZSB0ZXh0IGFzIGEganNvbiBleHByZXNzaW9uCiAgICAgICAgInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCiAgICAgICAgLy8gUGFyc2UgdGV4dCBhcyB4bWwKICAgICAgICAidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKICAgICAgfSwKICAgICAgLy8gRm9yIG9wdGlvbnMgdGhhdCBzaG91bGRuJ3QgYmUgZGVlcCBleHRlbmRlZDoKICAgICAgLy8geW91IGNhbiBhZGQgeW91ciBvd24gY3VzdG9tIG9wdGlvbnMgaGVyZSBpZgogICAgICAvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQogICAgICAvLyBkZWVwIGV4dGVuZGVkIChzZWUgYWpheEV4dGVuZCkKICAgICAgZmxhdE9wdGlvbnM6IHsKICAgICAgICB1cmw6IHRydWUsCiAgICAgICAgY29udGV4dDogdHJ1ZQogICAgICB9CiAgICB9LAogICAgLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKICAgIC8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KICAgIC8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCiAgICBhamF4U2V0dXA6IGZ1bmN0aW9uIGFqYXhTZXR1cCh0YXJnZXQsIHNldHRpbmdzKSB7CiAgICAgIHJldHVybiBzZXR0aW5ncyA/IC8vIEJ1aWxkaW5nIGEgc2V0dGluZ3Mgb2JqZWN0CiAgICAgIGFqYXhFeHRlbmQoYWpheEV4dGVuZCh0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MpLCBzZXR0aW5ncykgOiAvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCiAgICAgIGFqYXhFeHRlbmQoalF1ZXJ5LmFqYXhTZXR0aW5ncywgdGFyZ2V0KTsKICAgIH0sCiAgICBhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMocHJlZmlsdGVycyksCiAgICBhamF4VHJhbnNwb3J0OiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHModHJhbnNwb3J0cyksCiAgICAvLyBNYWluIG1ldGhvZAogICAgYWpheDogZnVuY3Rpb24gYWpheCh1cmwsIG9wdGlvbnMpIHsKICAgICAgLy8gSWYgdXJsIGlzIGFuIG9iamVjdCwgc2ltdWxhdGUgcHJlLTEuNSBzaWduYXR1cmUKICAgICAgaWYgKF90eXBlb2YodXJsKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBvcHRpb25zID0gdXJsOwogICAgICAgIHVybCA9IHVuZGVmaW5lZDsKICAgICAgfSAvLyBGb3JjZSBvcHRpb25zIHRvIGJlIGFuIG9iamVjdAoKCiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgdmFyIC8vIENyb3NzLWRvbWFpbiBkZXRlY3Rpb24gdmFycwogICAgICBwYXJ0cywKICAgICAgICAgIC8vIExvb3AgdmFyaWFibGUKICAgICAgaSwKICAgICAgICAgIC8vIFVSTCB3aXRob3V0IGFudGktY2FjaGUgcGFyYW0KICAgICAgY2FjaGVVUkwsCiAgICAgICAgICAvLyBSZXNwb25zZSBoZWFkZXJzIGFzIHN0cmluZwogICAgICByZXNwb25zZUhlYWRlcnNTdHJpbmcsCiAgICAgICAgICAvLyB0aW1lb3V0IGhhbmRsZQogICAgICB0aW1lb3V0VGltZXIsCiAgICAgICAgICAvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKICAgICAgZmlyZUdsb2JhbHMsCiAgICAgICAgICB0cmFuc3BvcnQsCiAgICAgICAgICAvLyBSZXNwb25zZSBoZWFkZXJzCiAgICAgIHJlc3BvbnNlSGVhZGVycywKICAgICAgICAgIC8vIENyZWF0ZSB0aGUgZmluYWwgb3B0aW9ucyBvYmplY3QKICAgICAgcyA9IGpRdWVyeS5hamF4U2V0dXAoe30sIG9wdGlvbnMpLAogICAgICAgICAgLy8gQ2FsbGJhY2tzIGNvbnRleHQKICAgICAgY2FsbGJhY2tDb250ZXh0ID0gcy5jb250ZXh0IHx8IHMsCiAgICAgICAgICAvLyBDb250ZXh0IGZvciBnbG9iYWwgZXZlbnRzIGlzIGNhbGxiYWNrQ29udGV4dCBpZiBpdCBpcyBhIERPTSBub2RlIG9yIGpRdWVyeSBjb2xsZWN0aW9uCiAgICAgIGdsb2JhbEV2ZW50Q29udGV4dCA9IHMuY29udGV4dCAmJiAoY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dC5qcXVlcnkpID8galF1ZXJ5KGNhbGxiYWNrQ29udGV4dCkgOiBqUXVlcnkuZXZlbnQsCiAgICAgICAgICAvLyBEZWZlcnJlZHMKICAgICAgZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKICAgICAgICAgIGNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLAogICAgICAgICAgLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKICAgICAgX3N0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCiAgICAgICAgICAvLyBIZWFkZXJzICh0aGV5IGFyZSBzZW50IGFsbCBhdCBvbmNlKQogICAgICByZXF1ZXN0SGVhZGVycyA9IHt9LAogICAgICAgICAgcmVxdWVzdEhlYWRlcnNOYW1lcyA9IHt9LAogICAgICAgICAgLy8gVGhlIGpxWEhSIHN0YXRlCiAgICAgIHN0YXRlID0gMCwKICAgICAgICAgIC8vIERlZmF1bHQgYWJvcnQgbWVzc2FnZQogICAgICBzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCiAgICAgICAgICAvLyBGYWtlIHhocgogICAgICBqcVhIUiA9IHsKICAgICAgICByZWFkeVN0YXRlOiAwLAogICAgICAgIC8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKICAgICAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24gZ2V0UmVzcG9uc2VIZWFkZXIoa2V5KSB7CiAgICAgICAgICB2YXIgbWF0Y2g7CgogICAgICAgICAgaWYgKHN0YXRlID09PSAyKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2VIZWFkZXJzKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzID0ge307CgogICAgICAgICAgICAgIHdoaWxlIChtYXRjaCA9IHJoZWFkZXJzLmV4ZWMocmVzcG9uc2VIZWFkZXJzU3RyaW5nKSkgewogICAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzW21hdGNoWzFdLnRvTG93ZXJDYXNlKCldID0gbWF0Y2hbMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBtYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CiAgICAgICAgfSwKICAgICAgICAvLyBSYXcgc3RyaW5nCiAgICAgICAgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbiBnZXRBbGxSZXNwb25zZUhlYWRlcnMoKSB7CiAgICAgICAgICByZXR1cm4gc3RhdGUgPT09IDIgPyByZXNwb25zZUhlYWRlcnNTdHJpbmcgOiBudWxsOwogICAgICAgIH0sCiAgICAgICAgLy8gQ2FjaGVzIHRoZSBoZWFkZXIKICAgICAgICBzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiBzZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICB2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgICAgICAgaWYgKCFzdGF0ZSkgewogICAgICAgICAgICBuYW1lID0gcmVxdWVzdEhlYWRlcnNOYW1lc1tsbmFtZV0gPSByZXF1ZXN0SGVhZGVyc05hbWVzW2xuYW1lXSB8fCBuYW1lOwogICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1tuYW1lXSA9IHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXIKICAgICAgICBvdmVycmlkZU1pbWVUeXBlOiBmdW5jdGlvbiBvdmVycmlkZU1pbWVUeXBlKHR5cGUpIHsKICAgICAgICAgIGlmICghc3RhdGUpIHsKICAgICAgICAgICAgcy5taW1lVHlwZSA9IHR5cGU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICAvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwogICAgICAgIHN0YXR1c0NvZGU6IGZ1bmN0aW9uIHN0YXR1c0NvZGUobWFwKSB7CiAgICAgICAgICB2YXIgY29kZTsKCiAgICAgICAgICBpZiAobWFwKSB7CiAgICAgICAgICAgIGlmIChzdGF0ZSA8IDIpIHsKICAgICAgICAgICAgICBmb3IgKGNvZGUgaW4gbWFwKSB7CiAgICAgICAgICAgICAgICAvLyBMYXp5LWFkZCB0aGUgbmV3IGNhbGxiYWNrIGluIGEgd2F5IHRoYXQgcHJlc2VydmVzIG9sZCBvbmVzCiAgICAgICAgICAgICAgICBfc3RhdHVzQ29kZVtjb2RlXSA9IFtfc3RhdHVzQ29kZVtjb2RlXSwgbWFwW2NvZGVdXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCiAgICAgICAgICAgICAganFYSFIuYWx3YXlzKG1hcFtqcVhIUi5zdGF0dXNdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CiAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uIGFib3J0KHN0YXR1c1RleHQpIHsKICAgICAgICAgIHZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0OwoKICAgICAgICAgIGlmICh0cmFuc3BvcnQpIHsKICAgICAgICAgICAgdHJhbnNwb3J0LmFib3J0KGZpbmFsVGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgZG9uZSgwLCBmaW5hbFRleHQpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9OyAvLyBBdHRhY2ggZGVmZXJyZWRzCgoKICAgICAgZGVmZXJyZWQucHJvbWlzZShqcVhIUikuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsKICAgICAganFYSFIuc3VjY2VzcyA9IGpxWEhSLmRvbmU7CiAgICAgIGpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsgLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCiAgICAgIC8vIEFkZCBwcm90b2NvbCBpZiBub3QgcHJvdmlkZWQgKCM1ODY2OiBJRTcgaXNzdWUgd2l0aCBwcm90b2NvbC1sZXNzIHVybHMpCiAgICAgIC8vIEhhbmRsZSBmYWxzeSB1cmwgaW4gdGhlIHNldHRpbmdzIG9iamVjdCAoIzEwMDkzOiBjb25zaXN0ZW5jeSB3aXRoIG9sZCBzaWduYXR1cmUpCiAgICAgIC8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoKICAgICAgcy51cmwgPSAoKHVybCB8fCBzLnVybCB8fCBhamF4TG9jYXRpb24pICsgIiIpLnJlcGxhY2Uocmhhc2gsICIiKS5yZXBsYWNlKHJwcm90b2NvbCwgYWpheExvY1BhcnRzWzFdICsgIi8vIik7IC8vIEFsaWFzIG1ldGhvZCBvcHRpb24gdG8gdHlwZSBhcyBwZXIgdGlja2V0ICMxMjAwNAoKICAgICAgcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsgLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoKICAgICAgcy5kYXRhVHlwZXMgPSBqUXVlcnkudHJpbShzLmRhdGFUeXBlIHx8ICIqIikudG9Mb3dlckNhc2UoKS5tYXRjaChjb3JlX3Jub3R3aGl0ZSkgfHwgWyIiXTsgLy8gQSBjcm9zcy1kb21haW4gcmVxdWVzdCBpcyBpbiBvcmRlciB3aGVuIHdlIGhhdmUgYSBwcm90b2NvbDpob3N0OnBvcnQgbWlzbWF0Y2gKCiAgICAgIGlmIChzLmNyb3NzRG9tYWluID09IG51bGwpIHsKICAgICAgICBwYXJ0cyA9IHJ1cmwuZXhlYyhzLnVybC50b0xvd2VyQ2FzZSgpKTsKICAgICAgICBzLmNyb3NzRG9tYWluID0gISEocGFydHMgJiYgKHBhcnRzWzFdICE9PSBhamF4TG9jUGFydHNbMV0gfHwgcGFydHNbMl0gIT09IGFqYXhMb2NQYXJ0c1syXSB8fCAocGFydHNbM10gfHwgKHBhcnRzWzFdID09PSAiaHR0cDoiID8gODAgOiA0NDMpKSAhPSAoYWpheExvY1BhcnRzWzNdIHx8IChhamF4TG9jUGFydHNbMV0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MykpKSk7CiAgICAgIH0gLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgoKICAgICAgaWYgKHMuZGF0YSAmJiBzLnByb2Nlc3NEYXRhICYmIHR5cGVvZiBzLmRhdGEgIT09ICJzdHJpbmciKSB7CiAgICAgICAgcy5kYXRhID0galF1ZXJ5LnBhcmFtKHMuZGF0YSwgcy50cmFkaXRpb25hbCk7CiAgICAgIH0gLy8gQXBwbHkgcHJlZmlsdGVycwoKCiAgICAgIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSKTsgLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCiAgICAgIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgIHJldHVybiBqcVhIUjsKICAgICAgfSAvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoKCiAgICAgIGZpcmVHbG9iYWxzID0gcy5nbG9iYWw7IC8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCiAgICAgIGlmIChmaXJlR2xvYmFscyAmJiBqUXVlcnkuYWN0aXZlKysgPT09IDApIHsKICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7CiAgICAgIH0gLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgoKICAgICAgcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7IC8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgogICAgICBzLmhhc0NvbnRlbnQgPSAhcm5vQ29udGVudC50ZXN0KHMudHlwZSk7IC8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQogICAgICAvLyBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIgbGF0ZXIgb24KCiAgICAgIGNhY2hlVVJMID0gcy51cmw7IC8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgogICAgICBpZiAoIXMuaGFzQ29udGVudCkgewogICAgICAgIC8vIElmIGRhdGEgaXMgYXZhaWxhYmxlLCBhcHBlbmQgZGF0YSB0byB1cmwKICAgICAgICBpZiAocy5kYXRhKSB7CiAgICAgICAgICBjYWNoZVVSTCA9IHMudXJsICs9IChhamF4X3JxdWVyeS50ZXN0KGNhY2hlVVJMKSA/ICImIiA6ICI/IikgKyBzLmRhdGE7IC8vICM5NjgyOiByZW1vdmUgZGF0YSBzbyB0aGF0IGl0J3Mgbm90IHVzZWQgaW4gYW4gZXZlbnR1YWwgcmV0cnkKCiAgICAgICAgICBkZWxldGUgcy5kYXRhOwogICAgICAgIH0gLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoKCiAgICAgICAgaWYgKHMuY2FjaGUgPT09IGZhbHNlKSB7CiAgICAgICAgICBzLnVybCA9IHJ0cy50ZXN0KGNhY2hlVVJMKSA/IC8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCiAgICAgICAgICBjYWNoZVVSTC5yZXBsYWNlKHJ0cywgIiQxXz0iICsgYWpheF9ub25jZSsrKSA6IC8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKICAgICAgICAgIGNhY2hlVVJMICsgKGFqYXhfcnF1ZXJ5LnRlc3QoY2FjaGVVUkwpID8gIiYiIDogIj8iKSArICJfPSIgKyBhamF4X25vbmNlKys7CiAgICAgICAgfQogICAgICB9IC8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgoKICAgICAgaWYgKHMuaWZNb2RpZmllZCkgewogICAgICAgIGlmIChqUXVlcnkubGFzdE1vZGlmaWVkW2NhY2hlVVJMXSkgewogICAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLCBqUXVlcnkubGFzdE1vZGlmaWVkW2NhY2hlVVJMXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoalF1ZXJ5LmV0YWdbY2FjaGVVUkxdKSB7CiAgICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Ob25lLU1hdGNoIiwgalF1ZXJ5LmV0YWdbY2FjaGVVUkxdKTsKICAgICAgICB9CiAgICAgIH0gLy8gU2V0IHRoZSBjb3JyZWN0IGhlYWRlciwgaWYgZGF0YSBpcyBiZWluZyBzZW50CgoKICAgICAgaWYgKHMuZGF0YSAmJiBzLmhhc0NvbnRlbnQgJiYgcy5jb250ZW50VHlwZSAhPT0gZmFsc2UgfHwgb3B0aW9ucy5jb250ZW50VHlwZSkgewogICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsIHMuY29udGVudFR5cGUpOwogICAgICB9IC8vIFNldCB0aGUgQWNjZXB0cyBoZWFkZXIgZm9yIHRoZSBzZXJ2ZXIsIGRlcGVuZGluZyBvbiB0aGUgZGF0YVR5cGUKCgogICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLCBzLmRhdGFUeXBlc1swXSAmJiBzLmFjY2VwdHNbcy5kYXRhVHlwZXNbMF1dID8gcy5hY2NlcHRzW3MuZGF0YVR5cGVzWzBdXSArIChzLmRhdGFUeXBlc1swXSAhPT0gIioiID8gIiwgIiArIGFsbFR5cGVzICsgIjsgcT0wLjAxIiA6ICIiKSA6IHMuYWNjZXB0c1siKiJdKTsgLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uCgogICAgICBmb3IgKGkgaW4gcy5oZWFkZXJzKSB7CiAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlcihpLCBzLmhlYWRlcnNbaV0pOwogICAgICB9IC8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCgogICAgICBpZiAocy5iZWZvcmVTZW5kICYmIChzLmJlZm9yZVNlbmQuY2FsbChjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzKSA9PT0gZmFsc2UgfHwgc3RhdGUgPT09IDIpKSB7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGRvbmUgYWxyZWFkeSBhbmQgcmV0dXJuCiAgICAgICAgcmV0dXJuIGpxWEhSLmFib3J0KCk7CiAgICAgIH0gLy8gYWJvcnRpbmcgaXMgbm8gbG9uZ2VyIGEgY2FuY2VsbGF0aW9uCgoKICAgICAgc3RyQWJvcnQgPSAiYWJvcnQiOyAvLyBJbnN0YWxsIGNhbGxiYWNrcyBvbiBkZWZlcnJlZHMKCiAgICAgIGZvciAoaSBpbiB7CiAgICAgICAgc3VjY2VzczogMSwKICAgICAgICBlcnJvcjogMSwKICAgICAgICBjb21wbGV0ZTogMQogICAgICB9KSB7CiAgICAgICAganFYSFJbaV0oc1tpXSk7CiAgICAgIH0gLy8gR2V0IHRyYW5zcG9ydAoKCiAgICAgIHRyYW5zcG9ydCA9IGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKHRyYW5zcG9ydHMsIHMsIG9wdGlvbnMsIGpxWEhSKTsgLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgogICAgICBpZiAoIXRyYW5zcG9ydCkgewogICAgICAgIGRvbmUoLTEsICJObyBUcmFuc3BvcnQiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBqcVhIUi5yZWFkeVN0YXRlID0gMTsgLy8gU2VuZCBnbG9iYWwgZXZlbnQKCiAgICAgICAgaWYgKGZpcmVHbG9iYWxzKSB7CiAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlcigiYWpheFNlbmQiLCBbanFYSFIsIHNdKTsKICAgICAgICB9IC8vIFRpbWVvdXQKCgogICAgICAgIGlmIChzLmFzeW5jICYmIHMudGltZW91dCA+IDApIHsKICAgICAgICAgIHRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBqcVhIUi5hYm9ydCgidGltZW91dCIpOwogICAgICAgICAgfSwgcy50aW1lb3V0KTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBzdGF0ZSA9IDE7CiAgICAgICAgICB0cmFuc3BvcnQuc2VuZChyZXF1ZXN0SGVhZGVycywgZG9uZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQogICAgICAgICAgaWYgKHN0YXRlIDwgMikgewogICAgICAgICAgICBkb25lKC0xLCBlKTsgLy8gU2ltcGx5IHJldGhyb3cgb3RoZXJ3aXNlCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCgogICAgICBmdW5jdGlvbiBkb25lKHN0YXR1cywgbmF0aXZlU3RhdHVzVGV4dCwgcmVzcG9uc2VzLCBoZWFkZXJzKSB7CiAgICAgICAgdmFyIGlzU3VjY2VzcywKICAgICAgICAgICAgc3VjY2VzcywKICAgICAgICAgICAgZXJyb3IsCiAgICAgICAgICAgIHJlc3BvbnNlLAogICAgICAgICAgICBtb2RpZmllZCwKICAgICAgICAgICAgc3RhdHVzVGV4dCA9IG5hdGl2ZVN0YXR1c1RleHQ7IC8vIENhbGxlZCBvbmNlCgogICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoKCiAgICAgICAgc3RhdGUgPSAyOyAvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoKICAgICAgICBpZiAodGltZW91dFRpbWVyKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dFRpbWVyKTsKICAgICAgICB9IC8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCiAgICAgICAgLy8gKG5vIG1hdHRlciBob3cgbG9uZyB0aGUganFYSFIgb2JqZWN0IHdpbGwgYmUgdXNlZCkKCgogICAgICAgIHRyYW5zcG9ydCA9IHVuZGVmaW5lZDsgLy8gQ2FjaGUgcmVzcG9uc2UgaGVhZGVycwoKICAgICAgICByZXNwb25zZUhlYWRlcnNTdHJpbmcgPSBoZWFkZXJzIHx8ICIiOyAvLyBTZXQgcmVhZHlTdGF0ZQoKICAgICAgICBqcVhIUi5yZWFkeVN0YXRlID0gc3RhdHVzID4gMCA/IDQgOiAwOyAvLyBHZXQgcmVzcG9uc2UgZGF0YQoKICAgICAgICBpZiAocmVzcG9uc2VzKSB7CiAgICAgICAgICByZXNwb25zZSA9IGFqYXhIYW5kbGVSZXNwb25zZXMocywganFYSFIsIHJlc3BvbnNlcyk7CiAgICAgICAgfSAvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoKCiAgICAgICAgaWYgKHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0KSB7CiAgICAgICAgICAvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLgogICAgICAgICAgaWYgKHMuaWZNb2RpZmllZCkgewogICAgICAgICAgICBtb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgogICAgICAgICAgICBpZiAobW9kaWZpZWQpIHsKICAgICAgICAgICAgICBqUXVlcnkubGFzdE1vZGlmaWVkW2NhY2hlVVJMXSA9IG1vZGlmaWVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgogICAgICAgICAgICBpZiAobW9kaWZpZWQpIHsKICAgICAgICAgICAgICBqUXVlcnkuZXRhZ1tjYWNoZVVSTF0gPSBtb2RpZmllZDsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBpZiBubyBjb250ZW50CgoKICAgICAgICAgIGlmIChzdGF0dXMgPT09IDIwNCkgewogICAgICAgICAgICBpc1N1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICBzdGF0dXNUZXh0ID0gIm5vY29udGVudCI7IC8vIGlmIG5vdCBtb2RpZmllZAogICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDMwNCkgewogICAgICAgICAgICBpc1N1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICBzdGF0dXNUZXh0ID0gIm5vdG1vZGlmaWVkIjsgLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc1N1Y2Nlc3MgPSBhamF4Q29udmVydChzLCByZXNwb25zZSk7CiAgICAgICAgICAgIHN0YXR1c1RleHQgPSBpc1N1Y2Nlc3Muc3RhdGU7CiAgICAgICAgICAgIHN1Y2Nlc3MgPSBpc1N1Y2Nlc3MuZGF0YTsKICAgICAgICAgICAgZXJyb3IgPSBpc1N1Y2Nlc3MuZXJyb3I7CiAgICAgICAgICAgIGlzU3VjY2VzcyA9ICFlcnJvcjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gV2UgZXh0cmFjdCBlcnJvciBmcm9tIHN0YXR1c1RleHQKICAgICAgICAgIC8vIHRoZW4gbm9ybWFsaXplIHN0YXR1c1RleHQgYW5kIHN0YXR1cyBmb3Igbm9uLWFib3J0cwogICAgICAgICAgZXJyb3IgPSBzdGF0dXNUZXh0OwoKICAgICAgICAgIGlmIChzdGF0dXMgfHwgIXN0YXR1c1RleHQpIHsKICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJlcnJvciI7CgogICAgICAgICAgICBpZiAoc3RhdHVzIDwgMCkgewogICAgICAgICAgICAgIHN0YXR1cyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgoKICAgICAgICBqcVhIUi5zdGF0dXMgPSBzdGF0dXM7CiAgICAgICAganFYSFIuc3RhdHVzVGV4dCA9IChuYXRpdmVTdGF0dXNUZXh0IHx8IHN0YXR1c1RleHQpICsgIiI7IC8vIFN1Y2Nlc3MvRXJyb3IKCiAgICAgICAgaWYgKGlzU3VjY2VzcykgewogICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoY2FsbGJhY2tDb250ZXh0LCBbc3VjY2Vzcywgc3RhdHVzVGV4dCwganFYSFJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVmZXJyZWQucmVqZWN0V2l0aChjYWxsYmFja0NvbnRleHQsIFtqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3JdKTsKICAgICAgICB9IC8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgoKICAgICAgICBqcVhIUi5zdGF0dXNDb2RlKF9zdGF0dXNDb2RlKTsKICAgICAgICBfc3RhdHVzQ29kZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgaWYgKGZpcmVHbG9iYWxzKSB7CiAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlcihpc1N1Y2Nlc3MgPyAiYWpheFN1Y2Nlc3MiIDogImFqYXhFcnJvciIsIFtqcVhIUiwgcywgaXNTdWNjZXNzID8gc3VjY2VzcyA6IGVycm9yXSk7CiAgICAgICAgfSAvLyBDb21wbGV0ZQoKCiAgICAgICAgY29tcGxldGVEZWZlcnJlZC5maXJlV2l0aChjYWxsYmFja0NvbnRleHQsIFtqcVhIUiwgc3RhdHVzVGV4dF0pOwoKICAgICAgICBpZiAoZmlyZUdsb2JhbHMpIHsKICAgICAgICAgIGdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCJhamF4Q29tcGxldGUiLCBbanFYSFIsIHNdKTsgLy8gSGFuZGxlIHRoZSBnbG9iYWwgQUpBWCBjb3VudGVyCgogICAgICAgICAgaWYgKCEgLS1qUXVlcnkuYWN0aXZlKSB7CiAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGpxWEhSOwogICAgfSwKICAgIGdldFNjcmlwdDogZnVuY3Rpb24gZ2V0U2NyaXB0KHVybCwgY2FsbGJhY2spIHsKICAgICAgcmV0dXJuIGpRdWVyeS5nZXQodXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0Iik7CiAgICB9LAogICAgZ2V0SlNPTjogZnVuY3Rpb24gZ2V0SlNPTih1cmwsIGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiBqUXVlcnkuZ2V0KHVybCwgZGF0YSwgY2FsbGJhY2ssICJqc29uIik7CiAgICB9CiAgfSk7CiAgLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0Og0KICAgKiAtIHNldHMgYWxsIHJlc3BvbnNlWFhYIGZpZWxkcyBhY2NvcmRpbmdseQ0KICAgKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQ0KICAgKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UNCiAgICovCgogIGZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMocywganFYSFIsIHJlc3BvbnNlcykgewogICAgdmFyIGZpcnN0RGF0YVR5cGUsCiAgICAgICAgY3QsCiAgICAgICAgZmluYWxEYXRhVHlwZSwKICAgICAgICB0eXBlLAogICAgICAgIGNvbnRlbnRzID0gcy5jb250ZW50cywKICAgICAgICBkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcywKICAgICAgICByZXNwb25zZUZpZWxkcyA9IHMucmVzcG9uc2VGaWVsZHM7IC8vIEZpbGwgcmVzcG9uc2VYWFggZmllbGRzCgogICAgZm9yICh0eXBlIGluIHJlc3BvbnNlRmllbGRzKSB7CiAgICAgIGlmICh0eXBlIGluIHJlc3BvbnNlcykgewogICAgICAgIGpxWEhSW3Jlc3BvbnNlRmllbGRzW3R5cGVdXSA9IHJlc3BvbnNlc1t0eXBlXTsKICAgICAgfQogICAgfSAvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoKCiAgICB3aGlsZSAoZGF0YVR5cGVzWzBdID09PSAiKiIpIHsKICAgICAgZGF0YVR5cGVzLnNoaWZ0KCk7CgogICAgICBpZiAoY3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGN0ID0gcy5taW1lVHlwZSB8fCBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIik7CiAgICAgIH0KICAgIH0gLy8gQ2hlY2sgaWYgd2UncmUgZGVhbGluZyB3aXRoIGEga25vd24gY29udGVudC10eXBlCgoKICAgIGlmIChjdCkgewogICAgICBmb3IgKHR5cGUgaW4gY29udGVudHMpIHsKICAgICAgICBpZiAoY29udGVudHNbdHlwZV0gJiYgY29udGVudHNbdHlwZV0udGVzdChjdCkpIHsKICAgICAgICAgIGRhdGFUeXBlcy51bnNoaWZ0KHR5cGUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQoKCiAgICBpZiAoZGF0YVR5cGVzWzBdIGluIHJlc3BvbnNlcykgewogICAgICBmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWzBdOwogICAgfSBlbHNlIHsKICAgICAgLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwogICAgICBmb3IgKHR5cGUgaW4gcmVzcG9uc2VzKSB7CiAgICAgICAgaWYgKCFkYXRhVHlwZXNbMF0gfHwgcy5jb252ZXJ0ZXJzW3R5cGUgKyAiICIgKyBkYXRhVHlwZXNbMF1dKSB7CiAgICAgICAgICBmaW5hbERhdGFUeXBlID0gdHlwZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmaXJzdERhdGFUeXBlKSB7CiAgICAgICAgICBmaXJzdERhdGFUeXBlID0gdHlwZTsKICAgICAgICB9CiAgICAgIH0gLy8gT3IganVzdCB1c2UgZmlyc3Qgb25lCgoKICAgICAgZmluYWxEYXRhVHlwZSA9IGZpbmFsRGF0YVR5cGUgfHwgZmlyc3REYXRhVHlwZTsKICAgIH0gLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQogICAgLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKICAgIC8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCgogICAgaWYgKGZpbmFsRGF0YVR5cGUpIHsKICAgICAgaWYgKGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1swXSkgewogICAgICAgIGRhdGFUeXBlcy51bnNoaWZ0KGZpbmFsRGF0YVR5cGUpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzcG9uc2VzW2ZpbmFsRGF0YVR5cGVdOwogICAgfQogIH0gLy8gQ2hhaW4gY29udmVyc2lvbnMgZ2l2ZW4gdGhlIHJlcXVlc3QgYW5kIHRoZSBvcmlnaW5hbCByZXNwb25zZQoKCiAgZnVuY3Rpb24gYWpheENvbnZlcnQocywgcmVzcG9uc2UpIHsKICAgIHZhciBjb252MiwKICAgICAgICBjdXJyZW50LAogICAgICAgIGNvbnYsCiAgICAgICAgdG1wLAogICAgICAgIGNvbnZlcnRlcnMgPSB7fSwKICAgICAgICBpID0gMCwKICAgICAgICAvLyBXb3JrIHdpdGggYSBjb3B5IG9mIGRhdGFUeXBlcyBpbiBjYXNlIHdlIG5lZWQgdG8gbW9kaWZ5IGl0IGZvciBjb252ZXJzaW9uCiAgICBkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpLAogICAgICAgIHByZXYgPSBkYXRhVHlwZXNbMF07IC8vIEFwcGx5IHRoZSBkYXRhRmlsdGVyIGlmIHByb3ZpZGVkCgogICAgaWYgKHMuZGF0YUZpbHRlcikgewogICAgICByZXNwb25zZSA9IHMuZGF0YUZpbHRlcihyZXNwb25zZSwgcy5kYXRhVHlwZSk7CiAgICB9IC8vIENyZWF0ZSBjb252ZXJ0ZXJzIG1hcCB3aXRoIGxvd2VyY2FzZWQga2V5cwoKCiAgICBpZiAoZGF0YVR5cGVzWzFdKSB7CiAgICAgIGZvciAoY29udiBpbiBzLmNvbnZlcnRlcnMpIHsKICAgICAgICBjb252ZXJ0ZXJzW2NvbnYudG9Mb3dlckNhc2UoKV0gPSBzLmNvbnZlcnRlcnNbY29udl07CiAgICAgIH0KICAgIH0gLy8gQ29udmVydCB0byBlYWNoIHNlcXVlbnRpYWwgZGF0YVR5cGUsIHRvbGVyYXRpbmcgbGlzdCBtb2RpZmljYXRpb24KCgogICAgZm9yICg7IGN1cnJlbnQgPSBkYXRhVHlwZXNbKytpXTspIHsKICAgICAgLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwogICAgICBpZiAoY3VycmVudCAhPT0gIioiKSB7CiAgICAgICAgLy8gQ29udmVydCByZXNwb25zZSBpZiBwcmV2IGRhdGFUeXBlIGlzIG5vbi1hdXRvIGFuZCBkaWZmZXJzIGZyb20gY3VycmVudAogICAgICAgIGlmIChwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCkgewogICAgICAgICAgLy8gU2VlayBhIGRpcmVjdCBjb252ZXJ0ZXIKICAgICAgICAgIGNvbnYgPSBjb252ZXJ0ZXJzW3ByZXYgKyAiICIgKyBjdXJyZW50XSB8fCBjb252ZXJ0ZXJzWyIqICIgKyBjdXJyZW50XTsgLy8gSWYgbm9uZSBmb3VuZCwgc2VlayBhIHBhaXIKCiAgICAgICAgICBpZiAoIWNvbnYpIHsKICAgICAgICAgICAgZm9yIChjb252MiBpbiBjb252ZXJ0ZXJzKSB7CiAgICAgICAgICAgICAgLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CiAgICAgICAgICAgICAgdG1wID0gY29udjIuc3BsaXQoIiAiKTsKCiAgICAgICAgICAgICAgaWYgKHRtcFsxXSA9PT0gY3VycmVudCkgewogICAgICAgICAgICAgICAgLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CiAgICAgICAgICAgICAgICBjb252ID0gY29udmVydGVyc1twcmV2ICsgIiAiICsgdG1wWzBdXSB8fCBjb252ZXJ0ZXJzWyIqICIgKyB0bXBbMF1dOwoKICAgICAgICAgICAgICAgIGlmIChjb252KSB7CiAgICAgICAgICAgICAgICAgIC8vIENvbmRlbnNlIGVxdWl2YWxlbmNlIGNvbnZlcnRlcnMKICAgICAgICAgICAgICAgICAgaWYgKGNvbnYgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBjb252ID0gY29udmVydGVyc1tjb252Ml07IC8vIE90aGVyd2lzZSwgaW5zZXJ0IHRoZSBpbnRlcm1lZGlhdGUgZGF0YVR5cGUKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb252ZXJ0ZXJzW2NvbnYyXSAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSB0bXBbMF07CiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGVzLnNwbGljZShpLS0sIDAsIGN1cnJlbnQpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gQXBwbHkgY29udmVydGVyIChpZiBub3QgYW4gZXF1aXZhbGVuY2UpCgoKICAgICAgICAgIGlmIChjb252ICE9PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIFVubGVzcyBlcnJvcnMgYXJlIGFsbG93ZWQgdG8gYnViYmxlLCBjYXRjaCBhbmQgcmV0dXJuIHRoZW0KICAgICAgICAgICAgaWYgKGNvbnYgJiYgc1sidGhyb3dzIl0pIHsKICAgICAgICAgICAgICByZXNwb25zZSA9IGNvbnYocmVzcG9uc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGNvbnYocmVzcG9uc2UpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAicGFyc2VyZXJyb3IiLAogICAgICAgICAgICAgICAgICBlcnJvcjogY29udiA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBwcmV2ICsgIiB0byAiICsgY3VycmVudAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vIFVwZGF0ZSBwcmV2IGZvciBuZXh0IGl0ZXJhdGlvbgoKCiAgICAgICAgcHJldiA9IGN1cnJlbnQ7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBzdGF0ZTogInN1Y2Nlc3MiLAogICAgICBkYXRhOiByZXNwb25zZQogICAgfTsKICB9IC8vIEluc3RhbGwgc2NyaXB0IGRhdGFUeXBlCgoKICBqUXVlcnkuYWpheFNldHVwKHsKICAgIGFjY2VwdHM6IHsKICAgICAgc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiCiAgICB9LAogICAgY29udGVudHM6IHsKICAgICAgc2NyaXB0OiAvKD86amF2YXxlY21hKXNjcmlwdC8KICAgIH0sCiAgICBjb252ZXJ0ZXJzOiB7CiAgICAgICJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uIHRleHRTY3JpcHQodGV4dCkgewogICAgICAgIGpRdWVyeS5nbG9iYWxFdmFsKHRleHQpOwogICAgICAgIHJldHVybiB0ZXh0OwogICAgICB9CiAgICB9CiAgfSk7IC8vIEhhbmRsZSBjYWNoZSdzIHNwZWNpYWwgY2FzZSBhbmQgZ2xvYmFsCgogIGpRdWVyeS5hamF4UHJlZmlsdGVyKCJzY3JpcHQiLCBmdW5jdGlvbiAocykgewogICAgaWYgKHMuY2FjaGUgPT09IHVuZGVmaW5lZCkgewogICAgICBzLmNhY2hlID0gZmFsc2U7CiAgICB9CgogICAgaWYgKHMuY3Jvc3NEb21haW4pIHsKICAgICAgcy50eXBlID0gIkdFVCI7CiAgICAgIHMuZ2xvYmFsID0gZmFsc2U7CiAgICB9CiAgfSk7IC8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydAoKICBqUXVlcnkuYWpheFRyYW5zcG9ydCgic2NyaXB0IiwgZnVuY3Rpb24gKHMpIHsKICAgIC8vIFRoaXMgdHJhbnNwb3J0IG9ubHkgZGVhbHMgd2l0aCBjcm9zcyBkb21haW4gcmVxdWVzdHMKICAgIGlmIChzLmNyb3NzRG9tYWluKSB7CiAgICAgIHZhciBzY3JpcHQsCiAgICAgICAgICBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBqUXVlcnkoImhlYWQiKVswXSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgIHJldHVybiB7CiAgICAgICAgc2VuZDogZnVuY3Rpb24gc2VuZChfLCBjYWxsYmFjaykgewogICAgICAgICAgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlOwoKICAgICAgICAgIGlmIChzLnNjcmlwdENoYXJzZXQpIHsKICAgICAgICAgICAgc2NyaXB0LmNoYXJzZXQgPSBzLnNjcmlwdENoYXJzZXQ7CiAgICAgICAgICB9CgogICAgICAgICAgc2NyaXB0LnNyYyA9IHMudXJsOyAvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoKICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKF8sIGlzQWJvcnQpIHsKICAgICAgICAgICAgaWYgKGlzQWJvcnQgfHwgIXNjcmlwdC5yZWFkeVN0YXRlIHx8IC9sb2FkZWR8Y29tcGxldGUvLnRlc3Qoc2NyaXB0LnJlYWR5U3RhdGUpKSB7CiAgICAgICAgICAgICAgLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCiAgICAgICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsOyAvLyBSZW1vdmUgdGhlIHNjcmlwdAoKICAgICAgICAgICAgICBpZiAoc2NyaXB0LnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgICAgICAgICAgICAgfSAvLyBEZXJlZmVyZW5jZSB0aGUgc2NyaXB0CgoKICAgICAgICAgICAgICBzY3JpcHQgPSBudWxsOyAvLyBDYWxsYmFjayBpZiBub3QgYWJvcnQKCiAgICAgICAgICAgICAgaWYgKCFpc0Fib3J0KSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygyMDAsICJzdWNjZXNzIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OyAvLyBDaXJjdW12ZW50IElFNiBidWdzIHdpdGggYmFzZSBlbGVtZW50cyAoIzI3MDkgYW5kICM0Mzc4KSBieSBwcmVwZW5kaW5nCiAgICAgICAgICAvLyBVc2UgbmF0aXZlIERPTSBtYW5pcHVsYXRpb24gdG8gYXZvaWQgb3VyIGRvbU1hbmlwIEFKQVggdHJpY2tlcnkKCgogICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoc2NyaXB0LCBoZWFkLmZpcnN0Q2hpbGQpOwogICAgICAgIH0sCiAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgICAgaWYgKHNjcmlwdCkgewogICAgICAgICAgICBzY3JpcHQub25sb2FkKHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pOwogIHZhciBvbGRDYWxsYmFja3MgPSBbXSwKICAgICAgcmpzb25wID0gLyg9KVw/KD89JnwkKXxcP1w/LzsgLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwoKICBqUXVlcnkuYWpheFNldHVwKHsKICAgIGpzb25wOiAiY2FsbGJhY2siLAogICAganNvbnBDYWxsYmFjazogZnVuY3Rpb24ganNvbnBDYWxsYmFjaygpIHsKICAgICAgdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8IGpRdWVyeS5leHBhbmRvICsgIl8iICsgYWpheF9ub25jZSsrOwogICAgICB0aGlzW2NhbGxiYWNrXSA9IHRydWU7CiAgICAgIHJldHVybiBjYWxsYmFjazsKICAgIH0KICB9KTsgLy8gRGV0ZWN0LCBub3JtYWxpemUgb3B0aW9ucyBhbmQgaW5zdGFsbCBjYWxsYmFja3MgZm9yIGpzb25wIHJlcXVlc3RzCgogIGpRdWVyeS5hamF4UHJlZmlsdGVyKCJqc29uIGpzb25wIiwgZnVuY3Rpb24gKHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSKSB7CiAgICB2YXIgY2FsbGJhY2tOYW1lLAogICAgICAgIG92ZXJ3cml0dGVuLAogICAgICAgIHJlc3BvbnNlQ29udGFpbmVyLAogICAgICAgIGpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKHJqc29ucC50ZXN0KHMudXJsKSA/ICJ1cmwiIDogdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgIShzLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiByanNvbnAudGVzdChzLmRhdGEpICYmICJkYXRhIik7IC8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CgogICAgaWYgKGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWzBdID09PSAianNvbnAiKSB7CiAgICAgIC8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKICAgICAgY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0galF1ZXJ5LmlzRnVuY3Rpb24ocy5qc29ucENhbGxiYWNrKSA/IHMuanNvbnBDYWxsYmFjaygpIDogcy5qc29ucENhbGxiYWNrOyAvLyBJbnNlcnQgY2FsbGJhY2sgaW50byB1cmwgb3IgZm9ybSBkYXRhCgogICAgICBpZiAoanNvblByb3ApIHsKICAgICAgICBzW2pzb25Qcm9wXSA9IHNbanNvblByb3BdLnJlcGxhY2Uocmpzb25wLCAiJDEiICsgY2FsbGJhY2tOYW1lKTsKICAgICAgfSBlbHNlIGlmIChzLmpzb25wICE9PSBmYWxzZSkgewogICAgICAgIHMudXJsICs9IChhamF4X3JxdWVyeS50ZXN0KHMudXJsKSA/ICImIiA6ICI/IikgKyBzLmpzb25wICsgIj0iICsgY2FsbGJhY2tOYW1lOwogICAgICB9IC8vIFVzZSBkYXRhIGNvbnZlcnRlciB0byByZXRyaWV2ZSBqc29uIGFmdGVyIHNjcmlwdCBleGVjdXRpb24KCgogICAgICBzLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFyZXNwb25zZUNvbnRhaW5lcikgewogICAgICAgICAgalF1ZXJ5LmVycm9yKGNhbGxiYWNrTmFtZSArICIgd2FzIG5vdCBjYWxsZWQiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXNwb25zZUNvbnRhaW5lclswXTsKICAgICAgfTsgLy8gZm9yY2UganNvbiBkYXRhVHlwZQoKCiAgICAgIHMuZGF0YVR5cGVzWzBdID0gImpzb24iOyAvLyBJbnN0YWxsIGNhbGxiYWNrCgogICAgICBvdmVyd3JpdHRlbiA9IHdpbmRvd1tjYWxsYmFja05hbWVdOwoKICAgICAgd2luZG93W2NhbGxiYWNrTmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVzcG9uc2VDb250YWluZXIgPSBhcmd1bWVudHM7CiAgICAgIH07IC8vIENsZWFuLXVwIGZ1bmN0aW9uIChmaXJlcyBhZnRlciBjb252ZXJ0ZXJzKQoKCiAgICAgIGpxWEhSLmFsd2F5cyhmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gUmVzdG9yZSBwcmVleGlzdGluZyB2YWx1ZQogICAgICAgIHdpbmRvd1tjYWxsYmFja05hbWVdID0gb3ZlcndyaXR0ZW47IC8vIFNhdmUgYmFjayBhcyBmcmVlCgogICAgICAgIGlmIChzW2NhbGxiYWNrTmFtZV0pIHsKICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHJlLXVzaW5nIHRoZSBvcHRpb25zIGRvZXNuJ3Qgc2NyZXcgdGhpbmdzIGFyb3VuZAogICAgICAgICAgcy5qc29ucENhbGxiYWNrID0gb3JpZ2luYWxTZXR0aW5ncy5qc29ucENhbGxiYWNrOyAvLyBzYXZlIHRoZSBjYWxsYmFjayBuYW1lIGZvciBmdXR1cmUgdXNlCgogICAgICAgICAgb2xkQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2tOYW1lKTsKICAgICAgICB9IC8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQoKCiAgICAgICAgaWYgKHJlc3BvbnNlQ29udGFpbmVyICYmIGpRdWVyeS5pc0Z1bmN0aW9uKG92ZXJ3cml0dGVuKSkgewogICAgICAgICAgb3ZlcndyaXR0ZW4ocmVzcG9uc2VDb250YWluZXJbMF0pOwogICAgICAgIH0KCiAgICAgICAgcmVzcG9uc2VDb250YWluZXIgPSBvdmVyd3JpdHRlbiA9IHVuZGVmaW5lZDsKICAgICAgfSk7IC8vIERlbGVnYXRlIHRvIHNjcmlwdAoKICAgICAgcmV0dXJuICJzY3JpcHQiOwogICAgfQogIH0pOwoKICB2YXIgeGhyQ2FsbGJhY2tzLAogICAgICB4aHJTdXBwb3J0ZWQsCiAgICAgIHhocklkID0gMCwKICAgICAgLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKICB4aHJPblVubG9hZEFib3J0ID0gd2luZG93LkFjdGl2ZVhPYmplY3QgJiYgZnVuY3Rpb24gKCkgewogICAgLy8gQWJvcnQgYWxsIHBlbmRpbmcgcmVxdWVzdHMKICAgIHZhciBrZXk7CgogICAgZm9yIChrZXkgaW4geGhyQ2FsbGJhY2tzKSB7CiAgICAgIHhockNhbGxiYWNrc1trZXldKHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICB9CiAgfTsgLy8gRnVuY3Rpb25zIHRvIGNyZWF0ZSB4aHJzCgoKICBmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KCk7CiAgICB9IGNhdGNoIChlKSB7fQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQWN0aXZlWEhSKCkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfSAvLyBDcmVhdGUgdGhlIHJlcXVlc3Qgb2JqZWN0CiAgLy8gKFRoaXMgaXMgc3RpbGwgYXR0YWNoZWQgdG8gYWpheFNldHRpbmdzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KQoKCiAgalF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCA/CiAgLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQ0KICAgKiBpbXBsZW1lbnQgdGhlIFhNTEh0dHBSZXF1ZXN0IGluIElFNyAoY2FuJ3QgcmVxdWVzdCBsb2NhbCBmaWxlcyksDQogICAqIHNvIHdlIHVzZSB0aGUgQWN0aXZlWE9iamVjdCB3aGVuIGl0IGlzIGF2YWlsYWJsZQ0KICAgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28NCiAgICogd2UgbmVlZCBhIGZhbGxiYWNrLg0KICAgKi8KICBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gIXRoaXMuaXNMb2NhbCAmJiBjcmVhdGVTdGFuZGFyZFhIUigpIHx8IGNyZWF0ZUFjdGl2ZVhIUigpOwogIH0gOiAvLyBGb3IgYWxsIG90aGVyIGJyb3dzZXJzLCB1c2UgdGhlIHN0YW5kYXJkIFhNTEh0dHBSZXF1ZXN0IG9iamVjdAogIGNyZWF0ZVN0YW5kYXJkWEhSOyAvLyBEZXRlcm1pbmUgc3VwcG9ydCBwcm9wZXJ0aWVzCgogIHhoclN1cHBvcnRlZCA9IGpRdWVyeS5hamF4U2V0dGluZ3MueGhyKCk7CiAgalF1ZXJ5LnN1cHBvcnQuY29ycyA9ICEheGhyU3VwcG9ydGVkICYmICJ3aXRoQ3JlZGVudGlhbHMiIGluIHhoclN1cHBvcnRlZDsKICB4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuc3VwcG9ydC5hamF4ID0gISF4aHJTdXBwb3J0ZWQ7IC8vIENyZWF0ZSB0cmFuc3BvcnQgaWYgdGhlIGJyb3dzZXIgY2FuIHByb3ZpZGUgYW4geGhyCgogIGlmICh4aHJTdXBwb3J0ZWQpIHsKICAgIGpRdWVyeS5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uIChzKSB7CiAgICAgIC8vIENyb3NzIGRvbWFpbiBvbmx5IGFsbG93ZWQgaWYgc3VwcG9ydGVkIHRocm91Z2ggWE1MSHR0cFJlcXVlc3QKICAgICAgaWYgKCFzLmNyb3NzRG9tYWluIHx8IGpRdWVyeS5zdXBwb3J0LmNvcnMpIHsKICAgICAgICB2YXIgX2NhbGxiYWNrOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2VuZDogZnVuY3Rpb24gc2VuZChoZWFkZXJzLCBjb21wbGV0ZSkgewogICAgICAgICAgICAvLyBHZXQgYSBuZXcgeGhyCiAgICAgICAgICAgIHZhciBoYW5kbGUsCiAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgeGhyID0gcy54aHIoKTsgLy8gT3BlbiB0aGUgc29ja2V0CiAgICAgICAgICAgIC8vIFBhc3NpbmcgbnVsbCB1c2VybmFtZSwgZ2VuZXJhdGVzIGEgbG9naW4gcG9wdXAgb24gT3BlcmEgKCMyODY1KQoKICAgICAgICAgICAgaWYgKHMudXNlcm5hbWUpIHsKICAgICAgICAgICAgICB4aHIub3BlbihzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB4aHIub3BlbihzLnR5cGUsIHMudXJsLCBzLmFzeW5jKTsKICAgICAgICAgICAgfSAvLyBBcHBseSBjdXN0b20gZmllbGRzIGlmIHByb3ZpZGVkCgoKICAgICAgICAgICAgaWYgKHMueGhyRmllbGRzKSB7CiAgICAgICAgICAgICAgZm9yIChpIGluIHMueGhyRmllbGRzKSB7CiAgICAgICAgICAgICAgICB4aHJbaV0gPSBzLnhockZpZWxkc1tpXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZAoKCiAgICAgICAgICAgIGlmIChzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlKSB7CiAgICAgICAgICAgICAgeGhyLm92ZXJyaWRlTWltZVR5cGUocy5taW1lVHlwZSk7CiAgICAgICAgICAgIH0gLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKICAgICAgICAgICAgLy8gRm9yIGNyb3NzLWRvbWFpbiByZXF1ZXN0cywgc2VlaW5nIGFzIGNvbmRpdGlvbnMgZm9yIGEgcHJlZmxpZ2h0IGFyZQogICAgICAgICAgICAvLyBha2luIHRvIGEgamlnc2F3IHB1enpsZSwgd2Ugc2ltcGx5IG5ldmVyIHNldCBpdCB0byBiZSBzdXJlLgogICAgICAgICAgICAvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKICAgICAgICAgICAgLy8gRm9yIHNhbWUtZG9tYWluIHJlcXVlc3RzLCB3b24ndCBjaGFuZ2UgaGVhZGVyIGlmIGFscmVhZHkgcHJvdmlkZWQuCgoKICAgICAgICAgICAgaWYgKCFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0pIHsKICAgICAgICAgICAgICBoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiOwogICAgICAgICAgICB9IC8vIE5lZWQgYW4gZXh0cmEgdHJ5L2NhdGNoIGZvciBjcm9zcyBkb21haW4gcmVxdWVzdHMgaW4gRmlyZWZveCAzCgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKGkgaW4gaGVhZGVycykgewogICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaSwgaGVhZGVyc1tpXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9IC8vIERvIHNlbmQgdGhlIHJlcXVlc3QKICAgICAgICAgICAgLy8gVGhpcyBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uIHdoaWNoIGlzIGFjdHVhbGx5CiAgICAgICAgICAgIC8vIGhhbmRsZWQgaW4galF1ZXJ5LmFqYXggKHNvIG5vIHRyeS9jYXRjaCBoZXJlKQoKCiAgICAgICAgICAgIHhoci5zZW5kKHMuaGFzQ29udGVudCAmJiBzLmRhdGEgfHwgbnVsbCk7IC8vIExpc3RlbmVyCgogICAgICAgICAgICBfY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayhfLCBpc0Fib3J0KSB7CiAgICAgICAgICAgICAgdmFyIHN0YXR1cywgcmVzcG9uc2VIZWFkZXJzLCBzdGF0dXNUZXh0LCByZXNwb25zZXM7IC8vIEZpcmVmb3ggdGhyb3dzIGV4Y2VwdGlvbnMgd2hlbiBhY2Nlc3NpbmcgcHJvcGVydGllcwogICAgICAgICAgICAgIC8vIG9mIGFuIHhociB3aGVuIGEgbmV0d29yayBlcnJvciBvY2N1cnJlZAogICAgICAgICAgICAgIC8vIGh0dHA6Ly9oZWxwZnVsLmtub2JzLWRpYWxzLmNvbS9pbmRleC5waHAvQ29tcG9uZW50X3JldHVybmVkX2ZhaWx1cmVfY29kZTpfMHg4MDA0MDExMV8oTlNfRVJST1JfTk9UX0FWQUlMQUJMRSkKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdhcyBuZXZlciBjYWxsZWQgYW5kIGlzIGFib3J0ZWQgb3IgY29tcGxldGUKICAgICAgICAgICAgICAgIGlmIChfY2FsbGJhY2sgJiYgKGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQpKSB7CiAgICAgICAgICAgICAgICAgIC8vIE9ubHkgY2FsbGVkIG9uY2UKICAgICAgICAgICAgICAgICAgX2NhbGxiYWNrID0gdW5kZWZpbmVkOyAvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoKICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBqUXVlcnkubm9vcDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHhock9uVW5sb2FkQWJvcnQpIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB4aHJDYWxsYmFja3NbaGFuZGxlXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gLy8gSWYgaXQncyBhbiBhYm9ydAoKCiAgICAgICAgICAgICAgICAgIGlmIChpc0Fib3J0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQWJvcnQgaXQgbWFudWFsbHkgaWYgbmVlZGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VzID0ge307CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0geGhyLnN0YXR1czsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnMgPSB4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7IC8vIFdoZW4gcmVxdWVzdGluZyBiaW5hcnkgZGF0YSwgSUU2LTkgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAvLyBvbiBhbnkgYXR0ZW1wdCB0byBhY2Nlc3MgcmVzcG9uc2VUZXh0ICgjMTE0MjYpCgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgeGhyLnJlc3BvbnNlVGV4dCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgICAgICB9IC8vIEZpcmVmb3ggdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwogICAgICAgICAgICAgICAgICAgIC8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0geGhyLnN0YXR1c1RleHQ7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugbm9ybWFsaXplIHdpdGggV2Via2l0IGdpdmluZyBhbiBlbXB0eSBzdGF0dXNUZXh0CiAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSAvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgbG9jYWwgYW5kIHdlIGhhdmUgZGF0YTogYXNzdW1lIGEgc3VjY2VzcwogICAgICAgICAgICAgICAgICAgIC8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGNhbiBkbyBnaXZlbiBjdXJyZW50IGltcGxlbWVudGF0aW9ucykKCgogICAgICAgICAgICAgICAgICAgIGlmICghc3RhdHVzICYmIHMuaXNMb2NhbCAmJiAhcy5jcm9zc0RvbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcmVzcG9uc2VzLnRleHQgPyAyMDAgOiA0MDQ7IC8vIElFIC0gIzE0NTA6IHNvbWV0aW1lcyByZXR1cm5zIDEyMjMgd2hlbiBpdCBzaG91bGQgYmUgMjA0CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDEyMjMpIHsKICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IDIwNDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChmaXJlZm94QWNjZXNzRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzQWJvcnQpIHsKICAgICAgICAgICAgICAgICAgY29tcGxldGUoLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCgogICAgICAgICAgICAgIGlmIChyZXNwb25zZXMpIHsKICAgICAgICAgICAgICAgIGNvbXBsZXRlKHN0YXR1cywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzLCByZXNwb25zZUhlYWRlcnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmICghcy5hc3luYykgewogICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHN5bmMgbW9kZSB3ZSBmaXJlIHRoZSBjYWxsYmFjawogICAgICAgICAgICAgIF9jYWxsYmFjaygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICAgICAgLy8gKElFNiAmIElFNykgaWYgaXQncyBpbiBjYWNoZSBhbmQgaGFzIGJlZW4KICAgICAgICAgICAgICAvLyByZXRyaWV2ZWQgZGlyZWN0bHkgd2UgbmVlZCB0byBmaXJlIHRoZSBjYWxsYmFjawogICAgICAgICAgICAgIHNldFRpbWVvdXQoX2NhbGxiYWNrKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBoYW5kbGUgPSArK3hocklkOwoKICAgICAgICAgICAgICBpZiAoeGhyT25VbmxvYWRBYm9ydCkgewogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKICAgICAgICAgICAgICAgIC8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCiAgICAgICAgICAgICAgICBpZiAoIXhockNhbGxiYWNrcykgewogICAgICAgICAgICAgICAgICB4aHJDYWxsYmFja3MgPSB7fTsKICAgICAgICAgICAgICAgICAgalF1ZXJ5KHdpbmRvdykudW5sb2FkKHhock9uVW5sb2FkQWJvcnQpOwogICAgICAgICAgICAgICAgfSAvLyBBZGQgdG8gbGlzdCBvZiBhY3RpdmUgeGhycyBjYWxsYmFja3MKCgogICAgICAgICAgICAgICAgeGhyQ2FsbGJhY2tzW2hhbmRsZV0gPSBfY2FsbGJhY2s7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gX2NhbGxiYWNrOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgICAgICBpZiAoX2NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgX2NhbGxiYWNrKHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICB9CgogIHZhciBmeE5vdywKICAgICAgdGltZXJJZCwKICAgICAgcmZ4dHlwZXMgPSAvXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sCiAgICAgIHJmeG51bSA9IG5ldyBSZWdFeHAoIl4oPzooWystXSk9fCkoIiArIGNvcmVfcG51bSArICIpKFthLXolXSopJCIsICJpIiksCiAgICAgIHJydW4gPSAvcXVldWVIb29rcyQvLAogICAgICBhbmltYXRpb25QcmVmaWx0ZXJzID0gW2RlZmF1bHRQcmVmaWx0ZXJdLAogICAgICB0d2VlbmVycyA9IHsKICAgICIqIjogW2Z1bmN0aW9uIChwcm9wLCB2YWx1ZSkgewogICAgICB2YXIgZW5kLAogICAgICAgICAgdW5pdCwKICAgICAgICAgIHR3ZWVuID0gdGhpcy5jcmVhdGVUd2Vlbihwcm9wLCB2YWx1ZSksCiAgICAgICAgICBwYXJ0cyA9IHJmeG51bS5leGVjKHZhbHVlKSwKICAgICAgICAgIHRhcmdldCA9IHR3ZWVuLmN1cigpLAogICAgICAgICAgc3RhcnQgPSArdGFyZ2V0IHx8IDAsCiAgICAgICAgICBzY2FsZSA9IDEsCiAgICAgICAgICBtYXhJdGVyYXRpb25zID0gMjA7CgogICAgICBpZiAocGFydHMpIHsKICAgICAgICBlbmQgPSArcGFydHNbMl07CiAgICAgICAgdW5pdCA9IHBhcnRzWzNdIHx8IChqUXVlcnkuY3NzTnVtYmVyW3Byb3BdID8gIiIgOiAicHgiKTsgLy8gV2UgbmVlZCB0byBjb21wdXRlIHN0YXJ0aW5nIHZhbHVlCgogICAgICAgIGlmICh1bml0ICE9PSAicHgiICYmIHN0YXJ0KSB7CiAgICAgICAgICAvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAogICAgICAgICAgLy8gUHJlZmVyIHRoZSBjdXJyZW50IHByb3BlcnR5LCBiZWNhdXNlIHRoaXMgcHJvY2VzcyB3aWxsIGJlIHRyaXZpYWwgaWYgaXQgdXNlcyB0aGUgc2FtZSB1bml0cwogICAgICAgICAgLy8gRmFsbGJhY2sgdG8gZW5kIG9yIGEgc2ltcGxlIGNvbnN0YW50CiAgICAgICAgICBzdGFydCA9IGpRdWVyeS5jc3ModHdlZW4uZWxlbSwgcHJvcCwgdHJ1ZSkgfHwgZW5kIHx8IDE7CgogICAgICAgICAgZG8gewogICAgICAgICAgICAvLyBJZiBwcmV2aW91cyBpdGVyYXRpb24gemVyb2VkIG91dCwgZG91YmxlIHVudGlsIHdlIGdldCAqc29tZXRoaW5nKgogICAgICAgICAgICAvLyBVc2UgYSBzdHJpbmcgZm9yIGRvdWJsaW5nIGZhY3RvciBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwogICAgICAgICAgICBzY2FsZSA9IHNjYWxlIHx8ICIuNSI7IC8vIEFkanVzdCBhbmQgYXBwbHkKCiAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgLyBzY2FsZTsKICAgICAgICAgICAgalF1ZXJ5LnN0eWxlKHR3ZWVuLmVsZW0sIHByb3AsIHN0YXJ0ICsgdW5pdCk7IC8vIFVwZGF0ZSBzY2FsZSwgdG9sZXJhdGluZyB6ZXJvIG9yIE5hTiBmcm9tIHR3ZWVuLmN1cigpCiAgICAgICAgICAgIC8vIEFuZCBicmVha2luZyB0aGUgbG9vcCBpZiBzY2FsZSBpcyB1bmNoYW5nZWQgb3IgcGVyZmVjdCwgb3IgaWYgd2UndmUganVzdCBoYWQgZW5vdWdoCiAgICAgICAgICB9IHdoaWxlIChzY2FsZSAhPT0gKHNjYWxlID0gdHdlZW4uY3VyKCkgLyB0YXJnZXQpICYmIHNjYWxlICE9PSAxICYmIC0tbWF4SXRlcmF0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICB0d2Vlbi51bml0ID0gdW5pdDsKICAgICAgICB0d2Vlbi5zdGFydCA9IHN0YXJ0OyAvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24KCiAgICAgICAgdHdlZW4uZW5kID0gcGFydHNbMV0gPyBzdGFydCArIChwYXJ0c1sxXSArIDEpICogZW5kIDogZW5kOwogICAgICB9CgogICAgICByZXR1cm4gdHdlZW47CiAgICB9XQogIH07IC8vIEFuaW1hdGlvbnMgY3JlYXRlZCBzeW5jaHJvbm91c2x5IHdpbGwgcnVuIHN5bmNocm9ub3VzbHkKCiAgZnVuY3Rpb24gY3JlYXRlRnhOb3coKSB7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgZnhOb3cgPSB1bmRlZmluZWQ7CiAgICB9KTsKICAgIHJldHVybiBmeE5vdyA9IGpRdWVyeS5ub3coKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVR3ZWVucyhhbmltYXRpb24sIHByb3BzKSB7CiAgICBqUXVlcnkuZWFjaChwcm9wcywgZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gKHR3ZWVuZXJzW3Byb3BdIHx8IFtdKS5jb25jYXQodHdlZW5lcnNbIioiXSksCiAgICAgICAgICBpbmRleCA9IDAsCiAgICAgICAgICBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCiAgICAgIGZvciAoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGlmIChjb2xsZWN0aW9uW2luZGV4XS5jYWxsKGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUpKSB7CiAgICAgICAgICAvLyB3ZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBBbmltYXRpb24oZWxlbSwgcHJvcGVydGllcywgb3B0aW9ucykgewogICAgdmFyIHJlc3VsdCwKICAgICAgICBzdG9wcGVkLAogICAgICAgIGluZGV4ID0gMCwKICAgICAgICBsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKICAgICAgICBkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyhmdW5jdGlvbiAoKSB7CiAgICAgIC8vIGRvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgogICAgICBkZWxldGUgdGljay5lbGVtOwogICAgfSksCiAgICAgICAgdGljayA9IGZ1bmN0aW9uIHRpY2soKSB7CiAgICAgIGlmIChzdG9wcGVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgY3VycmVudFRpbWUgPSBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAogICAgICAgICAgcmVtYWluaW5nID0gTWF0aC5tYXgoMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lKSwKICAgICAgICAgIC8vIGFyY2hhaWMgY3Jhc2ggYnVnIHdvbid0IGFsbG93IHVzIHRvIHVzZSAxIC0gKCAwLjUgfHwgMCApICgjMTI0OTcpCiAgICAgIHRlbXAgPSByZW1haW5pbmcgLyBhbmltYXRpb24uZHVyYXRpb24gfHwgMCwKICAgICAgICAgIHBlcmNlbnQgPSAxIC0gdGVtcCwKICAgICAgICAgIGluZGV4ID0gMCwKICAgICAgICAgIGxlbmd0aCA9IGFuaW1hdGlvbi50d2VlbnMubGVuZ3RoOwoKICAgICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgYW5pbWF0aW9uLnR3ZWVuc1tpbmRleF0ucnVuKHBlcmNlbnQpOwogICAgICB9CgogICAgICBkZWZlcnJlZC5ub3RpZnlXaXRoKGVsZW0sIFthbmltYXRpb24sIHBlcmNlbnQsIHJlbWFpbmluZ10pOwoKICAgICAgaWYgKHBlcmNlbnQgPCAxICYmIGxlbmd0aCkgewogICAgICAgIHJldHVybiByZW1haW5pbmc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoZWxlbSwgW2FuaW1hdGlvbl0pOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgICAgICBhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKICAgICAgZWxlbTogZWxlbSwKICAgICAgcHJvcHM6IGpRdWVyeS5leHRlbmQoe30sIHByb3BlcnRpZXMpLAogICAgICBvcHRzOiBqUXVlcnkuZXh0ZW5kKHRydWUsIHsKICAgICAgICBzcGVjaWFsRWFzaW5nOiB7fQogICAgICB9LCBvcHRpb25zKSwKICAgICAgb3JpZ2luYWxQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLAogICAgICBvcmlnaW5hbE9wdGlvbnM6IG9wdGlvbnMsCiAgICAgIHN0YXJ0VGltZTogZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwKICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sCiAgICAgIHR3ZWVuczogW10sCiAgICAgIGNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiBjcmVhdGVUd2Vlbihwcm9wLCBlbmQpIHsKICAgICAgICB2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oZWxlbSwgYW5pbWF0aW9uLm9wdHMsIHByb3AsIGVuZCwgYW5pbWF0aW9uLm9wdHMuc3BlY2lhbEVhc2luZ1twcm9wXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcpOwogICAgICAgIGFuaW1hdGlvbi50d2VlbnMucHVzaCh0d2Vlbik7CiAgICAgICAgcmV0dXJuIHR3ZWVuOwogICAgICB9LAogICAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKGdvdG9FbmQpIHsKICAgICAgICB2YXIgaW5kZXggPSAwLAogICAgICAgICAgICAvLyBpZiB3ZSBhcmUgZ29pbmcgdG8gdGhlIGVuZCwgd2Ugd2FudCB0byBydW4gYWxsIHRoZSB0d2VlbnMKICAgICAgICAvLyBvdGhlcndpc2Ugd2Ugc2tpcCB0aGlzIHBhcnQKICAgICAgICBsZW5ndGggPSBnb3RvRW5kID8gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGggOiAwOwoKICAgICAgICBpZiAoc3RvcHBlZCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBzdG9wcGVkID0gdHJ1ZTsKCiAgICAgICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBhbmltYXRpb24udHdlZW5zW2luZGV4XS5ydW4oMSk7CiAgICAgICAgfSAvLyByZXNvbHZlIHdoZW4gd2UgcGxheWVkIHRoZSBsYXN0IGZyYW1lCiAgICAgICAgLy8gb3RoZXJ3aXNlLCByZWplY3QKCgogICAgICAgIGlmIChnb3RvRW5kKSB7CiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlV2l0aChlbGVtLCBbYW5pbWF0aW9uLCBnb3RvRW5kXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmVycmVkLnJlamVjdFdpdGgoZWxlbSwgW2FuaW1hdGlvbiwgZ290b0VuZF0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH0pLAogICAgICAgIHByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKICAgIHByb3BGaWx0ZXIocHJvcHMsIGFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmcpOwoKICAgIGZvciAoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICByZXN1bHQgPSBhbmltYXRpb25QcmVmaWx0ZXJzW2luZGV4XS5jYWxsKGFuaW1hdGlvbiwgZWxlbSwgcHJvcHMsIGFuaW1hdGlvbi5vcHRzKTsKCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9CgogICAgY3JlYXRlVHdlZW5zKGFuaW1hdGlvbiwgcHJvcHMpOwoKICAgIGlmIChqUXVlcnkuaXNGdW5jdGlvbihhbmltYXRpb24ub3B0cy5zdGFydCkpIHsKICAgICAgYW5pbWF0aW9uLm9wdHMuc3RhcnQuY2FsbChlbGVtLCBhbmltYXRpb24pOwogICAgfQoKICAgIGpRdWVyeS5meC50aW1lcihqUXVlcnkuZXh0ZW5kKHRpY2ssIHsKICAgICAgZWxlbTogZWxlbSwKICAgICAgYW5pbTogYW5pbWF0aW9uLAogICAgICBxdWV1ZTogYW5pbWF0aW9uLm9wdHMucXVldWUKICAgIH0pKTsgLy8gYXR0YWNoIGNhbGxiYWNrcyBmcm9tIG9wdGlvbnMKCiAgICByZXR1cm4gYW5pbWF0aW9uLnByb2dyZXNzKGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzKS5kb25lKGFuaW1hdGlvbi5vcHRzLmRvbmUsIGFuaW1hdGlvbi5vcHRzLmNvbXBsZXRlKS5mYWlsKGFuaW1hdGlvbi5vcHRzLmZhaWwpLmFsd2F5cyhhbmltYXRpb24ub3B0cy5hbHdheXMpOwogIH0KCiAgZnVuY3Rpb24gcHJvcEZpbHRlcihwcm9wcywgc3BlY2lhbEVhc2luZykgewogICAgdmFyIHZhbHVlLCBuYW1lLCBpbmRleCwgZWFzaW5nLCBob29rczsgLy8gY2FtZWxDYXNlLCBzcGVjaWFsRWFzaW5nIGFuZCBleHBhbmQgY3NzSG9vayBwYXNzCgogICAgZm9yIChpbmRleCBpbiBwcm9wcykgewogICAgICBuYW1lID0galF1ZXJ5LmNhbWVsQ2FzZShpbmRleCk7CiAgICAgIGVhc2luZyA9IHNwZWNpYWxFYXNpbmdbbmFtZV07CiAgICAgIHZhbHVlID0gcHJvcHNbaW5kZXhdOwoKICAgICAgaWYgKGpRdWVyeS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgIGVhc2luZyA9IHZhbHVlWzFdOwogICAgICAgIHZhbHVlID0gcHJvcHNbaW5kZXhdID0gdmFsdWVbMF07CiAgICAgIH0KCiAgICAgIGlmIChpbmRleCAhPT0gbmFtZSkgewogICAgICAgIHByb3BzW25hbWVdID0gdmFsdWU7CiAgICAgICAgZGVsZXRlIHByb3BzW2luZGV4XTsKICAgICAgfQoKICAgICAgaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbbmFtZV07CgogICAgICBpZiAoaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MpIHsKICAgICAgICB2YWx1ZSA9IGhvb2tzLmV4cGFuZCh2YWx1ZSk7CiAgICAgICAgZGVsZXRlIHByb3BzW25hbWVdOyAvLyBub3QgcXVpdGUgJC5leHRlbmQsIHRoaXMgd29udCBvdmVyd3JpdGUga2V5cyBhbHJlYWR5IHByZXNlbnQuCiAgICAgICAgLy8gYWxzbyAtIHJldXNpbmcgJ2luZGV4JyBmcm9tIGFib3ZlIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCiAgICAgICAgZm9yIChpbmRleCBpbiB2YWx1ZSkgewogICAgICAgICAgaWYgKCEoaW5kZXggaW4gcHJvcHMpKSB7CiAgICAgICAgICAgIHByb3BzW2luZGV4XSA9IHZhbHVlW2luZGV4XTsKICAgICAgICAgICAgc3BlY2lhbEVhc2luZ1tpbmRleF0gPSBlYXNpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHNwZWNpYWxFYXNpbmdbbmFtZV0gPSBlYXNpbmc7CiAgICAgIH0KICAgIH0KICB9CgogIGpRdWVyeS5BbmltYXRpb24gPSBqUXVlcnkuZXh0ZW5kKEFuaW1hdGlvbiwgewogICAgdHdlZW5lcjogZnVuY3Rpb24gdHdlZW5lcihwcm9wcywgY2FsbGJhY2spIHsKICAgICAgaWYgKGpRdWVyeS5pc0Z1bmN0aW9uKHByb3BzKSkgewogICAgICAgIGNhbGxiYWNrID0gcHJvcHM7CiAgICAgICAgcHJvcHMgPSBbIioiXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9wcyA9IHByb3BzLnNwbGl0KCIgIik7CiAgICAgIH0KCiAgICAgIHZhciBwcm9wLAogICAgICAgICAgaW5kZXggPSAwLAogICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKICAgICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgcHJvcCA9IHByb3BzW2luZGV4XTsKICAgICAgICB0d2VlbmVyc1twcm9wXSA9IHR3ZWVuZXJzW3Byb3BdIHx8IFtdOwogICAgICAgIHR3ZWVuZXJzW3Byb3BdLnVuc2hpZnQoY2FsbGJhY2spOwogICAgICB9CiAgICB9LAogICAgcHJlZmlsdGVyOiBmdW5jdGlvbiBwcmVmaWx0ZXIoY2FsbGJhY2ssIHByZXBlbmQpIHsKICAgICAgaWYgKHByZXBlbmQpIHsKICAgICAgICBhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoY2FsbGJhY2spOwogICAgICB9IGVsc2UgewogICAgICAgIGFuaW1hdGlvblByZWZpbHRlcnMucHVzaChjYWxsYmFjayk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gZGVmYXVsdFByZWZpbHRlcihlbGVtLCBwcm9wcywgb3B0cykgewogICAgLypqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi8KICAgIHZhciBwcm9wLAogICAgICAgIGluZGV4LAogICAgICAgIGxlbmd0aCwKICAgICAgICB2YWx1ZSwKICAgICAgICBkYXRhU2hvdywKICAgICAgICB0b2dnbGUsCiAgICAgICAgdHdlZW4sCiAgICAgICAgaG9va3MsCiAgICAgICAgb2xkZmlyZSwKICAgICAgICBhbmltID0gdGhpcywKICAgICAgICBzdHlsZSA9IGVsZW0uc3R5bGUsCiAgICAgICAgb3JpZyA9IHt9LAogICAgICAgIGhhbmRsZWQgPSBbXSwKICAgICAgICBoaWRkZW4gPSBlbGVtLm5vZGVUeXBlICYmIGlzSGlkZGVuKGVsZW0pOyAvLyBoYW5kbGUgcXVldWU6IGZhbHNlIHByb21pc2VzCgogICAgaWYgKCFvcHRzLnF1ZXVlKSB7CiAgICAgIGhvb2tzID0galF1ZXJ5Ll9xdWV1ZUhvb2tzKGVsZW0sICJmeCIpOwoKICAgICAgaWYgKGhvb2tzLnVucXVldWVkID09IG51bGwpIHsKICAgICAgICBob29rcy51bnF1ZXVlZCA9IDA7CiAgICAgICAgb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CgogICAgICAgIGhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIWhvb2tzLnVucXVldWVkKSB7CiAgICAgICAgICAgIG9sZGZpcmUoKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBob29rcy51bnF1ZXVlZCsrOwogICAgICBhbmltLmFsd2F5cyhmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gZG9pbmcgdGhpcyBtYWtlcyBzdXJlIHRoYXQgdGhlIGNvbXBsZXRlIGhhbmRsZXIgd2lsbCBiZSBjYWxsZWQKICAgICAgICAvLyBiZWZvcmUgdGhpcyBjb21wbGV0ZXMKICAgICAgICBhbmltLmFsd2F5cyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBob29rcy51bnF1ZXVlZC0tOwoKICAgICAgICAgIGlmICghalF1ZXJ5LnF1ZXVlKGVsZW0sICJmeCIpLmxlbmd0aCkgewogICAgICAgICAgICBob29rcy5lbXB0eS5maXJlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSAvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoKCiAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcykpIHsKICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgbm90aGluZyBzbmVha3Mgb3V0CiAgICAgIC8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKICAgICAgLy8gY2hhbmdlIHRoZSBvdmVyZmxvdyBhdHRyaWJ1dGUgd2hlbiBvdmVyZmxvd1ggYW5kCiAgICAgIC8vIG92ZXJmbG93WSBhcmUgc2V0IHRvIHRoZSBzYW1lIHZhbHVlCiAgICAgIG9wdHMub3ZlcmZsb3cgPSBbc3R5bGUub3ZlcmZsb3csIHN0eWxlLm92ZXJmbG93WCwgc3R5bGUub3ZlcmZsb3dZXTsgLy8gU2V0IGRpc3BsYXkgcHJvcGVydHkgdG8gaW5saW5lLWJsb2NrIGZvciBoZWlnaHQvd2lkdGgKICAgICAgLy8gYW5pbWF0aW9ucyBvbiBpbmxpbmUgZWxlbWVudHMgdGhhdCBhcmUgaGF2aW5nIHdpZHRoL2hlaWdodCBhbmltYXRlZAoKICAgICAgaWYgKGpRdWVyeS5jc3MoZWxlbSwgImRpc3BsYXkiKSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyhlbGVtLCAiZmxvYXQiKSA9PT0gIm5vbmUiKSB7CiAgICAgICAgLy8gaW5saW5lLWxldmVsIGVsZW1lbnRzIGFjY2VwdCBpbmxpbmUtYmxvY2s7CiAgICAgICAgLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKICAgICAgICBpZiAoIWpRdWVyeS5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgfHwgY3NzX2RlZmF1bHREaXNwbGF5KGVsZW0ubm9kZU5hbWUpID09PSAiaW5saW5lIikgewogICAgICAgICAgc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHlsZS56b29tID0gMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAob3B0cy5vdmVyZmxvdykgewogICAgICBzdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoKICAgICAgaWYgKCFqUXVlcnkuc3VwcG9ydC5zaHJpbmtXcmFwQmxvY2tzKSB7CiAgICAgICAgYW5pbS5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgICAgc3R5bGUub3ZlcmZsb3cgPSBvcHRzLm92ZXJmbG93WzBdOwogICAgICAgICAgc3R5bGUub3ZlcmZsb3dYID0gb3B0cy5vdmVyZmxvd1sxXTsKICAgICAgICAgIHN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbMl07CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gLy8gc2hvdy9oaWRlIHBhc3MKCgogICAgZm9yIChpbmRleCBpbiBwcm9wcykgewogICAgICB2YWx1ZSA9IHByb3BzW2luZGV4XTsKCiAgICAgIGlmIChyZnh0eXBlcy5leGVjKHZhbHVlKSkgewogICAgICAgIGRlbGV0ZSBwcm9wc1tpbmRleF07CiAgICAgICAgdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCiAgICAgICAgaWYgKHZhbHVlID09PSAoaGlkZGVuID8gImhpZGUiIDogInNob3ciKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBoYW5kbGVkLnB1c2goaW5kZXgpOwogICAgICB9CiAgICB9CgogICAgbGVuZ3RoID0gaGFuZGxlZC5sZW5ndGg7CgogICAgaWYgKGxlbmd0aCkgewogICAgICBkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YShlbGVtLCAiZnhzaG93IikgfHwgalF1ZXJ5Ll9kYXRhKGVsZW0sICJmeHNob3ciLCB7fSk7CgogICAgICBpZiAoImhpZGRlbiIgaW4gZGF0YVNob3cpIHsKICAgICAgICBoaWRkZW4gPSBkYXRhU2hvdy5oaWRkZW47CiAgICAgIH0gLy8gc3RvcmUgc3RhdGUgaWYgaXRzIHRvZ2dsZSAtIGVuYWJsZXMgLnN0b3AoKS50b2dnbGUoKSB0byAicmV2ZXJzZSIKCgogICAgICBpZiAodG9nZ2xlKSB7CiAgICAgICAgZGF0YVNob3cuaGlkZGVuID0gIWhpZGRlbjsKICAgICAgfQoKICAgICAgaWYgKGhpZGRlbikgewogICAgICAgIGpRdWVyeShlbGVtKS5zaG93KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYW5pbS5kb25lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGpRdWVyeShlbGVtKS5oaWRlKCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGFuaW0uZG9uZShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHByb3A7CgogICAgICAgIGpRdWVyeS5fcmVtb3ZlRGF0YShlbGVtLCAiZnhzaG93Iik7CgogICAgICAgIGZvciAocHJvcCBpbiBvcmlnKSB7CiAgICAgICAgICBqUXVlcnkuc3R5bGUoZWxlbSwgcHJvcCwgb3JpZ1twcm9wXSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIHByb3AgPSBoYW5kbGVkW2luZGV4XTsKICAgICAgICB0d2VlbiA9IGFuaW0uY3JlYXRlVHdlZW4ocHJvcCwgaGlkZGVuID8gZGF0YVNob3dbcHJvcF0gOiAwKTsKICAgICAgICBvcmlnW3Byb3BdID0gZGF0YVNob3dbcHJvcF0gfHwgalF1ZXJ5LnN0eWxlKGVsZW0sIHByb3ApOwoKICAgICAgICBpZiAoIShwcm9wIGluIGRhdGFTaG93KSkgewogICAgICAgICAgZGF0YVNob3dbcHJvcF0gPSB0d2Vlbi5zdGFydDsKCiAgICAgICAgICBpZiAoaGlkZGVuKSB7CiAgICAgICAgICAgIHR3ZWVuLmVuZCA9IHR3ZWVuLnN0YXJ0OwogICAgICAgICAgICB0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIFR3ZWVuKGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nKSB7CiAgICByZXR1cm4gbmV3IFR3ZWVuLnByb3RvdHlwZS5pbml0KGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nKTsKICB9CgogIGpRdWVyeS5Ud2VlbiA9IFR3ZWVuOwogIFR3ZWVuLnByb3RvdHlwZSA9IHsKICAgIGNvbnN0cnVjdG9yOiBUd2VlbiwKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQpIHsKICAgICAgdGhpcy5lbGVtID0gZWxlbTsKICAgICAgdGhpcy5wcm9wID0gcHJvcDsKICAgICAgdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgInN3aW5nIjsKICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgdGhpcy5zdGFydCA9IHRoaXMubm93ID0gdGhpcy5jdXIoKTsKICAgICAgdGhpcy5lbmQgPSBlbmQ7CiAgICAgIHRoaXMudW5pdCA9IHVuaXQgfHwgKGpRdWVyeS5jc3NOdW1iZXJbcHJvcF0gPyAiIiA6ICJweCIpOwogICAgfSwKICAgIGN1cjogZnVuY3Rpb24gY3VyKCkgewogICAgICB2YXIgaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbdGhpcy5wcm9wXTsKICAgICAgcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/IGhvb2tzLmdldCh0aGlzKSA6IFR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQodGhpcyk7CiAgICB9LAogICAgcnVuOiBmdW5jdGlvbiBydW4ocGVyY2VudCkgewogICAgICB2YXIgZWFzZWQsCiAgICAgICAgICBob29rcyA9IFR3ZWVuLnByb3BIb29rc1t0aGlzLnByb3BdOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5kdXJhdGlvbikgewogICAgICAgIHRoaXMucG9zID0gZWFzZWQgPSBqUXVlcnkuZWFzaW5nW3RoaXMuZWFzaW5nXShwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwogICAgICB9CgogICAgICB0aGlzLm5vdyA9ICh0aGlzLmVuZCAtIHRoaXMuc3RhcnQpICogZWFzZWQgKyB0aGlzLnN0YXJ0OwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGVwKSB7CiAgICAgICAgdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzKTsKICAgICAgfQoKICAgICAgaWYgKGhvb2tzICYmIGhvb2tzLnNldCkgewogICAgICAgIGhvb2tzLnNldCh0aGlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIFR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsKICBUd2Vlbi5wcm9wSG9va3MgPSB7CiAgICBfZGVmYXVsdDogewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCh0d2VlbikgewogICAgICAgIHZhciByZXN1bHQ7CgogICAgICAgIGlmICh0d2Vlbi5lbGVtW3R3ZWVuLnByb3BdICE9IG51bGwgJiYgKCF0d2Vlbi5lbGVtLnN0eWxlIHx8IHR3ZWVuLmVsZW0uc3R5bGVbdHdlZW4ucHJvcF0gPT0gbnVsbCkpIHsKICAgICAgICAgIHJldHVybiB0d2Vlbi5lbGVtW3R3ZWVuLnByb3BdOwogICAgICAgIH0gLy8gcGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CiAgICAgICAgLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscwogICAgICAgIC8vIHNvLCBzaW1wbGUgdmFsdWVzIHN1Y2ggYXMgIjEwcHgiIGFyZSBwYXJzZWQgdG8gRmxvYXQuCiAgICAgICAgLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMgaXMuCgoKICAgICAgICByZXN1bHQgPSBqUXVlcnkuY3NzKHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiKTsgLy8gRW1wdHkgc3RyaW5ncywgbnVsbCwgdW5kZWZpbmVkIGFuZCAiYXV0byIgYXJlIGNvbnZlcnRlZCB0byAwLgoKICAgICAgICByZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHR3ZWVuKSB7CiAgICAgICAgLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwogICAgICAgIC8vIGF2YWlsYWJsZSBhbmQgdXNlIHBsYWluIHByb3BlcnRpZXMgd2hlcmUgYXZhaWxhYmxlCiAgICAgICAgaWYgKGpRdWVyeS5meC5zdGVwW3R3ZWVuLnByb3BdKSB7CiAgICAgICAgICBqUXVlcnkuZnguc3RlcFt0d2Vlbi5wcm9wXSh0d2Vlbik7CiAgICAgICAgfSBlbHNlIGlmICh0d2Vlbi5lbGVtLnN0eWxlICYmICh0d2Vlbi5lbGVtLnN0eWxlW2pRdWVyeS5jc3NQcm9wc1t0d2Vlbi5wcm9wXV0gIT0gbnVsbCB8fCBqUXVlcnkuY3NzSG9va3NbdHdlZW4ucHJvcF0pKSB7CiAgICAgICAgICBqUXVlcnkuc3R5bGUodHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgdHdlZW4ubm93ICsgdHdlZW4udW5pdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHR3ZWVuLmVsZW1bdHdlZW4ucHJvcF0gPSB0d2Vlbi5ub3c7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsgLy8gUmVtb3ZlIGluIDIuMCAtIHRoaXMgc3VwcG9ydHMgSUU4J3MgcGFuaWMgYmFzZWQgYXBwcm9hY2gKICAvLyB0byBzZXR0aW5nIHRoaW5ncyBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCiAgVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewogICAgc2V0OiBmdW5jdGlvbiBzZXQodHdlZW4pIHsKICAgICAgaWYgKHR3ZWVuLmVsZW0ubm9kZVR5cGUgJiYgdHdlZW4uZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgdHdlZW4uZWxlbVt0d2Vlbi5wcm9wXSA9IHR3ZWVuLm5vdzsKICAgICAgfQogICAgfQogIH07CiAgalF1ZXJ5LmVhY2goWyJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIl0sIGZ1bmN0aW9uIChpLCBuYW1lKSB7CiAgICB2YXIgY3NzRm4gPSBqUXVlcnkuZm5bbmFtZV07CgogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiBzcGVlZCA9PSBudWxsIHx8IHR5cGVvZiBzcGVlZCA9PT0gImJvb2xlYW4iID8gY3NzRm4uYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IHRoaXMuYW5pbWF0ZShnZW5GeChuYW1lLCB0cnVlKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spOwogICAgfTsKICB9KTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGZhZGVUbzogZnVuY3Rpb24gZmFkZVRvKHNwZWVkLCB0bywgZWFzaW5nLCBjYWxsYmFjaykgewogICAgICAvLyBzaG93IGFueSBoaWRkZW4gZWxlbWVudHMgYWZ0ZXIgc2V0dGluZyBvcGFjaXR5IHRvIDAKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyKGlzSGlkZGVuKS5jc3MoIm9wYWNpdHkiLCAwKS5zaG93KCkgLy8gYW5pbWF0ZSB0byB0aGUgdmFsdWUgc3BlY2lmaWVkCiAgICAgIC5lbmQoKS5hbmltYXRlKHsKICAgICAgICBvcGFjaXR5OiB0bwogICAgICB9LCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayk7CiAgICB9LAogICAgYW5pbWF0ZTogZnVuY3Rpb24gYW5pbWF0ZShwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjaykgewogICAgICB2YXIgZW1wdHkgPSBqUXVlcnkuaXNFbXB0eU9iamVjdChwcm9wKSwKICAgICAgICAgIG9wdGFsbCA9IGpRdWVyeS5zcGVlZChzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayksCiAgICAgICAgICBkb0FuaW1hdGlvbiA9IGZ1bmN0aW9uIGRvQW5pbWF0aW9uKCkgewogICAgICAgIC8vIE9wZXJhdGUgb24gYSBjb3B5IG9mIHByb3Agc28gcGVyLXByb3BlcnR5IGVhc2luZyB3b24ndCBiZSBsb3N0CiAgICAgICAgdmFyIGFuaW0gPSBBbmltYXRpb24odGhpcywgalF1ZXJ5LmV4dGVuZCh7fSwgcHJvcCksIG9wdGFsbCk7CgogICAgICAgIGRvQW5pbWF0aW9uLmZpbmlzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGFuaW0uc3RvcCh0cnVlKTsKICAgICAgICB9OyAvLyBFbXB0eSBhbmltYXRpb25zLCBvciBmaW5pc2hpbmcgcmVzb2x2ZXMgaW1tZWRpYXRlbHkKCgogICAgICAgIGlmIChlbXB0eSB8fCBqUXVlcnkuX2RhdGEodGhpcywgImZpbmlzaCIpKSB7CiAgICAgICAgICBhbmltLnN0b3AodHJ1ZSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZG9BbmltYXRpb24uZmluaXNoID0gZG9BbmltYXRpb247CiAgICAgIHJldHVybiBlbXB0eSB8fCBvcHRhbGwucXVldWUgPT09IGZhbHNlID8gdGhpcy5lYWNoKGRvQW5pbWF0aW9uKSA6IHRoaXMucXVldWUob3B0YWxsLnF1ZXVlLCBkb0FuaW1hdGlvbik7CiAgICB9LAogICAgc3RvcDogZnVuY3Rpb24gc3RvcCh0eXBlLCBjbGVhclF1ZXVlLCBnb3RvRW5kKSB7CiAgICAgIHZhciBzdG9wUXVldWUgPSBmdW5jdGlvbiBzdG9wUXVldWUoaG9va3MpIHsKICAgICAgICB2YXIgc3RvcCA9IGhvb2tzLnN0b3A7CiAgICAgICAgZGVsZXRlIGhvb2tzLnN0b3A7CiAgICAgICAgc3RvcChnb3RvRW5kKTsKICAgICAgfTsKCiAgICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICBnb3RvRW5kID0gY2xlYXJRdWV1ZTsKICAgICAgICBjbGVhclF1ZXVlID0gdHlwZTsKICAgICAgICB0eXBlID0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBpZiAoY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSkgewogICAgICAgIHRoaXMucXVldWUodHlwZSB8fCAiZngiLCBbXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkZXF1ZXVlID0gdHJ1ZSwKICAgICAgICAgICAgaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKICAgICAgICAgICAgdGltZXJzID0galF1ZXJ5LnRpbWVycywKICAgICAgICAgICAgZGF0YSA9IGpRdWVyeS5fZGF0YSh0aGlzKTsKCiAgICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgICBpZiAoZGF0YVtpbmRleF0gJiYgZGF0YVtpbmRleF0uc3RvcCkgewogICAgICAgICAgICBzdG9wUXVldWUoZGF0YVtpbmRleF0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGluZGV4IGluIGRhdGEpIHsKICAgICAgICAgICAgaWYgKGRhdGFbaW5kZXhdICYmIGRhdGFbaW5kZXhdLnN0b3AgJiYgcnJ1bi50ZXN0KGluZGV4KSkgewogICAgICAgICAgICAgIHN0b3BRdWV1ZShkYXRhW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAoaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOykgewogICAgICAgICAgaWYgKHRpbWVyc1tpbmRleF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1tpbmRleF0ucXVldWUgPT09IHR5cGUpKSB7CiAgICAgICAgICAgIHRpbWVyc1tpbmRleF0uYW5pbS5zdG9wKGdvdG9FbmQpOwogICAgICAgICAgICBkZXF1ZXVlID0gZmFsc2U7CiAgICAgICAgICAgIHRpbWVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gc3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZAogICAgICAgIC8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlCiAgICAgICAgLy8gYnV0IG9ubHkgaWYgdGhleSB3ZXJlIGdvdG9FbmQKCgogICAgICAgIGlmIChkZXF1ZXVlIHx8ICFnb3RvRW5kKSB7CiAgICAgICAgICBqUXVlcnkuZGVxdWV1ZSh0aGlzLCB0eXBlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHR5cGUpIHsKICAgICAgaWYgKHR5cGUgIT09IGZhbHNlKSB7CiAgICAgICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGluZGV4LAogICAgICAgICAgICBkYXRhID0galF1ZXJ5Ll9kYXRhKHRoaXMpLAogICAgICAgICAgICBxdWV1ZSA9IGRhdGFbdHlwZSArICJxdWV1ZSJdLAogICAgICAgICAgICBob29rcyA9IGRhdGFbdHlwZSArICJxdWV1ZUhvb2tzIl0sCiAgICAgICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsCiAgICAgICAgICAgIGxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsgLy8gZW5hYmxlIGZpbmlzaGluZyBmbGFnIG9uIHByaXZhdGUgZGF0YQoKCiAgICAgICAgZGF0YS5maW5pc2ggPSB0cnVlOyAvLyBlbXB0eSB0aGUgcXVldWUgZmlyc3QKCiAgICAgICAgalF1ZXJ5LnF1ZXVlKHRoaXMsIHR5cGUsIFtdKTsKCiAgICAgICAgaWYgKGhvb2tzICYmIGhvb2tzLmN1ciAmJiBob29rcy5jdXIuZmluaXNoKSB7CiAgICAgICAgICBob29rcy5jdXIuZmluaXNoLmNhbGwodGhpcyk7CiAgICAgICAgfSAvLyBsb29rIGZvciBhbnkgYWN0aXZlIGFuaW1hdGlvbnMsIGFuZCBmaW5pc2ggdGhlbQoKCiAgICAgICAgZm9yIChpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07KSB7CiAgICAgICAgICBpZiAodGltZXJzW2luZGV4XS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1tpbmRleF0ucXVldWUgPT09IHR5cGUpIHsKICAgICAgICAgICAgdGltZXJzW2luZGV4XS5hbmltLnN0b3AodHJ1ZSk7CiAgICAgICAgICAgIHRpbWVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gbG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0KCgogICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgaWYgKHF1ZXVlW2luZGV4XSAmJiBxdWV1ZVtpbmRleF0uZmluaXNoKSB7CiAgICAgICAgICAgIHF1ZXVlW2luZGV4XS5maW5pc2guY2FsbCh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIHR1cm4gb2ZmIGZpbmlzaGluZyBmbGFnCgoKICAgICAgICBkZWxldGUgZGF0YS5maW5pc2g7CiAgICAgIH0pOwogICAgfQogIH0pOyAvLyBHZW5lcmF0ZSBwYXJhbWV0ZXJzIHRvIGNyZWF0ZSBhIHN0YW5kYXJkIGFuaW1hdGlvbgoKICBmdW5jdGlvbiBnZW5GeCh0eXBlLCBpbmNsdWRlV2lkdGgpIHsKICAgIHZhciB3aGljaCwKICAgICAgICBhdHRycyA9IHsKICAgICAgaGVpZ2h0OiB0eXBlCiAgICB9LAogICAgICAgIGkgPSAwOyAvLyBpZiB3ZSBpbmNsdWRlIHdpZHRoLCBzdGVwIHZhbHVlIGlzIDEgdG8gZG8gYWxsIGNzc0V4cGFuZCB2YWx1ZXMsCiAgICAvLyBpZiB3ZSBkb24ndCBpbmNsdWRlIHdpZHRoLCBzdGVwIHZhbHVlIGlzIDIgdG8gc2tpcCBvdmVyIExlZnQgYW5kIFJpZ2h0CgogICAgaW5jbHVkZVdpZHRoID0gaW5jbHVkZVdpZHRoID8gMSA6IDA7CgogICAgZm9yICg7IGkgPCA0OyBpICs9IDIgLSBpbmNsdWRlV2lkdGgpIHsKICAgICAgd2hpY2ggPSBjc3NFeHBhbmRbaV07CiAgICAgIGF0dHJzWyJtYXJnaW4iICsgd2hpY2hdID0gYXR0cnNbInBhZGRpbmciICsgd2hpY2hdID0gdHlwZTsKICAgIH0KCiAgICBpZiAoaW5jbHVkZVdpZHRoKSB7CiAgICAgIGF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7CiAgICB9CgogICAgcmV0dXJuIGF0dHJzOwogIH0gLy8gR2VuZXJhdGUgc2hvcnRjdXRzIGZvciBjdXN0b20gYW5pbWF0aW9ucwoKCiAgalF1ZXJ5LmVhY2goewogICAgc2xpZGVEb3duOiBnZW5GeCgic2hvdyIpLAogICAgc2xpZGVVcDogZ2VuRngoImhpZGUiKSwKICAgIHNsaWRlVG9nZ2xlOiBnZW5GeCgidG9nZ2xlIiksCiAgICBmYWRlSW46IHsKICAgICAgb3BhY2l0eTogInNob3ciCiAgICB9LAogICAgZmFkZU91dDogewogICAgICBvcGFjaXR5OiAiaGlkZSIKICAgIH0sCiAgICBmYWRlVG9nZ2xlOiB7CiAgICAgIG9wYWNpdHk6ICJ0b2dnbGUiCiAgICB9CiAgfSwgZnVuY3Rpb24gKG5hbWUsIHByb3BzKSB7CiAgICBqUXVlcnkuZm5bbmFtZV0gPSBmdW5jdGlvbiAoc3BlZWQsIGVhc2luZywgY2FsbGJhY2spIHsKICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZShwcm9wcywgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spOwogICAgfTsKICB9KTsKCiAgalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24gKHNwZWVkLCBlYXNpbmcsIGZuKSB7CiAgICB2YXIgb3B0ID0gc3BlZWQgJiYgX3R5cGVvZihzcGVlZCkgPT09ICJvYmplY3QiID8galF1ZXJ5LmV4dGVuZCh7fSwgc3BlZWQpIDogewogICAgICBjb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fCBqUXVlcnkuaXNGdW5jdGlvbihzcGVlZCkgJiYgc3BlZWQsCiAgICAgIGR1cmF0aW9uOiBzcGVlZCwKICAgICAgZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbihlYXNpbmcpICYmIGVhc2luZwogICAgfTsKICAgIG9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOiBvcHQuZHVyYXRpb24gaW4galF1ZXJ5LmZ4LnNwZWVkcyA/IGpRdWVyeS5meC5zcGVlZHNbb3B0LmR1cmF0aW9uXSA6IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7IC8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCiAgICBpZiAob3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlKSB7CiAgICAgIG9wdC5xdWV1ZSA9ICJmeCI7CiAgICB9IC8vIFF1ZXVlaW5nCgoKICAgIG9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgogICAgb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoalF1ZXJ5LmlzRnVuY3Rpb24ob3B0Lm9sZCkpIHsKICAgICAgICBvcHQub2xkLmNhbGwodGhpcyk7CiAgICAgIH0KCiAgICAgIGlmIChvcHQucXVldWUpIHsKICAgICAgICBqUXVlcnkuZGVxdWV1ZSh0aGlzLCBvcHQucXVldWUpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBvcHQ7CiAgfTsKCiAgalF1ZXJ5LmVhc2luZyA9IHsKICAgIGxpbmVhcjogZnVuY3Rpb24gbGluZWFyKHApIHsKICAgICAgcmV0dXJuIHA7CiAgICB9LAogICAgc3dpbmc6IGZ1bmN0aW9uIHN3aW5nKHApIHsKICAgICAgcmV0dXJuIDAuNSAtIE1hdGguY29zKHAgKiBNYXRoLlBJKSAvIDI7CiAgICB9CiAgfTsKICBqUXVlcnkudGltZXJzID0gW107CiAgalF1ZXJ5LmZ4ID0gVHdlZW4ucHJvdG90eXBlLmluaXQ7CgogIGpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHRpbWVyLAogICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsCiAgICAgICAgaSA9IDA7CiAgICBmeE5vdyA9IGpRdWVyeS5ub3coKTsKCiAgICBmb3IgKDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKykgewogICAgICB0aW1lciA9IHRpbWVyc1tpXTsgLy8gQ2hlY2tzIHRoZSB0aW1lciBoYXMgbm90IGFscmVhZHkgYmVlbiByZW1vdmVkCgogICAgICBpZiAoIXRpbWVyKCkgJiYgdGltZXJzW2ldID09PSB0aW1lcikgewogICAgICAgIHRpbWVycy5zcGxpY2UoaS0tLCAxKTsKICAgICAgfQogICAgfQoKICAgIGlmICghdGltZXJzLmxlbmd0aCkgewogICAgICBqUXVlcnkuZnguc3RvcCgpOwogICAgfQoKICAgIGZ4Tm93ID0gdW5kZWZpbmVkOwogIH07CgogIGpRdWVyeS5meC50aW1lciA9IGZ1bmN0aW9uICh0aW1lcikgewogICAgaWYgKHRpbWVyKCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKHRpbWVyKSkgewogICAgICBqUXVlcnkuZnguc3RhcnQoKTsKICAgIH0KICB9OwoKICBqUXVlcnkuZnguaW50ZXJ2YWwgPSAxMzsKCiAgalF1ZXJ5LmZ4LnN0YXJ0ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aW1lcklkKSB7CiAgICAgIHRpbWVySWQgPSBzZXRJbnRlcnZhbChqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsKTsKICAgIH0KICB9OwoKICBqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgIGNsZWFySW50ZXJ2YWwodGltZXJJZCk7CiAgICB0aW1lcklkID0gbnVsbDsKICB9OwoKICBqUXVlcnkuZnguc3BlZWRzID0gewogICAgc2xvdzogNjAwLAogICAgZmFzdDogMjAwLAogICAgLy8gRGVmYXVsdCBzcGVlZAogICAgX2RlZmF1bHQ6IDQwMAogIH07IC8vIEJhY2sgQ29tcGF0IDwxLjggZXh0ZW5zaW9uIHBvaW50CgogIGpRdWVyeS5meC5zdGVwID0ge307CgogIGlmIChqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzKSB7CiAgICBqUXVlcnkuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGpRdWVyeS50aW1lcnMsIGZ1bmN0aW9uIChmbikgewogICAgICAgIHJldHVybiBlbGVtID09PSBmbi5lbGVtOwogICAgICB9KS5sZW5ndGg7CiAgICB9OwogIH0KCiAgalF1ZXJ5LmZuLm9mZnNldCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkgewogICAgICByZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgIGpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsIG9wdGlvbnMsIGkpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgZG9jRWxlbSwKICAgICAgICB3aW4sCiAgICAgICAgYm94ID0gewogICAgICB0b3A6IDAsCiAgICAgIGxlZnQ6IDAKICAgIH0sCiAgICAgICAgZWxlbSA9IHRoaXNbMF0sCiAgICAgICAgZG9jID0gZWxlbSAmJiBlbGVtLm93bmVyRG9jdW1lbnQ7CgogICAgaWYgKCFkb2MpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OyAvLyBNYWtlIHN1cmUgaXQncyBub3QgYSBkaXNjb25uZWN0ZWQgRE9NIG5vZGUKCiAgICBpZiAoIWpRdWVyeS5jb250YWlucyhkb2NFbGVtLCBlbGVtKSkgewogICAgICByZXR1cm4gYm94OwogICAgfSAvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgogICAgLy8gQmxhY2tCZXJyeSA1LCBpT1MgMyAob3JpZ2luYWwgaVBob25lKQoKCiAgICBpZiAoX3R5cGVvZihlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCkgIT09IGNvcmVfc3RydW5kZWZpbmVkKSB7CiAgICAgIGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICB9CgogICAgd2luID0gZ2V0V2luZG93KGRvYyk7CiAgICByZXR1cm4gewogICAgICB0b3A6IGJveC50b3AgKyAod2luLnBhZ2VZT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsVG9wKSAtIChkb2NFbGVtLmNsaWVudFRvcCB8fCAwKSwKICAgICAgbGVmdDogYm94LmxlZnQgKyAod2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCkgLSAoZG9jRWxlbS5jbGllbnRMZWZ0IHx8IDApCiAgICB9OwogIH07CgogIGpRdWVyeS5vZmZzZXQgPSB7CiAgICBzZXRPZmZzZXQ6IGZ1bmN0aW9uIHNldE9mZnNldChlbGVtLCBvcHRpb25zLCBpKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoZWxlbSwgInBvc2l0aW9uIik7IC8vIHNldCBwb3NpdGlvbiBmaXJzdCwgaW4tY2FzZSB0b3AvbGVmdCBhcmUgc2V0IGV2ZW4gb24gc3RhdGljIGVsZW0KCiAgICAgIGlmIChwb3NpdGlvbiA9PT0gInN0YXRpYyIpIHsKICAgICAgICBlbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKICAgICAgfQoKICAgICAgdmFyIGN1ckVsZW0gPSBqUXVlcnkoZWxlbSksCiAgICAgICAgICBjdXJPZmZzZXQgPSBjdXJFbGVtLm9mZnNldCgpLAogICAgICAgICAgY3VyQ1NTVG9wID0galF1ZXJ5LmNzcyhlbGVtLCAidG9wIiksCiAgICAgICAgICBjdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyhlbGVtLCAibGVmdCIpLAogICAgICAgICAgY2FsY3VsYXRlUG9zaXRpb24gPSAocG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgfHwgcG9zaXRpb24gPT09ICJmaXhlZCIpICYmIGpRdWVyeS5pbkFycmF5KCJhdXRvIiwgW2N1ckNTU1RvcCwgY3VyQ1NTTGVmdF0pID4gLTEsCiAgICAgICAgICBwcm9wcyA9IHt9LAogICAgICAgICAgY3VyUG9zaXRpb24gPSB7fSwKICAgICAgICAgIGN1clRvcCwKICAgICAgICAgIGN1ckxlZnQ7IC8vIG5lZWQgdG8gYmUgYWJsZSB0byBjYWxjdWxhdGUgcG9zaXRpb24gaWYgZWl0aGVyIHRvcCBvciBsZWZ0IGlzIGF1dG8gYW5kIHBvc2l0aW9uIGlzIGVpdGhlciBhYnNvbHV0ZSBvciBmaXhlZAoKICAgICAgaWYgKGNhbGN1bGF0ZVBvc2l0aW9uKSB7CiAgICAgICAgY3VyUG9zaXRpb24gPSBjdXJFbGVtLnBvc2l0aW9uKCk7CiAgICAgICAgY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwogICAgICAgIGN1ckxlZnQgPSBjdXJQb3NpdGlvbi5sZWZ0OwogICAgICB9IGVsc2UgewogICAgICAgIGN1clRvcCA9IHBhcnNlRmxvYXQoY3VyQ1NTVG9wKSB8fCAwOwogICAgICAgIGN1ckxlZnQgPSBwYXJzZUZsb2F0KGN1ckNTU0xlZnQpIHx8IDA7CiAgICAgIH0KCiAgICAgIGlmIChqUXVlcnkuaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLmNhbGwoZWxlbSwgaSwgY3VyT2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG9wICE9IG51bGwpIHsKICAgICAgICBwcm9wcy50b3AgPSBvcHRpb25zLnRvcCAtIGN1ck9mZnNldC50b3AgKyBjdXJUb3A7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxlZnQgIT0gbnVsbCkgewogICAgICAgIHByb3BzLmxlZnQgPSBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCArIGN1ckxlZnQ7CiAgICAgIH0KCiAgICAgIGlmICgidXNpbmciIGluIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zLnVzaW5nLmNhbGwoZWxlbSwgcHJvcHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGN1ckVsZW0uY3NzKHByb3BzKTsKICAgICAgfQogICAgfQogIH07CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBwb3NpdGlvbjogZnVuY3Rpb24gcG9zaXRpb24oKSB7CiAgICAgIGlmICghdGhpc1swXSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG9mZnNldFBhcmVudCwKICAgICAgICAgIG9mZnNldCwKICAgICAgICAgIHBhcmVudE9mZnNldCA9IHsKICAgICAgICB0b3A6IDAsCiAgICAgICAgbGVmdDogMAogICAgICB9LAogICAgICAgICAgZWxlbSA9IHRoaXNbMF07IC8vIGZpeGVkIGVsZW1lbnRzIGFyZSBvZmZzZXQgZnJvbSB3aW5kb3cgKHBhcmVudE9mZnNldCA9IHt0b3A6MCwgbGVmdDogMH0sIGJlY2F1c2UgaXQgaXMgaXQncyBvbmx5IG9mZnNldCBwYXJlbnQKCiAgICAgIGlmIChqUXVlcnkuY3NzKGVsZW0sICJwb3NpdGlvbiIpID09PSAiZml4ZWQiKSB7CiAgICAgICAgLy8gd2UgYXNzdW1lIHRoYXQgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIGF2YWlsYWJsZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkCiAgICAgICAgb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBHZXQgKnJlYWwqIG9mZnNldFBhcmVudAogICAgICAgIG9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50KCk7IC8vIEdldCBjb3JyZWN0IG9mZnNldHMKCiAgICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQoKTsKCiAgICAgICAgaWYgKCFqUXVlcnkubm9kZU5hbWUob2Zmc2V0UGFyZW50WzBdLCAiaHRtbCIpKSB7CiAgICAgICAgICBwYXJlbnRPZmZzZXQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0KCk7CiAgICAgICAgfSAvLyBBZGQgb2Zmc2V0UGFyZW50IGJvcmRlcnMKCgogICAgICAgIHBhcmVudE9mZnNldC50b3AgKz0galF1ZXJ5LmNzcyhvZmZzZXRQYXJlbnRbMF0sICJib3JkZXJUb3BXaWR0aCIsIHRydWUpOwogICAgICAgIHBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50WzBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSk7CiAgICAgIH0gLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwogICAgICAvLyBub3RlOiB3aGVuIGFuIGVsZW1lbnQgaGFzIG1hcmdpbjogYXV0byB0aGUgb2Zmc2V0TGVmdCBhbmQgbWFyZ2luTGVmdAogICAgICAvLyBhcmUgdGhlIHNhbWUgaW4gU2FmYXJpIGNhdXNpbmcgb2Zmc2V0LmxlZnQgdG8gaW5jb3JyZWN0bHkgYmUgMAoKCiAgICAgIHJldHVybiB7CiAgICAgICAgdG9wOiBvZmZzZXQudG9wIC0gcGFyZW50T2Zmc2V0LnRvcCAtIGpRdWVyeS5jc3MoZWxlbSwgIm1hcmdpblRvcCIsIHRydWUpLAogICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0IC0gcGFyZW50T2Zmc2V0LmxlZnQgLSBqUXVlcnkuY3NzKGVsZW0sICJtYXJnaW5MZWZ0IiwgdHJ1ZSkKICAgICAgfTsKICAgIH0sCiAgICBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uIG9mZnNldFBhcmVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKICAgICAgICB3aGlsZSAob2Zmc2V0UGFyZW50ICYmICFqUXVlcnkubm9kZU5hbWUob2Zmc2V0UGFyZW50LCAiaHRtbCIpICYmIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIpIHsKICAgICAgICAgIG9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb2Zmc2V0UGFyZW50IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgfSk7CiAgICB9CiAgfSk7IC8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwoKICBqUXVlcnkuZWFjaCh7CiAgICBzY3JvbGxMZWZ0OiAicGFnZVhPZmZzZXQiLAogICAgc2Nyb2xsVG9wOiAicGFnZVlPZmZzZXQiCiAgfSwgZnVuY3Rpb24gKG1ldGhvZCwgcHJvcCkgewogICAgdmFyIHRvcCA9IC9ZLy50ZXN0KHByb3ApOwoKICAgIGpRdWVyeS5mblttZXRob2RdID0gZnVuY3Rpb24gKHZhbCkgewogICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAoZWxlbSwgbWV0aG9kLCB2YWwpIHsKICAgICAgICB2YXIgd2luID0gZ2V0V2luZG93KGVsZW0pOwoKICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiB3aW4gPyBwcm9wIGluIHdpbiA/IHdpbltwcm9wXSA6IHdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbbWV0aG9kXSA6IGVsZW1bbWV0aG9kXTsKICAgICAgICB9CgogICAgICAgIGlmICh3aW4pIHsKICAgICAgICAgIHdpbi5zY3JvbGxUbyghdG9wID8gdmFsIDogalF1ZXJ5KHdpbikuc2Nyb2xsTGVmdCgpLCB0b3AgPyB2YWwgOiBqUXVlcnkod2luKS5zY3JvbGxUb3AoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVsZW1bbWV0aG9kXSA9IHZhbDsKICAgICAgICB9CiAgICAgIH0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsKTsKICAgIH07CiAgfSk7CgogIGZ1bmN0aW9uIGdldFdpbmRvdyhlbGVtKSB7CiAgICByZXR1cm4galF1ZXJ5LmlzV2luZG93KGVsZW0pID8gZWxlbSA6IGVsZW0ubm9kZVR5cGUgPT09IDkgPyBlbGVtLmRlZmF1bHRWaWV3IHx8IGVsZW0ucGFyZW50V2luZG93IDogZmFsc2U7CiAgfSAvLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKCgogIGpRdWVyeS5lYWNoKHsKICAgIEhlaWdodDogImhlaWdodCIsCiAgICBXaWR0aDogIndpZHRoIgogIH0sIGZ1bmN0aW9uIChuYW1lLCB0eXBlKSB7CiAgICBqUXVlcnkuZWFjaCh7CiAgICAgIHBhZGRpbmc6ICJpbm5lciIgKyBuYW1lLAogICAgICBjb250ZW50OiB0eXBlLAogICAgICAiIjogIm91dGVyIiArIG5hbWUKICAgIH0sIGZ1bmN0aW9uIChkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lKSB7CiAgICAgIC8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAogICAgICBqUXVlcnkuZm5bZnVuY05hbWVdID0gZnVuY3Rpb24gKG1hcmdpbiwgdmFsdWUpIHsKICAgICAgICB2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoZGVmYXVsdEV4dHJhIHx8IHR5cGVvZiBtYXJnaW4gIT09ICJib29sZWFuIiksCiAgICAgICAgICAgIGV4dHJhID0gZGVmYXVsdEV4dHJhIHx8IChtYXJnaW4gPT09IHRydWUgfHwgdmFsdWUgPT09IHRydWUgPyAibWFyZ2luIiA6ICJib3JkZXIiKTsKICAgICAgICByZXR1cm4galF1ZXJ5LmFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAoZWxlbSwgdHlwZSwgdmFsdWUpIHsKICAgICAgICAgIHZhciBkb2M7CgogICAgICAgICAgaWYgKGpRdWVyeS5pc1dpbmRvdyhlbGVtKSkgewogICAgICAgICAgICAvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQogICAgICAgICAgICAvLyBpc24ndCBhIHdob2xlIGxvdCB3ZSBjYW4gZG8uIFNlZSBwdWxsIHJlcXVlc3QgYXQgdGhpcyBVUkwgZm9yIGRpc2N1c3Npb246CiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNzY0CiAgICAgICAgICAgIHJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IiArIG5hbWVdOwogICAgICAgICAgfSAvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0CgoKICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSA5KSB7CiAgICAgICAgICAgIGRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OyAvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVzdAogICAgICAgICAgICAvLyB1bmZvcnR1bmF0ZWx5LCB0aGlzIGNhdXNlcyBidWcgIzM4MzggaW4gSUU2Lzggb25seSwgYnV0IHRoZXJlIGlzIGN1cnJlbnRseSBubyBnb29kLCBzbWFsbCB3YXkgdG8gZml4IGl0LgoKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGVsZW0uYm9keVsic2Nyb2xsIiArIG5hbWVdLCBkb2NbInNjcm9sbCIgKyBuYW1lXSwgZWxlbS5ib2R5WyJvZmZzZXQiICsgbmFtZV0sIGRvY1sib2Zmc2V0IiArIG5hbWVdLCBkb2NbImNsaWVudCIgKyBuYW1lXSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyAvLyBHZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50LCByZXF1ZXN0aW5nIGJ1dCBub3QgZm9yY2luZyBwYXJzZUZsb2F0CiAgICAgICAgICBqUXVlcnkuY3NzKGVsZW0sIHR5cGUsIGV4dHJhKSA6IC8vIFNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQKICAgICAgICAgIGpRdWVyeS5zdHlsZShlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEpOwogICAgICAgIH0sIHR5cGUsIGNoYWluYWJsZSA/IG1hcmdpbiA6IHVuZGVmaW5lZCwgY2hhaW5hYmxlLCBudWxsKTsKICAgICAgfTsKICAgIH0pOwogIH0pOyAvLyBMaW1pdCBzY29wZSBwb2xsdXRpb24gZnJvbSBhbnkgZGVwcmVjYXRlZCBBUEkKICAvLyAoZnVuY3Rpb24oKSB7CiAgLy8gfSkoKTsKICAvLyBFeHBvc2UgalF1ZXJ5IHRvIHRoZSBnbG9iYWwgb2JqZWN0CgogIHdpbmRvdy5qUXVlcnkgPSB3aW5kb3cuJCA9IGpRdWVyeTsgLy8gRXhwb3NlIGpRdWVyeSBhcyBhbiBBTUQgbW9kdWxlLCBidXQgb25seSBmb3IgQU1EIGxvYWRlcnMgdGhhdAogIC8vIHVuZGVyc3RhbmQgdGhlIGlzc3VlcyB3aXRoIGxvYWRpbmcgbXVsdGlwbGUgdmVyc2lvbnMgb2YgalF1ZXJ5CiAgLy8gaW4gYSBwYWdlIHRoYXQgYWxsIG1pZ2h0IGNhbGwgZGVmaW5lKCkuIFRoZSBsb2FkZXIgd2lsbCBpbmRpY2F0ZQogIC8vIHRoZXkgaGF2ZSBzcGVjaWFsIGFsbG93YW5jZXMgZm9yIG11bHRpcGxlIGpRdWVyeSB2ZXJzaW9ucyBieQogIC8vIHNwZWNpZnlpbmcgZGVmaW5lLmFtZC5qUXVlcnkgPSB0cnVlLiBSZWdpc3RlciBhcyBhIG5hbWVkIG1vZHVsZSwKICAvLyBzaW5jZSBqUXVlcnkgY2FuIGJlIGNvbmNhdGVuYXRlZCB3aXRoIG90aGVyIGZpbGVzIHRoYXQgbWF5IHVzZSBkZWZpbmUsCiAgLy8gYnV0IG5vdCB1c2UgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdCB1bmRlcnN0YW5kcyBhbm9ueW1vdXMKICAvLyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdCB3YXkgdG8gcmVnaXN0ZXIuCiAgLy8gTG93ZXJjYXNlIGpxdWVyeSBpcyB1c2VkIGJlY2F1c2UgQU1EIG1vZHVsZSBuYW1lcyBhcmUgZGVyaXZlZCBmcm9tCiAgLy8gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UgZmlsZSBuYW1lLgogIC8vIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMgdG8gY2FsbAogIC8vIG5vQ29uZmxpY3QgdG8gaGlkZSB0aGlzIHZlcnNpb24gb2YgalF1ZXJ5LCBpdCB3aWxsIHdvcmsuCgogIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgJiYgZGVmaW5lLmFtZC5qUXVlcnkpIHsKICAgIGRlZmluZSgianF1ZXJ5IiwgW10sIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGpRdWVyeTsKICAgIH0pOwogIH0KfSkod2luZG93KTs="},{"version":3,"sources":["C:/Users/abcd/Desktop/activity-durian/src/api/jquery.js"],"names":["window","undefined","readyList","rootjQuery","core_strundefined","document","location","_jQuery","jQuery","_$","$","class2type","core_deletedIds","core_version","core_concat","concat","core_push","push","core_slice","slice","core_indexOf","indexOf","core_toString","toString","core_hasOwn","hasOwnProperty","core_trim","trim","selector","context","fn","init","core_pnum","source","core_rnotwhite","rtrim","rquickExpr","rsingleTag","rvalidchars","rvalidbraces","rvalidescape","rvalidtokens","rmsPrefix","rdashAlpha","fcamelCase","all","letter","toUpperCase","completed","event","addEventListener","type","readyState","detach","ready","removeEventListener","detachEvent","prototype","jquery","constructor","match","elem","charAt","length","exec","merge","parseHTML","nodeType","ownerDocument","test","isPlainObject","isFunction","attr","getElementById","parentNode","id","find","makeArray","size","toArray","call","get","num","pushStack","elems","ret","prevObject","each","callback","args","promise","done","apply","arguments","first","eq","last","i","len","j","map","end","sort","splice","extend","src","copyIsArray","copy","name","options","clone","target","deep","isArray","noConflict","isReady","readyWait","holdReady","hold","wait","body","setTimeout","resolveWith","trigger","off","obj","Array","isWindow","isNumeric","isNaN","parseFloat","isFinite","String","e","key","isEmptyObject","error","msg","Error","data","keepScripts","parsed","scripts","createElement","buildFragment","remove","childNodes","parseJSON","JSON","parse","replace","Function","parseXML","xml","tmp","DOMParser","parseFromString","ActiveXObject","async","loadXML","documentElement","getElementsByTagName","noop","globalEval","execScript","camelCase","string","nodeName","toLowerCase","value","isArraylike","text","arr","results","Object","inArray","Math","max","second","l","grep","inv","retVal","arg","guid","proxy","access","chainable","emptyGet","raw","bulk","now","Date","getTime","Deferred","attachEvent","top","frameElement","doScroll","doScrollCheck","split","optionsCache","createOptions","object","_","flag","Callbacks","firing","memory","fired","firingLength","firingIndex","firingStart","list","stack","once","fire","stopOnFalse","shift","self","disable","add","start","unique","has","index","empty","disabled","lock","locked","fireWith","func","tuples","state","always","deferred","fail","then","fns","newDefer","tuple","action","returned","resolve","reject","progress","notify","pipe","stateString","when","subordinate","resolveValues","remaining","updateFunc","contexts","values","progressValues","notifyWith","progressContexts","resolveContexts","support","a","input","select","fragment","opt","eventName","isSupported","div","setAttribute","innerHTML","appendChild","style","cssText","getSetAttribute","className","leadingWhitespace","firstChild","tbody","htmlSerialize","getAttribute","hrefNormalized","opacity","cssFloat","checkOn","optSelected","selected","enctype","html5Clone","cloneNode","outerHTML","boxModel","compatMode","deleteExpando","noCloneEvent","inlineBlockNeedsLayout","shrinkWrapBlocks","reliableMarginRight","boxSizingReliable","pixelPosition","checked","noCloneChecked","optDisabled","radioValue","createDocumentFragment","appendChecked","checkClone","lastChild","click","submit","change","focusin","attributes","expando","backgroundClip","clearCloneStyle","container","marginDiv","tds","divReset","offsetHeight","display","reliableHiddenOffsets","boxSizing","offsetWidth","doesNotIncludeMarginInBodyOffset","offsetTop","getComputedStyle","width","marginRight","zoom","removeChild","rbrace","rmultiDash","internalData","pvt","acceptData","thisCache","internalKey","getByName","isNode","cache","pop","toJSON","internalRemoveData","isEmptyDataObject","cleanData","random","noData","hasData","removeData","_data","_removeData","attrs","dataAttr","queue","dequeue","startLength","hooks","_queueHooks","next","cur","unshift","stop","setter","delay","time","fx","speeds","timeout","clearTimeout","clearQueue","count","defer","elements","nodeHook","boolHook","rclass","rreturn","rfocusable","rclickable","rboolean","ruseDefault","getSetInput","removeAttr","prop","removeProp","propFix","addClass","classes","clazz","proceed","removeClass","toggleClass","stateVal","isBool","classNames","hasClass","val","valHooks","set","option","specified","selectedIndex","one","notxml","nType","isXMLDoc","attrHooks","propName","attrNames","removeAttribute","tabindex","readonly","maxlength","cellspacing","cellpadding","rowspan","colspan","usemap","frameborder","contenteditable","propHooks","tabIndex","attributeNode","getAttributeNode","parseInt","href","detail","defaultValue","button","setAttributeNode","createAttribute","parent","rformElems","rkeyEvent","rmouseEvent","rfocusMorph","rtypenamespace","returnTrue","returnFalse","global","types","handler","events","t","handleObjIn","special","eventHandle","handleObj","handlers","namespaces","origType","elemData","handle","triggered","dispatch","delegateType","bindType","needsContext","expr","namespace","join","delegateCount","setup","mappedTypes","origCount","RegExp","teardown","removeEvent","onlyHandlers","ontype","bubbleType","eventPath","Event","isTrigger","namespace_re","result","noBubble","defaultView","parentWindow","isPropagationStopped","preventDefault","isDefaultPrevented","_default","fix","matched","handlerQueue","delegateTarget","preDispatch","currentTarget","isImmediatePropagationStopped","stopPropagation","postDispatch","sel","matches","originalEvent","fixHook","fixHooks","mouseHooks","keyHooks","props","srcElement","metaKey","filter","original","which","charCode","keyCode","eventDoc","doc","fromElement","pageX","clientX","scrollLeft","clientLeft","pageY","clientY","scrollTop","clientTop","relatedTarget","toElement","load","focus","activeElement","blur","beforeunload","returnValue","simulate","bubble","isSimulated","defaultPrevented","getPreventDefault","timeStamp","cancelBubble","stopImmediatePropagation","mouseenter","mouseleave","orig","related","contains","submitBubbles","form","_submit_bubble","changeBubbles","propertyName","_just_changed","focusinBubbles","attaches","on","origFn","bind","unbind","delegate","undelegate","triggerHandler","cachedruns","Expr","getText","isXML","compile","hasDuplicate","outermostContext","setDocument","docElem","documentIsXML","rbuggyQSA","rbuggyMatches","sortOrder","preferredDoc","dirruns","classCache","createCache","tokenCache","compilerCache","strundefined","MAX_NEGATIVE","whitespace","characterEncoding","identifier","operators","pseudos","rcomma","rcombinators","rpseudo","ridentifier","matchExpr","rsibling","rnative","rinputs","rheader","rescape","rattributeQuotes","runescape","funescape","escaped","high","fromCharCode","isNative","keys","cacheLength","markFunction","assert","Sizzle","seed","m","groups","old","nid","newContext","newSelector","getByClassName","getElementsByClassName","qsa","tokenize","toSelector","querySelectorAll","qsaError","node","tagNameNoComments","createComment","insertBefore","pass","getElementsByName","getIdNotName","attrHandle","attrId","tag","matchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","msMatchesSelector","disconnectedMatch","compareDocumentPosition","b","adown","bup","compare","aup","ap","bp","siblingCheck","detectDuplicates","uniqueSort","duplicates","diff","sourceIndex","nextSibling","createInputPseudo","createButtonPseudo","createPositionalPseudo","argument","matchIndexes","textContent","nodeValue","selectors","createPseudo","relative","dir","preFilter","excess","unquoted","pattern","operator","check","what","simple","forward","ofType","outerCache","nodeIndex","useCache","pseudo","setFilters","idx","matcher","unmatched","innerText","lang","elemLang","hash","hasFocus","radio","checkbox","file","password","image","reset","parseOnly","tokens","soFar","preFilters","cached","addCombinator","combinator","base","checkNonElements","doneName","dirkey","elementMatcher","matchers","condense","newUnmatched","mapped","setMatcher","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","multipleContexts","matcherIn","matcherOut","matcherFromTokens","checkContext","leadingRelative","implicitRelative","matchContext","matchAnyContext","matcherFromGroupMatchers","elementMatchers","setMatchers","matcherCachedRuns","bySet","byElement","superMatcher","expandContext","setMatched","matchedCount","outermost","contextBackup","dirrunsUnique","group","token","filters","runtil","rparentsprev","isSimple","rneedsContext","guaranteedUnique","children","contents","prev","targets","not","winnow","is","closest","pos","prevAll","addBack","andSelf","sibling","parents","parentsUntil","until","nextAll","nextUntil","prevUntil","siblings","contentDocument","contentWindow","reverse","n","r","qualifier","keep","filtered","createSafeFragment","nodeNames","safeFrag","rinlinejQuery","rnoshimcache","rleadingWhitespace","rxhtmlTag","rtagName","rtbody","rhtml","rnoInnerhtml","manipulation_rcheckableType","rchecked","rscriptType","rscriptTypeMasked","rcleanScript","wrapMap","legend","area","param","thead","tr","col","td","safeFragment","fragmentDiv","optgroup","tfoot","colgroup","caption","th","append","createTextNode","wrapAll","html","wrap","wrapInner","unwrap","replaceWith","domManip","prepend","before","after","keepData","getAll","setGlobalEval","dataAndEvents","deepDataAndEvents","isFunc","table","hasScripts","iNoClone","disableScript","findOrAppend","restoreScript","ajax","url","dataType","refElements","cloneCopyEvent","dest","oldData","curData","fixCloneNodeIssues","defaultChecked","defaultSelected","appendTo","prependTo","insertAfter","replaceAll","insert","found","fixDefaultChecked","destElements","srcElements","inPage","selection","safe","nodes","iframe","getStyles","curCSS","ralpha","ropacity","rposition","rdisplayswap","rmargin","rnumsplit","rnumnonpx","rrelNum","elemdisplay","BODY","cssShow","position","visibility","cssNormalTransform","letterSpacing","fontWeight","cssExpand","cssPrefixes","vendorPropName","capName","origName","isHidden","el","css","showHide","show","hidden","css_defaultDisplay","styles","hide","toggle","bool","cssHooks","computed","cssNumber","cssProps","extra","swap","_computed","minWidth","maxWidth","getPropertyValue","currentStyle","left","rs","rsLeft","runtimeStyle","pixelLeft","setPositiveNumber","subtract","augmentWidthOrHeight","isBorderBox","getWidthOrHeight","valueIsBorderBox","actualDisplay","write","close","$1","visible","margin","padding","border","prefix","suffix","expand","expanded","parts","r20","rbracket","rCRLF","rsubmitterTypes","rsubmittable","serialize","serializeArray","traditional","s","encodeURIComponent","ajaxSettings","buildParams","v","hover","fnOver","fnOut","ajaxLocParts","ajaxLocation","ajax_nonce","ajax_rquery","rhash","rts","rheaders","rlocalProtocol","rnoContent","rprotocol","rurl","_load","prefilters","transports","allTypes","addToPrefiltersOrTransports","structure","dataTypeExpression","dataTypes","inspectPrefiltersOrTransports","originalOptions","jqXHR","inspected","seekingTransport","inspect","prefilterOrFactory","dataTypeOrTransport","ajaxExtend","flatOptions","params","response","responseText","complete","status","method","success","active","lastModified","etag","isLocal","processData","contentType","accepts","json","responseFields","converters","ajaxSetup","settings","ajaxPrefilter","ajaxTransport","cacheURL","responseHeadersString","timeoutTimer","fireGlobals","transport","responseHeaders","callbackContext","globalEventContext","completeDeferred","statusCode","requestHeaders","requestHeadersNames","strAbort","getResponseHeader","getAllResponseHeaders","setRequestHeader","lname","overrideMimeType","mimeType","code","abort","statusText","finalText","crossDomain","hasContent","ifModified","headers","beforeSend","send","nativeStatusText","responses","isSuccess","modified","ajaxHandleResponses","ajaxConvert","rejectWith","getScript","getJSON","firstDataType","ct","finalDataType","conv2","current","conv","dataFilter","script","head","scriptCharset","charset","onload","onreadystatechange","isAbort","oldCallbacks","rjsonp","jsonp","jsonpCallback","originalSettings","callbackName","overwritten","responseContainer","jsonProp","xhrCallbacks","xhrSupported","xhrId","xhrOnUnloadAbort","createStandardXHR","XMLHttpRequest","createActiveXHR","xhr","cors","username","open","xhrFields","err","firefoxAccessException","unload","fxNow","timerId","rfxtypes","rfxnum","rrun","animationPrefilters","defaultPrefilter","tweeners","unit","tween","createTween","scale","maxIterations","createFxNow","createTweens","animation","collection","Animation","properties","stopped","tick","currentTime","startTime","duration","percent","tweens","run","opts","specialEasing","originalProperties","Tween","easing","gotoEnd","propFilter","timer","anim","tweener","prefilter","dataShow","oldfire","handled","unqueued","overflow","overflowX","overflowY","eased","step","cssFn","speed","animate","genFx","fadeTo","to","optall","doAnimation","finish","stopQueue","timers","includeWidth","height","slideDown","slideUp","slideToggle","fadeIn","fadeOut","fadeToggle","linear","p","swing","cos","PI","interval","setInterval","clearInterval","slow","fast","animated","offset","setOffset","win","box","getBoundingClientRect","getWindow","pageYOffset","pageXOffset","curElem","curOffset","curCSSTop","curCSSLeft","calculatePosition","curPosition","curTop","curLeft","using","offsetParent","parentOffset","scrollTo","Height","Width","content","defaultExtra","funcName","define","amd"],"mappings":"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","sourcesContent":["/*!\r\n * jQuery JavaScript Library v1.9.1\r\n * http://jquery.com/\r\n *\r\n * Includes Sizzle.js\r\n * http://sizzlejs.com/\r\n *\r\n * Copyright 2005, 2012 jQuery Foundation, Inc. and other contributors\r\n * Released under the MIT license\r\n * http://jquery.org/license\r\n *\r\n * Date: 2013-2-4\r\n */\r\n(function( window, undefined ) {\r\n\r\n    // Can't do this because several apps including ASP.NET trace\r\n    // the stack via arguments.caller.callee and Firefox dies if\r\n    // you try to trace through \"use strict\" call chains. (#13335)\r\n    // Support: Firefox 18+\r\n    //\"use strict\";\r\n    var\r\n        // The deferred used on DOM ready\r\n        readyList,\r\n    \r\n        // A central reference to the root jQuery(document)\r\n        rootjQuery,\r\n    \r\n        // Support: IE<9\r\n        // For `typeof node.method` instead of `node.method !== undefined`\r\n        core_strundefined = typeof undefined,\r\n    \r\n        // Use the correct document accordingly with window argument (sandbox)\r\n        document = window.document,\r\n        location = window.location,\r\n    \r\n        // Map over jQuery in case of overwrite\r\n        _jQuery = window.jQuery,\r\n    \r\n        // Map over the $ in case of overwrite\r\n        _$ = window.$,\r\n    \r\n        // [[Class]] -> type pairs\r\n        class2type = {},\r\n    \r\n        // List of deleted data cache ids, so we can reuse them\r\n        core_deletedIds = [],\r\n    \r\n        core_version = \"1.9.1\",\r\n    \r\n        // Save a reference to some core methods\r\n        core_concat = core_deletedIds.concat,\r\n        core_push = core_deletedIds.push,\r\n        core_slice = core_deletedIds.slice,\r\n        core_indexOf = core_deletedIds.indexOf,\r\n        core_toString = class2type.toString,\r\n        core_hasOwn = class2type.hasOwnProperty,\r\n        core_trim = core_version.trim,\r\n    \r\n        // Define a local copy of jQuery\r\n        jQuery = function( selector, context ) {\r\n            // The jQuery object is actually just the init constructor 'enhanced'\r\n            return new jQuery.fn.init( selector, context, rootjQuery );\r\n        },\r\n    \r\n        // Used for matching numbers\r\n        core_pnum = /[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,\r\n    \r\n        // Used for splitting on whitespace\r\n        core_rnotwhite = /\\S+/g,\r\n    \r\n        // Make sure we trim BOM and NBSP (here's looking at you, Safari 5.0 and IE)\r\n        rtrim = /^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,\r\n    \r\n        // A simple way to check for HTML strings\r\n        // Prioritize #id over <tag> to avoid XSS via location.hash (#9521)\r\n        // Strict HTML recognition (#11290: must start with <)\r\n        rquickExpr = /^(?:(<[\\w\\W]+>)[^>]*|#([\\w-]*))$/,\r\n    \r\n        // Match a standalone tag\r\n        rsingleTag = /^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,\r\n    \r\n        // JSON RegExp\r\n        rvalidchars = /^[\\],:{}\\s]*$/,\r\n        rvalidbraces = /(?:^|:|,)(?:\\s*\\[)+/g,\r\n        rvalidescape = /\\\\(?:[\"\\\\\\/bfnrt]|u[\\da-fA-F]{4})/g,\r\n        rvalidtokens = /\"[^\"\\\\\\r\\n]*\"|true|false|null|-?(?:\\d+\\.|)\\d+(?:[eE][+-]?\\d+|)/g,\r\n    \r\n        // Matches dashed string for camelizing\r\n        rmsPrefix = /^-ms-/,\r\n        rdashAlpha = /-([\\da-z])/gi,\r\n    \r\n        // Used by jQuery.camelCase as callback to replace()\r\n        fcamelCase = function( all, letter ) {\r\n            return letter.toUpperCase();\r\n        },\r\n    \r\n        // The ready event handler\r\n        completed = function( event ) {\r\n    \r\n            // readyState === \"complete\" is good enough for us to call the dom ready in oldIE\r\n            if ( document.addEventListener || event.type === \"load\" || document.readyState === \"complete\" ) {\r\n                detach();\r\n                jQuery.ready();\r\n            }\r\n        },\r\n        // Clean-up method for dom ready events\r\n        detach = function() {\r\n            if ( document.addEventListener ) {\r\n                document.removeEventListener( \"DOMContentLoaded\", completed, false );\r\n                window.removeEventListener( \"load\", completed, false );\r\n    \r\n            } else {\r\n                document.detachEvent( \"onreadystatechange\", completed );\r\n                window.detachEvent( \"onload\", completed );\r\n            }\r\n        };\r\n    \r\n    jQuery.fn = jQuery.prototype = {\r\n        // The current version of jQuery being used\r\n        jquery: core_version,\r\n    \r\n        constructor: jQuery,\r\n        init: function( selector, context, rootjQuery ) {\r\n            var match, elem;\r\n    \r\n            // HANDLE: $(\"\"), $(null), $(undefined), $(false)\r\n            if ( !selector ) {\r\n                return this;\r\n            }\r\n    \r\n            // Handle HTML strings\r\n            if ( typeof selector === \"string\" ) {\r\n                if ( selector.charAt(0) === \"<\" && selector.charAt( selector.length - 1 ) === \">\" && selector.length >= 3 ) {\r\n                    // Assume that strings that start and end with <> are HTML and skip the regex check\r\n                    match = [ null, selector, null ];\r\n    \r\n                } else {\r\n                    match = rquickExpr.exec( selector );\r\n                }\r\n    \r\n                // Match html or make sure no context is specified for #id\r\n                if ( match && (match[1] || !context) ) {\r\n    \r\n                    // HANDLE: $(html) -> $(array)\r\n                    if ( match[1] ) {\r\n                        context = context instanceof jQuery ? context[0] : context;\r\n    \r\n                        // scripts is true for back-compat\r\n                        jQuery.merge( this, jQuery.parseHTML(\r\n                            match[1],\r\n                            context && context.nodeType ? context.ownerDocument || context : document,\r\n                            true\r\n                        ) );\r\n    \r\n                        // HANDLE: $(html, props)\r\n                        if ( rsingleTag.test( match[1] ) && jQuery.isPlainObject( context ) ) {\r\n                            for ( match in context ) {\r\n                                // Properties of context are called as methods if possible\r\n                                if ( jQuery.isFunction( this[ match ] ) ) {\r\n                                    this[ match ]( context[ match ] );\r\n    \r\n                                // ...and otherwise set as attributes\r\n                                } else {\r\n                                    this.attr( match, context[ match ] );\r\n                                }\r\n                            }\r\n                        }\r\n    \r\n                        return this;\r\n    \r\n                    // HANDLE: $(#id)\r\n                    } else {\r\n                        elem = document.getElementById( match[2] );\r\n    \r\n                        // Check parentNode to catch when Blackberry 4.6 returns\r\n                        // nodes that are no longer in the document #6963\r\n                        if ( elem && elem.parentNode ) {\r\n                            // Handle the case where IE and Opera return items\r\n                            // by name instead of ID\r\n                            if ( elem.id !== match[2] ) {\r\n                                return rootjQuery.find( selector );\r\n                            }\r\n    \r\n                            // Otherwise, we inject the element directly into the jQuery object\r\n                            this.length = 1;\r\n                            this[0] = elem;\r\n                        }\r\n    \r\n                        this.context = document;\r\n                        this.selector = selector;\r\n                        return this;\r\n                    }\r\n    \r\n                // HANDLE: $(expr, $(...))\r\n                } else if ( !context || context.jquery ) {\r\n                    return ( context || rootjQuery ).find( selector );\r\n    \r\n                // HANDLE: $(expr, context)\r\n                // (which is just equivalent to: $(context).find(expr)\r\n                } else {\r\n                    return this.constructor( context ).find( selector );\r\n                }\r\n    \r\n            // HANDLE: $(DOMElement)\r\n            } else if ( selector.nodeType ) {\r\n                this.context = this[0] = selector;\r\n                this.length = 1;\r\n                return this;\r\n    \r\n            // HANDLE: $(function)\r\n            // Shortcut for document ready\r\n            } else if ( jQuery.isFunction( selector ) ) {\r\n                return rootjQuery.ready( selector );\r\n            }\r\n    \r\n            if ( selector.selector !== undefined ) {\r\n                this.selector = selector.selector;\r\n                this.context = selector.context;\r\n            }\r\n    \r\n            return jQuery.makeArray( selector, this );\r\n        },\r\n    \r\n        // Start with an empty selector\r\n        selector: \"\",\r\n    \r\n        // The default length of a jQuery object is 0\r\n        length: 0,\r\n    \r\n        // The number of elements contained in the matched element set\r\n        size: function() {\r\n            return this.length;\r\n        },\r\n    \r\n        toArray: function() {\r\n            return core_slice.call( this );\r\n        },\r\n    \r\n        // Get the Nth element in the matched element set OR\r\n        // Get the whole matched element set as a clean array\r\n        get: function( num ) {\r\n            return num == null ?\r\n    \r\n                // Return a 'clean' array\r\n                this.toArray() :\r\n    \r\n                // Return just the object\r\n                ( num < 0 ? this[ this.length + num ] : this[ num ] );\r\n        },\r\n    \r\n        // Take an array of elements and push it onto the stack\r\n        // (returning the new matched element set)\r\n        pushStack: function( elems ) {\r\n    \r\n            // Build a new jQuery matched element set\r\n            var ret = jQuery.merge( this.constructor(), elems );\r\n    \r\n            // Add the old object onto the stack (as a reference)\r\n            ret.prevObject = this;\r\n            ret.context = this.context;\r\n    \r\n            // Return the newly-formed element set\r\n            return ret;\r\n        },\r\n    \r\n        // Execute a callback for every element in the matched set.\r\n        // (You can seed the arguments with an array of args, but this is\r\n        // only used internally.)\r\n        each: function( callback, args ) {\r\n            return jQuery.each( this, callback, args );\r\n        },\r\n    \r\n        ready: function( fn ) {\r\n            // Add the callback\r\n            jQuery.ready.promise().done( fn );\r\n    \r\n            return this;\r\n        },\r\n    \r\n        slice: function() {\r\n            return this.pushStack( core_slice.apply( this, arguments ) );\r\n        },\r\n    \r\n        first: function() {\r\n            return this.eq( 0 );\r\n        },\r\n    \r\n        last: function() {\r\n            return this.eq( -1 );\r\n        },\r\n    \r\n        eq: function( i ) {\r\n            var len = this.length,\r\n                j = +i + ( i < 0 ? len : 0 );\r\n            return this.pushStack( j >= 0 && j < len ? [ this[j] ] : [] );\r\n        },\r\n    \r\n        map: function( callback ) {\r\n            return this.pushStack( jQuery.map(this, function( elem, i ) {\r\n                return callback.call( elem, i, elem );\r\n            }));\r\n        },\r\n    \r\n        end: function() {\r\n            return this.prevObject || this.constructor(null);\r\n        },\r\n    \r\n        // For internal use only.\r\n        // Behaves like an Array's method, not like a jQuery method.\r\n        push: core_push,\r\n        sort: [].sort,\r\n        splice: [].splice\r\n    };\r\n    \r\n    // Give the init function the jQuery prototype for later instantiation\r\n    jQuery.fn.init.prototype = jQuery.fn;\r\n    \r\n    jQuery.extend = jQuery.fn.extend = function() {\r\n        var src, copyIsArray, copy, name, options, clone,\r\n            target = arguments[0] || {},\r\n            i = 1,\r\n            length = arguments.length,\r\n            deep = false;\r\n    \r\n        // Handle a deep copy situation\r\n        if ( typeof target === \"boolean\" ) {\r\n            deep = target;\r\n            target = arguments[1] || {};\r\n            // skip the boolean and the target\r\n            i = 2;\r\n        }\r\n    \r\n        // Handle case when target is a string or something (possible in deep copy)\r\n        if ( typeof target !== \"object\" && !jQuery.isFunction(target) ) {\r\n            target = {};\r\n        }\r\n    \r\n        // extend jQuery itself if only one argument is passed\r\n        if ( length === i ) {\r\n            target = this;\r\n            --i;\r\n        }\r\n    \r\n        for ( ; i < length; i++ ) {\r\n            // Only deal with non-null/undefined values\r\n            if ( (options = arguments[ i ]) != null ) {\r\n                // Extend the base object\r\n                for ( name in options ) {\r\n                    src = target[ name ];\r\n                    copy = options[ name ];\r\n    \r\n                    // Prevent never-ending loop\r\n                    if ( target === copy ) {\r\n                        continue;\r\n                    }\r\n    \r\n                    // Recurse if we're merging plain objects or arrays\r\n                    if ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {\r\n                        if ( copyIsArray ) {\r\n                            copyIsArray = false;\r\n                            clone = src && jQuery.isArray(src) ? src : [];\r\n    \r\n                        } else {\r\n                            clone = src && jQuery.isPlainObject(src) ? src : {};\r\n                        }\r\n    \r\n                        // Never move original objects, clone them\r\n                        target[ name ] = jQuery.extend( deep, clone, copy );\r\n    \r\n                    // Don't bring in undefined values\r\n                    } else if ( copy !== undefined ) {\r\n                        target[ name ] = copy;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        // Return the modified object\r\n        return target;\r\n    };\r\n    \r\n    jQuery.extend({\r\n        noConflict: function( deep ) {\r\n            if ( window.$ === jQuery ) {\r\n                window.$ = _$;\r\n            }\r\n    \r\n            if ( deep && window.jQuery === jQuery ) {\r\n                window.jQuery = _jQuery;\r\n            }\r\n    \r\n            return jQuery;\r\n        },\r\n    \r\n        // Is the DOM ready to be used? Set to true once it occurs.\r\n        isReady: false,\r\n    \r\n        // A counter to track how many items to wait for before\r\n        // the ready event fires. See #6781\r\n        readyWait: 1,\r\n    \r\n        // Hold (or release) the ready event\r\n        holdReady: function( hold ) {\r\n            if ( hold ) {\r\n                jQuery.readyWait++;\r\n            } else {\r\n                jQuery.ready( true );\r\n            }\r\n        },\r\n    \r\n        // Handle when the DOM is ready\r\n        ready: function( wait ) {\r\n    \r\n            // Abort if there are pending holds or we're already ready\r\n            if ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {\r\n                return;\r\n            }\r\n    \r\n            // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).\r\n            if ( !document.body ) {\r\n                return setTimeout( jQuery.ready );\r\n            }\r\n    \r\n            // Remember that the DOM is ready\r\n            jQuery.isReady = true;\r\n    \r\n            // If a normal DOM Ready event fired, decrement, and wait if need be\r\n            if ( wait !== true && --jQuery.readyWait > 0 ) {\r\n                return;\r\n            }\r\n    \r\n            // If there are functions bound, to execute\r\n            readyList.resolveWith( document, [ jQuery ] );\r\n    \r\n            // Trigger any bound ready events\r\n            if ( jQuery.fn.trigger ) {\r\n                jQuery( document ).trigger(\"ready\").off(\"ready\");\r\n            }\r\n        },\r\n    \r\n        // See test/unit/core.js for details concerning isFunction.\r\n        // Since version 1.3, DOM methods and functions like alert\r\n        // aren't supported. They return false on IE (#2968).\r\n        isFunction: function( obj ) {\r\n            return jQuery.type(obj) === \"function\";\r\n        },\r\n    \r\n        isArray: Array.isArray || function( obj ) {\r\n            return jQuery.type(obj) === \"array\";\r\n        },\r\n    \r\n        isWindow: function( obj ) {\r\n            return obj != null && obj == obj.window;\r\n        },\r\n    \r\n        isNumeric: function( obj ) {\r\n            return !isNaN( parseFloat(obj) ) && isFinite( obj );\r\n        },\r\n    \r\n        type: function( obj ) {\r\n            if ( obj == null ) {\r\n                return String( obj );\r\n            }\r\n            return typeof obj === \"object\" || typeof obj === \"function\" ?\r\n                class2type[ core_toString.call(obj) ] || \"object\" :\r\n                typeof obj;\r\n        },\r\n    \r\n        isPlainObject: function( obj ) {\r\n            // Must be an Object.\r\n            // Because of IE, we also have to check the presence of the constructor property.\r\n            // Make sure that DOM nodes and window objects don't pass through, as well\r\n            if ( !obj || jQuery.type(obj) !== \"object\" || obj.nodeType || jQuery.isWindow( obj ) ) {\r\n                return false;\r\n            }\r\n    \r\n            try {\r\n                // Not own constructor property must be Object\r\n                if ( obj.constructor &&\r\n                    !core_hasOwn.call(obj, \"constructor\") &&\r\n                    !core_hasOwn.call(obj.constructor.prototype, \"isPrototypeOf\") ) {\r\n                    return false;\r\n                }\r\n            } catch ( e ) {\r\n                // IE8,9 Will throw exceptions on certain host objects #9897\r\n                return false;\r\n            }\r\n    \r\n            // Own properties are enumerated firstly, so to speed up,\r\n            // if last one is own, then all properties are own.\r\n    \r\n            var key;\r\n            for ( key in obj ) {}\r\n    \r\n            return key === undefined || core_hasOwn.call( obj, key );\r\n        },\r\n    \r\n        isEmptyObject: function( obj ) {\r\n            var name;\r\n            for ( name in obj ) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n    \r\n        error: function( msg ) {\r\n            throw new Error( msg );\r\n        },\r\n    \r\n        // data: string of html\r\n        // context (optional): If specified, the fragment will be created in this context, defaults to document\r\n        // keepScripts (optional): If true, will include scripts passed in the html string\r\n        parseHTML: function( data, context, keepScripts ) {\r\n            if ( !data || typeof data !== \"string\" ) {\r\n                return null;\r\n            }\r\n            if ( typeof context === \"boolean\" ) {\r\n                keepScripts = context;\r\n                context = false;\r\n            }\r\n            context = context || document;\r\n    \r\n            var parsed = rsingleTag.exec( data ),\r\n                scripts = !keepScripts && [];\r\n    \r\n            // Single tag\r\n            if ( parsed ) {\r\n                return [ context.createElement( parsed[1] ) ];\r\n            }\r\n    \r\n            parsed = jQuery.buildFragment( [ data ], context, scripts );\r\n            if ( scripts ) {\r\n                jQuery( scripts ).remove();\r\n            }\r\n            return jQuery.merge( [], parsed.childNodes );\r\n        },\r\n    \r\n        parseJSON: function( data ) {\r\n            // Attempt to parse using the native JSON parser first\r\n            if ( window.JSON && window.JSON.parse ) {\r\n                return window.JSON.parse( data );\r\n            }\r\n    \r\n            if ( data === null ) {\r\n                return data;\r\n            }\r\n    \r\n            if ( typeof data === \"string\" ) {\r\n    \r\n                // Make sure leading/trailing whitespace is removed (IE can't handle it)\r\n                data = jQuery.trim( data );\r\n    \r\n                if ( data ) {\r\n                    // Make sure the incoming data is actual JSON\r\n                    // Logic borrowed from http://json.org/json2.js\r\n                    if ( rvalidchars.test( data.replace( rvalidescape, \"@\" )\r\n                        .replace( rvalidtokens, \"]\" )\r\n                        .replace( rvalidbraces, \"\")) ) {\r\n    \r\n                        return ( new Function( \"return \" + data ) )();\r\n                    }\r\n                }\r\n            }\r\n    \r\n            jQuery.error( \"Invalid JSON: \" + data );\r\n        },\r\n    \r\n        // Cross-browser xml parsing\r\n        parseXML: function( data ) {\r\n            var xml, tmp;\r\n            if ( !data || typeof data !== \"string\" ) {\r\n                return null;\r\n            }\r\n            try {\r\n                if ( window.DOMParser ) { // Standard\r\n                    tmp = new DOMParser();\r\n                    xml = tmp.parseFromString( data , \"text/xml\" );\r\n                } else { // IE\r\n                    xml = new ActiveXObject( \"Microsoft.XMLDOM\" );\r\n                    xml.async = \"false\";\r\n                    xml.loadXML( data );\r\n                }\r\n            } catch( e ) {\r\n                xml = undefined;\r\n            }\r\n            if ( !xml || !xml.documentElement || xml.getElementsByTagName( \"parsererror\" ).length ) {\r\n                jQuery.error( \"Invalid XML: \" + data );\r\n            }\r\n            return xml;\r\n        },\r\n    \r\n        noop: function() {},\r\n    \r\n        // Evaluates a script in a global context\r\n        // Workarounds based on findings by Jim Driscoll\r\n        // http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context\r\n        globalEval: function( data ) {\r\n            if ( data && jQuery.trim( data ) ) {\r\n                // We use execScript on Internet Explorer\r\n                // We use an anonymous function so that context is window\r\n                // rather than jQuery in Firefox\r\n                ( window.execScript || function( data ) {\r\n                    window[ \"eval\" ].call( window, data );\r\n                } )( data );\r\n            }\r\n        },\r\n    \r\n        // Convert dashed to camelCase; used by the css and data modules\r\n        // Microsoft forgot to hump their vendor prefix (#9572)\r\n        camelCase: function( string ) {\r\n            return string.replace( rmsPrefix, \"ms-\" ).replace( rdashAlpha, fcamelCase );\r\n        },\r\n    \r\n        nodeName: function( elem, name ) {\r\n            return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();\r\n        },\r\n    \r\n        // args is for internal usage only\r\n        each: function( obj, callback, args ) {\r\n            var value,\r\n                i = 0,\r\n                length = obj.length,\r\n                isArray = isArraylike( obj );\r\n    \r\n            if ( args ) {\r\n                if ( isArray ) {\r\n                    for ( ; i < length; i++ ) {\r\n                        value = callback.apply( obj[ i ], args );\r\n    \r\n                        if ( value === false ) {\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    for ( i in obj ) {\r\n                        value = callback.apply( obj[ i ], args );\r\n    \r\n                        if ( value === false ) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n    \r\n            // A special, fast, case for the most common use of each\r\n            } else {\r\n                if ( isArray ) {\r\n                    for ( ; i < length; i++ ) {\r\n                        value = callback.call( obj[ i ], i, obj[ i ] );\r\n    \r\n                        if ( value === false ) {\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    for ( i in obj ) {\r\n                        value = callback.call( obj[ i ], i, obj[ i ] );\r\n    \r\n                        if ( value === false ) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return obj;\r\n        },\r\n    \r\n        // Use native String.trim function wherever possible\r\n        trim: core_trim && !core_trim.call(\"\\uFEFF\\xA0\") ?\r\n            function( text ) {\r\n                return text == null ?\r\n                    \"\" :\r\n                    core_trim.call( text );\r\n            } :\r\n    \r\n            // Otherwise use our own trimming functionality\r\n            function( text ) {\r\n                return text == null ?\r\n                    \"\" :\r\n                    ( text + \"\" ).replace( rtrim, \"\" );\r\n            },\r\n    \r\n        // results is for internal usage only\r\n        makeArray: function( arr, results ) {\r\n            var ret = results || [];\r\n    \r\n            if ( arr != null ) {\r\n                if ( isArraylike( Object(arr) ) ) {\r\n                    jQuery.merge( ret,\r\n                        typeof arr === \"string\" ?\r\n                        [ arr ] : arr\r\n                    );\r\n                } else {\r\n                    core_push.call( ret, arr );\r\n                }\r\n            }\r\n    \r\n            return ret;\r\n        },\r\n    \r\n        inArray: function( elem, arr, i ) {\r\n            var len;\r\n    \r\n            if ( arr ) {\r\n                if ( core_indexOf ) {\r\n                    return core_indexOf.call( arr, elem, i );\r\n                }\r\n    \r\n                len = arr.length;\r\n                i = i ? i < 0 ? Math.max( 0, len + i ) : i : 0;\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    // Skip accessing in sparse arrays\r\n                    if ( i in arr && arr[ i ] === elem ) {\r\n                        return i;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return -1;\r\n        },\r\n    \r\n        merge: function( first, second ) {\r\n            var l = second.length,\r\n                i = first.length,\r\n                j = 0;\r\n    \r\n            if ( typeof l === \"number\" ) {\r\n                for ( ; j < l; j++ ) {\r\n                    first[ i++ ] = second[ j ];\r\n                }\r\n            } else {\r\n                while ( second[j] !== undefined ) {\r\n                    first[ i++ ] = second[ j++ ];\r\n                }\r\n            }\r\n    \r\n            first.length = i;\r\n    \r\n            return first;\r\n        },\r\n    \r\n        grep: function( elems, callback, inv ) {\r\n            var retVal,\r\n                ret = [],\r\n                i = 0,\r\n                length = elems.length;\r\n            inv = !!inv;\r\n    \r\n            // Go through the array, only saving the items\r\n            // that pass the validator function\r\n            for ( ; i < length; i++ ) {\r\n                retVal = !!callback( elems[ i ], i );\r\n                if ( inv !== retVal ) {\r\n                    ret.push( elems[ i ] );\r\n                }\r\n            }\r\n    \r\n            return ret;\r\n        },\r\n    \r\n        // arg is for internal usage only\r\n        map: function( elems, callback, arg ) {\r\n            var value,\r\n                i = 0,\r\n                length = elems.length,\r\n                isArray = isArraylike( elems ),\r\n                ret = [];\r\n    \r\n            // Go through the array, translating each of the items to their\r\n            if ( isArray ) {\r\n                for ( ; i < length; i++ ) {\r\n                    value = callback( elems[ i ], i, arg );\r\n    \r\n                    if ( value != null ) {\r\n                        ret[ ret.length ] = value;\r\n                    }\r\n                }\r\n    \r\n            // Go through every key on the object,\r\n            } else {\r\n                for ( i in elems ) {\r\n                    value = callback( elems[ i ], i, arg );\r\n    \r\n                    if ( value != null ) {\r\n                        ret[ ret.length ] = value;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Flatten any nested arrays\r\n            return core_concat.apply( [], ret );\r\n        },\r\n    \r\n        // A global GUID counter for objects\r\n        guid: 1,\r\n    \r\n        // Bind a function to a context, optionally partially applying any\r\n        // arguments.\r\n        proxy: function( fn, context ) {\r\n            var args, proxy, tmp;\r\n    \r\n            if ( typeof context === \"string\" ) {\r\n                tmp = fn[ context ];\r\n                context = fn;\r\n                fn = tmp;\r\n            }\r\n    \r\n            // Quick check to determine if target is callable, in the spec\r\n            // this throws a TypeError, but we will just return undefined.\r\n            if ( !jQuery.isFunction( fn ) ) {\r\n                return undefined;\r\n            }\r\n    \r\n            // Simulated bind\r\n            args = core_slice.call( arguments, 2 );\r\n            proxy = function() {\r\n                return fn.apply( context || this, args.concat( core_slice.call( arguments ) ) );\r\n            };\r\n    \r\n            // Set the guid of unique handler to the same of original handler, so it can be removed\r\n            proxy.guid = fn.guid = fn.guid || jQuery.guid++;\r\n    \r\n            return proxy;\r\n        },\r\n    \r\n        // Multifunctional method to get and set values of a collection\r\n        // The value/s can optionally be executed if it's a function\r\n        access: function( elems, fn, key, value, chainable, emptyGet, raw ) {\r\n            var i = 0,\r\n                length = elems.length,\r\n                bulk = key == null;\r\n    \r\n            // Sets many values\r\n            if ( jQuery.type( key ) === \"object\" ) {\r\n                chainable = true;\r\n                for ( i in key ) {\r\n                    jQuery.access( elems, fn, i, key[i], true, emptyGet, raw );\r\n                }\r\n    \r\n            // Sets one value\r\n            } else if ( value !== undefined ) {\r\n                chainable = true;\r\n    \r\n                if ( !jQuery.isFunction( value ) ) {\r\n                    raw = true;\r\n                }\r\n    \r\n                if ( bulk ) {\r\n                    // Bulk operations run against the entire set\r\n                    if ( raw ) {\r\n                        fn.call( elems, value );\r\n                        fn = null;\r\n    \r\n                    // ...except when executing function values\r\n                    } else {\r\n                        bulk = fn;\r\n                        fn = function( elem, key, value ) {\r\n                            return bulk.call( jQuery( elem ), value );\r\n                        };\r\n                    }\r\n                }\r\n    \r\n                if ( fn ) {\r\n                    for ( ; i < length; i++ ) {\r\n                        fn( elems[i], key, raw ? value : value.call( elems[i], i, fn( elems[i], key ) ) );\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return chainable ?\r\n                elems :\r\n    \r\n                // Gets\r\n                bulk ?\r\n                    fn.call( elems ) :\r\n                    length ? fn( elems[0], key ) : emptyGet;\r\n        },\r\n    \r\n        now: function() {\r\n            return ( new Date() ).getTime();\r\n        }\r\n    });\r\n    \r\n    jQuery.ready.promise = function( obj ) {\r\n        if ( !readyList ) {\r\n    \r\n            readyList = jQuery.Deferred();\r\n    \r\n            // Catch cases where $(document).ready() is called after the browser event has already occurred.\r\n            // we once tried to use readyState \"interactive\" here, but it caused issues like the one\r\n            // discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15\r\n            if ( document.readyState === \"complete\" ) {\r\n                // Handle it asynchronously to allow scripts the opportunity to delay ready\r\n                setTimeout( jQuery.ready );\r\n    \r\n            // Standards-based browsers support DOMContentLoaded\r\n            } else if ( document.addEventListener ) {\r\n                // Use the handy event callback\r\n                document.addEventListener( \"DOMContentLoaded\", completed, false );\r\n    \r\n                // A fallback to window.onload, that will always work\r\n                window.addEventListener( \"load\", completed, false );\r\n    \r\n            // If IE event model is used\r\n            } else {\r\n                // Ensure firing before onload, maybe late but safe also for iframes\r\n                document.attachEvent( \"onreadystatechange\", completed );\r\n    \r\n                // A fallback to window.onload, that will always work\r\n                window.attachEvent( \"onload\", completed );\r\n    \r\n                // If IE and not a frame\r\n                // continually check to see if the document is ready\r\n                var top = false;\r\n    \r\n                try {\r\n                    top = window.frameElement == null && document.documentElement;\r\n                } catch(e) {}\r\n    \r\n                if ( top && top.doScroll ) {\r\n                    (function doScrollCheck() {\r\n                        if ( !jQuery.isReady ) {\r\n    \r\n                            try {\r\n                                // Use the trick by Diego Perini\r\n                                // http://javascript.nwbox.com/IEContentLoaded/\r\n                                top.doScroll(\"left\");\r\n                            } catch(e) {\r\n                                return setTimeout( doScrollCheck, 50 );\r\n                            }\r\n    \r\n                            // detach all dom ready events\r\n                            detach();\r\n    \r\n                            // and execute any waiting functions\r\n                            jQuery.ready();\r\n                        }\r\n                    })();\r\n                }\r\n            }\r\n        }\r\n        return readyList.promise( obj );\r\n    };\r\n    \r\n    // Populate the class2type map\r\n    jQuery.each(\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"), function(i, name) {\r\n        class2type[ \"[object \" + name + \"]\" ] = name.toLowerCase();\r\n    });\r\n    \r\n    function isArraylike( obj ) {\r\n        var length = obj.length,\r\n            type = jQuery.type( obj );\r\n    \r\n        if ( jQuery.isWindow( obj ) ) {\r\n            return false;\r\n        }\r\n    \r\n        if ( obj.nodeType === 1 && length ) {\r\n            return true;\r\n        }\r\n    \r\n        return type === \"array\" || type !== \"function\" &&\r\n            ( length === 0 ||\r\n            typeof length === \"number\" && length > 0 && ( length - 1 ) in obj );\r\n    }\r\n    \r\n    // All jQuery objects should point back to these\r\n    rootjQuery = jQuery(document);\r\n    // String to Object options format cache\r\n    var optionsCache = {};\r\n    \r\n    // Convert String-formatted options into Object-formatted ones and store in cache\r\n    function createOptions( options ) {\r\n        var object = optionsCache[ options ] = {};\r\n        jQuery.each( options.match( core_rnotwhite ) || [], function( _, flag ) {\r\n            object[ flag ] = true;\r\n        });\r\n        return object;\r\n    }\r\n    \r\n    /*\r\n     * Create a callback list using the following parameters:\r\n     *\r\n     *\toptions: an optional list of space-separated options that will change how\r\n     *\t\t\tthe callback list behaves or a more traditional option object\r\n     *\r\n     * By default a callback list will act like an event callback list and can be\r\n     * \"fired\" multiple times.\r\n     *\r\n     * Possible options:\r\n     *\r\n     *\tonce:\t\t\twill ensure the callback list can only be fired once (like a Deferred)\r\n     *\r\n     *\tmemory:\t\t\twill keep track of previous values and will call any callback added\r\n     *\t\t\t\t\tafter the list has been fired right away with the latest \"memorized\"\r\n     *\t\t\t\t\tvalues (like a Deferred)\r\n     *\r\n     *\tunique:\t\t\twill ensure a callback can only be added once (no duplicate in the list)\r\n     *\r\n     *\tstopOnFalse:\tinterrupt callings when a callback returns false\r\n     *\r\n     */\r\n    jQuery.Callbacks = function( options ) {\r\n    \r\n        // Convert options from String-formatted to Object-formatted if needed\r\n        // (we check in cache first)\r\n        options = typeof options === \"string\" ?\r\n            ( optionsCache[ options ] || createOptions( options ) ) :\r\n            jQuery.extend( {}, options );\r\n    \r\n        var // Flag to know if list is currently firing\r\n            firing,\r\n            // Last fire value (for non-forgettable lists)\r\n            memory,\r\n            // Flag to know if list was already fired\r\n            fired,\r\n            // End of the loop when firing\r\n            firingLength,\r\n            // Index of currently firing callback (modified by remove if needed)\r\n            firingIndex,\r\n            // First callback to fire (used internally by add and fireWith)\r\n            firingStart,\r\n            // Actual callback list\r\n            list = [],\r\n            // Stack of fire calls for repeatable lists\r\n            stack = !options.once && [],\r\n            // Fire callbacks\r\n            fire = function( data ) {\r\n                memory = options.memory && data;\r\n                fired = true;\r\n                firingIndex = firingStart || 0;\r\n                firingStart = 0;\r\n                firingLength = list.length;\r\n                firing = true;\r\n                for ( ; list && firingIndex < firingLength; firingIndex++ ) {\r\n                    if ( list[ firingIndex ].apply( data[ 0 ], data[ 1 ] ) === false && options.stopOnFalse ) {\r\n                        memory = false; // To prevent further calls using add\r\n                        break;\r\n                    }\r\n                }\r\n                firing = false;\r\n                if ( list ) {\r\n                    if ( stack ) {\r\n                        if ( stack.length ) {\r\n                            fire( stack.shift() );\r\n                        }\r\n                    } else if ( memory ) {\r\n                        list = [];\r\n                    } else {\r\n                        self.disable();\r\n                    }\r\n                }\r\n            },\r\n            // Actual Callbacks object\r\n            self = {\r\n                // Add a callback or a collection of callbacks to the list\r\n                add: function() {\r\n                    if ( list ) {\r\n                        // First, we save the current length\r\n                        var start = list.length;\r\n                        (function add( args ) {\r\n                            jQuery.each( args, function( _, arg ) {\r\n                                var type = jQuery.type( arg );\r\n                                if ( type === \"function\" ) {\r\n                                    if ( !options.unique || !self.has( arg ) ) {\r\n                                        list.push( arg );\r\n                                    }\r\n                                } else if ( arg && arg.length && type !== \"string\" ) {\r\n                                    // Inspect recursively\r\n                                    add( arg );\r\n                                }\r\n                            });\r\n                        })( arguments );\r\n                        // Do we need to add the callbacks to the\r\n                        // current firing batch?\r\n                        if ( firing ) {\r\n                            firingLength = list.length;\r\n                        // With memory, if we're not firing then\r\n                        // we should call right away\r\n                        } else if ( memory ) {\r\n                            firingStart = start;\r\n                            fire( memory );\r\n                        }\r\n                    }\r\n                    return this;\r\n                },\r\n                // Remove a callback from the list\r\n                remove: function() {\r\n                    if ( list ) {\r\n                        jQuery.each( arguments, function( _, arg ) {\r\n                            var index;\r\n                            while( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {\r\n                                list.splice( index, 1 );\r\n                                // Handle firing indexes\r\n                                if ( firing ) {\r\n                                    if ( index <= firingLength ) {\r\n                                        firingLength--;\r\n                                    }\r\n                                    if ( index <= firingIndex ) {\r\n                                        firingIndex--;\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    return this;\r\n                },\r\n                // Check if a given callback is in the list.\r\n                // If no argument is given, return whether or not list has callbacks attached.\r\n                has: function( fn ) {\r\n                    return fn ? jQuery.inArray( fn, list ) > -1 : !!( list && list.length );\r\n                },\r\n                // Remove all callbacks from the list\r\n                empty: function() {\r\n                    list = [];\r\n                    return this;\r\n                },\r\n                // Have the list do nothing anymore\r\n                disable: function() {\r\n                    list = stack = memory = undefined;\r\n                    return this;\r\n                },\r\n                // Is it disabled?\r\n                disabled: function() {\r\n                    return !list;\r\n                },\r\n                // Lock the list in its current state\r\n                lock: function() {\r\n                    stack = undefined;\r\n                    if ( !memory ) {\r\n                        self.disable();\r\n                    }\r\n                    return this;\r\n                },\r\n                // Is it locked?\r\n                locked: function() {\r\n                    return !stack;\r\n                },\r\n                // Call all callbacks with the given context and arguments\r\n                fireWith: function( context, args ) {\r\n                    args = args || [];\r\n                    args = [ context, args.slice ? args.slice() : args ];\r\n                    if ( list && ( !fired || stack ) ) {\r\n                        if ( firing ) {\r\n                            stack.push( args );\r\n                        } else {\r\n                            fire( args );\r\n                        }\r\n                    }\r\n                    return this;\r\n                },\r\n                // Call all the callbacks with the given arguments\r\n                fire: function() {\r\n                    self.fireWith( this, arguments );\r\n                    return this;\r\n                },\r\n                // To know if the callbacks have already been called at least once\r\n                fired: function() {\r\n                    return !!fired;\r\n                }\r\n            };\r\n    \r\n        return self;\r\n    };\r\n    jQuery.extend({\r\n    \r\n        Deferred: function( func ) {\r\n            var tuples = [\r\n                    // action, add listener, listener list, final state\r\n                    [ \"resolve\", \"done\", jQuery.Callbacks(\"once memory\"), \"resolved\" ],\r\n                    [ \"reject\", \"fail\", jQuery.Callbacks(\"once memory\"), \"rejected\" ],\r\n                    [ \"notify\", \"progress\", jQuery.Callbacks(\"memory\") ]\r\n                ],\r\n                state = \"pending\",\r\n                promise = {\r\n                    state: function() {\r\n                        return state;\r\n                    },\r\n                    always: function() {\r\n                        deferred.done( arguments ).fail( arguments );\r\n                        return this;\r\n                    },\r\n                    then: function( /* fnDone, fnFail, fnProgress */ ) {\r\n                        var fns = arguments;\r\n                        return jQuery.Deferred(function( newDefer ) {\r\n                            jQuery.each( tuples, function( i, tuple ) {\r\n                                var action = tuple[ 0 ],\r\n                                    fn = jQuery.isFunction( fns[ i ] ) && fns[ i ];\r\n                                // deferred[ done | fail | progress ] for forwarding actions to newDefer\r\n                                deferred[ tuple[1] ](function() {\r\n                                    var returned = fn && fn.apply( this, arguments );\r\n                                    if ( returned && jQuery.isFunction( returned.promise ) ) {\r\n                                        returned.promise()\r\n                                            .done( newDefer.resolve )\r\n                                            .fail( newDefer.reject )\r\n                                            .progress( newDefer.notify );\r\n                                    } else {\r\n                                        newDefer[ action + \"With\" ]( this === promise ? newDefer.promise() : this, fn ? [ returned ] : arguments );\r\n                                    }\r\n                                });\r\n                            });\r\n                            fns = null;\r\n                        }).promise();\r\n                    },\r\n                    // Get a promise for this deferred\r\n                    // If obj is provided, the promise aspect is added to the object\r\n                    promise: function( obj ) {\r\n                        return obj != null ? jQuery.extend( obj, promise ) : promise;\r\n                    }\r\n                },\r\n                deferred = {};\r\n    \r\n            // Keep pipe for back-compat\r\n            promise.pipe = promise.then;\r\n    \r\n            // Add list-specific methods\r\n            jQuery.each( tuples, function( i, tuple ) {\r\n                var list = tuple[ 2 ],\r\n                    stateString = tuple[ 3 ];\r\n    \r\n                // promise[ done | fail | progress ] = list.add\r\n                promise[ tuple[1] ] = list.add;\r\n    \r\n                // Handle state\r\n                if ( stateString ) {\r\n                    list.add(function() {\r\n                        // state = [ resolved | rejected ]\r\n                        state = stateString;\r\n    \r\n                    // [ reject_list | resolve_list ].disable; progress_list.lock\r\n                    }, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2 ].lock );\r\n                }\r\n    \r\n                // deferred[ resolve | reject | notify ]\r\n                deferred[ tuple[0] ] = function() {\r\n                    deferred[ tuple[0] + \"With\" ]( this === deferred ? promise : this, arguments );\r\n                    return this;\r\n                };\r\n                deferred[ tuple[0] + \"With\" ] = list.fireWith;\r\n            });\r\n    \r\n            // Make the deferred a promise\r\n            promise.promise( deferred );\r\n    \r\n            // Call given func if any\r\n            if ( func ) {\r\n                func.call( deferred, deferred );\r\n            }\r\n    \r\n            // All done!\r\n            return deferred;\r\n        },\r\n    \r\n        // Deferred helper\r\n        when: function( subordinate /* , ..., subordinateN */ ) {\r\n            var i = 0,\r\n                resolveValues = core_slice.call( arguments ),\r\n                length = resolveValues.length,\r\n    \r\n                // the count of uncompleted subordinates\r\n                remaining = length !== 1 || ( subordinate && jQuery.isFunction( subordinate.promise ) ) ? length : 0,\r\n    \r\n                // the master Deferred. If resolveValues consist of only a single Deferred, just use that.\r\n                deferred = remaining === 1 ? subordinate : jQuery.Deferred(),\r\n    \r\n                // Update function for both resolve and progress values\r\n                updateFunc = function( i, contexts, values ) {\r\n                    return function( value ) {\r\n                        contexts[ i ] = this;\r\n                        values[ i ] = arguments.length > 1 ? core_slice.call( arguments ) : value;\r\n                        if( values === progressValues ) {\r\n                            deferred.notifyWith( contexts, values );\r\n                        } else if ( !( --remaining ) ) {\r\n                            deferred.resolveWith( contexts, values );\r\n                        }\r\n                    };\r\n                },\r\n    \r\n                progressValues, progressContexts, resolveContexts;\r\n    \r\n            // add listeners to Deferred subordinates; treat others as resolved\r\n            if ( length > 1 ) {\r\n                progressValues = new Array( length );\r\n                progressContexts = new Array( length );\r\n                resolveContexts = new Array( length );\r\n                for ( ; i < length; i++ ) {\r\n                    if ( resolveValues[ i ] && jQuery.isFunction( resolveValues[ i ].promise ) ) {\r\n                        resolveValues[ i ].promise()\r\n                            .done( updateFunc( i, resolveContexts, resolveValues ) )\r\n                            .fail( deferred.reject )\r\n                            .progress( updateFunc( i, progressContexts, progressValues ) );\r\n                    } else {\r\n                        --remaining;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // if we're not waiting on anything, resolve the master\r\n            if ( !remaining ) {\r\n                deferred.resolveWith( resolveContexts, resolveValues );\r\n            }\r\n    \r\n            return deferred.promise();\r\n        }\r\n    });\r\n    jQuery.support = (function() {\r\n    \r\n        var support, all, a,\r\n            input, select, fragment,\r\n            opt, eventName, isSupported, i,\r\n            div = document.createElement(\"div\");\r\n    \r\n        // Setup\r\n        div.setAttribute( \"className\", \"t\" );\r\n        div.innerHTML = \"  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>\";\r\n    \r\n        // Support tests won't run in some limited or non-browser environments\r\n        all = div.getElementsByTagName(\"*\");\r\n        a = div.getElementsByTagName(\"a\")[ 0 ];\r\n        if ( !all || !a || !all.length ) {\r\n            return {};\r\n        }\r\n    \r\n        // First batch of tests\r\n        select = document.createElement(\"select\");\r\n        opt = select.appendChild( document.createElement(\"option\") );\r\n        input = div.getElementsByTagName(\"input\")[ 0 ];\r\n    \r\n        a.style.cssText = \"top:1px;float:left;opacity:.5\";\r\n        support = {\r\n            // Test setAttribute on camelCase class. If it works, we need attrFixes when doing get/setAttribute (ie6/7)\r\n            getSetAttribute: div.className !== \"t\",\r\n    \r\n            // IE strips leading whitespace when .innerHTML is used\r\n            leadingWhitespace: div.firstChild.nodeType === 3,\r\n    \r\n            // Make sure that tbody elements aren't automatically inserted\r\n            // IE will insert them into empty tables\r\n            tbody: !div.getElementsByTagName(\"tbody\").length,\r\n    \r\n            // Make sure that link elements get serialized correctly by innerHTML\r\n            // This requires a wrapper element in IE\r\n            htmlSerialize: !!div.getElementsByTagName(\"link\").length,\r\n    \r\n            // Get the style information from getAttribute\r\n            // (IE uses .cssText instead)\r\n            style: /top/.test( a.getAttribute(\"style\") ),\r\n    \r\n            // Make sure that URLs aren't manipulated\r\n            // (IE normalizes it by default)\r\n            hrefNormalized: a.getAttribute(\"href\") === \"/a\",\r\n    \r\n            // Make sure that element opacity exists\r\n            // (IE uses filter instead)\r\n            // Use a regex to work around a WebKit issue. See #5145\r\n            opacity: /^0.5/.test( a.style.opacity ),\r\n    \r\n            // Verify style float existence\r\n            // (IE uses styleFloat instead of cssFloat)\r\n            cssFloat: !!a.style.cssFloat,\r\n    \r\n            // Check the default checkbox/radio value (\"\" on WebKit; \"on\" elsewhere)\r\n            checkOn: !!input.value,\r\n    \r\n            // Make sure that a selected-by-default option has a working selected property.\r\n            // (WebKit defaults to false instead of true, IE too, if it's in an optgroup)\r\n            optSelected: opt.selected,\r\n    \r\n            // Tests for enctype support on a form (#6743)\r\n            enctype: !!document.createElement(\"form\").enctype,\r\n    \r\n            // Makes sure cloning an html5 element does not cause problems\r\n            // Where outerHTML is undefined, this still works\r\n            html5Clone: document.createElement(\"nav\").cloneNode( true ).outerHTML !== \"<:nav></:nav>\",\r\n    \r\n            // jQuery.support.boxModel DEPRECATED in 1.8 since we don't support Quirks Mode\r\n            boxModel: document.compatMode === \"CSS1Compat\",\r\n    \r\n            // Will be defined later\r\n            deleteExpando: true,\r\n            noCloneEvent: true,\r\n            inlineBlockNeedsLayout: false,\r\n            shrinkWrapBlocks: false,\r\n            reliableMarginRight: true,\r\n            boxSizingReliable: true,\r\n            pixelPosition: false\r\n        };\r\n    \r\n        // Make sure checked status is properly cloned\r\n        input.checked = true;\r\n        support.noCloneChecked = input.cloneNode( true ).checked;\r\n    \r\n        // Make sure that the options inside disabled selects aren't marked as disabled\r\n        // (WebKit marks them as disabled)\r\n        select.disabled = true;\r\n        support.optDisabled = !opt.disabled;\r\n    \r\n        // Support: IE<9\r\n        try {\r\n            delete div.test;\r\n        } catch( e ) {\r\n            support.deleteExpando = false;\r\n        }\r\n    \r\n        // Check if we can trust getAttribute(\"value\")\r\n        input = document.createElement(\"input\");\r\n        input.setAttribute( \"value\", \"\" );\r\n        support.input = input.getAttribute( \"value\" ) === \"\";\r\n    \r\n        // Check if an input maintains its value after becoming a radio\r\n        input.value = \"t\";\r\n        input.setAttribute( \"type\", \"radio\" );\r\n        support.radioValue = input.value === \"t\";\r\n    \r\n        // #11217 - WebKit loses check when the name is after the checked attribute\r\n        input.setAttribute( \"checked\", \"t\" );\r\n        input.setAttribute( \"name\", \"t\" );\r\n    \r\n        fragment = document.createDocumentFragment();\r\n        fragment.appendChild( input );\r\n    \r\n        // Check if a disconnected checkbox will retain its checked\r\n        // value of true after appended to the DOM (IE6/7)\r\n        support.appendChecked = input.checked;\r\n    \r\n        // WebKit doesn't clone checked state correctly in fragments\r\n        support.checkClone = fragment.cloneNode( true ).cloneNode( true ).lastChild.checked;\r\n    \r\n        // Support: IE<9\r\n        // Opera does not clone events (and typeof div.attachEvent === undefined).\r\n        // IE9-10 clones events bound via attachEvent, but they don't trigger with .click()\r\n        if ( div.attachEvent ) {\r\n            div.attachEvent( \"onclick\", function() {\r\n                support.noCloneEvent = false;\r\n            });\r\n    \r\n            div.cloneNode( true ).click();\r\n        }\r\n    \r\n        // Support: IE<9 (lack submit/change bubble), Firefox 17+ (lack focusin event)\r\n        // Beware of CSP restrictions (https://developer.mozilla.org/en/Security/CSP), test/csp.php\r\n        for ( i in { submit: true, change: true, focusin: true }) {\r\n            div.setAttribute( eventName = \"on\" + i, \"t\" );\r\n    \r\n            support[ i + \"Bubbles\" ] = eventName in window || div.attributes[ eventName ].expando === false;\r\n        }\r\n    \r\n        div.style.backgroundClip = \"content-box\";\r\n        div.cloneNode( true ).style.backgroundClip = \"\";\r\n        support.clearCloneStyle = div.style.backgroundClip === \"content-box\";\r\n    \r\n        // Run tests that need a body at doc ready\r\n        jQuery(function() {\r\n            var container, marginDiv, tds,\r\n                divReset = \"padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;\",\r\n                body = document.getElementsByTagName(\"body\")[0];\r\n    \r\n            if ( !body ) {\r\n                // Return for frameset docs that don't have a body\r\n                return;\r\n            }\r\n    \r\n            container = document.createElement(\"div\");\r\n            container.style.cssText = \"border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px\";\r\n    \r\n            body.appendChild( container ).appendChild( div );\r\n    \r\n            // Support: IE8\r\n            // Check if table cells still have offsetWidth/Height when they are set\r\n            // to display:none and there are still other visible table cells in a\r\n            // table row; if so, offsetWidth/Height are not reliable for use when\r\n            // determining if an element has been hidden directly using\r\n            // display:none (it is still safe to use offsets if a parent element is\r\n            // hidden; don safety goggles and see bug #4512 for more information).\r\n            div.innerHTML = \"<table><tr><td></td><td>t</td></tr></table>\";\r\n            tds = div.getElementsByTagName(\"td\");\r\n            tds[ 0 ].style.cssText = \"padding:0;margin:0;border:0;display:none\";\r\n            isSupported = ( tds[ 0 ].offsetHeight === 0 );\r\n    \r\n            tds[ 0 ].style.display = \"\";\r\n            tds[ 1 ].style.display = \"none\";\r\n    \r\n            // Support: IE8\r\n            // Check if empty table cells still have offsetWidth/Height\r\n            support.reliableHiddenOffsets = isSupported && ( tds[ 0 ].offsetHeight === 0 );\r\n    \r\n            // Check box-sizing and margin behavior\r\n            div.innerHTML = \"\";\r\n            div.style.cssText = \"box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;\";\r\n            support.boxSizing = ( div.offsetWidth === 4 );\r\n            support.doesNotIncludeMarginInBodyOffset = ( body.offsetTop !== 1 );\r\n    \r\n            // Use window.getComputedStyle because jsdom on node.js will break without it.\r\n            if ( window.getComputedStyle ) {\r\n                support.pixelPosition = ( window.getComputedStyle( div, null ) || {} ).top !== \"1%\";\r\n                support.boxSizingReliable = ( window.getComputedStyle( div, null ) || { width: \"4px\" } ).width === \"4px\";\r\n    \r\n                // Check if div with explicit width and no margin-right incorrectly\r\n                // gets computed margin-right based on width of container. (#3333)\r\n                // Fails in WebKit before Feb 2011 nightlies\r\n                // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right\r\n                marginDiv = div.appendChild( document.createElement(\"div\") );\r\n                marginDiv.style.cssText = div.style.cssText = divReset;\r\n                marginDiv.style.marginRight = marginDiv.style.width = \"0\";\r\n                div.style.width = \"1px\";\r\n    \r\n                support.reliableMarginRight =\r\n                    !parseFloat( ( window.getComputedStyle( marginDiv, null ) || {} ).marginRight );\r\n            }\r\n    \r\n            if ( typeof div.style.zoom !== core_strundefined ) {\r\n                // Support: IE<8\r\n                // Check if natively block-level elements act like inline-block\r\n                // elements when setting their display to 'inline' and giving\r\n                // them layout\r\n                div.innerHTML = \"\";\r\n                div.style.cssText = divReset + \"width:1px;padding:1px;display:inline;zoom:1\";\r\n                support.inlineBlockNeedsLayout = ( div.offsetWidth === 3 );\r\n    \r\n                // Support: IE6\r\n                // Check if elements with layout shrink-wrap their children\r\n                div.style.display = \"block\";\r\n                div.innerHTML = \"<div></div>\";\r\n                div.firstChild.style.width = \"5px\";\r\n                support.shrinkWrapBlocks = ( div.offsetWidth !== 3 );\r\n    \r\n                if ( support.inlineBlockNeedsLayout ) {\r\n                    // Prevent IE 6 from affecting layout for positioned elements #11048\r\n                    // Prevent IE from shrinking the body in IE 7 mode #12869\r\n                    // Support: IE<8\r\n                    body.style.zoom = 1;\r\n                }\r\n            }\r\n    \r\n            body.removeChild( container );\r\n    \r\n            // Null elements to avoid leaks in IE\r\n            container = div = tds = marginDiv = null;\r\n        });\r\n    \r\n        // Null elements to avoid leaks in IE\r\n        all = select = fragment = opt = a = input = null;\r\n    \r\n        return support;\r\n    })();\r\n    \r\n    var rbrace = /(?:\\{[\\s\\S]*\\}|\\[[\\s\\S]*\\])$/,\r\n        rmultiDash = /([A-Z])/g;\r\n    \r\n    function internalData( elem, name, data, pvt /* Internal Use Only */ ){\r\n        if ( !jQuery.acceptData( elem ) ) {\r\n            return;\r\n        }\r\n    \r\n        var thisCache, ret,\r\n            internalKey = jQuery.expando,\r\n            getByName = typeof name === \"string\",\r\n    \r\n            // We have to handle DOM nodes and JS objects differently because IE6-7\r\n            // can't GC object references properly across the DOM-JS boundary\r\n            isNode = elem.nodeType,\r\n    \r\n            // Only DOM nodes need the global jQuery cache; JS object data is\r\n            // attached directly to the object so GC can occur automatically\r\n            cache = isNode ? jQuery.cache : elem,\r\n    \r\n            // Only defining an ID for JS objects if its cache already exists allows\r\n            // the code to shortcut on the same path as a DOM node with no cache\r\n            id = isNode ? elem[ internalKey ] : elem[ internalKey ] && internalKey;\r\n    \r\n        // Avoid doing any more work than we need to when trying to get data on an\r\n        // object that has no data at all\r\n        if ( (!id || !cache[id] || (!pvt && !cache[id].data)) && getByName && data === undefined ) {\r\n            return;\r\n        }\r\n    \r\n        if ( !id ) {\r\n            // Only DOM nodes need a new unique ID for each element since their data\r\n            // ends up in the global cache\r\n            if ( isNode ) {\r\n                elem[ internalKey ] = id = core_deletedIds.pop() || jQuery.guid++;\r\n            } else {\r\n                id = internalKey;\r\n            }\r\n        }\r\n    \r\n        if ( !cache[ id ] ) {\r\n            cache[ id ] = {};\r\n    \r\n            // Avoids exposing jQuery metadata on plain JS objects when the object\r\n            // is serialized using JSON.stringify\r\n            if ( !isNode ) {\r\n                cache[ id ].toJSON = jQuery.noop;\r\n            }\r\n        }\r\n    \r\n        // An object can be passed to jQuery.data instead of a key/value pair; this gets\r\n        // shallow copied over onto the existing cache\r\n        if ( typeof name === \"object\" || typeof name === \"function\" ) {\r\n            if ( pvt ) {\r\n                cache[ id ] = jQuery.extend( cache[ id ], name );\r\n            } else {\r\n                cache[ id ].data = jQuery.extend( cache[ id ].data, name );\r\n            }\r\n        }\r\n    \r\n        thisCache = cache[ id ];\r\n    \r\n        // jQuery data() is stored in a separate object inside the object's internal data\r\n        // cache in order to avoid key collisions between internal data and user-defined\r\n        // data.\r\n        if ( !pvt ) {\r\n            if ( !thisCache.data ) {\r\n                thisCache.data = {};\r\n            }\r\n    \r\n            thisCache = thisCache.data;\r\n        }\r\n    \r\n        if ( data !== undefined ) {\r\n            thisCache[ jQuery.camelCase( name ) ] = data;\r\n        }\r\n    \r\n        // Check for both converted-to-camel and non-converted data property names\r\n        // If a data property was specified\r\n        if ( getByName ) {\r\n    \r\n            // First Try to find as-is property data\r\n            ret = thisCache[ name ];\r\n    \r\n            // Test for null|undefined property data\r\n            if ( ret == null ) {\r\n    \r\n                // Try to find the camelCased property\r\n                ret = thisCache[ jQuery.camelCase( name ) ];\r\n            }\r\n        } else {\r\n            ret = thisCache;\r\n        }\r\n    \r\n        return ret;\r\n    }\r\n    \r\n    function internalRemoveData( elem, name, pvt ) {\r\n        if ( !jQuery.acceptData( elem ) ) {\r\n            return;\r\n        }\r\n    \r\n        var i, l, thisCache,\r\n            isNode = elem.nodeType,\r\n    \r\n            // See jQuery.data for more information\r\n            cache = isNode ? jQuery.cache : elem,\r\n            id = isNode ? elem[ jQuery.expando ] : jQuery.expando;\r\n    \r\n        // If there is already no cache entry for this object, there is no\r\n        // purpose in continuing\r\n        if ( !cache[ id ] ) {\r\n            return;\r\n        }\r\n    \r\n        if ( name ) {\r\n    \r\n            thisCache = pvt ? cache[ id ] : cache[ id ].data;\r\n    \r\n            if ( thisCache ) {\r\n    \r\n                // Support array or space separated string names for data keys\r\n                if ( !jQuery.isArray( name ) ) {\r\n    \r\n                    // try the string as a key before any manipulation\r\n                    if ( name in thisCache ) {\r\n                        name = [ name ];\r\n                    } else {\r\n    \r\n                        // split the camel cased version by spaces unless a key with the spaces exists\r\n                        name = jQuery.camelCase( name );\r\n                        if ( name in thisCache ) {\r\n                            name = [ name ];\r\n                        } else {\r\n                            name = name.split(\" \");\r\n                        }\r\n                    }\r\n                } else {\r\n                    // If \"name\" is an array of keys...\r\n                    // When data is initially created, via (\"key\", \"val\") signature,\r\n                    // keys will be converted to camelCase.\r\n                    // Since there is no way to tell _how_ a key was added, remove\r\n                    // both plain key and camelCase key. #12786\r\n                    // This will only penalize the array argument path.\r\n                    name = name.concat( jQuery.map( name, jQuery.camelCase ) );\r\n                }\r\n    \r\n                for ( i = 0, l = name.length; i < l; i++ ) {\r\n                    delete thisCache[ name[i] ];\r\n                }\r\n    \r\n                // If there is no data left in the cache, we want to continue\r\n                // and let the cache object itself get destroyed\r\n                if ( !( pvt ? isEmptyDataObject : jQuery.isEmptyObject )( thisCache ) ) {\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    \r\n        // See jQuery.data for more information\r\n        if ( !pvt ) {\r\n            delete cache[ id ].data;\r\n    \r\n            // Don't destroy the parent cache unless the internal data object\r\n            // had been the only thing left in it\r\n            if ( !isEmptyDataObject( cache[ id ] ) ) {\r\n                return;\r\n            }\r\n        }\r\n    \r\n        // Destroy the cache\r\n        if ( isNode ) {\r\n            jQuery.cleanData( [ elem ], true );\r\n    \r\n        // Use delete when supported for expandos or `cache` is not a window per isWindow (#10080)\r\n        } else if ( jQuery.support.deleteExpando || cache != cache.window ) {\r\n            delete cache[ id ];\r\n    \r\n        // When all else fails, null\r\n        } else {\r\n            cache[ id ] = null;\r\n        }\r\n    }\r\n    \r\n    jQuery.extend({\r\n        cache: {},\r\n    \r\n        // Unique for each copy of jQuery on the page\r\n        // Non-digits removed to match rinlinejQuery\r\n        expando: \"jQuery\" + ( core_version + Math.random() ).replace( /\\D/g, \"\" ),\r\n    \r\n        // The following elements throw uncatchable exceptions if you\r\n        // attempt to add expando properties to them.\r\n        noData: {\r\n            \"embed\": true,\r\n            // Ban all objects except for Flash (which handle expandos)\r\n            \"object\": \"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\",\r\n            \"applet\": true\r\n        },\r\n    \r\n        hasData: function( elem ) {\r\n            elem = elem.nodeType ? jQuery.cache[ elem[jQuery.expando] ] : elem[ jQuery.expando ];\r\n            return !!elem && !isEmptyDataObject( elem );\r\n        },\r\n    \r\n        data: function( elem, name, data ) {\r\n            return internalData( elem, name, data );\r\n        },\r\n    \r\n        removeData: function( elem, name ) {\r\n            return internalRemoveData( elem, name );\r\n        },\r\n    \r\n        // For internal use only.\r\n        _data: function( elem, name, data ) {\r\n            return internalData( elem, name, data, true );\r\n        },\r\n    \r\n        _removeData: function( elem, name ) {\r\n            return internalRemoveData( elem, name, true );\r\n        },\r\n    \r\n        // A method for determining if a DOM node can handle the data expando\r\n        acceptData: function( elem ) {\r\n            // Do not set data on non-element because it will not be cleared (#8335).\r\n            if ( elem.nodeType && elem.nodeType !== 1 && elem.nodeType !== 9 ) {\r\n                return false;\r\n            }\r\n    \r\n            var noData = elem.nodeName && jQuery.noData[ elem.nodeName.toLowerCase() ];\r\n    \r\n            // nodes accept data unless otherwise specified; rejection can be conditional\r\n            return !noData || noData !== true && elem.getAttribute(\"classid\") === noData;\r\n        }\r\n    });\r\n    \r\n    jQuery.fn.extend({\r\n        data: function( key, value ) {\r\n            var attrs, name,\r\n                elem = this[0],\r\n                i = 0,\r\n                data = null;\r\n    \r\n            // Gets all values\r\n            if ( key === undefined ) {\r\n                if ( this.length ) {\r\n                    data = jQuery.data( elem );\r\n    \r\n                    if ( elem.nodeType === 1 && !jQuery._data( elem, \"parsedAttrs\" ) ) {\r\n                        attrs = elem.attributes;\r\n                        for ( ; i < attrs.length; i++ ) {\r\n                            name = attrs[i].name;\r\n    \r\n                            if ( !name.indexOf( \"data-\" ) ) {\r\n                                name = jQuery.camelCase( name.slice(5) );\r\n    \r\n                                dataAttr( elem, name, data[ name ] );\r\n                            }\r\n                        }\r\n                        jQuery._data( elem, \"parsedAttrs\", true );\r\n                    }\r\n                }\r\n    \r\n                return data;\r\n            }\r\n    \r\n            // Sets multiple values\r\n            if ( typeof key === \"object\" ) {\r\n                return this.each(function() {\r\n                    jQuery.data( this, key );\r\n                });\r\n            }\r\n    \r\n            return jQuery.access( this, function( value ) {\r\n    \r\n                if ( value === undefined ) {\r\n                    // Try to fetch any internally stored data first\r\n                    return elem ? dataAttr( elem, key, jQuery.data( elem, key ) ) : null;\r\n                }\r\n    \r\n                this.each(function() {\r\n                    jQuery.data( this, key, value );\r\n                });\r\n            }, null, value, arguments.length > 1, null, true );\r\n        },\r\n    \r\n        removeData: function( key ) {\r\n            return this.each(function() {\r\n                jQuery.removeData( this, key );\r\n            });\r\n        }\r\n    });\r\n    \r\n    function dataAttr( elem, key, data ) {\r\n        // If nothing was found internally, try to fetch any\r\n        // data from the HTML5 data-* attribute\r\n        if ( data === undefined && elem.nodeType === 1 ) {\r\n    \r\n            var name = \"data-\" + key.replace( rmultiDash, \"-$1\" ).toLowerCase();\r\n    \r\n            data = elem.getAttribute( name );\r\n    \r\n            if ( typeof data === \"string\" ) {\r\n                try {\r\n                    data = data === \"true\" ? true :\r\n                        data === \"false\" ? false :\r\n                        data === \"null\" ? null :\r\n                        // Only convert to a number if it doesn't change the string\r\n                        +data + \"\" === data ? +data :\r\n                        rbrace.test( data ) ? jQuery.parseJSON( data ) :\r\n                            data;\r\n                } catch( e ) {}\r\n    \r\n                // Make sure we set the data so it isn't changed later\r\n                jQuery.data( elem, key, data );\r\n    \r\n            } else {\r\n                data = undefined;\r\n            }\r\n        }\r\n    \r\n        return data;\r\n    }\r\n    \r\n    // checks a cache object for emptiness\r\n    function isEmptyDataObject( obj ) {\r\n        var name;\r\n        for ( name in obj ) {\r\n    \r\n            // if the public data object is empty, the private is still empty\r\n            if ( name === \"data\" && jQuery.isEmptyObject( obj[name] ) ) {\r\n                continue;\r\n            }\r\n            if ( name !== \"toJSON\" ) {\r\n                return false;\r\n            }\r\n        }\r\n    \r\n        return true;\r\n    }\r\n    jQuery.extend({\r\n        queue: function( elem, type, data ) {\r\n            var queue;\r\n    \r\n            if ( elem ) {\r\n                type = ( type || \"fx\" ) + \"queue\";\r\n                queue = jQuery._data( elem, type );\r\n    \r\n                // Speed up dequeue by getting out quickly if this is just a lookup\r\n                if ( data ) {\r\n                    if ( !queue || jQuery.isArray(data) ) {\r\n                        queue = jQuery._data( elem, type, jQuery.makeArray(data) );\r\n                    } else {\r\n                        queue.push( data );\r\n                    }\r\n                }\r\n                return queue || [];\r\n            }\r\n        },\r\n    \r\n        dequeue: function( elem, type ) {\r\n            type = type || \"fx\";\r\n    \r\n            var queue = jQuery.queue( elem, type ),\r\n                startLength = queue.length,\r\n                fn = queue.shift(),\r\n                hooks = jQuery._queueHooks( elem, type ),\r\n                next = function() {\r\n                    jQuery.dequeue( elem, type );\r\n                };\r\n    \r\n            // If the fx queue is dequeued, always remove the progress sentinel\r\n            if ( fn === \"inprogress\" ) {\r\n                fn = queue.shift();\r\n                startLength--;\r\n            }\r\n    \r\n            hooks.cur = fn;\r\n            if ( fn ) {\r\n    \r\n                // Add a progress sentinel to prevent the fx queue from being\r\n                // automatically dequeued\r\n                if ( type === \"fx\" ) {\r\n                    queue.unshift( \"inprogress\" );\r\n                }\r\n    \r\n                // clear up the last queue stop function\r\n                delete hooks.stop;\r\n                fn.call( elem, next, hooks );\r\n            }\r\n    \r\n            if ( !startLength && hooks ) {\r\n                hooks.empty.fire();\r\n            }\r\n        },\r\n    \r\n        // not intended for public consumption - generates a queueHooks object, or returns the current one\r\n        _queueHooks: function( elem, type ) {\r\n            var key = type + \"queueHooks\";\r\n            return jQuery._data( elem, key ) || jQuery._data( elem, key, {\r\n                empty: jQuery.Callbacks(\"once memory\").add(function() {\r\n                    jQuery._removeData( elem, type + \"queue\" );\r\n                    jQuery._removeData( elem, key );\r\n                })\r\n            });\r\n        }\r\n    });\r\n    \r\n    jQuery.fn.extend({\r\n        queue: function( type, data ) {\r\n            var setter = 2;\r\n    \r\n            if ( typeof type !== \"string\" ) {\r\n                data = type;\r\n                type = \"fx\";\r\n                setter--;\r\n            }\r\n    \r\n            if ( arguments.length < setter ) {\r\n                return jQuery.queue( this[0], type );\r\n            }\r\n    \r\n            return data === undefined ?\r\n                this :\r\n                this.each(function() {\r\n                    var queue = jQuery.queue( this, type, data );\r\n    \r\n                    // ensure a hooks for this queue\r\n                    jQuery._queueHooks( this, type );\r\n    \r\n                    if ( type === \"fx\" && queue[0] !== \"inprogress\" ) {\r\n                        jQuery.dequeue( this, type );\r\n                    }\r\n                });\r\n        },\r\n        dequeue: function( type ) {\r\n            return this.each(function() {\r\n                jQuery.dequeue( this, type );\r\n            });\r\n        },\r\n        // Based off of the plugin by Clint Helfers, with permission.\r\n        // http://blindsignals.com/index.php/2009/07/jquery-delay/\r\n        delay: function( time, type ) {\r\n            time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;\r\n            type = type || \"fx\";\r\n    \r\n            return this.queue( type, function( next, hooks ) {\r\n                var timeout = setTimeout( next, time );\r\n                hooks.stop = function() {\r\n                    clearTimeout( timeout );\r\n                };\r\n            });\r\n        },\r\n        clearQueue: function( type ) {\r\n            return this.queue( type || \"fx\", [] );\r\n        },\r\n        // Get a promise resolved when queues of a certain type\r\n        // are emptied (fx is the type by default)\r\n        promise: function( type, obj ) {\r\n            var tmp,\r\n                count = 1,\r\n                defer = jQuery.Deferred(),\r\n                elements = this,\r\n                i = this.length,\r\n                resolve = function() {\r\n                    if ( !( --count ) ) {\r\n                        defer.resolveWith( elements, [ elements ] );\r\n                    }\r\n                };\r\n    \r\n            if ( typeof type !== \"string\" ) {\r\n                obj = type;\r\n                type = undefined;\r\n            }\r\n            type = type || \"fx\";\r\n    \r\n            while( i-- ) {\r\n                tmp = jQuery._data( elements[ i ], type + \"queueHooks\" );\r\n                if ( tmp && tmp.empty ) {\r\n                    count++;\r\n                    tmp.empty.add( resolve );\r\n                }\r\n            }\r\n            resolve();\r\n            return defer.promise( obj );\r\n        }\r\n    });\r\n    var nodeHook, boolHook,\r\n        rclass = /[\\t\\r\\n]/g,\r\n        rreturn = /\\r/g,\r\n        rfocusable = /^(?:input|select|textarea|button|object)$/i,\r\n        rclickable = /^(?:a|area)$/i,\r\n        rboolean = /^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,\r\n        ruseDefault = /^(?:checked|selected)$/i,\r\n        getSetAttribute = jQuery.support.getSetAttribute,\r\n        getSetInput = jQuery.support.input;\r\n    \r\n    jQuery.fn.extend({\r\n        attr: function( name, value ) {\r\n            return jQuery.access( this, jQuery.attr, name, value, arguments.length > 1 );\r\n        },\r\n    \r\n        removeAttr: function( name ) {\r\n            return this.each(function() {\r\n                jQuery.removeAttr( this, name );\r\n            });\r\n        },\r\n    \r\n        prop: function( name, value ) {\r\n            return jQuery.access( this, jQuery.prop, name, value, arguments.length > 1 );\r\n        },\r\n    \r\n        removeProp: function( name ) {\r\n            name = jQuery.propFix[ name ] || name;\r\n            return this.each(function() {\r\n                // try/catch handles cases where IE balks (such as removing a property on window)\r\n                try {\r\n                    this[ name ] = undefined;\r\n                    delete this[ name ];\r\n                } catch( e ) {}\r\n            });\r\n        },\r\n    \r\n        addClass: function( value ) {\r\n            var classes, elem, cur, clazz, j,\r\n                i = 0,\r\n                len = this.length,\r\n                proceed = typeof value === \"string\" && value;\r\n    \r\n            if ( jQuery.isFunction( value ) ) {\r\n                return this.each(function( j ) {\r\n                    jQuery( this ).addClass( value.call( this, j, this.className ) );\r\n                });\r\n            }\r\n    \r\n            if ( proceed ) {\r\n                // The disjunction here is for better compressibility (see removeClass)\r\n                classes = ( value || \"\" ).match( core_rnotwhite ) || [];\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    elem = this[ i ];\r\n                    cur = elem.nodeType === 1 && ( elem.className ?\r\n                        ( \" \" + elem.className + \" \" ).replace( rclass, \" \" ) :\r\n                        \" \"\r\n                    );\r\n    \r\n                    if ( cur ) {\r\n                        j = 0;\r\n                        while ( (clazz = classes[j++]) ) {\r\n                            if ( cur.indexOf( \" \" + clazz + \" \" ) < 0 ) {\r\n                                cur += clazz + \" \";\r\n                            }\r\n                        }\r\n                        elem.className = jQuery.trim( cur );\r\n    \r\n                    }\r\n                }\r\n            }\r\n    \r\n            return this;\r\n        },\r\n    \r\n        removeClass: function( value ) {\r\n            var classes, elem, cur, clazz, j,\r\n                i = 0,\r\n                len = this.length,\r\n                proceed = arguments.length === 0 || typeof value === \"string\" && value;\r\n    \r\n            if ( jQuery.isFunction( value ) ) {\r\n                return this.each(function( j ) {\r\n                    jQuery( this ).removeClass( value.call( this, j, this.className ) );\r\n                });\r\n            }\r\n            if ( proceed ) {\r\n                classes = ( value || \"\" ).match( core_rnotwhite ) || [];\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    elem = this[ i ];\r\n                    // This expression is here for better compressibility (see addClass)\r\n                    cur = elem.nodeType === 1 && ( elem.className ?\r\n                        ( \" \" + elem.className + \" \" ).replace( rclass, \" \" ) :\r\n                        \"\"\r\n                    );\r\n    \r\n                    if ( cur ) {\r\n                        j = 0;\r\n                        while ( (clazz = classes[j++]) ) {\r\n                            // Remove *all* instances\r\n                            while ( cur.indexOf( \" \" + clazz + \" \" ) >= 0 ) {\r\n                                cur = cur.replace( \" \" + clazz + \" \", \" \" );\r\n                            }\r\n                        }\r\n                        elem.className = value ? jQuery.trim( cur ) : \"\";\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return this;\r\n        },\r\n    \r\n        toggleClass: function( value, stateVal ) {\r\n            var type = typeof value,\r\n                isBool = typeof stateVal === \"boolean\";\r\n    \r\n            if ( jQuery.isFunction( value ) ) {\r\n                return this.each(function( i ) {\r\n                    jQuery( this ).toggleClass( value.call(this, i, this.className, stateVal), stateVal );\r\n                });\r\n            }\r\n    \r\n            return this.each(function() {\r\n                if ( type === \"string\" ) {\r\n                    // toggle individual class names\r\n                    var className,\r\n                        i = 0,\r\n                        self = jQuery( this ),\r\n                        state = stateVal,\r\n                        classNames = value.match( core_rnotwhite ) || [];\r\n    \r\n                    while ( (className = classNames[ i++ ]) ) {\r\n                        // check each className given, space separated list\r\n                        state = isBool ? state : !self.hasClass( className );\r\n                        self[ state ? \"addClass\" : \"removeClass\" ]( className );\r\n                    }\r\n    \r\n                // Toggle whole class name\r\n                } else if ( type === core_strundefined || type === \"boolean\" ) {\r\n                    if ( this.className ) {\r\n                        // store className if set\r\n                        jQuery._data( this, \"__className__\", this.className );\r\n                    }\r\n    \r\n                    // If the element has a class name or if we're passed \"false\",\r\n                    // then remove the whole classname (if there was one, the above saved it).\r\n                    // Otherwise bring back whatever was previously saved (if anything),\r\n                    // falling back to the empty string if nothing was stored.\r\n                    this.className = this.className || value === false ? \"\" : jQuery._data( this, \"__className__\" ) || \"\";\r\n                }\r\n            });\r\n        },\r\n    \r\n        hasClass: function( selector ) {\r\n            var className = \" \" + selector + \" \",\r\n                i = 0,\r\n                l = this.length;\r\n            for ( ; i < l; i++ ) {\r\n                if ( this[i].nodeType === 1 && (\" \" + this[i].className + \" \").replace(rclass, \" \").indexOf( className ) >= 0 ) {\r\n                    return true;\r\n                }\r\n            }\r\n    \r\n            return false;\r\n        },\r\n    \r\n        val: function( value ) {\r\n            var ret, hooks, isFunction,\r\n                elem = this[0];\r\n    \r\n            if ( !arguments.length ) {\r\n                if ( elem ) {\r\n                    hooks = jQuery.valHooks[ elem.type ] || jQuery.valHooks[ elem.nodeName.toLowerCase() ];\r\n    \r\n                    if ( hooks && \"get\" in hooks && (ret = hooks.get( elem, \"value\" )) !== undefined ) {\r\n                        return ret;\r\n                    }\r\n    \r\n                    ret = elem.value;\r\n    \r\n                    return typeof ret === \"string\" ?\r\n                        // handle most common string cases\r\n                        ret.replace(rreturn, \"\") :\r\n                        // handle cases where value is null/undef or number\r\n                        ret == null ? \"\" : ret;\r\n                }\r\n    \r\n                return;\r\n            }\r\n    \r\n            isFunction = jQuery.isFunction( value );\r\n    \r\n            return this.each(function( i ) {\r\n                var val,\r\n                    self = jQuery(this);\r\n    \r\n                if ( this.nodeType !== 1 ) {\r\n                    return;\r\n                }\r\n    \r\n                if ( isFunction ) {\r\n                    val = value.call( this, i, self.val() );\r\n                } else {\r\n                    val = value;\r\n                }\r\n    \r\n                // Treat null/undefined as \"\"; convert numbers to string\r\n                if ( val == null ) {\r\n                    val = \"\";\r\n                } else if ( typeof val === \"number\" ) {\r\n                    val += \"\";\r\n                } else if ( jQuery.isArray( val ) ) {\r\n                    val = jQuery.map(val, function ( value ) {\r\n                        return value == null ? \"\" : value + \"\";\r\n                    });\r\n                }\r\n    \r\n                hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];\r\n    \r\n                // If set returns undefined, fall back to normal setting\r\n                if ( !hooks || !(\"set\" in hooks) || hooks.set( this, val, \"value\" ) === undefined ) {\r\n                    this.value = val;\r\n                }\r\n            });\r\n        }\r\n    });\r\n    \r\n    jQuery.extend({\r\n        valHooks: {\r\n            option: {\r\n                get: function( elem ) {\r\n                    // attributes.value is undefined in Blackberry 4.7 but\r\n                    // uses .value. See #6932\r\n                    var val = elem.attributes.value;\r\n                    return !val || val.specified ? elem.value : elem.text;\r\n                }\r\n            },\r\n            select: {\r\n                get: function( elem ) {\r\n                    var value, option,\r\n                        options = elem.options,\r\n                        index = elem.selectedIndex,\r\n                        one = elem.type === \"select-one\" || index < 0,\r\n                        values = one ? null : [],\r\n                        max = one ? index + 1 : options.length,\r\n                        i = index < 0 ?\r\n                            max :\r\n                            one ? index : 0;\r\n    \r\n                    // Loop through all the selected options\r\n                    for ( ; i < max; i++ ) {\r\n                        option = options[ i ];\r\n    \r\n                        // oldIE doesn't update selected after form reset (#2551)\r\n                        if ( ( option.selected || i === index ) &&\r\n                                // Don't return options that are disabled or in a disabled optgroup\r\n                                ( jQuery.support.optDisabled ? !option.disabled : option.getAttribute(\"disabled\") === null ) &&\r\n                                ( !option.parentNode.disabled || !jQuery.nodeName( option.parentNode, \"optgroup\" ) ) ) {\r\n    \r\n                            // Get the specific value for the option\r\n                            value = jQuery( option ).val();\r\n    \r\n                            // We don't need an array for one selects\r\n                            if ( one ) {\r\n                                return value;\r\n                            }\r\n    \r\n                            // Multi-Selects return an array\r\n                            values.push( value );\r\n                        }\r\n                    }\r\n    \r\n                    return values;\r\n                },\r\n    \r\n                set: function( elem, value ) {\r\n                    var values = jQuery.makeArray( value );\r\n    \r\n                    jQuery(elem).find(\"option\").each(function() {\r\n                        this.selected = jQuery.inArray( jQuery(this).val(), values ) >= 0;\r\n                    });\r\n    \r\n                    if ( !values.length ) {\r\n                        elem.selectedIndex = -1;\r\n                    }\r\n                    return values;\r\n                }\r\n            }\r\n        },\r\n    \r\n        attr: function( elem, name, value ) {\r\n            var hooks, notxml, ret,\r\n                nType = elem.nodeType;\r\n    \r\n            // don't get/set attributes on text, comment and attribute nodes\r\n            if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {\r\n                return;\r\n            }\r\n    \r\n            // Fallback to prop when attributes are not supported\r\n            if ( typeof elem.getAttribute === core_strundefined ) {\r\n                return jQuery.prop( elem, name, value );\r\n            }\r\n    \r\n            notxml = nType !== 1 || !jQuery.isXMLDoc( elem );\r\n    \r\n            // All attributes are lowercase\r\n            // Grab necessary hook if one is defined\r\n            if ( notxml ) {\r\n                name = name.toLowerCase();\r\n                hooks = jQuery.attrHooks[ name ] || ( rboolean.test( name ) ? boolHook : nodeHook );\r\n            }\r\n    \r\n            if ( value !== undefined ) {\r\n    \r\n                if ( value === null ) {\r\n                    jQuery.removeAttr( elem, name );\r\n    \r\n                } else if ( hooks && notxml && \"set\" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {\r\n                    return ret;\r\n    \r\n                } else {\r\n                    elem.setAttribute( name, value + \"\" );\r\n                    return value;\r\n                }\r\n    \r\n            } else if ( hooks && notxml && \"get\" in hooks && (ret = hooks.get( elem, name )) !== null ) {\r\n                return ret;\r\n    \r\n            } else {\r\n    \r\n                // In IE9+, Flash objects don't have .getAttribute (#12945)\r\n                // Support: IE9+\r\n                if ( typeof elem.getAttribute !== core_strundefined ) {\r\n                    ret =  elem.getAttribute( name );\r\n                }\r\n    \r\n                // Non-existent attributes return null, we normalize to undefined\r\n                return ret == null ?\r\n                    undefined :\r\n                    ret;\r\n            }\r\n        },\r\n    \r\n        removeAttr: function( elem, value ) {\r\n            var name, propName,\r\n                i = 0,\r\n                attrNames = value && value.match( core_rnotwhite );\r\n    \r\n            if ( attrNames && elem.nodeType === 1 ) {\r\n                while ( (name = attrNames[i++]) ) {\r\n                    propName = jQuery.propFix[ name ] || name;\r\n    \r\n                    // Boolean attributes get special treatment (#10870)\r\n                    if ( rboolean.test( name ) ) {\r\n                        // Set corresponding property to false for boolean attributes\r\n                        // Also clear defaultChecked/defaultSelected (if appropriate) for IE<8\r\n                        if ( !getSetAttribute && ruseDefault.test( name ) ) {\r\n                            elem[ jQuery.camelCase( \"default-\" + name ) ] =\r\n                                elem[ propName ] = false;\r\n                        } else {\r\n                            elem[ propName ] = false;\r\n                        }\r\n    \r\n                    // See #9699 for explanation of this approach (setting first, then removal)\r\n                    } else {\r\n                        jQuery.attr( elem, name, \"\" );\r\n                    }\r\n    \r\n                    elem.removeAttribute( getSetAttribute ? name : propName );\r\n                }\r\n            }\r\n        },\r\n    \r\n        attrHooks: {\r\n            type: {\r\n                set: function( elem, value ) {\r\n                    if ( !jQuery.support.radioValue && value === \"radio\" && jQuery.nodeName(elem, \"input\") ) {\r\n                        // Setting the type on a radio button after the value resets the value in IE6-9\r\n                        // Reset value to default in case type is set after value during creation\r\n                        var val = elem.value;\r\n                        elem.setAttribute( \"type\", value );\r\n                        if ( val ) {\r\n                            elem.value = val;\r\n                        }\r\n                        return value;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    \r\n        propFix: {\r\n            tabindex: \"tabIndex\",\r\n            readonly: \"readOnly\",\r\n            \"for\": \"htmlFor\",\r\n            \"class\": \"className\",\r\n            maxlength: \"maxLength\",\r\n            cellspacing: \"cellSpacing\",\r\n            cellpadding: \"cellPadding\",\r\n            rowspan: \"rowSpan\",\r\n            colspan: \"colSpan\",\r\n            usemap: \"useMap\",\r\n            frameborder: \"frameBorder\",\r\n            contenteditable: \"contentEditable\"\r\n        },\r\n    \r\n        prop: function( elem, name, value ) {\r\n            var ret, hooks, notxml,\r\n                nType = elem.nodeType;\r\n    \r\n            // don't get/set properties on text, comment and attribute nodes\r\n            if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {\r\n                return;\r\n            }\r\n    \r\n            notxml = nType !== 1 || !jQuery.isXMLDoc( elem );\r\n    \r\n            if ( notxml ) {\r\n                // Fix name and attach hooks\r\n                name = jQuery.propFix[ name ] || name;\r\n                hooks = jQuery.propHooks[ name ];\r\n            }\r\n    \r\n            if ( value !== undefined ) {\r\n                if ( hooks && \"set\" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {\r\n                    return ret;\r\n    \r\n                } else {\r\n                    return ( elem[ name ] = value );\r\n                }\r\n    \r\n            } else {\r\n                if ( hooks && \"get\" in hooks && (ret = hooks.get( elem, name )) !== null ) {\r\n                    return ret;\r\n    \r\n                } else {\r\n                    return elem[ name ];\r\n                }\r\n            }\r\n        },\r\n    \r\n        propHooks: {\r\n            tabIndex: {\r\n                get: function( elem ) {\r\n                    // elem.tabIndex doesn't always return the correct value when it hasn't been explicitly set\r\n                    // http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/\r\n                    var attributeNode = elem.getAttributeNode(\"tabindex\");\r\n    \r\n                    return attributeNode && attributeNode.specified ?\r\n                        parseInt( attributeNode.value, 10 ) :\r\n                        rfocusable.test( elem.nodeName ) || rclickable.test( elem.nodeName ) && elem.href ?\r\n                            0 :\r\n                            undefined;\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    // Hook for boolean attributes\r\n    boolHook = {\r\n        get: function( elem, name ) {\r\n            var\r\n                // Use .prop to determine if this attribute is understood as boolean\r\n                prop = jQuery.prop( elem, name ),\r\n    \r\n                // Fetch it accordingly\r\n                attr = typeof prop === \"boolean\" && elem.getAttribute( name ),\r\n                detail = typeof prop === \"boolean\" ?\r\n    \r\n                    getSetInput && getSetAttribute ?\r\n                        attr != null :\r\n                        // oldIE fabricates an empty string for missing boolean attributes\r\n                        // and conflates checked/selected into attroperties\r\n                        ruseDefault.test( name ) ?\r\n                            elem[ jQuery.camelCase( \"default-\" + name ) ] :\r\n                            !!attr :\r\n    \r\n                    // fetch an attribute node for properties not recognized as boolean\r\n                    elem.getAttributeNode( name );\r\n    \r\n            return detail && detail.value !== false ?\r\n                name.toLowerCase() :\r\n                undefined;\r\n        },\r\n        set: function( elem, value, name ) {\r\n            if ( value === false ) {\r\n                // Remove boolean attributes when set to false\r\n                jQuery.removeAttr( elem, name );\r\n            } else if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {\r\n                // IE<8 needs the *property* name\r\n                elem.setAttribute( !getSetAttribute && jQuery.propFix[ name ] || name, name );\r\n    \r\n            // Use defaultChecked and defaultSelected for oldIE\r\n            } else {\r\n                elem[ jQuery.camelCase( \"default-\" + name ) ] = elem[ name ] = true;\r\n            }\r\n    \r\n            return name;\r\n        }\r\n    };\r\n    \r\n    // fix oldIE value attroperty\r\n    if ( !getSetInput || !getSetAttribute ) {\r\n        jQuery.attrHooks.value = {\r\n            get: function( elem, name ) {\r\n                var ret = elem.getAttributeNode( name );\r\n                return jQuery.nodeName( elem, \"input\" ) ?\r\n    \r\n                    // Ignore the value *property* by using defaultValue\r\n                    elem.defaultValue :\r\n    \r\n                    ret && ret.specified ? ret.value : undefined;\r\n            },\r\n            set: function( elem, value, name ) {\r\n                if ( jQuery.nodeName( elem, \"input\" ) ) {\r\n                    // Does not return so that setAttribute is also used\r\n                    elem.defaultValue = value;\r\n                } else {\r\n                    // Use nodeHook if defined (#1954); otherwise setAttribute is fine\r\n                    return nodeHook && nodeHook.set( elem, value, name );\r\n                }\r\n            }\r\n        };\r\n    }\r\n    \r\n    // IE6/7 do not support getting/setting some attributes with get/setAttribute\r\n    if ( !getSetAttribute ) {\r\n    \r\n        // Use this for any attribute in IE6/7\r\n        // This fixes almost every IE6/7 issue\r\n        nodeHook = jQuery.valHooks.button = {\r\n            get: function( elem, name ) {\r\n                var ret = elem.getAttributeNode( name );\r\n                return ret && ( name === \"id\" || name === \"name\" || name === \"coords\" ? ret.value !== \"\" : ret.specified ) ?\r\n                    ret.value :\r\n                    undefined;\r\n            },\r\n            set: function( elem, value, name ) {\r\n                // Set the existing or create a new attribute node\r\n                var ret = elem.getAttributeNode( name );\r\n                if ( !ret ) {\r\n                    elem.setAttributeNode(\r\n                        (ret = elem.ownerDocument.createAttribute( name ))\r\n                    );\r\n                }\r\n    \r\n                ret.value = value += \"\";\r\n    \r\n                // Break association with cloned elements by also using setAttribute (#9646)\r\n                return name === \"value\" || value === elem.getAttribute( name ) ?\r\n                    value :\r\n                    undefined;\r\n            }\r\n        };\r\n    \r\n        // Set contenteditable to false on removals(#10429)\r\n        // Setting to empty string throws an error as an invalid value\r\n        jQuery.attrHooks.contenteditable = {\r\n            get: nodeHook.get,\r\n            set: function( elem, value, name ) {\r\n                nodeHook.set( elem, value === \"\" ? false : value, name );\r\n            }\r\n        };\r\n    \r\n        // Set width and height to auto instead of 0 on empty string( Bug #8150 )\r\n        // This is for removals\r\n        jQuery.each([ \"width\", \"height\" ], function( i, name ) {\r\n            jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {\r\n                set: function( elem, value ) {\r\n                    if ( value === \"\" ) {\r\n                        elem.setAttribute( name, \"auto\" );\r\n                        return value;\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n    \r\n    \r\n    // Some attributes require a special call on IE\r\n    // http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\r\n    if ( !jQuery.support.hrefNormalized ) {\r\n        jQuery.each([ \"href\", \"src\", \"width\", \"height\" ], function( i, name ) {\r\n            jQuery.attrHooks[ name ] = jQuery.extend( jQuery.attrHooks[ name ], {\r\n                get: function( elem ) {\r\n                    var ret = elem.getAttribute( name, 2 );\r\n                    return ret == null ? undefined : ret;\r\n                }\r\n            });\r\n        });\r\n    \r\n        // href/src property should get the full normalized URL (#10299/#12915)\r\n        jQuery.each([ \"href\", \"src\" ], function( i, name ) {\r\n            jQuery.propHooks[ name ] = {\r\n                get: function( elem ) {\r\n                    return elem.getAttribute( name, 4 );\r\n                }\r\n            };\r\n        });\r\n    }\r\n    \r\n    if ( !jQuery.support.style ) {\r\n        jQuery.attrHooks.style = {\r\n            get: function( elem ) {\r\n                // Return undefined in the case of empty string\r\n                // Note: IE uppercases css property names, but if we were to .toLowerCase()\r\n                // .cssText, that would destroy case senstitivity in URL's, like in \"background\"\r\n                return elem.style.cssText || undefined;\r\n            },\r\n            set: function( elem, value ) {\r\n                return ( elem.style.cssText = value + \"\" );\r\n            }\r\n        };\r\n    }\r\n    \r\n    // Safari mis-reports the default selected property of an option\r\n    // Accessing the parent's selectedIndex property fixes it\r\n    if ( !jQuery.support.optSelected ) {\r\n        jQuery.propHooks.selected = jQuery.extend( jQuery.propHooks.selected, {\r\n            get: function( elem ) {\r\n                var parent = elem.parentNode;\r\n    \r\n                if ( parent ) {\r\n                    parent.selectedIndex;\r\n    \r\n                    // Make sure that it also works with optgroups, see #5701\r\n                    if ( parent.parentNode ) {\r\n                        parent.parentNode.selectedIndex;\r\n                    }\r\n                }\r\n                return null;\r\n            }\r\n        });\r\n    }\r\n    \r\n    // IE6/7 call enctype encoding\r\n    if ( !jQuery.support.enctype ) {\r\n        jQuery.propFix.enctype = \"encoding\";\r\n    }\r\n    \r\n    // Radios and checkboxes getter/setter\r\n    if ( !jQuery.support.checkOn ) {\r\n        jQuery.each([ \"radio\", \"checkbox\" ], function() {\r\n            jQuery.valHooks[ this ] = {\r\n                get: function( elem ) {\r\n                    // Handle the case where in Webkit \"\" is returned instead of \"on\" if a value isn't specified\r\n                    return elem.getAttribute(\"value\") === null ? \"on\" : elem.value;\r\n                }\r\n            };\r\n        });\r\n    }\r\n    jQuery.each([ \"radio\", \"checkbox\" ], function() {\r\n        jQuery.valHooks[ this ] = jQuery.extend( jQuery.valHooks[ this ], {\r\n            set: function( elem, value ) {\r\n                if ( jQuery.isArray( value ) ) {\r\n                    return ( elem.checked = jQuery.inArray( jQuery(elem).val(), value ) >= 0 );\r\n                }\r\n            }\r\n        });\r\n    });\r\n    var rformElems = /^(?:input|select|textarea)$/i,\r\n        rkeyEvent = /^key/,\r\n        rmouseEvent = /^(?:mouse|contextmenu)|click/,\r\n        rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,\r\n        rtypenamespace = /^([^.]*)(?:\\.(.+)|)$/;\r\n    \r\n    function returnTrue() {\r\n        return true;\r\n    }\r\n    \r\n    function returnFalse() {\r\n        return false;\r\n    }\r\n    \r\n    /*\r\n     * Helper functions for managing events -- not part of the public interface.\r\n     * Props to Dean Edwards' addEvent library for many of the ideas.\r\n     */\r\n    jQuery.event = {\r\n    \r\n        global: {},\r\n    \r\n        add: function( elem, types, handler, data, selector ) {\r\n            var tmp, events, t, handleObjIn,\r\n                special, eventHandle, handleObj,\r\n                handlers, type, namespaces, origType,\r\n                elemData = jQuery._data( elem );\r\n    \r\n            // Don't attach events to noData or text/comment nodes (but allow plain objects)\r\n            if ( !elemData ) {\r\n                return;\r\n            }\r\n    \r\n            // Caller can pass in an object of custom data in lieu of the handler\r\n            if ( handler.handler ) {\r\n                handleObjIn = handler;\r\n                handler = handleObjIn.handler;\r\n                selector = handleObjIn.selector;\r\n            }\r\n    \r\n            // Make sure that the handler has a unique ID, used to find/remove it later\r\n            if ( !handler.guid ) {\r\n                handler.guid = jQuery.guid++;\r\n            }\r\n    \r\n            // Init the element's event structure and main handler, if this is the first\r\n            if ( !(events = elemData.events) ) {\r\n                events = elemData.events = {};\r\n            }\r\n            if ( !(eventHandle = elemData.handle) ) {\r\n                eventHandle = elemData.handle = function( e ) {\r\n                    // Discard the second event of a jQuery.event.trigger() and\r\n                    // when an event is called after a page has unloaded\r\n                    return typeof jQuery !== core_strundefined && (!e || jQuery.event.triggered !== e.type) ?\r\n                        jQuery.event.dispatch.apply( eventHandle.elem, arguments ) :\r\n                        undefined;\r\n                };\r\n                // Add elem as a property of the handle fn to prevent a memory leak with IE non-native events\r\n                eventHandle.elem = elem;\r\n            }\r\n    \r\n            // Handle multiple events separated by a space\r\n            // jQuery(...).bind(\"mouseover mouseout\", fn);\r\n            types = ( types || \"\" ).match( core_rnotwhite ) || [\"\"];\r\n            t = types.length;\r\n            while ( t-- ) {\r\n                tmp = rtypenamespace.exec( types[t] ) || [];\r\n                type = origType = tmp[1];\r\n                namespaces = ( tmp[2] || \"\" ).split( \".\" ).sort();\r\n    \r\n                // If event changes its type, use the special event handlers for the changed type\r\n                special = jQuery.event.special[ type ] || {};\r\n    \r\n                // If selector defined, determine special event api type, otherwise given type\r\n                type = ( selector ? special.delegateType : special.bindType ) || type;\r\n    \r\n                // Update special based on newly reset type\r\n                special = jQuery.event.special[ type ] || {};\r\n    \r\n                // handleObj is passed to all event handlers\r\n                handleObj = jQuery.extend({\r\n                    type: type,\r\n                    origType: origType,\r\n                    data: data,\r\n                    handler: handler,\r\n                    guid: handler.guid,\r\n                    selector: selector,\r\n                    needsContext: selector && jQuery.expr.match.needsContext.test( selector ),\r\n                    namespace: namespaces.join(\".\")\r\n                }, handleObjIn );\r\n    \r\n                // Init the event handler queue if we're the first\r\n                if ( !(handlers = events[ type ]) ) {\r\n                    handlers = events[ type ] = [];\r\n                    handlers.delegateCount = 0;\r\n    \r\n                    // Only use addEventListener/attachEvent if the special events handler returns false\r\n                    if ( !special.setup || special.setup.call( elem, data, namespaces, eventHandle ) === false ) {\r\n                        // Bind the global event handler to the element\r\n                        if ( elem.addEventListener ) {\r\n                            elem.addEventListener( type, eventHandle, false );\r\n    \r\n                        } else if ( elem.attachEvent ) {\r\n                            elem.attachEvent( \"on\" + type, eventHandle );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                if ( special.add ) {\r\n                    special.add.call( elem, handleObj );\r\n    \r\n                    if ( !handleObj.handler.guid ) {\r\n                        handleObj.handler.guid = handler.guid;\r\n                    }\r\n                }\r\n    \r\n                // Add to the element's handler list, delegates in front\r\n                if ( selector ) {\r\n                    handlers.splice( handlers.delegateCount++, 0, handleObj );\r\n                } else {\r\n                    handlers.push( handleObj );\r\n                }\r\n    \r\n                // Keep track of which events have ever been used, for event optimization\r\n                jQuery.event.global[ type ] = true;\r\n            }\r\n    \r\n            // Nullify elem to prevent memory leaks in IE\r\n            elem = null;\r\n        },\r\n    \r\n        // Detach an event or set of events from an element\r\n        remove: function( elem, types, handler, selector, mappedTypes ) {\r\n            var j, handleObj, tmp,\r\n                origCount, t, events,\r\n                special, handlers, type,\r\n                namespaces, origType,\r\n                elemData = jQuery.hasData( elem ) && jQuery._data( elem );\r\n    \r\n            if ( !elemData || !(events = elemData.events) ) {\r\n                return;\r\n            }\r\n    \r\n            // Once for each type.namespace in types; type may be omitted\r\n            types = ( types || \"\" ).match( core_rnotwhite ) || [\"\"];\r\n            t = types.length;\r\n            while ( t-- ) {\r\n                tmp = rtypenamespace.exec( types[t] ) || [];\r\n                type = origType = tmp[1];\r\n                namespaces = ( tmp[2] || \"\" ).split( \".\" ).sort();\r\n    \r\n                // Unbind all events (on this namespace, if provided) for the element\r\n                if ( !type ) {\r\n                    for ( type in events ) {\r\n                        jQuery.event.remove( elem, type + types[ t ], handler, selector, true );\r\n                    }\r\n                    continue;\r\n                }\r\n    \r\n                special = jQuery.event.special[ type ] || {};\r\n                type = ( selector ? special.delegateType : special.bindType ) || type;\r\n                handlers = events[ type ] || [];\r\n                tmp = tmp[2] && new RegExp( \"(^|\\\\.)\" + namespaces.join(\"\\\\.(?:.*\\\\.|)\") + \"(\\\\.|$)\" );\r\n    \r\n                // Remove matching events\r\n                origCount = j = handlers.length;\r\n                while ( j-- ) {\r\n                    handleObj = handlers[ j ];\r\n    \r\n                    if ( ( mappedTypes || origType === handleObj.origType ) &&\r\n                        ( !handler || handler.guid === handleObj.guid ) &&\r\n                        ( !tmp || tmp.test( handleObj.namespace ) ) &&\r\n                        ( !selector || selector === handleObj.selector || selector === \"**\" && handleObj.selector ) ) {\r\n                        handlers.splice( j, 1 );\r\n    \r\n                        if ( handleObj.selector ) {\r\n                            handlers.delegateCount--;\r\n                        }\r\n                        if ( special.remove ) {\r\n                            special.remove.call( elem, handleObj );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                // Remove generic event handler if we removed something and no more handlers exist\r\n                // (avoids potential for endless recursion during removal of special event handlers)\r\n                if ( origCount && !handlers.length ) {\r\n                    if ( !special.teardown || special.teardown.call( elem, namespaces, elemData.handle ) === false ) {\r\n                        jQuery.removeEvent( elem, type, elemData.handle );\r\n                    }\r\n    \r\n                    delete events[ type ];\r\n                }\r\n            }\r\n    \r\n            // Remove the expando if it's no longer used\r\n            if ( jQuery.isEmptyObject( events ) ) {\r\n                delete elemData.handle;\r\n    \r\n                // removeData also checks for emptiness and clears the expando if empty\r\n                // so use it instead of delete\r\n                jQuery._removeData( elem, \"events\" );\r\n            }\r\n        },\r\n    \r\n        trigger: function( event, data, elem, onlyHandlers ) {\r\n            var handle, ontype, cur,\r\n                bubbleType, special, tmp, i,\r\n                eventPath = [ elem || document ],\r\n                type = core_hasOwn.call( event, \"type\" ) ? event.type : event,\r\n                namespaces = core_hasOwn.call( event, \"namespace\" ) ? event.namespace.split(\".\") : [];\r\n    \r\n            cur = tmp = elem = elem || document;\r\n    \r\n            // Don't do events on text and comment nodes\r\n            if ( elem.nodeType === 3 || elem.nodeType === 8 ) {\r\n                return;\r\n            }\r\n    \r\n            // focus/blur morphs to focusin/out; ensure we're not firing them right now\r\n            if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {\r\n                return;\r\n            }\r\n    \r\n            if ( type.indexOf(\".\") >= 0 ) {\r\n                // Namespaced trigger; create a regexp to match event type in handle()\r\n                namespaces = type.split(\".\");\r\n                type = namespaces.shift();\r\n                namespaces.sort();\r\n            }\r\n            ontype = type.indexOf(\":\") < 0 && \"on\" + type;\r\n    \r\n            // Caller can pass in a jQuery.Event object, Object, or just an event type string\r\n            event = event[ jQuery.expando ] ?\r\n                event :\r\n                new jQuery.Event( type, typeof event === \"object\" && event );\r\n    \r\n            event.isTrigger = true;\r\n            event.namespace = namespaces.join(\".\");\r\n            event.namespace_re = event.namespace ?\r\n                new RegExp( \"(^|\\\\.)\" + namespaces.join(\"\\\\.(?:.*\\\\.|)\") + \"(\\\\.|$)\" ) :\r\n                null;\r\n    \r\n            // Clean up the event in case it is being reused\r\n            event.result = undefined;\r\n            if ( !event.target ) {\r\n                event.target = elem;\r\n            }\r\n    \r\n            // Clone any incoming data and prepend the event, creating the handler arg list\r\n            data = data == null ?\r\n                [ event ] :\r\n                jQuery.makeArray( data, [ event ] );\r\n    \r\n            // Allow special events to draw outside the lines\r\n            special = jQuery.event.special[ type ] || {};\r\n            if ( !onlyHandlers && special.trigger && special.trigger.apply( elem, data ) === false ) {\r\n                return;\r\n            }\r\n    \r\n            // Determine event propagation path in advance, per W3C events spec (#9951)\r\n            // Bubble up to document, then to window; watch for a global ownerDocument var (#9724)\r\n            if ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {\r\n    \r\n                bubbleType = special.delegateType || type;\r\n                if ( !rfocusMorph.test( bubbleType + type ) ) {\r\n                    cur = cur.parentNode;\r\n                }\r\n                for ( ; cur; cur = cur.parentNode ) {\r\n                    eventPath.push( cur );\r\n                    tmp = cur;\r\n                }\r\n    \r\n                // Only add window if we got to document (e.g., not plain obj or detached DOM)\r\n                if ( tmp === (elem.ownerDocument || document) ) {\r\n                    eventPath.push( tmp.defaultView || tmp.parentWindow || window );\r\n                }\r\n            }\r\n    \r\n            // Fire handlers on the event path\r\n            i = 0;\r\n            while ( (cur = eventPath[i++]) && !event.isPropagationStopped() ) {\r\n    \r\n                event.type = i > 1 ?\r\n                    bubbleType :\r\n                    special.bindType || type;\r\n    \r\n                // jQuery handler\r\n                handle = ( jQuery._data( cur, \"events\" ) || {} )[ event.type ] && jQuery._data( cur, \"handle\" );\r\n                if ( handle ) {\r\n                    handle.apply( cur, data );\r\n                }\r\n    \r\n                // Native handler\r\n                handle = ontype && cur[ ontype ];\r\n                if ( handle && jQuery.acceptData( cur ) && handle.apply && handle.apply( cur, data ) === false ) {\r\n                    event.preventDefault();\r\n                }\r\n            }\r\n            event.type = type;\r\n    \r\n            // If nobody prevented the default action, do it now\r\n            if ( !onlyHandlers && !event.isDefaultPrevented() ) {\r\n    \r\n                if ( (!special._default || special._default.apply( elem.ownerDocument, data ) === false) &&\r\n                    !(type === \"click\" && jQuery.nodeName( elem, \"a\" )) && jQuery.acceptData( elem ) ) {\r\n    \r\n                    // Call a native DOM method on the target with the same name name as the event.\r\n                    // Can't use an .isFunction() check here because IE6/7 fails that test.\r\n                    // Don't do default actions on window, that's where global variables be (#6170)\r\n                    if ( ontype && elem[ type ] && !jQuery.isWindow( elem ) ) {\r\n    \r\n                        // Don't re-trigger an onFOO event when we call its FOO() method\r\n                        tmp = elem[ ontype ];\r\n    \r\n                        if ( tmp ) {\r\n                            elem[ ontype ] = null;\r\n                        }\r\n    \r\n                        // Prevent re-triggering of the same event, since we already bubbled it above\r\n                        jQuery.event.triggered = type;\r\n                        try {\r\n                            elem[ type ]();\r\n                        } catch ( e ) {\r\n                            // IE<9 dies on focus/blur to hidden element (#1486,#12518)\r\n                            // only reproducible on winXP IE8 native, not IE9 in IE8 mode\r\n                        }\r\n                        jQuery.event.triggered = undefined;\r\n    \r\n                        if ( tmp ) {\r\n                            elem[ ontype ] = tmp;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return event.result;\r\n        },\r\n    \r\n        dispatch: function( event ) {\r\n    \r\n            // Make a writable jQuery.Event from the native event object\r\n            event = jQuery.event.fix( event );\r\n    \r\n            var i, ret, handleObj, matched, j,\r\n                handlerQueue = [],\r\n                args = core_slice.call( arguments ),\r\n                handlers = ( jQuery._data( this, \"events\" ) || {} )[ event.type ] || [],\r\n                special = jQuery.event.special[ event.type ] || {};\r\n    \r\n            // Use the fix-ed jQuery.Event rather than the (read-only) native event\r\n            args[0] = event;\r\n            event.delegateTarget = this;\r\n    \r\n            // Call the preDispatch hook for the mapped type, and let it bail if desired\r\n            if ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {\r\n                return;\r\n            }\r\n    \r\n            // Determine handlers\r\n            handlerQueue = jQuery.event.handlers.call( this, event, handlers );\r\n    \r\n            // Run delegates first; they may want to stop propagation beneath us\r\n            i = 0;\r\n            while ( (matched = handlerQueue[ i++ ]) && !event.isPropagationStopped() ) {\r\n                event.currentTarget = matched.elem;\r\n    \r\n                j = 0;\r\n                while ( (handleObj = matched.handlers[ j++ ]) && !event.isImmediatePropagationStopped() ) {\r\n    \r\n                    // Triggered event must either 1) have no namespace, or\r\n                    // 2) have namespace(s) a subset or equal to those in the bound event (both can have no namespace).\r\n                    if ( !event.namespace_re || event.namespace_re.test( handleObj.namespace ) ) {\r\n    \r\n                        event.handleObj = handleObj;\r\n                        event.data = handleObj.data;\r\n    \r\n                        ret = ( (jQuery.event.special[ handleObj.origType ] || {}).handle || handleObj.handler )\r\n                                .apply( matched.elem, args );\r\n    \r\n                        if ( ret !== undefined ) {\r\n                            if ( (event.result = ret) === false ) {\r\n                                event.preventDefault();\r\n                                event.stopPropagation();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Call the postDispatch hook for the mapped type\r\n            if ( special.postDispatch ) {\r\n                special.postDispatch.call( this, event );\r\n            }\r\n    \r\n            return event.result;\r\n        },\r\n    \r\n        handlers: function( event, handlers ) {\r\n            var sel, handleObj, matches, i,\r\n                handlerQueue = [],\r\n                delegateCount = handlers.delegateCount,\r\n                cur = event.target;\r\n    \r\n            // Find delegate handlers\r\n            // Black-hole SVG <use> instance trees (#13180)\r\n            // Avoid non-left-click bubbling in Firefox (#3861)\r\n            if ( delegateCount && cur.nodeType && (!event.button || event.type !== \"click\") ) {\r\n    \r\n                for ( ; cur != this; cur = cur.parentNode || this ) {\r\n    \r\n                    // Don't check non-elements (#13208)\r\n                    // Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)\r\n                    if ( cur.nodeType === 1 && (cur.disabled !== true || event.type !== \"click\") ) {\r\n                        matches = [];\r\n                        for ( i = 0; i < delegateCount; i++ ) {\r\n                            handleObj = handlers[ i ];\r\n    \r\n                            // Don't conflict with Object.prototype properties (#13203)\r\n                            sel = handleObj.selector + \" \";\r\n    \r\n                            if ( matches[ sel ] === undefined ) {\r\n                                matches[ sel ] = handleObj.needsContext ?\r\n                                    jQuery( sel, this ).index( cur ) >= 0 :\r\n                                    jQuery.find( sel, this, null, [ cur ] ).length;\r\n                            }\r\n                            if ( matches[ sel ] ) {\r\n                                matches.push( handleObj );\r\n                            }\r\n                        }\r\n                        if ( matches.length ) {\r\n                            handlerQueue.push({ elem: cur, handlers: matches });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Add the remaining (directly-bound) handlers\r\n            if ( delegateCount < handlers.length ) {\r\n                handlerQueue.push({ elem: this, handlers: handlers.slice( delegateCount ) });\r\n            }\r\n    \r\n            return handlerQueue;\r\n        },\r\n    \r\n        fix: function( event ) {\r\n            if ( event[ jQuery.expando ] ) {\r\n                return event;\r\n            }\r\n    \r\n            // Create a writable copy of the event object and normalize some properties\r\n            var i, prop, copy,\r\n                type = event.type,\r\n                originalEvent = event,\r\n                fixHook = this.fixHooks[ type ];\r\n    \r\n            if ( !fixHook ) {\r\n                this.fixHooks[ type ] = fixHook =\r\n                    rmouseEvent.test( type ) ? this.mouseHooks :\r\n                    rkeyEvent.test( type ) ? this.keyHooks :\r\n                    {};\r\n            }\r\n            copy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;\r\n    \r\n            event = new jQuery.Event( originalEvent );\r\n    \r\n            i = copy.length;\r\n            while ( i-- ) {\r\n                prop = copy[ i ];\r\n                event[ prop ] = originalEvent[ prop ];\r\n            }\r\n    \r\n            // Support: IE<9\r\n            // Fix target property (#1925)\r\n            if ( !event.target ) {\r\n                event.target = originalEvent.srcElement || document;\r\n            }\r\n    \r\n            // Support: Chrome 23+, Safari?\r\n            // Target should not be a text node (#504, #13143)\r\n            if ( event.target.nodeType === 3 ) {\r\n                event.target = event.target.parentNode;\r\n            }\r\n    \r\n            // Support: IE<9\r\n            // For mouse/key events, metaKey==false if it's undefined (#3368, #11328)\r\n            event.metaKey = !!event.metaKey;\r\n    \r\n            return fixHook.filter ? fixHook.filter( event, originalEvent ) : event;\r\n        },\r\n    \r\n        // Includes some event props shared by KeyEvent and MouseEvent\r\n        props: \"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which\".split(\" \"),\r\n    \r\n        fixHooks: {},\r\n    \r\n        keyHooks: {\r\n            props: \"char charCode key keyCode\".split(\" \"),\r\n            filter: function( event, original ) {\r\n    \r\n                // Add which for key events\r\n                if ( event.which == null ) {\r\n                    event.which = original.charCode != null ? original.charCode : original.keyCode;\r\n                }\r\n    \r\n                return event;\r\n            }\r\n        },\r\n    \r\n        mouseHooks: {\r\n            props: \"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement\".split(\" \"),\r\n            filter: function( event, original ) {\r\n                var body, eventDoc, doc,\r\n                    button = original.button,\r\n                    fromElement = original.fromElement;\r\n    \r\n                // Calculate pageX/Y if missing and clientX/Y available\r\n                if ( event.pageX == null && original.clientX != null ) {\r\n                    eventDoc = event.target.ownerDocument || document;\r\n                    doc = eventDoc.documentElement;\r\n                    body = eventDoc.body;\r\n    \r\n                    event.pageX = original.clientX + ( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - ( doc && doc.clientLeft || body && body.clientLeft || 0 );\r\n                    event.pageY = original.clientY + ( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) - ( doc && doc.clientTop  || body && body.clientTop  || 0 );\r\n                }\r\n    \r\n                // Add relatedTarget, if necessary\r\n                if ( !event.relatedTarget && fromElement ) {\r\n                    event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;\r\n                }\r\n    \r\n                // Add which for click: 1 === left; 2 === middle; 3 === right\r\n                // Note: button is not normalized, so don't use it\r\n                if ( !event.which && button !== undefined ) {\r\n                    event.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );\r\n                }\r\n    \r\n                return event;\r\n            }\r\n        },\r\n    \r\n        special: {\r\n            load: {\r\n                // Prevent triggered image.load events from bubbling to window.load\r\n                noBubble: true\r\n            },\r\n            click: {\r\n                // For checkbox, fire native event so checked state will be right\r\n                trigger: function() {\r\n                    if ( jQuery.nodeName( this, \"input\" ) && this.type === \"checkbox\" && this.click ) {\r\n                        this.click();\r\n                        return false;\r\n                    }\r\n                }\r\n            },\r\n            focus: {\r\n                // Fire native event if possible so blur/focus sequence is correct\r\n                trigger: function() {\r\n                    if ( this !== document.activeElement && this.focus ) {\r\n                        try {\r\n                            this.focus();\r\n                            return false;\r\n                        } catch ( e ) {\r\n                            // Support: IE<9\r\n                            // If we error on focus to hidden element (#1486, #12518),\r\n                            // let .trigger() run the handlers\r\n                        }\r\n                    }\r\n                },\r\n                delegateType: \"focusin\"\r\n            },\r\n            blur: {\r\n                trigger: function() {\r\n                    if ( this === document.activeElement && this.blur ) {\r\n                        this.blur();\r\n                        return false;\r\n                    }\r\n                },\r\n                delegateType: \"focusout\"\r\n            },\r\n    \r\n            beforeunload: {\r\n                postDispatch: function( event ) {\r\n    \r\n                    // Even when returnValue equals to undefined Firefox will still show alert\r\n                    if ( event.result !== undefined ) {\r\n                        event.originalEvent.returnValue = event.result;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    \r\n        simulate: function( type, elem, event, bubble ) {\r\n            // Piggyback on a donor event to simulate a different one.\r\n            // Fake originalEvent to avoid donor's stopPropagation, but if the\r\n            // simulated event prevents default then we do the same on the donor.\r\n            var e = jQuery.extend(\r\n                new jQuery.Event(),\r\n                event,\r\n                { type: type,\r\n                    isSimulated: true,\r\n                    originalEvent: {}\r\n                }\r\n            );\r\n            if ( bubble ) {\r\n                jQuery.event.trigger( e, null, elem );\r\n            } else {\r\n                jQuery.event.dispatch.call( elem, e );\r\n            }\r\n            if ( e.isDefaultPrevented() ) {\r\n                event.preventDefault();\r\n            }\r\n        }\r\n    };\r\n    \r\n    jQuery.removeEvent = document.removeEventListener ?\r\n        function( elem, type, handle ) {\r\n            if ( elem.removeEventListener ) {\r\n                elem.removeEventListener( type, handle, false );\r\n            }\r\n        } :\r\n        function( elem, type, handle ) {\r\n            var name = \"on\" + type;\r\n    \r\n            if ( elem.detachEvent ) {\r\n    \r\n                // #8545, #7054, preventing memory leaks for custom events in IE6-8\r\n                // detachEvent needed property on element, by name of that event, to properly expose it to GC\r\n                if ( typeof elem[ name ] === core_strundefined ) {\r\n                    elem[ name ] = null;\r\n                }\r\n    \r\n                elem.detachEvent( name, handle );\r\n            }\r\n        };\r\n    \r\n    jQuery.Event = function( src, props ) {\r\n        // Allow instantiation without the 'new' keyword\r\n        if ( !(this instanceof jQuery.Event) ) {\r\n            return new jQuery.Event( src, props );\r\n        }\r\n    \r\n        // Event object\r\n        if ( src && src.type ) {\r\n            this.originalEvent = src;\r\n            this.type = src.type;\r\n    \r\n            // Events bubbling up the document may have been marked as prevented\r\n            // by a handler lower down the tree; reflect the correct value.\r\n            this.isDefaultPrevented = ( src.defaultPrevented || src.returnValue === false ||\r\n                src.getPreventDefault && src.getPreventDefault() ) ? returnTrue : returnFalse;\r\n    \r\n        // Event type\r\n        } else {\r\n            this.type = src;\r\n        }\r\n    \r\n        // Put explicitly provided properties onto the event object\r\n        if ( props ) {\r\n            jQuery.extend( this, props );\r\n        }\r\n    \r\n        // Create a timestamp if incoming event doesn't have one\r\n        this.timeStamp = src && src.timeStamp || jQuery.now();\r\n    \r\n        // Mark it as fixed\r\n        this[ jQuery.expando ] = true;\r\n    };\r\n    \r\n    // jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding\r\n    // http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html\r\n    jQuery.Event.prototype = {\r\n        isDefaultPrevented: returnFalse,\r\n        isPropagationStopped: returnFalse,\r\n        isImmediatePropagationStopped: returnFalse,\r\n    \r\n        preventDefault: function() {\r\n            var e = this.originalEvent;\r\n    \r\n            this.isDefaultPrevented = returnTrue;\r\n            if ( !e ) {\r\n                return;\r\n            }\r\n    \r\n            // If preventDefault exists, run it on the original event\r\n            if ( e.preventDefault ) {\r\n                e.preventDefault();\r\n    \r\n            // Support: IE\r\n            // Otherwise set the returnValue property of the original event to false\r\n            } else {\r\n                e.returnValue = false;\r\n            }\r\n        },\r\n        stopPropagation: function() {\r\n            var e = this.originalEvent;\r\n    \r\n            this.isPropagationStopped = returnTrue;\r\n            if ( !e ) {\r\n                return;\r\n            }\r\n            // If stopPropagation exists, run it on the original event\r\n            if ( e.stopPropagation ) {\r\n                e.stopPropagation();\r\n            }\r\n    \r\n            // Support: IE\r\n            // Set the cancelBubble property of the original event to true\r\n            e.cancelBubble = true;\r\n        },\r\n        stopImmediatePropagation: function() {\r\n            this.isImmediatePropagationStopped = returnTrue;\r\n            this.stopPropagation();\r\n        }\r\n    };\r\n    \r\n    // Create mouseenter/leave events using mouseover/out and event-time checks\r\n    jQuery.each({\r\n        mouseenter: \"mouseover\",\r\n        mouseleave: \"mouseout\"\r\n    }, function( orig, fix ) {\r\n        jQuery.event.special[ orig ] = {\r\n            delegateType: fix,\r\n            bindType: fix,\r\n    \r\n            handle: function( event ) {\r\n                var ret,\r\n                    target = this,\r\n                    related = event.relatedTarget,\r\n                    handleObj = event.handleObj;\r\n    \r\n                // For mousenter/leave call the handler if related is outside the target.\r\n                // NB: No relatedTarget if the mouse left/entered the browser window\r\n                if ( !related || (related !== target && !jQuery.contains( target, related )) ) {\r\n                    event.type = handleObj.origType;\r\n                    ret = handleObj.handler.apply( this, arguments );\r\n                    event.type = fix;\r\n                }\r\n                return ret;\r\n            }\r\n        };\r\n    });\r\n    \r\n    // IE submit delegation\r\n    if ( !jQuery.support.submitBubbles ) {\r\n    \r\n        jQuery.event.special.submit = {\r\n            setup: function() {\r\n                // Only need this for delegated form submit events\r\n                if ( jQuery.nodeName( this, \"form\" ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                // Lazy-add a submit handler when a descendant form may potentially be submitted\r\n                jQuery.event.add( this, \"click._submit keypress._submit\", function( e ) {\r\n                    // Node name check avoids a VML-related crash in IE (#9807)\r\n                    var elem = e.target,\r\n                        form = jQuery.nodeName( elem, \"input\" ) || jQuery.nodeName( elem, \"button\" ) ? elem.form : undefined;\r\n                    if ( form && !jQuery._data( form, \"submitBubbles\" ) ) {\r\n                        jQuery.event.add( form, \"submit._submit\", function( event ) {\r\n                            event._submit_bubble = true;\r\n                        });\r\n                        jQuery._data( form, \"submitBubbles\", true );\r\n                    }\r\n                });\r\n                // return undefined since we don't need an event listener\r\n            },\r\n    \r\n            postDispatch: function( event ) {\r\n                // If form was submitted by the user, bubble the event up the tree\r\n                if ( event._submit_bubble ) {\r\n                    delete event._submit_bubble;\r\n                    if ( this.parentNode && !event.isTrigger ) {\r\n                        jQuery.event.simulate( \"submit\", this.parentNode, event, true );\r\n                    }\r\n                }\r\n            },\r\n    \r\n            teardown: function() {\r\n                // Only need this for delegated form submit events\r\n                if ( jQuery.nodeName( this, \"form\" ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                // Remove delegated handlers; cleanData eventually reaps submit handlers attached above\r\n                jQuery.event.remove( this, \"._submit\" );\r\n            }\r\n        };\r\n    }\r\n    \r\n    // IE change delegation and checkbox/radio fix\r\n    if ( !jQuery.support.changeBubbles ) {\r\n    \r\n        jQuery.event.special.change = {\r\n    \r\n            setup: function() {\r\n    \r\n                if ( rformElems.test( this.nodeName ) ) {\r\n                    // IE doesn't fire change on a check/radio until blur; trigger it on click\r\n                    // after a propertychange. Eat the blur-change in special.change.handle.\r\n                    // This still fires onchange a second time for check/radio after blur.\r\n                    if ( this.type === \"checkbox\" || this.type === \"radio\" ) {\r\n                        jQuery.event.add( this, \"propertychange._change\", function( event ) {\r\n                            if ( event.originalEvent.propertyName === \"checked\" ) {\r\n                                this._just_changed = true;\r\n                            }\r\n                        });\r\n                        jQuery.event.add( this, \"click._change\", function( event ) {\r\n                            if ( this._just_changed && !event.isTrigger ) {\r\n                                this._just_changed = false;\r\n                            }\r\n                            // Allow triggered, simulated change events (#11500)\r\n                            jQuery.event.simulate( \"change\", this, event, true );\r\n                        });\r\n                    }\r\n                    return false;\r\n                }\r\n                // Delegated event; lazy-add a change handler on descendant inputs\r\n                jQuery.event.add( this, \"beforeactivate._change\", function( e ) {\r\n                    var elem = e.target;\r\n    \r\n                    if ( rformElems.test( elem.nodeName ) && !jQuery._data( elem, \"changeBubbles\" ) ) {\r\n                        jQuery.event.add( elem, \"change._change\", function( event ) {\r\n                            if ( this.parentNode && !event.isSimulated && !event.isTrigger ) {\r\n                                jQuery.event.simulate( \"change\", this.parentNode, event, true );\r\n                            }\r\n                        });\r\n                        jQuery._data( elem, \"changeBubbles\", true );\r\n                    }\r\n                });\r\n            },\r\n    \r\n            handle: function( event ) {\r\n                var elem = event.target;\r\n    \r\n                // Swallow native change events from checkbox/radio, we already triggered them above\r\n                if ( this !== elem || event.isSimulated || event.isTrigger || (elem.type !== \"radio\" && elem.type !== \"checkbox\") ) {\r\n                    return event.handleObj.handler.apply( this, arguments );\r\n                }\r\n            },\r\n    \r\n            teardown: function() {\r\n                jQuery.event.remove( this, \"._change\" );\r\n    \r\n                return !rformElems.test( this.nodeName );\r\n            }\r\n        };\r\n    }\r\n    \r\n    // Create \"bubbling\" focus and blur events\r\n    if ( !jQuery.support.focusinBubbles ) {\r\n        jQuery.each({ focus: \"focusin\", blur: \"focusout\" }, function( orig, fix ) {\r\n    \r\n            // Attach a single capturing handler while someone wants focusin/focusout\r\n            var attaches = 0,\r\n                handler = function( event ) {\r\n                    jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ), true );\r\n                };\r\n    \r\n            jQuery.event.special[ fix ] = {\r\n                setup: function() {\r\n                    if ( attaches++ === 0 ) {\r\n                        document.addEventListener( orig, handler, true );\r\n                    }\r\n                },\r\n                teardown: function() {\r\n                    if ( --attaches === 0 ) {\r\n                        document.removeEventListener( orig, handler, true );\r\n                    }\r\n                }\r\n            };\r\n        });\r\n    }\r\n    \r\n    jQuery.fn.extend({\r\n    \r\n        on: function( types, selector, data, fn, /*INTERNAL*/ one ) {\r\n            var type, origFn;\r\n    \r\n            // Types can be a map of types/handlers\r\n            if ( typeof types === \"object\" ) {\r\n                // ( types-Object, selector, data )\r\n                if ( typeof selector !== \"string\" ) {\r\n                    // ( types-Object, data )\r\n                    data = data || selector;\r\n                    selector = undefined;\r\n                }\r\n                for ( type in types ) {\r\n                    this.on( type, selector, data, types[ type ], one );\r\n                }\r\n                return this;\r\n            }\r\n    \r\n            if ( data == null && fn == null ) {\r\n                // ( types, fn )\r\n                fn = selector;\r\n                data = selector = undefined;\r\n            } else if ( fn == null ) {\r\n                if ( typeof selector === \"string\" ) {\r\n                    // ( types, selector, fn )\r\n                    fn = data;\r\n                    data = undefined;\r\n                } else {\r\n                    // ( types, data, fn )\r\n                    fn = data;\r\n                    data = selector;\r\n                    selector = undefined;\r\n                }\r\n            }\r\n            if ( fn === false ) {\r\n                fn = returnFalse;\r\n            } else if ( !fn ) {\r\n                return this;\r\n            }\r\n    \r\n            if ( one === 1 ) {\r\n                origFn = fn;\r\n                fn = function( event ) {\r\n                    // Can use an empty set, since event contains the info\r\n                    jQuery().off( event );\r\n                    return origFn.apply( this, arguments );\r\n                };\r\n                // Use same guid so caller can remove using origFn\r\n                fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );\r\n            }\r\n            return this.each( function() {\r\n                jQuery.event.add( this, types, fn, data, selector );\r\n            });\r\n        },\r\n        one: function( types, selector, data, fn ) {\r\n            return this.on( types, selector, data, fn, 1 );\r\n        },\r\n        off: function( types, selector, fn ) {\r\n            var handleObj, type;\r\n            if ( types && types.preventDefault && types.handleObj ) {\r\n                // ( event )  dispatched jQuery.Event\r\n                handleObj = types.handleObj;\r\n                jQuery( types.delegateTarget ).off(\r\n                    handleObj.namespace ? handleObj.origType + \".\" + handleObj.namespace : handleObj.origType,\r\n                    handleObj.selector,\r\n                    handleObj.handler\r\n                );\r\n                return this;\r\n            }\r\n            if ( typeof types === \"object\" ) {\r\n                // ( types-object [, selector] )\r\n                for ( type in types ) {\r\n                    this.off( type, selector, types[ type ] );\r\n                }\r\n                return this;\r\n            }\r\n            if ( selector === false || typeof selector === \"function\" ) {\r\n                // ( types [, fn] )\r\n                fn = selector;\r\n                selector = undefined;\r\n            }\r\n            if ( fn === false ) {\r\n                fn = returnFalse;\r\n            }\r\n            return this.each(function() {\r\n                jQuery.event.remove( this, types, fn, selector );\r\n            });\r\n        },\r\n    \r\n        bind: function( types, data, fn ) {\r\n            return this.on( types, null, data, fn );\r\n        },\r\n        unbind: function( types, fn ) {\r\n            return this.off( types, null, fn );\r\n        },\r\n    \r\n        delegate: function( selector, types, data, fn ) {\r\n            return this.on( types, selector, data, fn );\r\n        },\r\n        undelegate: function( selector, types, fn ) {\r\n            // ( namespace ) or ( selector, types [, fn] )\r\n            return arguments.length === 1 ? this.off( selector, \"**\" ) : this.off( types, selector || \"**\", fn );\r\n        },\r\n    \r\n        trigger: function( type, data ) {\r\n            return this.each(function() {\r\n                jQuery.event.trigger( type, data, this );\r\n            });\r\n        },\r\n        triggerHandler: function( type, data ) {\r\n            var elem = this[0];\r\n            if ( elem ) {\r\n                return jQuery.event.trigger( type, data, elem, true );\r\n            }\r\n        }\r\n    });\r\n    /*!\r\n     * Sizzle CSS Selector Engine\r\n     * Copyright 2012 jQuery Foundation and other contributors\r\n     * Released under the MIT license\r\n     * http://sizzlejs.com/\r\n     */\r\n    (function( window, undefined ) {\r\n    \r\n    var i,\r\n        cachedruns,\r\n        Expr,\r\n        getText,\r\n        isXML,\r\n        compile,\r\n        hasDuplicate,\r\n        outermostContext,\r\n    \r\n        // Local document vars\r\n        setDocument,\r\n        document,\r\n        docElem,\r\n        documentIsXML,\r\n        rbuggyQSA,\r\n        rbuggyMatches,\r\n        matches,\r\n        contains,\r\n        sortOrder,\r\n    \r\n        // Instance-specific data\r\n        expando = \"sizzle\" + -(new Date()),\r\n        preferredDoc = window.document,\r\n        support = {},\r\n        dirruns = 0,\r\n        done = 0,\r\n        classCache = createCache(),\r\n        tokenCache = createCache(),\r\n        compilerCache = createCache(),\r\n    \r\n        // General-purpose constants\r\n        strundefined = typeof undefined,\r\n        MAX_NEGATIVE = 1 << 31,\r\n    \r\n        // Array methods\r\n        arr = [],\r\n        pop = arr.pop,\r\n        push = arr.push,\r\n        slice = arr.slice,\r\n        // Use a stripped-down indexOf if we can't use a native one\r\n        indexOf = arr.indexOf || function( elem ) {\r\n            var i = 0,\r\n                len = this.length;\r\n            for ( ; i < len; i++ ) {\r\n                if ( this[i] === elem ) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        },\r\n    \r\n    \r\n        // Regular expressions\r\n    \r\n        // Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace\r\n        whitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\r\n        // http://www.w3.org/TR/css3-syntax/#characters\r\n        characterEncoding = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\r\n    \r\n        // Loosely modeled on CSS identifier characters\r\n        // An unquoted value should be a CSS identifier http://www.w3.org/TR/css3-selectors/#attribute-selectors\r\n        // Proper syntax: http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\r\n        identifier = characterEncoding.replace( \"w\", \"w#\" ),\r\n    \r\n        // Acceptable operators http://www.w3.org/TR/selectors/#attribute-selectors\r\n        operators = \"([*^$|!~]?=)\",\r\n        attributes = \"\\\\[\" + whitespace + \"*(\" + characterEncoding + \")\" + whitespace +\r\n            \"*(?:\" + operators + whitespace + \"*(?:(['\\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\3|(\" + identifier + \")|)|)\" + whitespace + \"*\\\\]\",\r\n    \r\n        // Prefer arguments quoted,\r\n        //   then not containing pseudos/brackets,\r\n        //   then attribute selectors/non-parenthetical expressions,\r\n        //   then anything else\r\n        // These preferences are here to reduce the number of selectors\r\n        //   needing tokenize in the PSEUDO preFilter\r\n        pseudos = \":(\" + characterEncoding + \")(?:\\\\(((['\\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\3|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes.replace( 3, 8 ) + \")*)|.*)\\\\)|)\",\r\n    \r\n        // Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\r\n        rtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\r\n    \r\n        rcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\r\n        rcombinators = new RegExp( \"^\" + whitespace + \"*([\\\\x20\\\\t\\\\r\\\\n\\\\f>+~])\" + whitespace + \"*\" ),\r\n        rpseudo = new RegExp( pseudos ),\r\n        ridentifier = new RegExp( \"^\" + identifier + \"$\" ),\r\n    \r\n        matchExpr = {\r\n            \"ID\": new RegExp( \"^#(\" + characterEncoding + \")\" ),\r\n            \"CLASS\": new RegExp( \"^\\\\.(\" + characterEncoding + \")\" ),\r\n            \"NAME\": new RegExp( \"^\\\\[name=['\\\"]?(\" + characterEncoding + \")['\\\"]?\\\\]\" ),\r\n            \"TAG\": new RegExp( \"^(\" + characterEncoding.replace( \"w\", \"w*\" ) + \")\" ),\r\n            \"ATTR\": new RegExp( \"^\" + attributes ),\r\n            \"PSEUDO\": new RegExp( \"^\" + pseudos ),\r\n            \"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\r\n                \"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\r\n                \"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\r\n            // For use in libraries implementing .is()\r\n            // We use this for POS matching in `select`\r\n            \"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\r\n                whitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\r\n        },\r\n    \r\n        rsibling = /[\\x20\\t\\r\\n\\f]*[+~]/,\r\n    \r\n        rnative = /^[^{]+\\{\\s*\\[native code/,\r\n    \r\n        // Easily-parseable/retrievable ID or TAG or CLASS selectors\r\n        rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\r\n    \r\n        rinputs = /^(?:input|select|textarea|button)$/i,\r\n        rheader = /^h\\d$/i,\r\n    \r\n        rescape = /'|\\\\/g,\r\n        rattributeQuotes = /\\=[\\x20\\t\\r\\n\\f]*([^'\"\\]]*)[\\x20\\t\\r\\n\\f]*\\]/g,\r\n    \r\n        // CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\r\n        runescape = /\\\\([\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|.)/g,\r\n        funescape = function( _, escaped ) {\r\n            var high = \"0x\" + escaped - 0x10000;\r\n            // NaN means non-codepoint\r\n            return high !== high ?\r\n                escaped :\r\n                // BMP codepoint\r\n                high < 0 ?\r\n                    String.fromCharCode( high + 0x10000 ) :\r\n                    // Supplemental Plane codepoint (surrogate pair)\r\n                    String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\r\n        };\r\n    \r\n    // Use a stripped-down slice if we can't use a native one\r\n    try {\r\n        slice.call( preferredDoc.documentElement.childNodes, 0 )[0].nodeType;\r\n    } catch ( e ) {\r\n        slice = function( i ) {\r\n            var elem,\r\n                results = [];\r\n            while ( (elem = this[i++]) ) {\r\n                results.push( elem );\r\n            }\r\n            return results;\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * For feature detection\r\n     * @param {Function} fn The function to test for native support\r\n     */\r\n    function isNative( fn ) {\r\n        return rnative.test( fn + \"\" );\r\n    }\r\n    \r\n    /**\r\n     * Create key-value caches of limited size\r\n     * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\r\n     *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\r\n     *\tdeleting the oldest entry\r\n     */\r\n    function createCache() {\r\n        var cache,\r\n            keys = [];\r\n    \r\n        return (cache = function( key, value ) {\r\n            // Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\r\n            if ( keys.push( key += \" \" ) > Expr.cacheLength ) {\r\n                // Only keep the most recent entries\r\n                delete cache[ keys.shift() ];\r\n            }\r\n            return (cache[ key ] = value);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Mark a function for special use by Sizzle\r\n     * @param {Function} fn The function to mark\r\n     */\r\n    function markFunction( fn ) {\r\n        fn[ expando ] = true;\r\n        return fn;\r\n    }\r\n    \r\n    /**\r\n     * Support testing using an element\r\n     * @param {Function} fn Passed the created div and expects a boolean result\r\n     */\r\n    function assert( fn ) {\r\n        var div = document.createElement(\"div\");\r\n    \r\n        try {\r\n            return fn( div );\r\n        } catch (e) {\r\n            return false;\r\n        } finally {\r\n            // release memory in IE\r\n            div = null;\r\n        }\r\n    }\r\n    \r\n    function Sizzle( selector, context, results, seed ) {\r\n        var match, elem, m, nodeType,\r\n            // QSA vars\r\n            i, groups, old, nid, newContext, newSelector;\r\n    \r\n        if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\r\n            setDocument( context );\r\n        }\r\n    \r\n        context = context || document;\r\n        results = results || [];\r\n    \r\n        if ( !selector || typeof selector !== \"string\" ) {\r\n            return results;\r\n        }\r\n    \r\n        if ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {\r\n            return [];\r\n        }\r\n    \r\n        if ( !documentIsXML && !seed ) {\r\n    \r\n            // Shortcuts\r\n            if ( (match = rquickExpr.exec( selector )) ) {\r\n                // Speed-up: Sizzle(\"#ID\")\r\n                if ( (m = match[1]) ) {\r\n                    if ( nodeType === 9 ) {\r\n                        elem = context.getElementById( m );\r\n                        // Check parentNode to catch when Blackberry 4.6 returns\r\n                        // nodes that are no longer in the document #6963\r\n                        if ( elem && elem.parentNode ) {\r\n                            // Handle the case where IE, Opera, and Webkit return items\r\n                            // by name instead of ID\r\n                            if ( elem.id === m ) {\r\n                                results.push( elem );\r\n                                return results;\r\n                            }\r\n                        } else {\r\n                            return results;\r\n                        }\r\n                    } else {\r\n                        // Context is not a document\r\n                        if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\r\n                            contains( context, elem ) && elem.id === m ) {\r\n                            results.push( elem );\r\n                            return results;\r\n                        }\r\n                    }\r\n    \r\n                // Speed-up: Sizzle(\"TAG\")\r\n                } else if ( match[2] ) {\r\n                    push.apply( results, slice.call(context.getElementsByTagName( selector ), 0) );\r\n                    return results;\r\n    \r\n                // Speed-up: Sizzle(\".CLASS\")\r\n                } else if ( (m = match[3]) && support.getByClassName && context.getElementsByClassName ) {\r\n                    push.apply( results, slice.call(context.getElementsByClassName( m ), 0) );\r\n                    return results;\r\n                }\r\n            }\r\n    \r\n            // QSA path\r\n            if ( support.qsa && !rbuggyQSA.test(selector) ) {\r\n                old = true;\r\n                nid = expando;\r\n                newContext = context;\r\n                newSelector = nodeType === 9 && selector;\r\n    \r\n                // qSA works strangely on Element-rooted queries\r\n                // We can work around this by specifying an extra ID on the root\r\n                // and working up from there (Thanks to Andrew Dupont for the technique)\r\n                // IE 8 doesn't work on object elements\r\n                if ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\r\n                    groups = tokenize( selector );\r\n    \r\n                    if ( (old = context.getAttribute(\"id\")) ) {\r\n                        nid = old.replace( rescape, \"\\\\$&\" );\r\n                    } else {\r\n                        context.setAttribute( \"id\", nid );\r\n                    }\r\n                    nid = \"[id='\" + nid + \"'] \";\r\n    \r\n                    i = groups.length;\r\n                    while ( i-- ) {\r\n                        groups[i] = nid + toSelector( groups[i] );\r\n                    }\r\n                    newContext = rsibling.test( selector ) && context.parentNode || context;\r\n                    newSelector = groups.join(\",\");\r\n                }\r\n    \r\n                if ( newSelector ) {\r\n                    try {\r\n                        push.apply( results, slice.call( newContext.querySelectorAll(\r\n                            newSelector\r\n                        ), 0 ) );\r\n                        return results;\r\n                    } catch(qsaError) {\r\n                    } finally {\r\n                        if ( !old ) {\r\n                            context.removeAttribute(\"id\");\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        // All others\r\n        return select( selector.replace( rtrim, \"$1\" ), context, results, seed );\r\n    }\r\n    \r\n    /**\r\n     * Detect xml\r\n     * @param {Element|Object} elem An element or a document\r\n     */\r\n    isXML = Sizzle.isXML = function( elem ) {\r\n        // documentElement is verified for cases where it doesn't yet exist\r\n        // (such as loading iframes in IE - #4833)\r\n        var documentElement = elem && (elem.ownerDocument || elem).documentElement;\r\n        return documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n    };\r\n    \r\n    /**\r\n     * Sets document-related variables once based on the current document\r\n     * @param {Element|Object} [doc] An element or document object to use to set the document\r\n     * @returns {Object} Returns the current document\r\n     */\r\n    setDocument = Sizzle.setDocument = function( node ) {\r\n        var doc = node ? node.ownerDocument || node : preferredDoc;\r\n    \r\n        // If no document and documentElement is available, return\r\n        if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\r\n            return document;\r\n        }\r\n    \r\n        // Set our document\r\n        document = doc;\r\n        docElem = doc.documentElement;\r\n    \r\n        // Support tests\r\n        documentIsXML = isXML( doc );\r\n    \r\n        // Check if getElementsByTagName(\"*\") returns only elements\r\n        support.tagNameNoComments = assert(function( div ) {\r\n            div.appendChild( doc.createComment(\"\") );\r\n            return !div.getElementsByTagName(\"*\").length;\r\n        });\r\n    \r\n        // Check if attributes should be retrieved by attribute nodes\r\n        support.attributes = assert(function( div ) {\r\n            div.innerHTML = \"<select></select>\";\r\n            var type = typeof div.lastChild.getAttribute(\"multiple\");\r\n            // IE8 returns a string for some attributes even when not present\r\n            return type !== \"boolean\" && type !== \"string\";\r\n        });\r\n    \r\n        // Check if getElementsByClassName can be trusted\r\n        support.getByClassName = assert(function( div ) {\r\n            // Opera can't find a second classname (in 9.6)\r\n            div.innerHTML = \"<div class='hidden e'></div><div class='hidden'></div>\";\r\n            if ( !div.getElementsByClassName || !div.getElementsByClassName(\"e\").length ) {\r\n                return false;\r\n            }\r\n    \r\n            // Safari 3.2 caches class attributes and doesn't catch changes\r\n            div.lastChild.className = \"e\";\r\n            return div.getElementsByClassName(\"e\").length === 2;\r\n        });\r\n    \r\n        // Check if getElementById returns elements by name\r\n        // Check if getElementsByName privileges form controls or returns elements by ID\r\n        support.getByName = assert(function( div ) {\r\n            // Inject content\r\n            div.id = expando + 0;\r\n            div.innerHTML = \"<a name='\" + expando + \"'></a><div name='\" + expando + \"'></div>\";\r\n            docElem.insertBefore( div, docElem.firstChild );\r\n    \r\n            // Test\r\n            var pass = doc.getElementsByName &&\r\n                // buggy browsers will return fewer than the correct 2\r\n                doc.getElementsByName( expando ).length === 2 +\r\n                // buggy browsers will return more than the correct 0\r\n                doc.getElementsByName( expando + 0 ).length;\r\n            support.getIdNotName = !doc.getElementById( expando );\r\n    \r\n            // Cleanup\r\n            docElem.removeChild( div );\r\n    \r\n            return pass;\r\n        });\r\n    \r\n        // IE6/7 return modified attributes\r\n        Expr.attrHandle = assert(function( div ) {\r\n            div.innerHTML = \"<a href='#'></a>\";\r\n            return div.firstChild && typeof div.firstChild.getAttribute !== strundefined &&\r\n                div.firstChild.getAttribute(\"href\") === \"#\";\r\n        }) ?\r\n            {} :\r\n            {\r\n                \"href\": function( elem ) {\r\n                    return elem.getAttribute( \"href\", 2 );\r\n                },\r\n                \"type\": function( elem ) {\r\n                    return elem.getAttribute(\"type\");\r\n                }\r\n            };\r\n    \r\n        // ID find and filter\r\n        if ( support.getIdNotName ) {\r\n            Expr.find[\"ID\"] = function( id, context ) {\r\n                if ( typeof context.getElementById !== strundefined && !documentIsXML ) {\r\n                    var m = context.getElementById( id );\r\n                    // Check parentNode to catch when Blackberry 4.6 returns\r\n                    // nodes that are no longer in the document #6963\r\n                    return m && m.parentNode ? [m] : [];\r\n                }\r\n            };\r\n            Expr.filter[\"ID\"] = function( id ) {\r\n                var attrId = id.replace( runescape, funescape );\r\n                return function( elem ) {\r\n                    return elem.getAttribute(\"id\") === attrId;\r\n                };\r\n            };\r\n        } else {\r\n            Expr.find[\"ID\"] = function( id, context ) {\r\n                if ( typeof context.getElementById !== strundefined && !documentIsXML ) {\r\n                    var m = context.getElementById( id );\r\n    \r\n                    return m ?\r\n                        m.id === id || typeof m.getAttributeNode !== strundefined && m.getAttributeNode(\"id\").value === id ?\r\n                            [m] :\r\n                            undefined :\r\n                        [];\r\n                }\r\n            };\r\n            Expr.filter[\"ID\"] =  function( id ) {\r\n                var attrId = id.replace( runescape, funescape );\r\n                return function( elem ) {\r\n                    var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode(\"id\");\r\n                    return node && node.value === attrId;\r\n                };\r\n            };\r\n        }\r\n    \r\n        // Tag\r\n        Expr.find[\"TAG\"] = support.tagNameNoComments ?\r\n            function( tag, context ) {\r\n                if ( typeof context.getElementsByTagName !== strundefined ) {\r\n                    return context.getElementsByTagName( tag );\r\n                }\r\n            } :\r\n            function( tag, context ) {\r\n                var elem,\r\n                    tmp = [],\r\n                    i = 0,\r\n                    results = context.getElementsByTagName( tag );\r\n    \r\n                // Filter out possible comments\r\n                if ( tag === \"*\" ) {\r\n                    while ( (elem = results[i++]) ) {\r\n                        if ( elem.nodeType === 1 ) {\r\n                            tmp.push( elem );\r\n                        }\r\n                    }\r\n    \r\n                    return tmp;\r\n                }\r\n                return results;\r\n            };\r\n    \r\n        // Name\r\n        Expr.find[\"NAME\"] = support.getByName && function( tag, context ) {\r\n            if ( typeof context.getElementsByName !== strundefined ) {\r\n                return context.getElementsByName( name );\r\n            }\r\n        };\r\n    \r\n        // Class\r\n        Expr.find[\"CLASS\"] = support.getByClassName && function( className, context ) {\r\n            if ( typeof context.getElementsByClassName !== strundefined && !documentIsXML ) {\r\n                return context.getElementsByClassName( className );\r\n            }\r\n        };\r\n    \r\n        // QSA and matchesSelector support\r\n    \r\n        // matchesSelector(:active) reports false when true (IE9/Opera 11.5)\r\n        rbuggyMatches = [];\r\n    \r\n        // qSa(:focus) reports false when true (Chrome 21),\r\n        // no need to also add to buggyMatches since matches checks buggyQSA\r\n        // A support test would require too much code (would include document ready)\r\n        rbuggyQSA = [ \":focus\" ];\r\n    \r\n        if ( (support.qsa = isNative(doc.querySelectorAll)) ) {\r\n            // Build QSA regex\r\n            // Regex strategy adopted from Diego Perini\r\n            assert(function( div ) {\r\n                // Select is set to empty string on purpose\r\n                // This is to test IE's treatment of not explictly\r\n                // setting a boolean content attribute,\r\n                // since its presence should be enough\r\n                // http://bugs.jquery.com/ticket/12359\r\n                div.innerHTML = \"<select><option selected=''></option></select>\";\r\n    \r\n                // IE8 - Some boolean attributes are not treated correctly\r\n                if ( !div.querySelectorAll(\"[selected]\").length ) {\r\n                    rbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:checked|disabled|ismap|multiple|readonly|selected|value)\" );\r\n                }\r\n    \r\n                // Webkit/Opera - :checked should return selected option elements\r\n                // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n                // IE8 throws error here and will not see later tests\r\n                if ( !div.querySelectorAll(\":checked\").length ) {\r\n                    rbuggyQSA.push(\":checked\");\r\n                }\r\n            });\r\n    \r\n            assert(function( div ) {\r\n    \r\n                // Opera 10-12/IE8 - ^= $= *= and empty values\r\n                // Should not select anything\r\n                div.innerHTML = \"<input type='hidden' i=''/>\";\r\n                if ( div.querySelectorAll(\"[i^='']\").length ) {\r\n                    rbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:\\\"\\\"|'')\" );\r\n                }\r\n    \r\n                // FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\r\n                // IE8 throws error here and will not see later tests\r\n                if ( !div.querySelectorAll(\":enabled\").length ) {\r\n                    rbuggyQSA.push( \":enabled\", \":disabled\" );\r\n                }\r\n    \r\n                // Opera 10-11 does not throw on post-comma invalid pseudos\r\n                div.querySelectorAll(\"*,:x\");\r\n                rbuggyQSA.push(\",.*:\");\r\n            });\r\n        }\r\n    \r\n        if ( (support.matchesSelector = isNative( (matches = docElem.matchesSelector ||\r\n            docElem.mozMatchesSelector ||\r\n            docElem.webkitMatchesSelector ||\r\n            docElem.oMatchesSelector ||\r\n            docElem.msMatchesSelector) )) ) {\r\n    \r\n            assert(function( div ) {\r\n                // Check to see if it's possible to do matchesSelector\r\n                // on a disconnected node (IE 9)\r\n                support.disconnectedMatch = matches.call( div, \"div\" );\r\n    \r\n                // This should fail with an exception\r\n                // Gecko does not error, returns false instead\r\n                matches.call( div, \"[s!='']:x\" );\r\n                rbuggyMatches.push( \"!=\", pseudos );\r\n            });\r\n        }\r\n    \r\n        rbuggyQSA = new RegExp( rbuggyQSA.join(\"|\") );\r\n        rbuggyMatches = new RegExp( rbuggyMatches.join(\"|\") );\r\n    \r\n        // Element contains another\r\n        // Purposefully does not implement inclusive descendent\r\n        // As in, an element does not contain itself\r\n        contains = isNative(docElem.contains) || docElem.compareDocumentPosition ?\r\n            function( a, b ) {\r\n                var adown = a.nodeType === 9 ? a.documentElement : a,\r\n                    bup = b && b.parentNode;\r\n                return a === bup || !!( bup && bup.nodeType === 1 && (\r\n                    adown.contains ?\r\n                        adown.contains( bup ) :\r\n                        a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\r\n                ));\r\n            } :\r\n            function( a, b ) {\r\n                if ( b ) {\r\n                    while ( (b = b.parentNode) ) {\r\n                        if ( b === a ) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n    \r\n        // Document order sorting\r\n        sortOrder = docElem.compareDocumentPosition ?\r\n        function( a, b ) {\r\n            var compare;\r\n    \r\n            if ( a === b ) {\r\n                hasDuplicate = true;\r\n                return 0;\r\n            }\r\n    \r\n            if ( (compare = b.compareDocumentPosition && a.compareDocumentPosition && a.compareDocumentPosition( b )) ) {\r\n                if ( compare & 1 || a.parentNode && a.parentNode.nodeType === 11 ) {\r\n                    if ( a === doc || contains( preferredDoc, a ) ) {\r\n                        return -1;\r\n                    }\r\n                    if ( b === doc || contains( preferredDoc, b ) ) {\r\n                        return 1;\r\n                    }\r\n                    return 0;\r\n                }\r\n                return compare & 4 ? -1 : 1;\r\n            }\r\n    \r\n            return a.compareDocumentPosition ? -1 : 1;\r\n        } :\r\n        function( a, b ) {\r\n            var cur,\r\n                i = 0,\r\n                aup = a.parentNode,\r\n                bup = b.parentNode,\r\n                ap = [ a ],\r\n                bp = [ b ];\r\n    \r\n            // Exit early if the nodes are identical\r\n            if ( a === b ) {\r\n                hasDuplicate = true;\r\n                return 0;\r\n    \r\n            // Parentless nodes are either documents or disconnected\r\n            } else if ( !aup || !bup ) {\r\n                return a === doc ? -1 :\r\n                    b === doc ? 1 :\r\n                    aup ? -1 :\r\n                    bup ? 1 :\r\n                    0;\r\n    \r\n            // If the nodes are siblings, we can do a quick check\r\n            } else if ( aup === bup ) {\r\n                return siblingCheck( a, b );\r\n            }\r\n    \r\n            // Otherwise we need full lists of their ancestors for comparison\r\n            cur = a;\r\n            while ( (cur = cur.parentNode) ) {\r\n                ap.unshift( cur );\r\n            }\r\n            cur = b;\r\n            while ( (cur = cur.parentNode) ) {\r\n                bp.unshift( cur );\r\n            }\r\n    \r\n            // Walk down the tree looking for a discrepancy\r\n            while ( ap[i] === bp[i] ) {\r\n                i++;\r\n            }\r\n    \r\n            return i ?\r\n                // Do a sibling check if the nodes have a common ancestor\r\n                siblingCheck( ap[i], bp[i] ) :\r\n    \r\n                // Otherwise nodes in our document sort first\r\n                ap[i] === preferredDoc ? -1 :\r\n                bp[i] === preferredDoc ? 1 :\r\n                0;\r\n        };\r\n    \r\n        // Always assume the presence of duplicates if sort doesn't\r\n        // pass them to our comparison function (as in Google Chrome).\r\n        hasDuplicate = false;\r\n        [0, 0].sort( sortOrder );\r\n        support.detectDuplicates = hasDuplicate;\r\n    \r\n        return document;\r\n    };\r\n    \r\n    Sizzle.matches = function( expr, elements ) {\r\n        return Sizzle( expr, null, null, elements );\r\n    };\r\n    \r\n    Sizzle.matchesSelector = function( elem, expr ) {\r\n        // Set document vars if needed\r\n        if ( ( elem.ownerDocument || elem ) !== document ) {\r\n            setDocument( elem );\r\n        }\r\n    \r\n        // Make sure that attribute selectors are quoted\r\n        expr = expr.replace( rattributeQuotes, \"='$1']\" );\r\n    \r\n        // rbuggyQSA always contains :focus, so no need for an existence check\r\n        if ( support.matchesSelector && !documentIsXML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && !rbuggyQSA.test(expr) ) {\r\n            try {\r\n                var ret = matches.call( elem, expr );\r\n    \r\n                // IE 9's matchesSelector returns false on disconnected nodes\r\n                if ( ret || support.disconnectedMatch ||\r\n                        // As well, disconnected nodes are said to be in a document\r\n                        // fragment in IE 9\r\n                        elem.document && elem.document.nodeType !== 11 ) {\r\n                    return ret;\r\n                }\r\n            } catch(e) {}\r\n        }\r\n    \r\n        return Sizzle( expr, document, null, [elem] ).length > 0;\r\n    };\r\n    \r\n    Sizzle.contains = function( context, elem ) {\r\n        // Set document vars if needed\r\n        if ( ( context.ownerDocument || context ) !== document ) {\r\n            setDocument( context );\r\n        }\r\n        return contains( context, elem );\r\n    };\r\n    \r\n    Sizzle.attr = function( elem, name ) {\r\n        var val;\r\n    \r\n        // Set document vars if needed\r\n        if ( ( elem.ownerDocument || elem ) !== document ) {\r\n            setDocument( elem );\r\n        }\r\n    \r\n        if ( !documentIsXML ) {\r\n            name = name.toLowerCase();\r\n        }\r\n        if ( (val = Expr.attrHandle[ name ]) ) {\r\n            return val( elem );\r\n        }\r\n        if ( documentIsXML || support.attributes ) {\r\n            return elem.getAttribute( name );\r\n        }\r\n        return ( (val = elem.getAttributeNode( name )) || elem.getAttribute( name ) ) && elem[ name ] === true ?\r\n            name :\r\n            val && val.specified ? val.value : null;\r\n    };\r\n    \r\n    Sizzle.error = function( msg ) {\r\n        throw new Error( \"Syntax error, unrecognized expression: \" + msg );\r\n    };\r\n    \r\n    // Document sorting and removing duplicates\r\n    Sizzle.uniqueSort = function( results ) {\r\n        var elem,\r\n            duplicates = [],\r\n            i = 1,\r\n            j = 0;\r\n    \r\n        // Unless we *know* we can detect duplicates, assume their presence\r\n        hasDuplicate = !support.detectDuplicates;\r\n        results.sort( sortOrder );\r\n    \r\n        if ( hasDuplicate ) {\r\n            for ( ; (elem = results[i]); i++ ) {\r\n                if ( elem === results[ i - 1 ] ) {\r\n                    j = duplicates.push( i );\r\n                }\r\n            }\r\n            while ( j-- ) {\r\n                results.splice( duplicates[ j ], 1 );\r\n            }\r\n        }\r\n    \r\n        return results;\r\n    };\r\n    \r\n    function siblingCheck( a, b ) {\r\n        var cur = b && a,\r\n            diff = cur && ( ~b.sourceIndex || MAX_NEGATIVE ) - ( ~a.sourceIndex || MAX_NEGATIVE );\r\n    \r\n        // Use IE sourceIndex if available on both nodes\r\n        if ( diff ) {\r\n            return diff;\r\n        }\r\n    \r\n        // Check if b follows a\r\n        if ( cur ) {\r\n            while ( (cur = cur.nextSibling) ) {\r\n                if ( cur === b ) {\r\n                    return -1;\r\n                }\r\n            }\r\n        }\r\n    \r\n        return a ? 1 : -1;\r\n    }\r\n    \r\n    // Returns a function to use in pseudos for input types\r\n    function createInputPseudo( type ) {\r\n        return function( elem ) {\r\n            var name = elem.nodeName.toLowerCase();\r\n            return name === \"input\" && elem.type === type;\r\n        };\r\n    }\r\n    \r\n    // Returns a function to use in pseudos for buttons\r\n    function createButtonPseudo( type ) {\r\n        return function( elem ) {\r\n            var name = elem.nodeName.toLowerCase();\r\n            return (name === \"input\" || name === \"button\") && elem.type === type;\r\n        };\r\n    }\r\n    \r\n    // Returns a function to use in pseudos for positionals\r\n    function createPositionalPseudo( fn ) {\r\n        return markFunction(function( argument ) {\r\n            argument = +argument;\r\n            return markFunction(function( seed, matches ) {\r\n                var j,\r\n                    matchIndexes = fn( [], seed.length, argument ),\r\n                    i = matchIndexes.length;\r\n    \r\n                // Match elements found at the specified indexes\r\n                while ( i-- ) {\r\n                    if ( seed[ (j = matchIndexes[i]) ] ) {\r\n                        seed[j] = !(matches[j] = seed[j]);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Utility function for retrieving the text value of an array of DOM nodes\r\n     * @param {Array|Element} elem\r\n     */\r\n    getText = Sizzle.getText = function( elem ) {\r\n        var node,\r\n            ret = \"\",\r\n            i = 0,\r\n            nodeType = elem.nodeType;\r\n    \r\n        if ( !nodeType ) {\r\n            // If no nodeType, this is expected to be an array\r\n            for ( ; (node = elem[i]); i++ ) {\r\n                // Do not traverse comment nodes\r\n                ret += getText( node );\r\n            }\r\n        } else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\r\n            // Use textContent for elements\r\n            // innerText usage removed for consistency of new lines (see #11153)\r\n            if ( typeof elem.textContent === \"string\" ) {\r\n                return elem.textContent;\r\n            } else {\r\n                // Traverse its children\r\n                for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n                    ret += getText( elem );\r\n                }\r\n            }\r\n        } else if ( nodeType === 3 || nodeType === 4 ) {\r\n            return elem.nodeValue;\r\n        }\r\n        // Do not include comment or processing instruction nodes\r\n    \r\n        return ret;\r\n    };\r\n    \r\n    Expr = Sizzle.selectors = {\r\n    \r\n        // Can be adjusted by the user\r\n        cacheLength: 50,\r\n    \r\n        createPseudo: markFunction,\r\n    \r\n        match: matchExpr,\r\n    \r\n        find: {},\r\n    \r\n        relative: {\r\n            \">\": { dir: \"parentNode\", first: true },\r\n            \" \": { dir: \"parentNode\" },\r\n            \"+\": { dir: \"previousSibling\", first: true },\r\n            \"~\": { dir: \"previousSibling\" }\r\n        },\r\n    \r\n        preFilter: {\r\n            \"ATTR\": function( match ) {\r\n                match[1] = match[1].replace( runescape, funescape );\r\n    \r\n                // Move the given value to match[3] whether quoted or unquoted\r\n                match[3] = ( match[4] || match[5] || \"\" ).replace( runescape, funescape );\r\n    \r\n                if ( match[2] === \"~=\" ) {\r\n                    match[3] = \" \" + match[3] + \" \";\r\n                }\r\n    \r\n                return match.slice( 0, 4 );\r\n            },\r\n    \r\n            \"CHILD\": function( match ) {\r\n                /* matches from matchExpr[\"CHILD\"]\r\n                    1 type (only|nth|...)\r\n                    2 what (child|of-type)\r\n                    3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\r\n                    4 xn-component of xn+y argument ([+-]?\\d*n|)\r\n                    5 sign of xn-component\r\n                    6 x of xn-component\r\n                    7 sign of y-component\r\n                    8 y of y-component\r\n                */\r\n                match[1] = match[1].toLowerCase();\r\n    \r\n                if ( match[1].slice( 0, 3 ) === \"nth\" ) {\r\n                    // nth-* requires argument\r\n                    if ( !match[3] ) {\r\n                        Sizzle.error( match[0] );\r\n                    }\r\n    \r\n                    // numeric x and y parameters for Expr.filter.CHILD\r\n                    // remember that false/true cast respectively to 0/1\r\n                    match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\r\n                    match[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\r\n    \r\n                // other types prohibit arguments\r\n                } else if ( match[3] ) {\r\n                    Sizzle.error( match[0] );\r\n                }\r\n    \r\n                return match;\r\n            },\r\n    \r\n            \"PSEUDO\": function( match ) {\r\n                var excess,\r\n                    unquoted = !match[5] && match[2];\r\n    \r\n                if ( matchExpr[\"CHILD\"].test( match[0] ) ) {\r\n                    return null;\r\n                }\r\n    \r\n                // Accept quoted arguments as-is\r\n                if ( match[4] ) {\r\n                    match[2] = match[4];\r\n    \r\n                // Strip excess characters from unquoted arguments\r\n                } else if ( unquoted && rpseudo.test( unquoted ) &&\r\n                    // Get excess from tokenize (recursively)\r\n                    (excess = tokenize( unquoted, true )) &&\r\n                    // advance to the next closing parenthesis\r\n                    (excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\r\n    \r\n                    // excess is a negative index\r\n                    match[0] = match[0].slice( 0, excess );\r\n                    match[2] = unquoted.slice( 0, excess );\r\n                }\r\n    \r\n                // Return only captures needed by the pseudo filter method (type and argument)\r\n                return match.slice( 0, 3 );\r\n            }\r\n        },\r\n    \r\n        filter: {\r\n    \r\n            \"TAG\": function( nodeName ) {\r\n                if ( nodeName === \"*\" ) {\r\n                    return function() { return true; };\r\n                }\r\n    \r\n                nodeName = nodeName.replace( runescape, funescape ).toLowerCase();\r\n                return function( elem ) {\r\n                    return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\r\n                };\r\n            },\r\n    \r\n            \"CLASS\": function( className ) {\r\n                var pattern = classCache[ className + \" \" ];\r\n    \r\n                return pattern ||\r\n                    (pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\r\n                    classCache( className, function( elem ) {\r\n                        return pattern.test( elem.className || (typeof elem.getAttribute !== strundefined && elem.getAttribute(\"class\")) || \"\" );\r\n                    });\r\n            },\r\n    \r\n            \"ATTR\": function( name, operator, check ) {\r\n                return function( elem ) {\r\n                    var result = Sizzle.attr( elem, name );\r\n    \r\n                    if ( result == null ) {\r\n                        return operator === \"!=\";\r\n                    }\r\n                    if ( !operator ) {\r\n                        return true;\r\n                    }\r\n    \r\n                    result += \"\";\r\n    \r\n                    return operator === \"=\" ? result === check :\r\n                        operator === \"!=\" ? result !== check :\r\n                        operator === \"^=\" ? check && result.indexOf( check ) === 0 :\r\n                        operator === \"*=\" ? check && result.indexOf( check ) > -1 :\r\n                        operator === \"$=\" ? check && result.slice( -check.length ) === check :\r\n                        operator === \"~=\" ? ( \" \" + result + \" \" ).indexOf( check ) > -1 :\r\n                        operator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\r\n                        false;\r\n                };\r\n            },\r\n    \r\n            \"CHILD\": function( type, what, argument, first, last ) {\r\n                var simple = type.slice( 0, 3 ) !== \"nth\",\r\n                    forward = type.slice( -4 ) !== \"last\",\r\n                    ofType = what === \"of-type\";\r\n    \r\n                return first === 1 && last === 0 ?\r\n    \r\n                    // Shortcut for :nth-*(n)\r\n                    function( elem ) {\r\n                        return !!elem.parentNode;\r\n                    } :\r\n    \r\n                    function( elem, context, xml ) {\r\n                        var cache, outerCache, node, diff, nodeIndex, start,\r\n                            dir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\r\n                            parent = elem.parentNode,\r\n                            name = ofType && elem.nodeName.toLowerCase(),\r\n                            useCache = !xml && !ofType;\r\n    \r\n                        if ( parent ) {\r\n    \r\n                            // :(first|last|only)-(child|of-type)\r\n                            if ( simple ) {\r\n                                while ( dir ) {\r\n                                    node = elem;\r\n                                    while ( (node = node[ dir ]) ) {\r\n                                        if ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\r\n                                            return false;\r\n                                        }\r\n                                    }\r\n                                    // Reverse direction for :only-* (if we haven't yet done so)\r\n                                    start = dir = type === \"only\" && !start && \"nextSibling\";\r\n                                }\r\n                                return true;\r\n                            }\r\n    \r\n                            start = [ forward ? parent.firstChild : parent.lastChild ];\r\n    \r\n                            // non-xml :nth-child(...) stores cache data on `parent`\r\n                            if ( forward && useCache ) {\r\n                                // Seek `elem` from a previously-cached index\r\n                                outerCache = parent[ expando ] || (parent[ expando ] = {});\r\n                                cache = outerCache[ type ] || [];\r\n                                nodeIndex = cache[0] === dirruns && cache[1];\r\n                                diff = cache[0] === dirruns && cache[2];\r\n                                node = nodeIndex && parent.childNodes[ nodeIndex ];\r\n    \r\n                                while ( (node = ++nodeIndex && node && node[ dir ] ||\r\n    \r\n                                    // Fallback to seeking `elem` from the start\r\n                                    (diff = nodeIndex = 0) || start.pop()) ) {\r\n    \r\n                                    // When found, cache indexes on `parent` and break\r\n                                    if ( node.nodeType === 1 && ++diff && node === elem ) {\r\n                                        outerCache[ type ] = [ dirruns, nodeIndex, diff ];\r\n                                        break;\r\n                                    }\r\n                                }\r\n    \r\n                            // Use previously-cached element index if available\r\n                            } else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\r\n                                diff = cache[1];\r\n    \r\n                            // xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\r\n                            } else {\r\n                                // Use the same loop as above to seek `elem` from the start\r\n                                while ( (node = ++nodeIndex && node && node[ dir ] ||\r\n                                    (diff = nodeIndex = 0) || start.pop()) ) {\r\n    \r\n                                    if ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\r\n                                        // Cache the index of each encountered element\r\n                                        if ( useCache ) {\r\n                                            (node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\r\n                                        }\r\n    \r\n                                        if ( node === elem ) {\r\n                                            break;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n    \r\n                            // Incorporate the offset, then check against cycle size\r\n                            diff -= last;\r\n                            return diff === first || ( diff % first === 0 && diff / first >= 0 );\r\n                        }\r\n                    };\r\n            },\r\n    \r\n            \"PSEUDO\": function( pseudo, argument ) {\r\n                // pseudo-class names are case-insensitive\r\n                // http://www.w3.org/TR/selectors/#pseudo-classes\r\n                // Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\r\n                // Remember that setFilters inherits from pseudos\r\n                var args,\r\n                    fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\r\n                        Sizzle.error( \"unsupported pseudo: \" + pseudo );\r\n    \r\n                // The user may use createPseudo to indicate that\r\n                // arguments are needed to create the filter function\r\n                // just as Sizzle does\r\n                if ( fn[ expando ] ) {\r\n                    return fn( argument );\r\n                }\r\n    \r\n                // But maintain support for old signatures\r\n                if ( fn.length > 1 ) {\r\n                    args = [ pseudo, pseudo, \"\", argument ];\r\n                    return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\r\n                        markFunction(function( seed, matches ) {\r\n                            var idx,\r\n                                matched = fn( seed, argument ),\r\n                                i = matched.length;\r\n                            while ( i-- ) {\r\n                                idx = indexOf.call( seed, matched[i] );\r\n                                seed[ idx ] = !( matches[ idx ] = matched[i] );\r\n                            }\r\n                        }) :\r\n                        function( elem ) {\r\n                            return fn( elem, 0, args );\r\n                        };\r\n                }\r\n    \r\n                return fn;\r\n            }\r\n        },\r\n    \r\n        pseudos: {\r\n            // Potentially complex pseudos\r\n            \"not\": markFunction(function( selector ) {\r\n                // Trim the selector passed to compile\r\n                // to avoid treating leading and trailing\r\n                // spaces as combinators\r\n                var input = [],\r\n                    results = [],\r\n                    matcher = compile( selector.replace( rtrim, \"$1\" ) );\r\n    \r\n                return matcher[ expando ] ?\r\n                    markFunction(function( seed, matches, context, xml ) {\r\n                        var elem,\r\n                            unmatched = matcher( seed, null, xml, [] ),\r\n                            i = seed.length;\r\n    \r\n                        // Match elements unmatched by `matcher`\r\n                        while ( i-- ) {\r\n                            if ( (elem = unmatched[i]) ) {\r\n                                seed[i] = !(matches[i] = elem);\r\n                            }\r\n                        }\r\n                    }) :\r\n                    function( elem, context, xml ) {\r\n                        input[0] = elem;\r\n                        matcher( input, null, xml, results );\r\n                        return !results.pop();\r\n                    };\r\n            }),\r\n    \r\n            \"has\": markFunction(function( selector ) {\r\n                return function( elem ) {\r\n                    return Sizzle( selector, elem ).length > 0;\r\n                };\r\n            }),\r\n    \r\n            \"contains\": markFunction(function( text ) {\r\n                return function( elem ) {\r\n                    return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\r\n                };\r\n            }),\r\n    \r\n            // \"Whether an element is represented by a :lang() selector\r\n            // is based solely on the element's language value\r\n            // being equal to the identifier C,\r\n            // or beginning with the identifier C immediately followed by \"-\".\r\n            // The matching of C against the element's language value is performed case-insensitively.\r\n            // The identifier C does not have to be a valid language name.\"\r\n            // http://www.w3.org/TR/selectors/#lang-pseudo\r\n            \"lang\": markFunction( function( lang ) {\r\n                // lang value must be a valid identifider\r\n                if ( !ridentifier.test(lang || \"\") ) {\r\n                    Sizzle.error( \"unsupported lang: \" + lang );\r\n                }\r\n                lang = lang.replace( runescape, funescape ).toLowerCase();\r\n                return function( elem ) {\r\n                    var elemLang;\r\n                    do {\r\n                        if ( (elemLang = documentIsXML ?\r\n                            elem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\") :\r\n                            elem.lang) ) {\r\n    \r\n                            elemLang = elemLang.toLowerCase();\r\n                            return elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\r\n                        }\r\n                    } while ( (elem = elem.parentNode) && elem.nodeType === 1 );\r\n                    return false;\r\n                };\r\n            }),\r\n    \r\n            // Miscellaneous\r\n            \"target\": function( elem ) {\r\n                var hash = window.location && window.location.hash;\r\n                return hash && hash.slice( 1 ) === elem.id;\r\n            },\r\n    \r\n            \"root\": function( elem ) {\r\n                return elem === docElem;\r\n            },\r\n    \r\n            \"focus\": function( elem ) {\r\n                return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\r\n            },\r\n    \r\n            // Boolean properties\r\n            \"enabled\": function( elem ) {\r\n                return elem.disabled === false;\r\n            },\r\n    \r\n            \"disabled\": function( elem ) {\r\n                return elem.disabled === true;\r\n            },\r\n    \r\n            \"checked\": function( elem ) {\r\n                // In CSS3, :checked should return both checked and selected elements\r\n                // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n                var nodeName = elem.nodeName.toLowerCase();\r\n                return (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\r\n            },\r\n    \r\n            \"selected\": function( elem ) {\r\n                // Accessing this property makes selected-by-default\r\n                // options in Safari work properly\r\n                if ( elem.parentNode ) {\r\n                    elem.parentNode.selectedIndex;\r\n                }\r\n    \r\n                return elem.selected === true;\r\n            },\r\n    \r\n            // Contents\r\n            \"empty\": function( elem ) {\r\n                // http://www.w3.org/TR/selectors/#empty-pseudo\r\n                // :empty is only affected by element nodes and content nodes(including text(3), cdata(4)),\r\n                //   not comment, processing instructions, or others\r\n                // Thanks to Diego Perini for the nodeName shortcut\r\n                //   Greater than \"@\" means alpha characters (specifically not starting with \"#\" or \"?\")\r\n                for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n                    if ( elem.nodeName > \"@\" || elem.nodeType === 3 || elem.nodeType === 4 ) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            },\r\n    \r\n            \"parent\": function( elem ) {\r\n                return !Expr.pseudos[\"empty\"]( elem );\r\n            },\r\n    \r\n            // Element/input types\r\n            \"header\": function( elem ) {\r\n                return rheader.test( elem.nodeName );\r\n            },\r\n    \r\n            \"input\": function( elem ) {\r\n                return rinputs.test( elem.nodeName );\r\n            },\r\n    \r\n            \"button\": function( elem ) {\r\n                var name = elem.nodeName.toLowerCase();\r\n                return name === \"input\" && elem.type === \"button\" || name === \"button\";\r\n            },\r\n    \r\n            \"text\": function( elem ) {\r\n                var attr;\r\n                // IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)\r\n                // use getAttribute instead to test this case\r\n                return elem.nodeName.toLowerCase() === \"input\" &&\r\n                    elem.type === \"text\" &&\r\n                    ( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === elem.type );\r\n            },\r\n    \r\n            // Position-in-collection\r\n            \"first\": createPositionalPseudo(function() {\r\n                return [ 0 ];\r\n            }),\r\n    \r\n            \"last\": createPositionalPseudo(function( matchIndexes, length ) {\r\n                return [ length - 1 ];\r\n            }),\r\n    \r\n            \"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n                return [ argument < 0 ? argument + length : argument ];\r\n            }),\r\n    \r\n            \"even\": createPositionalPseudo(function( matchIndexes, length ) {\r\n                var i = 0;\r\n                for ( ; i < length; i += 2 ) {\r\n                    matchIndexes.push( i );\r\n                }\r\n                return matchIndexes;\r\n            }),\r\n    \r\n            \"odd\": createPositionalPseudo(function( matchIndexes, length ) {\r\n                var i = 1;\r\n                for ( ; i < length; i += 2 ) {\r\n                    matchIndexes.push( i );\r\n                }\r\n                return matchIndexes;\r\n            }),\r\n    \r\n            \"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n                var i = argument < 0 ? argument + length : argument;\r\n                for ( ; --i >= 0; ) {\r\n                    matchIndexes.push( i );\r\n                }\r\n                return matchIndexes;\r\n            }),\r\n    \r\n            \"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n                var i = argument < 0 ? argument + length : argument;\r\n                for ( ; ++i < length; ) {\r\n                    matchIndexes.push( i );\r\n                }\r\n                return matchIndexes;\r\n            })\r\n        }\r\n    };\r\n    \r\n    // Add button/input type pseudos\r\n    for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\r\n        Expr.pseudos[ i ] = createInputPseudo( i );\r\n    }\r\n    for ( i in { submit: true, reset: true } ) {\r\n        Expr.pseudos[ i ] = createButtonPseudo( i );\r\n    }\r\n    \r\n    function tokenize( selector, parseOnly ) {\r\n        var matched, match, tokens, type,\r\n            soFar, groups, preFilters,\r\n            cached = tokenCache[ selector + \" \" ];\r\n    \r\n        if ( cached ) {\r\n            return parseOnly ? 0 : cached.slice( 0 );\r\n        }\r\n    \r\n        soFar = selector;\r\n        groups = [];\r\n        preFilters = Expr.preFilter;\r\n    \r\n        while ( soFar ) {\r\n    \r\n            // Comma and first run\r\n            if ( !matched || (match = rcomma.exec( soFar )) ) {\r\n                if ( match ) {\r\n                    // Don't consume trailing commas as valid\r\n                    soFar = soFar.slice( match[0].length ) || soFar;\r\n                }\r\n                groups.push( tokens = [] );\r\n            }\r\n    \r\n            matched = false;\r\n    \r\n            // Combinators\r\n            if ( (match = rcombinators.exec( soFar )) ) {\r\n                matched = match.shift();\r\n                tokens.push( {\r\n                    value: matched,\r\n                    // Cast descendant combinators to space\r\n                    type: match[0].replace( rtrim, \" \" )\r\n                } );\r\n                soFar = soFar.slice( matched.length );\r\n            }\r\n    \r\n            // Filters\r\n            for ( type in Expr.filter ) {\r\n                if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\r\n                    (match = preFilters[ type ]( match ))) ) {\r\n                    matched = match.shift();\r\n                    tokens.push( {\r\n                        value: matched,\r\n                        type: type,\r\n                        matches: match\r\n                    } );\r\n                    soFar = soFar.slice( matched.length );\r\n                }\r\n            }\r\n    \r\n            if ( !matched ) {\r\n                break;\r\n            }\r\n        }\r\n    \r\n        // Return the length of the invalid excess\r\n        // if we're just parsing\r\n        // Otherwise, throw an error or return tokens\r\n        return parseOnly ?\r\n            soFar.length :\r\n            soFar ?\r\n                Sizzle.error( selector ) :\r\n                // Cache the tokens\r\n                tokenCache( selector, groups ).slice( 0 );\r\n    }\r\n    \r\n    function toSelector( tokens ) {\r\n        var i = 0,\r\n            len = tokens.length,\r\n            selector = \"\";\r\n        for ( ; i < len; i++ ) {\r\n            selector += tokens[i].value;\r\n        }\r\n        return selector;\r\n    }\r\n    \r\n    function addCombinator( matcher, combinator, base ) {\r\n        var dir = combinator.dir,\r\n            checkNonElements = base && dir === \"parentNode\",\r\n            doneName = done++;\r\n    \r\n        return combinator.first ?\r\n            // Check against closest ancestor/preceding element\r\n            function( elem, context, xml ) {\r\n                while ( (elem = elem[ dir ]) ) {\r\n                    if ( elem.nodeType === 1 || checkNonElements ) {\r\n                        return matcher( elem, context, xml );\r\n                    }\r\n                }\r\n            } :\r\n    \r\n            // Check against all ancestor/preceding elements\r\n            function( elem, context, xml ) {\r\n                var data, cache, outerCache,\r\n                    dirkey = dirruns + \" \" + doneName;\r\n    \r\n                // We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\r\n                if ( xml ) {\r\n                    while ( (elem = elem[ dir ]) ) {\r\n                        if ( elem.nodeType === 1 || checkNonElements ) {\r\n                            if ( matcher( elem, context, xml ) ) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    while ( (elem = elem[ dir ]) ) {\r\n                        if ( elem.nodeType === 1 || checkNonElements ) {\r\n                            outerCache = elem[ expando ] || (elem[ expando ] = {});\r\n                            if ( (cache = outerCache[ dir ]) && cache[0] === dirkey ) {\r\n                                if ( (data = cache[1]) === true || data === cachedruns ) {\r\n                                    return data === true;\r\n                                }\r\n                            } else {\r\n                                cache = outerCache[ dir ] = [ dirkey ];\r\n                                cache[1] = matcher( elem, context, xml ) || cachedruns;\r\n                                if ( cache[1] === true ) {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n    }\r\n    \r\n    function elementMatcher( matchers ) {\r\n        return matchers.length > 1 ?\r\n            function( elem, context, xml ) {\r\n                var i = matchers.length;\r\n                while ( i-- ) {\r\n                    if ( !matchers[i]( elem, context, xml ) ) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            } :\r\n            matchers[0];\r\n    }\r\n    \r\n    function condense( unmatched, map, filter, context, xml ) {\r\n        var elem,\r\n            newUnmatched = [],\r\n            i = 0,\r\n            len = unmatched.length,\r\n            mapped = map != null;\r\n    \r\n        for ( ; i < len; i++ ) {\r\n            if ( (elem = unmatched[i]) ) {\r\n                if ( !filter || filter( elem, context, xml ) ) {\r\n                    newUnmatched.push( elem );\r\n                    if ( mapped ) {\r\n                        map.push( i );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        return newUnmatched;\r\n    }\r\n    \r\n    function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\r\n        if ( postFilter && !postFilter[ expando ] ) {\r\n            postFilter = setMatcher( postFilter );\r\n        }\r\n        if ( postFinder && !postFinder[ expando ] ) {\r\n            postFinder = setMatcher( postFinder, postSelector );\r\n        }\r\n        return markFunction(function( seed, results, context, xml ) {\r\n            var temp, i, elem,\r\n                preMap = [],\r\n                postMap = [],\r\n                preexisting = results.length,\r\n    \r\n                // Get initial elements from seed or context\r\n                elems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\r\n    \r\n                // Prefilter to get matcher input, preserving a map for seed-results synchronization\r\n                matcherIn = preFilter && ( seed || !selector ) ?\r\n                    condense( elems, preMap, preFilter, context, xml ) :\r\n                    elems,\r\n    \r\n                matcherOut = matcher ?\r\n                    // If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\r\n                    postFinder || ( seed ? preFilter : preexisting || postFilter ) ?\r\n    \r\n                        // ...intermediate processing is necessary\r\n                        [] :\r\n    \r\n                        // ...otherwise use results directly\r\n                        results :\r\n                    matcherIn;\r\n    \r\n            // Find primary matches\r\n            if ( matcher ) {\r\n                matcher( matcherIn, matcherOut, context, xml );\r\n            }\r\n    \r\n            // Apply postFilter\r\n            if ( postFilter ) {\r\n                temp = condense( matcherOut, postMap );\r\n                postFilter( temp, [], context, xml );\r\n    \r\n                // Un-match failing elements by moving them back to matcherIn\r\n                i = temp.length;\r\n                while ( i-- ) {\r\n                    if ( (elem = temp[i]) ) {\r\n                        matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\r\n                    }\r\n                }\r\n            }\r\n    \r\n            if ( seed ) {\r\n                if ( postFinder || preFilter ) {\r\n                    if ( postFinder ) {\r\n                        // Get the final matcherOut by condensing this intermediate into postFinder contexts\r\n                        temp = [];\r\n                        i = matcherOut.length;\r\n                        while ( i-- ) {\r\n                            if ( (elem = matcherOut[i]) ) {\r\n                                // Restore matcherIn since elem is not yet a final match\r\n                                temp.push( (matcherIn[i] = elem) );\r\n                            }\r\n                        }\r\n                        postFinder( null, (matcherOut = []), temp, xml );\r\n                    }\r\n    \r\n                    // Move matched elements from seed to results to keep them synchronized\r\n                    i = matcherOut.length;\r\n                    while ( i-- ) {\r\n                        if ( (elem = matcherOut[i]) &&\r\n                            (temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {\r\n    \r\n                            seed[temp] = !(results[temp] = elem);\r\n                        }\r\n                    }\r\n                }\r\n    \r\n            // Add elements to results, through postFinder if defined\r\n            } else {\r\n                matcherOut = condense(\r\n                    matcherOut === results ?\r\n                        matcherOut.splice( preexisting, matcherOut.length ) :\r\n                        matcherOut\r\n                );\r\n                if ( postFinder ) {\r\n                    postFinder( null, results, matcherOut, xml );\r\n                } else {\r\n                    push.apply( results, matcherOut );\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    function matcherFromTokens( tokens ) {\r\n        var checkContext, matcher, j,\r\n            len = tokens.length,\r\n            leadingRelative = Expr.relative[ tokens[0].type ],\r\n            implicitRelative = leadingRelative || Expr.relative[\" \"],\r\n            i = leadingRelative ? 1 : 0,\r\n    \r\n            // The foundational matcher ensures that elements are reachable from top-level context(s)\r\n            matchContext = addCombinator( function( elem ) {\r\n                return elem === checkContext;\r\n            }, implicitRelative, true ),\r\n            matchAnyContext = addCombinator( function( elem ) {\r\n                return indexOf.call( checkContext, elem ) > -1;\r\n            }, implicitRelative, true ),\r\n            matchers = [ function( elem, context, xml ) {\r\n                return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\r\n                    (checkContext = context).nodeType ?\r\n                        matchContext( elem, context, xml ) :\r\n                        matchAnyContext( elem, context, xml ) );\r\n            } ];\r\n    \r\n        for ( ; i < len; i++ ) {\r\n            if ( (matcher = Expr.relative[ tokens[i].type ]) ) {\r\n                matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\r\n            } else {\r\n                matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\r\n    \r\n                // Return special upon seeing a positional matcher\r\n                if ( matcher[ expando ] ) {\r\n                    // Find the next relative operator (if any) for proper handling\r\n                    j = ++i;\r\n                    for ( ; j < len; j++ ) {\r\n                        if ( Expr.relative[ tokens[j].type ] ) {\r\n                            break;\r\n                        }\r\n                    }\r\n                    return setMatcher(\r\n                        i > 1 && elementMatcher( matchers ),\r\n                        i > 1 && toSelector( tokens.slice( 0, i - 1 ) ).replace( rtrim, \"$1\" ),\r\n                        matcher,\r\n                        i < j && matcherFromTokens( tokens.slice( i, j ) ),\r\n                        j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\r\n                        j < len && toSelector( tokens )\r\n                    );\r\n                }\r\n                matchers.push( matcher );\r\n            }\r\n        }\r\n    \r\n        return elementMatcher( matchers );\r\n    }\r\n    \r\n    function matcherFromGroupMatchers( elementMatchers, setMatchers ) {\r\n        // A counter to specify which element is currently being matched\r\n        var matcherCachedRuns = 0,\r\n            bySet = setMatchers.length > 0,\r\n            byElement = elementMatchers.length > 0,\r\n            superMatcher = function( seed, context, xml, results, expandContext ) {\r\n                var elem, j, matcher,\r\n                    setMatched = [],\r\n                    matchedCount = 0,\r\n                    i = \"0\",\r\n                    unmatched = seed && [],\r\n                    outermost = expandContext != null,\r\n                    contextBackup = outermostContext,\r\n                    // We must always have either seed elements or context\r\n                    elems = seed || byElement && Expr.find[\"TAG\"]( \"*\", expandContext && context.parentNode || context ),\r\n                    // Use integer dirruns iff this is the outermost matcher\r\n                    dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1);\r\n    \r\n                if ( outermost ) {\r\n                    outermostContext = context !== document && context;\r\n                    cachedruns = matcherCachedRuns;\r\n                }\r\n    \r\n                // Add elements passing elementMatchers directly to results\r\n                // Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\r\n                for ( ; (elem = elems[i]) != null; i++ ) {\r\n                    if ( byElement && elem ) {\r\n                        j = 0;\r\n                        while ( (matcher = elementMatchers[j++]) ) {\r\n                            if ( matcher( elem, context, xml ) ) {\r\n                                results.push( elem );\r\n                                break;\r\n                            }\r\n                        }\r\n                        if ( outermost ) {\r\n                            dirruns = dirrunsUnique;\r\n                            cachedruns = ++matcherCachedRuns;\r\n                        }\r\n                    }\r\n    \r\n                    // Track unmatched elements for set filters\r\n                    if ( bySet ) {\r\n                        // They will have gone through all possible matchers\r\n                        if ( (elem = !matcher && elem) ) {\r\n                            matchedCount--;\r\n                        }\r\n    \r\n                        // Lengthen the array for every element, matched or not\r\n                        if ( seed ) {\r\n                            unmatched.push( elem );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                // Apply set filters to unmatched elements\r\n                matchedCount += i;\r\n                if ( bySet && i !== matchedCount ) {\r\n                    j = 0;\r\n                    while ( (matcher = setMatchers[j++]) ) {\r\n                        matcher( unmatched, setMatched, context, xml );\r\n                    }\r\n    \r\n                    if ( seed ) {\r\n                        // Reintegrate element matches to eliminate the need for sorting\r\n                        if ( matchedCount > 0 ) {\r\n                            while ( i-- ) {\r\n                                if ( !(unmatched[i] || setMatched[i]) ) {\r\n                                    setMatched[i] = pop.call( results );\r\n                                }\r\n                            }\r\n                        }\r\n    \r\n                        // Discard index placeholder values to get only actual matches\r\n                        setMatched = condense( setMatched );\r\n                    }\r\n    \r\n                    // Add matches to results\r\n                    push.apply( results, setMatched );\r\n    \r\n                    // Seedless set matches succeeding multiple successful matchers stipulate sorting\r\n                    if ( outermost && !seed && setMatched.length > 0 &&\r\n                        ( matchedCount + setMatchers.length ) > 1 ) {\r\n    \r\n                        Sizzle.uniqueSort( results );\r\n                    }\r\n                }\r\n    \r\n                // Override manipulation of globals by nested matchers\r\n                if ( outermost ) {\r\n                    dirruns = dirrunsUnique;\r\n                    outermostContext = contextBackup;\r\n                }\r\n    \r\n                return unmatched;\r\n            };\r\n    \r\n        return bySet ?\r\n            markFunction( superMatcher ) :\r\n            superMatcher;\r\n    }\r\n    \r\n    compile = Sizzle.compile = function( selector, group /* Internal Use Only */ ) {\r\n        var i,\r\n            setMatchers = [],\r\n            elementMatchers = [],\r\n            cached = compilerCache[ selector + \" \" ];\r\n    \r\n        if ( !cached ) {\r\n            // Generate a function of recursive functions that can be used to check each element\r\n            if ( !group ) {\r\n                group = tokenize( selector );\r\n            }\r\n            i = group.length;\r\n            while ( i-- ) {\r\n                cached = matcherFromTokens( group[i] );\r\n                if ( cached[ expando ] ) {\r\n                    setMatchers.push( cached );\r\n                } else {\r\n                    elementMatchers.push( cached );\r\n                }\r\n            }\r\n    \r\n            // Cache the compiled function\r\n            cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\r\n        }\r\n        return cached;\r\n    };\r\n    \r\n    function multipleContexts( selector, contexts, results ) {\r\n        var i = 0,\r\n            len = contexts.length;\r\n        for ( ; i < len; i++ ) {\r\n            Sizzle( selector, contexts[i], results );\r\n        }\r\n        return results;\r\n    }\r\n    \r\n    function select( selector, context, results, seed ) {\r\n        var i, tokens, token, type, find,\r\n            match = tokenize( selector );\r\n    \r\n        if ( !seed ) {\r\n            // Try to minimize operations if there is only one group\r\n            if ( match.length === 1 ) {\r\n    \r\n                // Take a shortcut and set the context if the root selector is an ID\r\n                tokens = match[0] = match[0].slice( 0 );\r\n                if ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\r\n                        context.nodeType === 9 && !documentIsXML &&\r\n                        Expr.relative[ tokens[1].type ] ) {\r\n    \r\n                    context = Expr.find[\"ID\"]( token.matches[0].replace( runescape, funescape ), context )[0];\r\n                    if ( !context ) {\r\n                        return results;\r\n                    }\r\n    \r\n                    selector = selector.slice( tokens.shift().value.length );\r\n                }\r\n    \r\n                // Fetch a seed set for right-to-left matching\r\n                i = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\r\n                while ( i-- ) {\r\n                    token = tokens[i];\r\n    \r\n                    // Abort if we hit a combinator\r\n                    if ( Expr.relative[ (type = token.type) ] ) {\r\n                        break;\r\n                    }\r\n                    if ( (find = Expr.find[ type ]) ) {\r\n                        // Search, expanding context for leading sibling combinators\r\n                        if ( (seed = find(\r\n                            token.matches[0].replace( runescape, funescape ),\r\n                            rsibling.test( tokens[0].type ) && context.parentNode || context\r\n                        )) ) {\r\n    \r\n                            // If seed is empty or no tokens remain, we can return early\r\n                            tokens.splice( i, 1 );\r\n                            selector = seed.length && toSelector( tokens );\r\n                            if ( !selector ) {\r\n                                push.apply( results, slice.call( seed, 0 ) );\r\n                                return results;\r\n                            }\r\n    \r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        // Compile and execute a filtering function\r\n        // Provide `match` to avoid retokenization if we modified the selector above\r\n        compile( selector, match )(\r\n            seed,\r\n            context,\r\n            documentIsXML,\r\n            results,\r\n            rsibling.test( selector )\r\n        );\r\n        return results;\r\n    }\r\n    \r\n    // Deprecated\r\n    Expr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\r\n    \r\n    // Easy API for creating new setFilters\r\n    function setFilters() {}\r\n    Expr.filters = setFilters.prototype = Expr.pseudos;\r\n    Expr.setFilters = new setFilters();\r\n    \r\n    // Initialize with the default document\r\n    setDocument();\r\n    \r\n    // Override sizzle attribute retrieval\r\n    Sizzle.attr = jQuery.attr;\r\n    jQuery.find = Sizzle;\r\n    jQuery.expr = Sizzle.selectors;\r\n    jQuery.expr[\":\"] = jQuery.expr.pseudos;\r\n    jQuery.unique = Sizzle.uniqueSort;\r\n    jQuery.text = Sizzle.getText;\r\n    jQuery.isXMLDoc = Sizzle.isXML;\r\n    jQuery.contains = Sizzle.contains;\r\n    \r\n    \r\n    })( window );\r\n    var runtil = /Until$/,\r\n        rparentsprev = /^(?:parents|prev(?:Until|All))/,\r\n        isSimple = /^.[^:#\\[\\.,]*$/,\r\n        rneedsContext = jQuery.expr.match.needsContext,\r\n        // methods guaranteed to produce a unique set when starting from a unique set\r\n        guaranteedUnique = {\r\n            children: true,\r\n            contents: true,\r\n            next: true,\r\n            prev: true\r\n        };\r\n    \r\n    jQuery.fn.extend({\r\n        find: function( selector ) {\r\n            var i, ret, self,\r\n                len = this.length;\r\n    \r\n            if ( typeof selector !== \"string\" ) {\r\n                self = this;\r\n                return this.pushStack( jQuery( selector ).filter(function() {\r\n                    for ( i = 0; i < len; i++ ) {\r\n                        if ( jQuery.contains( self[ i ], this ) ) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }) );\r\n            }\r\n    \r\n            ret = [];\r\n            for ( i = 0; i < len; i++ ) {\r\n                jQuery.find( selector, this[ i ], ret );\r\n            }\r\n    \r\n            // Needed because $( selector, context ) becomes $( context ).find( selector )\r\n            ret = this.pushStack( len > 1 ? jQuery.unique( ret ) : ret );\r\n            ret.selector = ( this.selector ? this.selector + \" \" : \"\" ) + selector;\r\n            return ret;\r\n        },\r\n    \r\n        has: function( target ) {\r\n            var i,\r\n                targets = jQuery( target, this ),\r\n                len = targets.length;\r\n    \r\n            return this.filter(function() {\r\n                for ( i = 0; i < len; i++ ) {\r\n                    if ( jQuery.contains( this, targets[i] ) ) {\r\n                        return true;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n    \r\n        not: function( selector ) {\r\n            return this.pushStack( winnow(this, selector, false) );\r\n        },\r\n    \r\n        filter: function( selector ) {\r\n            return this.pushStack( winnow(this, selector, true) );\r\n        },\r\n    \r\n        is: function( selector ) {\r\n            return !!selector && (\r\n                typeof selector === \"string\" ?\r\n                    // If this is a positional/relative selector, check membership in the returned set\r\n                    // so $(\"p:first\").is(\"p:last\") won't return true for a doc with two \"p\".\r\n                    rneedsContext.test( selector ) ?\r\n                        jQuery( selector, this.context ).index( this[0] ) >= 0 :\r\n                        jQuery.filter( selector, this ).length > 0 :\r\n                    this.filter( selector ).length > 0 );\r\n        },\r\n    \r\n        closest: function( selectors, context ) {\r\n            var cur,\r\n                i = 0,\r\n                l = this.length,\r\n                ret = [],\r\n                pos = rneedsContext.test( selectors ) || typeof selectors !== \"string\" ?\r\n                    jQuery( selectors, context || this.context ) :\r\n                    0;\r\n    \r\n            for ( ; i < l; i++ ) {\r\n                cur = this[i];\r\n    \r\n                while ( cur && cur.ownerDocument && cur !== context && cur.nodeType !== 11 ) {\r\n                    if ( pos ? pos.index(cur) > -1 : jQuery.find.matchesSelector(cur, selectors) ) {\r\n                        ret.push( cur );\r\n                        break;\r\n                    }\r\n                    cur = cur.parentNode;\r\n                }\r\n            }\r\n    \r\n            return this.pushStack( ret.length > 1 ? jQuery.unique( ret ) : ret );\r\n        },\r\n    \r\n        // Determine the position of an element within\r\n        // the matched set of elements\r\n        index: function( elem ) {\r\n    \r\n            // No argument, return index in parent\r\n            if ( !elem ) {\r\n                return ( this[0] && this[0].parentNode ) ? this.first().prevAll().length : -1;\r\n            }\r\n    \r\n            // index in selector\r\n            if ( typeof elem === \"string\" ) {\r\n                return jQuery.inArray( this[0], jQuery( elem ) );\r\n            }\r\n    \r\n            // Locate the position of the desired element\r\n            return jQuery.inArray(\r\n                // If it receives a jQuery object, the first element is used\r\n                elem.jquery ? elem[0] : elem, this );\r\n        },\r\n    \r\n        add: function( selector, context ) {\r\n            var set = typeof selector === \"string\" ?\r\n                    jQuery( selector, context ) :\r\n                    jQuery.makeArray( selector && selector.nodeType ? [ selector ] : selector ),\r\n                all = jQuery.merge( this.get(), set );\r\n    \r\n            return this.pushStack( jQuery.unique(all) );\r\n        },\r\n    \r\n        addBack: function( selector ) {\r\n            return this.add( selector == null ?\r\n                this.prevObject : this.prevObject.filter(selector)\r\n            );\r\n        }\r\n    });\r\n    \r\n    jQuery.fn.andSelf = jQuery.fn.addBack;\r\n    \r\n    function sibling( cur, dir ) {\r\n        do {\r\n            cur = cur[ dir ];\r\n        } while ( cur && cur.nodeType !== 1 );\r\n    \r\n        return cur;\r\n    }\r\n    \r\n    jQuery.each({\r\n        parent: function( elem ) {\r\n            var parent = elem.parentNode;\r\n            return parent && parent.nodeType !== 11 ? parent : null;\r\n        },\r\n        parents: function( elem ) {\r\n            return jQuery.dir( elem, \"parentNode\" );\r\n        },\r\n        parentsUntil: function( elem, i, until ) {\r\n            return jQuery.dir( elem, \"parentNode\", until );\r\n        },\r\n        next: function( elem ) {\r\n            return sibling( elem, \"nextSibling\" );\r\n        },\r\n        prev: function( elem ) {\r\n            return sibling( elem, \"previousSibling\" );\r\n        },\r\n        nextAll: function( elem ) {\r\n            return jQuery.dir( elem, \"nextSibling\" );\r\n        },\r\n        prevAll: function( elem ) {\r\n            return jQuery.dir( elem, \"previousSibling\" );\r\n        },\r\n        nextUntil: function( elem, i, until ) {\r\n            return jQuery.dir( elem, \"nextSibling\", until );\r\n        },\r\n        prevUntil: function( elem, i, until ) {\r\n            return jQuery.dir( elem, \"previousSibling\", until );\r\n        },\r\n        siblings: function( elem ) {\r\n            return jQuery.sibling( ( elem.parentNode || {} ).firstChild, elem );\r\n        },\r\n        children: function( elem ) {\r\n            return jQuery.sibling( elem.firstChild );\r\n        },\r\n        contents: function( elem ) {\r\n            return jQuery.nodeName( elem, \"iframe\" ) ?\r\n                elem.contentDocument || elem.contentWindow.document :\r\n                jQuery.merge( [], elem.childNodes );\r\n        }\r\n    }, function( name, fn ) {\r\n        jQuery.fn[ name ] = function( until, selector ) {\r\n            var ret = jQuery.map( this, fn, until );\r\n    \r\n            if ( !runtil.test( name ) ) {\r\n                selector = until;\r\n            }\r\n    \r\n            if ( selector && typeof selector === \"string\" ) {\r\n                ret = jQuery.filter( selector, ret );\r\n            }\r\n    \r\n            ret = this.length > 1 && !guaranteedUnique[ name ] ? jQuery.unique( ret ) : ret;\r\n    \r\n            if ( this.length > 1 && rparentsprev.test( name ) ) {\r\n                ret = ret.reverse();\r\n            }\r\n    \r\n            return this.pushStack( ret );\r\n        };\r\n    });\r\n    \r\n    jQuery.extend({\r\n        filter: function( expr, elems, not ) {\r\n            if ( not ) {\r\n                expr = \":not(\" + expr + \")\";\r\n            }\r\n    \r\n            return elems.length === 1 ?\r\n                jQuery.find.matchesSelector(elems[0], expr) ? [ elems[0] ] : [] :\r\n                jQuery.find.matches(expr, elems);\r\n        },\r\n    \r\n        dir: function( elem, dir, until ) {\r\n            var matched = [],\r\n                cur = elem[ dir ];\r\n    \r\n            while ( cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery( cur ).is( until )) ) {\r\n                if ( cur.nodeType === 1 ) {\r\n                    matched.push( cur );\r\n                }\r\n                cur = cur[dir];\r\n            }\r\n            return matched;\r\n        },\r\n    \r\n        sibling: function( n, elem ) {\r\n            var r = [];\r\n    \r\n            for ( ; n; n = n.nextSibling ) {\r\n                if ( n.nodeType === 1 && n !== elem ) {\r\n                    r.push( n );\r\n                }\r\n            }\r\n    \r\n            return r;\r\n        }\r\n    });\r\n    \r\n    // Implement the identical functionality for filter and not\r\n    function winnow( elements, qualifier, keep ) {\r\n    \r\n        // Can't pass null or undefined to indexOf in Firefox 4\r\n        // Set to 0 to skip string check\r\n        qualifier = qualifier || 0;\r\n    \r\n        if ( jQuery.isFunction( qualifier ) ) {\r\n            return jQuery.grep(elements, function( elem, i ) {\r\n                var retVal = !!qualifier.call( elem, i, elem );\r\n                return retVal === keep;\r\n            });\r\n    \r\n        } else if ( qualifier.nodeType ) {\r\n            return jQuery.grep(elements, function( elem ) {\r\n                return ( elem === qualifier ) === keep;\r\n            });\r\n    \r\n        } else if ( typeof qualifier === \"string\" ) {\r\n            var filtered = jQuery.grep(elements, function( elem ) {\r\n                return elem.nodeType === 1;\r\n            });\r\n    \r\n            if ( isSimple.test( qualifier ) ) {\r\n                return jQuery.filter(qualifier, filtered, !keep);\r\n            } else {\r\n                qualifier = jQuery.filter( qualifier, filtered );\r\n            }\r\n        }\r\n    \r\n        return jQuery.grep(elements, function( elem ) {\r\n            return ( jQuery.inArray( elem, qualifier ) >= 0 ) === keep;\r\n        });\r\n    }\r\n    function createSafeFragment( document ) {\r\n        var list = nodeNames.split( \"|\" ),\r\n            safeFrag = document.createDocumentFragment();\r\n    \r\n        if ( safeFrag.createElement ) {\r\n            while ( list.length ) {\r\n                safeFrag.createElement(\r\n                    list.pop()\r\n                );\r\n            }\r\n        }\r\n        return safeFrag;\r\n    }\r\n    \r\n    var nodeNames = \"abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|\" +\r\n            \"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video\",\r\n        rinlinejQuery = / jQuery\\d+=\"(?:null|\\d+)\"/g,\r\n        rnoshimcache = new RegExp(\"<(?:\" + nodeNames + \")[\\\\s/>]\", \"i\"),\r\n        rleadingWhitespace = /^\\s+/,\r\n        rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi,\r\n        rtagName = /<([\\w:]+)/,\r\n        rtbody = /<tbody/i,\r\n        rhtml = /<|&#?\\w+;/,\r\n        rnoInnerhtml = /<(?:script|style|link)/i,\r\n        manipulation_rcheckableType = /^(?:checkbox|radio)$/i,\r\n        // checked=\"checked\" or checked\r\n        rchecked = /checked\\s*(?:[^=]|=\\s*.checked.)/i,\r\n        rscriptType = /^$|\\/(?:java|ecma)script/i,\r\n        rscriptTypeMasked = /^true\\/(.*)/,\r\n        rcleanScript = /^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g,\r\n    \r\n        // We have to close these tags to support XHTML (#13200)\r\n        wrapMap = {\r\n            option: [ 1, \"<select multiple='multiple'>\", \"</select>\" ],\r\n            legend: [ 1, \"<fieldset>\", \"</fieldset>\" ],\r\n            area: [ 1, \"<map>\", \"</map>\" ],\r\n            param: [ 1, \"<object>\", \"</object>\" ],\r\n            thead: [ 1, \"<table>\", \"</table>\" ],\r\n            tr: [ 2, \"<table><tbody>\", \"</tbody></table>\" ],\r\n            col: [ 2, \"<table><tbody></tbody><colgroup>\", \"</colgroup></table>\" ],\r\n            td: [ 3, \"<table><tbody><tr>\", \"</tr></tbody></table>\" ],\r\n    \r\n            // IE6-8 can't serialize link, script, style, or any html5 (NoScope) tags,\r\n            // unless wrapped in a div with non-breaking characters in front of it.\r\n            _default: jQuery.support.htmlSerialize ? [ 0, \"\", \"\" ] : [ 1, \"X<div>\", \"</div>\"  ]\r\n        },\r\n        safeFragment = createSafeFragment( document ),\r\n        fragmentDiv = safeFragment.appendChild( document.createElement(\"div\") );\r\n    \r\n    wrapMap.optgroup = wrapMap.option;\r\n    wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;\r\n    wrapMap.th = wrapMap.td;\r\n    \r\n    jQuery.fn.extend({\r\n        text: function( value ) {\r\n            return jQuery.access( this, function( value ) {\r\n                return value === undefined ?\r\n                    jQuery.text( this ) :\r\n                    this.empty().append( ( this[0] && this[0].ownerDocument || document ).createTextNode( value ) );\r\n            }, null, value, arguments.length );\r\n        },\r\n    \r\n        wrapAll: function( html ) {\r\n            if ( jQuery.isFunction( html ) ) {\r\n                return this.each(function(i) {\r\n                    jQuery(this).wrapAll( html.call(this, i) );\r\n                });\r\n            }\r\n    \r\n            if ( this[0] ) {\r\n                // The elements to wrap the target around\r\n                var wrap = jQuery( html, this[0].ownerDocument ).eq(0).clone(true);\r\n    \r\n                if ( this[0].parentNode ) {\r\n                    wrap.insertBefore( this[0] );\r\n                }\r\n    \r\n                wrap.map(function() {\r\n                    var elem = this;\r\n    \r\n                    while ( elem.firstChild && elem.firstChild.nodeType === 1 ) {\r\n                        elem = elem.firstChild;\r\n                    }\r\n    \r\n                    return elem;\r\n                }).append( this );\r\n            }\r\n    \r\n            return this;\r\n        },\r\n    \r\n        wrapInner: function( html ) {\r\n            if ( jQuery.isFunction( html ) ) {\r\n                return this.each(function(i) {\r\n                    jQuery(this).wrapInner( html.call(this, i) );\r\n                });\r\n            }\r\n    \r\n            return this.each(function() {\r\n                var self = jQuery( this ),\r\n                    contents = self.contents();\r\n    \r\n                if ( contents.length ) {\r\n                    contents.wrapAll( html );\r\n    \r\n                } else {\r\n                    self.append( html );\r\n                }\r\n            });\r\n        },\r\n    \r\n        wrap: function( html ) {\r\n            var isFunction = jQuery.isFunction( html );\r\n    \r\n            return this.each(function(i) {\r\n                jQuery( this ).wrapAll( isFunction ? html.call(this, i) : html );\r\n            });\r\n        },\r\n    \r\n        unwrap: function() {\r\n            return this.parent().each(function() {\r\n                if ( !jQuery.nodeName( this, \"body\" ) ) {\r\n                    jQuery( this ).replaceWith( this.childNodes );\r\n                }\r\n            }).end();\r\n        },\r\n    \r\n        append: function() {\r\n            return this.domManip(arguments, true, function( elem ) {\r\n                if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\r\n                    this.appendChild( elem );\r\n                }\r\n            });\r\n        },\r\n    \r\n        prepend: function() {\r\n            return this.domManip(arguments, true, function( elem ) {\r\n                if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\r\n                    this.insertBefore( elem, this.firstChild );\r\n                }\r\n            });\r\n        },\r\n    \r\n        before: function() {\r\n            return this.domManip( arguments, false, function( elem ) {\r\n                if ( this.parentNode ) {\r\n                    this.parentNode.insertBefore( elem, this );\r\n                }\r\n            });\r\n        },\r\n    \r\n        after: function() {\r\n            return this.domManip( arguments, false, function( elem ) {\r\n                if ( this.parentNode ) {\r\n                    this.parentNode.insertBefore( elem, this.nextSibling );\r\n                }\r\n            });\r\n        },\r\n    \r\n        // keepData is for internal use only--do not document\r\n        remove: function( selector, keepData ) {\r\n            var elem,\r\n                i = 0;\r\n    \r\n            for ( ; (elem = this[i]) != null; i++ ) {\r\n                if ( !selector || jQuery.filter( selector, [ elem ] ).length > 0 ) {\r\n                    if ( !keepData && elem.nodeType === 1 ) {\r\n                        jQuery.cleanData( getAll( elem ) );\r\n                    }\r\n    \r\n                    if ( elem.parentNode ) {\r\n                        if ( keepData && jQuery.contains( elem.ownerDocument, elem ) ) {\r\n                            setGlobalEval( getAll( elem, \"script\" ) );\r\n                        }\r\n                        elem.parentNode.removeChild( elem );\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return this;\r\n        },\r\n    \r\n        empty: function() {\r\n            var elem,\r\n                i = 0;\r\n    \r\n            for ( ; (elem = this[i]) != null; i++ ) {\r\n                // Remove element nodes and prevent memory leaks\r\n                if ( elem.nodeType === 1 ) {\r\n                    jQuery.cleanData( getAll( elem, false ) );\r\n                }\r\n    \r\n                // Remove any remaining nodes\r\n                while ( elem.firstChild ) {\r\n                    elem.removeChild( elem.firstChild );\r\n                }\r\n    \r\n                // If this is a select, ensure that it displays empty (#12336)\r\n                // Support: IE<9\r\n                if ( elem.options && jQuery.nodeName( elem, \"select\" ) ) {\r\n                    elem.options.length = 0;\r\n                }\r\n            }\r\n    \r\n            return this;\r\n        },\r\n    \r\n        clone: function( dataAndEvents, deepDataAndEvents ) {\r\n            dataAndEvents = dataAndEvents == null ? false : dataAndEvents;\r\n            deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;\r\n    \r\n            return this.map( function () {\r\n                return jQuery.clone( this, dataAndEvents, deepDataAndEvents );\r\n            });\r\n        },\r\n    \r\n        html: function( value ) {\r\n            return jQuery.access( this, function( value ) {\r\n                var elem = this[0] || {},\r\n                    i = 0,\r\n                    l = this.length;\r\n    \r\n                if ( value === undefined ) {\r\n                    return elem.nodeType === 1 ?\r\n                        elem.innerHTML.replace( rinlinejQuery, \"\" ) :\r\n                        undefined;\r\n                }\r\n    \r\n                // See if we can take a shortcut and just use innerHTML\r\n                if ( typeof value === \"string\" && !rnoInnerhtml.test( value ) &&\r\n                    ( jQuery.support.htmlSerialize || !rnoshimcache.test( value )  ) &&\r\n                    ( jQuery.support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&\r\n                    !wrapMap[ ( rtagName.exec( value ) || [\"\", \"\"] )[1].toLowerCase() ] ) {\r\n    \r\n                    value = value.replace( rxhtmlTag, \"<$1></$2>\" );\r\n    \r\n                    try {\r\n                        for (; i < l; i++ ) {\r\n                            // Remove element nodes and prevent memory leaks\r\n                            elem = this[i] || {};\r\n                            if ( elem.nodeType === 1 ) {\r\n                                jQuery.cleanData( getAll( elem, false ) );\r\n                                elem.innerHTML = value;\r\n                            }\r\n                        }\r\n    \r\n                        elem = 0;\r\n    \r\n                    // If using innerHTML throws an exception, use the fallback method\r\n                    } catch(e) {}\r\n                }\r\n    \r\n                if ( elem ) {\r\n                    this.empty().append( value );\r\n                }\r\n            }, null, value, arguments.length );\r\n        },\r\n    \r\n        replaceWith: function( value ) {\r\n            var isFunc = jQuery.isFunction( value );\r\n    \r\n            // Make sure that the elements are removed from the DOM before they are inserted\r\n            // this can help fix replacing a parent with child elements\r\n            if ( !isFunc && typeof value !== \"string\" ) {\r\n                value = jQuery( value ).not( this ).detach();\r\n            }\r\n    \r\n            return this.domManip( [ value ], true, function( elem ) {\r\n                var next = this.nextSibling,\r\n                    parent = this.parentNode;\r\n    \r\n                if ( parent ) {\r\n                    jQuery( this ).remove();\r\n                    parent.insertBefore( elem, next );\r\n                }\r\n            });\r\n        },\r\n    \r\n        detach: function( selector ) {\r\n            return this.remove( selector, true );\r\n        },\r\n    \r\n        domManip: function( args, table, callback ) {\r\n    \r\n            // Flatten any nested arrays\r\n            args = core_concat.apply( [], args );\r\n    \r\n            var first, node, hasScripts,\r\n                scripts, doc, fragment,\r\n                i = 0,\r\n                l = this.length,\r\n                set = this,\r\n                iNoClone = l - 1,\r\n                value = args[0],\r\n                isFunction = jQuery.isFunction( value );\r\n    \r\n            // We can't cloneNode fragments that contain checked, in WebKit\r\n            if ( isFunction || !( l <= 1 || typeof value !== \"string\" || jQuery.support.checkClone || !rchecked.test( value ) ) ) {\r\n                return this.each(function( index ) {\r\n                    var self = set.eq( index );\r\n                    if ( isFunction ) {\r\n                        args[0] = value.call( this, index, table ? self.html() : undefined );\r\n                    }\r\n                    self.domManip( args, table, callback );\r\n                });\r\n            }\r\n    \r\n            if ( l ) {\r\n                fragment = jQuery.buildFragment( args, this[ 0 ].ownerDocument, false, this );\r\n                first = fragment.firstChild;\r\n    \r\n                if ( fragment.childNodes.length === 1 ) {\r\n                    fragment = first;\r\n                }\r\n    \r\n                if ( first ) {\r\n                    table = table && jQuery.nodeName( first, \"tr\" );\r\n                    scripts = jQuery.map( getAll( fragment, \"script\" ), disableScript );\r\n                    hasScripts = scripts.length;\r\n    \r\n                    // Use the original fragment for the last item instead of the first because it can end up\r\n                    // being emptied incorrectly in certain situations (#8070).\r\n                    for ( ; i < l; i++ ) {\r\n                        node = fragment;\r\n    \r\n                        if ( i !== iNoClone ) {\r\n                            node = jQuery.clone( node, true, true );\r\n    \r\n                            // Keep references to cloned scripts for later restoration\r\n                            if ( hasScripts ) {\r\n                                jQuery.merge( scripts, getAll( node, \"script\" ) );\r\n                            }\r\n                        }\r\n    \r\n                        callback.call(\r\n                            table && jQuery.nodeName( this[i], \"table\" ) ?\r\n                                findOrAppend( this[i], \"tbody\" ) :\r\n                                this[i],\r\n                            node,\r\n                            i\r\n                        );\r\n                    }\r\n    \r\n                    if ( hasScripts ) {\r\n                        doc = scripts[ scripts.length - 1 ].ownerDocument;\r\n    \r\n                        // Reenable scripts\r\n                        jQuery.map( scripts, restoreScript );\r\n    \r\n                        // Evaluate executable scripts on first document insertion\r\n                        for ( i = 0; i < hasScripts; i++ ) {\r\n                            node = scripts[ i ];\r\n                            if ( rscriptType.test( node.type || \"\" ) &&\r\n                                !jQuery._data( node, \"globalEval\" ) && jQuery.contains( doc, node ) ) {\r\n    \r\n                                if ( node.src ) {\r\n                                    // Hope ajax is available...\r\n                                    jQuery.ajax({\r\n                                        url: node.src,\r\n                                        type: \"GET\",\r\n                                        dataType: \"script\",\r\n                                        async: false,\r\n                                        global: false,\r\n                                        \"throws\": true\r\n                                    });\r\n                                } else {\r\n                                    jQuery.globalEval( ( node.text || node.textContent || node.innerHTML || \"\" ).replace( rcleanScript, \"\" ) );\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n    \r\n                    // Fix #11809: Avoid leaking memory\r\n                    fragment = first = null;\r\n                }\r\n            }\r\n    \r\n            return this;\r\n        }\r\n    });\r\n    \r\n    function findOrAppend( elem, tag ) {\r\n        return elem.getElementsByTagName( tag )[0] || elem.appendChild( elem.ownerDocument.createElement( tag ) );\r\n    }\r\n    \r\n    // Replace/restore the type attribute of script elements for safe DOM manipulation\r\n    function disableScript( elem ) {\r\n        var attr = elem.getAttributeNode(\"type\");\r\n        elem.type = ( attr && attr.specified ) + \"/\" + elem.type;\r\n        return elem;\r\n    }\r\n    function restoreScript( elem ) {\r\n        var match = rscriptTypeMasked.exec( elem.type );\r\n        if ( match ) {\r\n            elem.type = match[1];\r\n        } else {\r\n            elem.removeAttribute(\"type\");\r\n        }\r\n        return elem;\r\n    }\r\n    \r\n    // Mark scripts as having already been evaluated\r\n    function setGlobalEval( elems, refElements ) {\r\n        var elem,\r\n            i = 0;\r\n        for ( ; (elem = elems[i]) != null; i++ ) {\r\n            jQuery._data( elem, \"globalEval\", !refElements || jQuery._data( refElements[i], \"globalEval\" ) );\r\n        }\r\n    }\r\n    \r\n    function cloneCopyEvent( src, dest ) {\r\n    \r\n        if ( dest.nodeType !== 1 || !jQuery.hasData( src ) ) {\r\n            return;\r\n        }\r\n    \r\n        var type, i, l,\r\n            oldData = jQuery._data( src ),\r\n            curData = jQuery._data( dest, oldData ),\r\n            events = oldData.events;\r\n    \r\n        if ( events ) {\r\n            delete curData.handle;\r\n            curData.events = {};\r\n    \r\n            for ( type in events ) {\r\n                for ( i = 0, l = events[ type ].length; i < l; i++ ) {\r\n                    jQuery.event.add( dest, type, events[ type ][ i ] );\r\n                }\r\n            }\r\n        }\r\n    \r\n        // make the cloned public data object a copy from the original\r\n        if ( curData.data ) {\r\n            curData.data = jQuery.extend( {}, curData.data );\r\n        }\r\n    }\r\n    \r\n    function fixCloneNodeIssues( src, dest ) {\r\n        var nodeName, e, data;\r\n    \r\n        // We do not need to do anything for non-Elements\r\n        if ( dest.nodeType !== 1 ) {\r\n            return;\r\n        }\r\n    \r\n        nodeName = dest.nodeName.toLowerCase();\r\n    \r\n        // IE6-8 copies events bound via attachEvent when using cloneNode.\r\n        if ( !jQuery.support.noCloneEvent && dest[ jQuery.expando ] ) {\r\n            data = jQuery._data( dest );\r\n    \r\n            for ( e in data.events ) {\r\n                jQuery.removeEvent( dest, e, data.handle );\r\n            }\r\n    \r\n            // Event data gets referenced instead of copied if the expando gets copied too\r\n            dest.removeAttribute( jQuery.expando );\r\n        }\r\n    \r\n        // IE blanks contents when cloning scripts, and tries to evaluate newly-set text\r\n        if ( nodeName === \"script\" && dest.text !== src.text ) {\r\n            disableScript( dest ).text = src.text;\r\n            restoreScript( dest );\r\n    \r\n        // IE6-10 improperly clones children of object elements using classid.\r\n        // IE10 throws NoModificationAllowedError if parent is null, #12132.\r\n        } else if ( nodeName === \"object\" ) {\r\n            if ( dest.parentNode ) {\r\n                dest.outerHTML = src.outerHTML;\r\n            }\r\n    \r\n            // This path appears unavoidable for IE9. When cloning an object\r\n            // element in IE9, the outerHTML strategy above is not sufficient.\r\n            // If the src has innerHTML and the destination does not,\r\n            // copy the src.innerHTML into the dest.innerHTML. #10324\r\n            if ( jQuery.support.html5Clone && ( src.innerHTML && !jQuery.trim(dest.innerHTML) ) ) {\r\n                dest.innerHTML = src.innerHTML;\r\n            }\r\n    \r\n        } else if ( nodeName === \"input\" && manipulation_rcheckableType.test( src.type ) ) {\r\n            // IE6-8 fails to persist the checked state of a cloned checkbox\r\n            // or radio button. Worse, IE6-7 fail to give the cloned element\r\n            // a checked appearance if the defaultChecked value isn't also set\r\n    \r\n            dest.defaultChecked = dest.checked = src.checked;\r\n    \r\n            // IE6-7 get confused and end up setting the value of a cloned\r\n            // checkbox/radio button to an empty string instead of \"on\"\r\n            if ( dest.value !== src.value ) {\r\n                dest.value = src.value;\r\n            }\r\n    \r\n        // IE6-8 fails to return the selected option to the default selected\r\n        // state when cloning options\r\n        } else if ( nodeName === \"option\" ) {\r\n            dest.defaultSelected = dest.selected = src.defaultSelected;\r\n    \r\n        // IE6-8 fails to set the defaultValue to the correct value when\r\n        // cloning other types of input fields\r\n        } else if ( nodeName === \"input\" || nodeName === \"textarea\" ) {\r\n            dest.defaultValue = src.defaultValue;\r\n        }\r\n    }\r\n    \r\n    jQuery.each({\r\n        appendTo: \"append\",\r\n        prependTo: \"prepend\",\r\n        insertBefore: \"before\",\r\n        insertAfter: \"after\",\r\n        replaceAll: \"replaceWith\"\r\n    }, function( name, original ) {\r\n        jQuery.fn[ name ] = function( selector ) {\r\n            var elems,\r\n                i = 0,\r\n                ret = [],\r\n                insert = jQuery( selector ),\r\n                last = insert.length - 1;\r\n    \r\n            for ( ; i <= last; i++ ) {\r\n                elems = i === last ? this : this.clone(true);\r\n                jQuery( insert[i] )[ original ]( elems );\r\n    \r\n                // Modern browsers can apply jQuery collections as arrays, but oldIE needs a .get()\r\n                core_push.apply( ret, elems.get() );\r\n            }\r\n    \r\n            return this.pushStack( ret );\r\n        };\r\n    });\r\n    \r\n    function getAll( context, tag ) {\r\n        var elems, elem,\r\n            i = 0,\r\n            found = typeof context.getElementsByTagName !== core_strundefined ? context.getElementsByTagName( tag || \"*\" ) :\r\n                typeof context.querySelectorAll !== core_strundefined ? context.querySelectorAll( tag || \"*\" ) :\r\n                undefined;\r\n    \r\n        if ( !found ) {\r\n            for ( found = [], elems = context.childNodes || context; (elem = elems[i]) != null; i++ ) {\r\n                if ( !tag || jQuery.nodeName( elem, tag ) ) {\r\n                    found.push( elem );\r\n                } else {\r\n                    jQuery.merge( found, getAll( elem, tag ) );\r\n                }\r\n            }\r\n        }\r\n    \r\n        return tag === undefined || tag && jQuery.nodeName( context, tag ) ?\r\n            jQuery.merge( [ context ], found ) :\r\n            found;\r\n    }\r\n    \r\n    // Used in buildFragment, fixes the defaultChecked property\r\n    function fixDefaultChecked( elem ) {\r\n        if ( manipulation_rcheckableType.test( elem.type ) ) {\r\n            elem.defaultChecked = elem.checked;\r\n        }\r\n    }\r\n    \r\n    jQuery.extend({\r\n        clone: function( elem, dataAndEvents, deepDataAndEvents ) {\r\n            var destElements, node, clone, i, srcElements,\r\n                inPage = jQuery.contains( elem.ownerDocument, elem );\r\n    \r\n            if ( jQuery.support.html5Clone || jQuery.isXMLDoc(elem) || !rnoshimcache.test( \"<\" + elem.nodeName + \">\" ) ) {\r\n                clone = elem.cloneNode( true );\r\n    \r\n            // IE<=8 does not properly clone detached, unknown element nodes\r\n            } else {\r\n                fragmentDiv.innerHTML = elem.outerHTML;\r\n                fragmentDiv.removeChild( clone = fragmentDiv.firstChild );\r\n            }\r\n    \r\n            if ( (!jQuery.support.noCloneEvent || !jQuery.support.noCloneChecked) &&\r\n                    (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem) ) {\r\n    \r\n                // We eschew Sizzle here for performance reasons: http://jsperf.com/getall-vs-sizzle/2\r\n                destElements = getAll( clone );\r\n                srcElements = getAll( elem );\r\n    \r\n                // Fix all IE cloning issues\r\n                for ( i = 0; (node = srcElements[i]) != null; ++i ) {\r\n                    // Ensure that the destination node is not null; Fixes #9587\r\n                    if ( destElements[i] ) {\r\n                        fixCloneNodeIssues( node, destElements[i] );\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Copy the events from the original to the clone\r\n            if ( dataAndEvents ) {\r\n                if ( deepDataAndEvents ) {\r\n                    srcElements = srcElements || getAll( elem );\r\n                    destElements = destElements || getAll( clone );\r\n    \r\n                    for ( i = 0; (node = srcElements[i]) != null; i++ ) {\r\n                        cloneCopyEvent( node, destElements[i] );\r\n                    }\r\n                } else {\r\n                    cloneCopyEvent( elem, clone );\r\n                }\r\n            }\r\n    \r\n            // Preserve script evaluation history\r\n            destElements = getAll( clone, \"script\" );\r\n            if ( destElements.length > 0 ) {\r\n                setGlobalEval( destElements, !inPage && getAll( elem, \"script\" ) );\r\n            }\r\n    \r\n            destElements = srcElements = node = null;\r\n    \r\n            // Return the cloned set\r\n            return clone;\r\n        },\r\n    \r\n        buildFragment: function( elems, context, scripts, selection ) {\r\n            var j, elem, contains,\r\n                tmp, tag, tbody, wrap,\r\n                l = elems.length,\r\n    \r\n                // Ensure a safe fragment\r\n                safe = createSafeFragment( context ),\r\n    \r\n                nodes = [],\r\n                i = 0;\r\n    \r\n            for ( ; i < l; i++ ) {\r\n                elem = elems[ i ];\r\n    \r\n                if ( elem || elem === 0 ) {\r\n    \r\n                    // Add nodes directly\r\n                    if ( jQuery.type( elem ) === \"object\" ) {\r\n                        jQuery.merge( nodes, elem.nodeType ? [ elem ] : elem );\r\n    \r\n                    // Convert non-html into a text node\r\n                    } else if ( !rhtml.test( elem ) ) {\r\n                        nodes.push( context.createTextNode( elem ) );\r\n    \r\n                    // Convert html into DOM nodes\r\n                    } else {\r\n                        tmp = tmp || safe.appendChild( context.createElement(\"div\") );\r\n    \r\n                        // Deserialize a standard representation\r\n                        tag = ( rtagName.exec( elem ) || [\"\", \"\"] )[1].toLowerCase();\r\n                        wrap = wrapMap[ tag ] || wrapMap._default;\r\n    \r\n                        tmp.innerHTML = wrap[1] + elem.replace( rxhtmlTag, \"<$1></$2>\" ) + wrap[2];\r\n    \r\n                        // Descend through wrappers to the right content\r\n                        j = wrap[0];\r\n                        while ( j-- ) {\r\n                            tmp = tmp.lastChild;\r\n                        }\r\n    \r\n                        // Manually add leading whitespace removed by IE\r\n                        if ( !jQuery.support.leadingWhitespace && rleadingWhitespace.test( elem ) ) {\r\n                            nodes.push( context.createTextNode( rleadingWhitespace.exec( elem )[0] ) );\r\n                        }\r\n    \r\n                        // Remove IE's autoinserted <tbody> from table fragments\r\n                        if ( !jQuery.support.tbody ) {\r\n    \r\n                            // String was a <table>, *may* have spurious <tbody>\r\n                            elem = tag === \"table\" && !rtbody.test( elem ) ?\r\n                                tmp.firstChild :\r\n    \r\n                                // String was a bare <thead> or <tfoot>\r\n                                wrap[1] === \"<table>\" && !rtbody.test( elem ) ?\r\n                                    tmp :\r\n                                    0;\r\n    \r\n                            j = elem && elem.childNodes.length;\r\n                            while ( j-- ) {\r\n                                if ( jQuery.nodeName( (tbody = elem.childNodes[j]), \"tbody\" ) && !tbody.childNodes.length ) {\r\n                                    elem.removeChild( tbody );\r\n                                }\r\n                            }\r\n                        }\r\n    \r\n                        jQuery.merge( nodes, tmp.childNodes );\r\n    \r\n                        // Fix #12392 for WebKit and IE > 9\r\n                        tmp.textContent = \"\";\r\n    \r\n                        // Fix #12392 for oldIE\r\n                        while ( tmp.firstChild ) {\r\n                            tmp.removeChild( tmp.firstChild );\r\n                        }\r\n    \r\n                        // Remember the top-level container for proper cleanup\r\n                        tmp = safe.lastChild;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Fix #11356: Clear elements from fragment\r\n            if ( tmp ) {\r\n                safe.removeChild( tmp );\r\n            }\r\n    \r\n            // Reset defaultChecked for any radios and checkboxes\r\n            // about to be appended to the DOM in IE 6/7 (#8060)\r\n            if ( !jQuery.support.appendChecked ) {\r\n                jQuery.grep( getAll( nodes, \"input\" ), fixDefaultChecked );\r\n            }\r\n    \r\n            i = 0;\r\n            while ( (elem = nodes[ i++ ]) ) {\r\n    \r\n                // #4087 - If origin and destination elements are the same, and this is\r\n                // that element, do not do anything\r\n                if ( selection && jQuery.inArray( elem, selection ) !== -1 ) {\r\n                    continue;\r\n                }\r\n    \r\n                contains = jQuery.contains( elem.ownerDocument, elem );\r\n    \r\n                // Append to fragment\r\n                tmp = getAll( safe.appendChild( elem ), \"script\" );\r\n    \r\n                // Preserve script evaluation history\r\n                if ( contains ) {\r\n                    setGlobalEval( tmp );\r\n                }\r\n    \r\n                // Capture executables\r\n                if ( scripts ) {\r\n                    j = 0;\r\n                    while ( (elem = tmp[ j++ ]) ) {\r\n                        if ( rscriptType.test( elem.type || \"\" ) ) {\r\n                            scripts.push( elem );\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    \r\n            tmp = null;\r\n    \r\n            return safe;\r\n        },\r\n    \r\n        cleanData: function( elems, /* internal */ acceptData ) {\r\n            var elem, type, id, data,\r\n                i = 0,\r\n                internalKey = jQuery.expando,\r\n                cache = jQuery.cache,\r\n                deleteExpando = jQuery.support.deleteExpando,\r\n                special = jQuery.event.special;\r\n    \r\n            for ( ; (elem = elems[i]) != null; i++ ) {\r\n    \r\n                if ( acceptData || jQuery.acceptData( elem ) ) {\r\n    \r\n                    id = elem[ internalKey ];\r\n                    data = id && cache[ id ];\r\n    \r\n                    if ( data ) {\r\n                        if ( data.events ) {\r\n                            for ( type in data.events ) {\r\n                                if ( special[ type ] ) {\r\n                                    jQuery.event.remove( elem, type );\r\n    \r\n                                // This is a shortcut to avoid jQuery.event.remove's overhead\r\n                                } else {\r\n                                    jQuery.removeEvent( elem, type, data.handle );\r\n                                }\r\n                            }\r\n                        }\r\n    \r\n                        // Remove cache only if it was not already removed by jQuery.event.remove\r\n                        if ( cache[ id ] ) {\r\n    \r\n                            delete cache[ id ];\r\n    \r\n                            // IE does not allow us to delete expando properties from nodes,\r\n                            // nor does it have a removeAttribute function on Document nodes;\r\n                            // we must handle all of these cases\r\n                            if ( deleteExpando ) {\r\n                                delete elem[ internalKey ];\r\n    \r\n                            } else if ( typeof elem.removeAttribute !== core_strundefined ) {\r\n                                elem.removeAttribute( internalKey );\r\n    \r\n                            } else {\r\n                                elem[ internalKey ] = null;\r\n                            }\r\n    \r\n                            core_deletedIds.push( id );\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    var iframe, getStyles, curCSS,\r\n        ralpha = /alpha\\([^)]*\\)/i,\r\n        ropacity = /opacity\\s*=\\s*([^)]*)/,\r\n        rposition = /^(top|right|bottom|left)$/,\r\n        // swappable if display is none or starts with table except \"table\", \"table-cell\", or \"table-caption\"\r\n        // see here for display values: https://developer.mozilla.org/en-US/docs/CSS/display\r\n        rdisplayswap = /^(none|table(?!-c[ea]).+)/,\r\n        rmargin = /^margin/,\r\n        rnumsplit = new RegExp( \"^(\" + core_pnum + \")(.*)$\", \"i\" ),\r\n        rnumnonpx = new RegExp( \"^(\" + core_pnum + \")(?!px)[a-z%]+$\", \"i\" ),\r\n        rrelNum = new RegExp( \"^([+-])=(\" + core_pnum + \")\", \"i\" ),\r\n        elemdisplay = { BODY: \"block\" },\r\n    \r\n        cssShow = { position: \"absolute\", visibility: \"hidden\", display: \"block\" },\r\n        cssNormalTransform = {\r\n            letterSpacing: 0,\r\n            fontWeight: 400\r\n        },\r\n    \r\n        cssExpand = [ \"Top\", \"Right\", \"Bottom\", \"Left\" ],\r\n        cssPrefixes = [ \"Webkit\", \"O\", \"Moz\", \"ms\" ];\r\n    \r\n    // return a css property mapped to a potentially vendor prefixed property\r\n    function vendorPropName( style, name ) {\r\n    \r\n        // shortcut for names that are not vendor prefixed\r\n        if ( name in style ) {\r\n            return name;\r\n        }\r\n    \r\n        // check for vendor prefixed names\r\n        var capName = name.charAt(0).toUpperCase() + name.slice(1),\r\n            origName = name,\r\n            i = cssPrefixes.length;\r\n    \r\n        while ( i-- ) {\r\n            name = cssPrefixes[ i ] + capName;\r\n            if ( name in style ) {\r\n                return name;\r\n            }\r\n        }\r\n    \r\n        return origName;\r\n    }\r\n    \r\n    function isHidden( elem, el ) {\r\n        // isHidden might be called from jQuery#filter function;\r\n        // in that case, element will be second argument\r\n        elem = el || elem;\r\n        return jQuery.css( elem, \"display\" ) === \"none\" || !jQuery.contains( elem.ownerDocument, elem );\r\n    }\r\n    \r\n    function showHide( elements, show ) {\r\n        var display, elem, hidden,\r\n            values = [],\r\n            index = 0,\r\n            length = elements.length;\r\n    \r\n        for ( ; index < length; index++ ) {\r\n            elem = elements[ index ];\r\n            if ( !elem.style ) {\r\n                continue;\r\n            }\r\n    \r\n            values[ index ] = jQuery._data( elem, \"olddisplay\" );\r\n            display = elem.style.display;\r\n            if ( show ) {\r\n                // Reset the inline display of this element to learn if it is\r\n                // being hidden by cascaded rules or not\r\n                if ( !values[ index ] && display === \"none\" ) {\r\n                    elem.style.display = \"\";\r\n                }\r\n    \r\n                // Set elements which have been overridden with display: none\r\n                // in a stylesheet to whatever the default browser style is\r\n                // for such an element\r\n                if ( elem.style.display === \"\" && isHidden( elem ) ) {\r\n                    values[ index ] = jQuery._data( elem, \"olddisplay\", css_defaultDisplay(elem.nodeName) );\r\n                }\r\n            } else {\r\n    \r\n                if ( !values[ index ] ) {\r\n                    hidden = isHidden( elem );\r\n    \r\n                    if ( display && display !== \"none\" || !hidden ) {\r\n                        jQuery._data( elem, \"olddisplay\", hidden ? display : jQuery.css( elem, \"display\" ) );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        // Set the display of most of the elements in a second loop\r\n        // to avoid the constant reflow\r\n        for ( index = 0; index < length; index++ ) {\r\n            elem = elements[ index ];\r\n            if ( !elem.style ) {\r\n                continue;\r\n            }\r\n            if ( !show || elem.style.display === \"none\" || elem.style.display === \"\" ) {\r\n                elem.style.display = show ? values[ index ] || \"\" : \"none\";\r\n            }\r\n        }\r\n    \r\n        return elements;\r\n    }\r\n    \r\n    jQuery.fn.extend({\r\n        css: function( name, value ) {\r\n            return jQuery.access( this, function( elem, name, value ) {\r\n                var len, styles,\r\n                    map = {},\r\n                    i = 0;\r\n    \r\n                if ( jQuery.isArray( name ) ) {\r\n                    styles = getStyles( elem );\r\n                    len = name.length;\r\n    \r\n                    for ( ; i < len; i++ ) {\r\n                        map[ name[ i ] ] = jQuery.css( elem, name[ i ], false, styles );\r\n                    }\r\n    \r\n                    return map;\r\n                }\r\n    \r\n                return value !== undefined ?\r\n                    jQuery.style( elem, name, value ) :\r\n                    jQuery.css( elem, name );\r\n            }, name, value, arguments.length > 1 );\r\n        },\r\n        show: function() {\r\n            return showHide( this, true );\r\n        },\r\n        hide: function() {\r\n            return showHide( this );\r\n        },\r\n        toggle: function( state ) {\r\n            var bool = typeof state === \"boolean\";\r\n    \r\n            return this.each(function() {\r\n                if ( bool ? state : isHidden( this ) ) {\r\n                    jQuery( this ).show();\r\n                } else {\r\n                    jQuery( this ).hide();\r\n                }\r\n            });\r\n        }\r\n    });\r\n    \r\n    jQuery.extend({\r\n        // Add in style property hooks for overriding the default\r\n        // behavior of getting and setting a style property\r\n        cssHooks: {\r\n            opacity: {\r\n                get: function( elem, computed ) {\r\n                    if ( computed ) {\r\n                        // We should always get a number back from opacity\r\n                        var ret = curCSS( elem, \"opacity\" );\r\n                        return ret === \"\" ? \"1\" : ret;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    \r\n        // Exclude the following css properties to add px\r\n        cssNumber: {\r\n            \"columnCount\": true,\r\n            \"fillOpacity\": true,\r\n            \"fontWeight\": true,\r\n            \"lineHeight\": true,\r\n            \"opacity\": true,\r\n            \"orphans\": true,\r\n            \"widows\": true,\r\n            \"zIndex\": true,\r\n            \"zoom\": true\r\n        },\r\n    \r\n        // Add in properties whose names you wish to fix before\r\n        // setting or getting the value\r\n        cssProps: {\r\n            // normalize float css property\r\n            \"float\": jQuery.support.cssFloat ? \"cssFloat\" : \"styleFloat\"\r\n        },\r\n    \r\n        // Get and set the style property on a DOM Node\r\n        style: function( elem, name, value, extra ) {\r\n            // Don't set styles on text and comment nodes\r\n            if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {\r\n                return;\r\n            }\r\n    \r\n            // Make sure that we're working with the right name\r\n            var ret, type, hooks,\r\n                origName = jQuery.camelCase( name ),\r\n                style = elem.style;\r\n    \r\n            name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( style, origName ) );\r\n    \r\n            // gets hook for the prefixed version\r\n            // followed by the unprefixed version\r\n            hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\r\n    \r\n            // Check if we're setting a value\r\n            if ( value !== undefined ) {\r\n                type = typeof value;\r\n    \r\n                // convert relative number strings (+= or -=) to relative numbers. #7345\r\n                if ( type === \"string\" && (ret = rrelNum.exec( value )) ) {\r\n                    value = ( ret[1] + 1 ) * ret[2] + parseFloat( jQuery.css( elem, name ) );\r\n                    // Fixes bug #9237\r\n                    type = \"number\";\r\n                }\r\n    \r\n                // Make sure that NaN and null values aren't set. See: #7116\r\n                if ( value == null || type === \"number\" && isNaN( value ) ) {\r\n                    return;\r\n                }\r\n    \r\n                // If a number was passed in, add 'px' to the (except for certain CSS properties)\r\n                if ( type === \"number\" && !jQuery.cssNumber[ origName ] ) {\r\n                    value += \"px\";\r\n                }\r\n    \r\n                // Fixes #8908, it can be done more correctly by specifing setters in cssHooks,\r\n                // but it would mean to define eight (for every problematic property) identical functions\r\n                if ( !jQuery.support.clearCloneStyle && value === \"\" && name.indexOf(\"background\") === 0 ) {\r\n                    style[ name ] = \"inherit\";\r\n                }\r\n    \r\n                // If a hook was provided, use that value, otherwise just set the specified value\r\n                if ( !hooks || !(\"set\" in hooks) || (value = hooks.set( elem, value, extra )) !== undefined ) {\r\n    \r\n                    // Wrapped to prevent IE from throwing errors when 'invalid' values are provided\r\n                    // Fixes bug #5509\r\n                    try {\r\n                        style[ name ] = value;\r\n                    } catch(e) {}\r\n                }\r\n    \r\n            } else {\r\n                // If a hook was provided get the non-computed value from there\r\n                if ( hooks && \"get\" in hooks && (ret = hooks.get( elem, false, extra )) !== undefined ) {\r\n                    return ret;\r\n                }\r\n    \r\n                // Otherwise just get the value from the style object\r\n                return style[ name ];\r\n            }\r\n        },\r\n    \r\n        css: function( elem, name, extra, styles ) {\r\n            var num, val, hooks,\r\n                origName = jQuery.camelCase( name );\r\n    \r\n            // Make sure that we're working with the right name\r\n            name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( elem.style, origName ) );\r\n    \r\n            // gets hook for the prefixed version\r\n            // followed by the unprefixed version\r\n            hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\r\n    \r\n            // If a hook was provided get the computed value from there\r\n            if ( hooks && \"get\" in hooks ) {\r\n                val = hooks.get( elem, true, extra );\r\n            }\r\n    \r\n            // Otherwise, if a way to get the computed value exists, use that\r\n            if ( val === undefined ) {\r\n                val = curCSS( elem, name, styles );\r\n            }\r\n    \r\n            //convert \"normal\" to computed value\r\n            if ( val === \"normal\" && name in cssNormalTransform ) {\r\n                val = cssNormalTransform[ name ];\r\n            }\r\n    \r\n            // Return, converting to number if forced or a qualifier was provided and val looks numeric\r\n            if ( extra === \"\" || extra ) {\r\n                num = parseFloat( val );\r\n                return extra === true || jQuery.isNumeric( num ) ? num || 0 : val;\r\n            }\r\n            return val;\r\n        },\r\n    \r\n        // A method for quickly swapping in/out CSS properties to get correct calculations\r\n        swap: function( elem, options, callback, args ) {\r\n            var ret, name,\r\n                old = {};\r\n    \r\n            // Remember the old values, and insert the new ones\r\n            for ( name in options ) {\r\n                old[ name ] = elem.style[ name ];\r\n                elem.style[ name ] = options[ name ];\r\n            }\r\n    \r\n            ret = callback.apply( elem, args || [] );\r\n    \r\n            // Revert the old values\r\n            for ( name in options ) {\r\n                elem.style[ name ] = old[ name ];\r\n            }\r\n    \r\n            return ret;\r\n        }\r\n    });\r\n    \r\n    // NOTE: we've included the \"window\" in window.getComputedStyle\r\n    // because jsdom on node.js will break without it.\r\n    if ( window.getComputedStyle ) {\r\n        getStyles = function( elem ) {\r\n            return window.getComputedStyle( elem, null );\r\n        };\r\n    \r\n        curCSS = function( elem, name, _computed ) {\r\n            var width, minWidth, maxWidth,\r\n                computed = _computed || getStyles( elem ),\r\n    \r\n                // getPropertyValue is only needed for .css('filter') in IE9, see #12537\r\n                ret = computed ? computed.getPropertyValue( name ) || computed[ name ] : undefined,\r\n                style = elem.style;\r\n    \r\n            if ( computed ) {\r\n    \r\n                if ( ret === \"\" && !jQuery.contains( elem.ownerDocument, elem ) ) {\r\n                    ret = jQuery.style( elem, name );\r\n                }\r\n    \r\n                // A tribute to the \"awesome hack by Dean Edwards\"\r\n                // Chrome < 17 and Safari 5.0 uses \"computed value\" instead of \"used value\" for margin-right\r\n                // Safari 5.1.7 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels\r\n                // this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values\r\n                if ( rnumnonpx.test( ret ) && rmargin.test( name ) ) {\r\n    \r\n                    // Remember the original values\r\n                    width = style.width;\r\n                    minWidth = style.minWidth;\r\n                    maxWidth = style.maxWidth;\r\n    \r\n                    // Put in the new values to get a computed value out\r\n                    style.minWidth = style.maxWidth = style.width = ret;\r\n                    ret = computed.width;\r\n    \r\n                    // Revert the changed values\r\n                    style.width = width;\r\n                    style.minWidth = minWidth;\r\n                    style.maxWidth = maxWidth;\r\n                }\r\n            }\r\n    \r\n            return ret;\r\n        };\r\n    } else if ( document.documentElement.currentStyle ) {\r\n        getStyles = function( elem ) {\r\n            return elem.currentStyle;\r\n        };\r\n    \r\n        curCSS = function( elem, name, _computed ) {\r\n            var left, rs, rsLeft,\r\n                computed = _computed || getStyles( elem ),\r\n                ret = computed ? computed[ name ] : undefined,\r\n                style = elem.style;\r\n    \r\n            // Avoid setting ret to empty string here\r\n            // so we don't default to auto\r\n            if ( ret == null && style && style[ name ] ) {\r\n                ret = style[ name ];\r\n            }\r\n    \r\n            // From the awesome hack by Dean Edwards\r\n            // http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291\r\n    \r\n            // If we're not dealing with a regular pixel number\r\n            // but a number that has a weird ending, we need to convert it to pixels\r\n            // but not position css attributes, as those are proportional to the parent element instead\r\n            // and we can't measure the parent instead because it might trigger a \"stacking dolls\" problem\r\n            if ( rnumnonpx.test( ret ) && !rposition.test( name ) ) {\r\n    \r\n                // Remember the original values\r\n                left = style.left;\r\n                rs = elem.runtimeStyle;\r\n                rsLeft = rs && rs.left;\r\n    \r\n                // Put in the new values to get a computed value out\r\n                if ( rsLeft ) {\r\n                    rs.left = elem.currentStyle.left;\r\n                }\r\n                style.left = name === \"fontSize\" ? \"1em\" : ret;\r\n                ret = style.pixelLeft + \"px\";\r\n    \r\n                // Revert the changed values\r\n                style.left = left;\r\n                if ( rsLeft ) {\r\n                    rs.left = rsLeft;\r\n                }\r\n            }\r\n    \r\n            return ret === \"\" ? \"auto\" : ret;\r\n        };\r\n    }\r\n    \r\n    function setPositiveNumber( elem, value, subtract ) {\r\n        var matches = rnumsplit.exec( value );\r\n        return matches ?\r\n            // Guard against undefined \"subtract\", e.g., when used as in cssHooks\r\n            Math.max( 0, matches[ 1 ] - ( subtract || 0 ) ) + ( matches[ 2 ] || \"px\" ) :\r\n            value;\r\n    }\r\n    \r\n    function augmentWidthOrHeight( elem, name, extra, isBorderBox, styles ) {\r\n        var i = extra === ( isBorderBox ? \"border\" : \"content\" ) ?\r\n            // If we already have the right measurement, avoid augmentation\r\n            4 :\r\n            // Otherwise initialize for horizontal or vertical properties\r\n            name === \"width\" ? 1 : 0,\r\n    \r\n            val = 0;\r\n    \r\n        for ( ; i < 4; i += 2 ) {\r\n            // both box models exclude margin, so add it if we want it\r\n            if ( extra === \"margin\" ) {\r\n                val += jQuery.css( elem, extra + cssExpand[ i ], true, styles );\r\n            }\r\n    \r\n            if ( isBorderBox ) {\r\n                // border-box includes padding, so remove it if we want content\r\n                if ( extra === \"content\" ) {\r\n                    val -= jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\r\n                }\r\n    \r\n                // at this point, extra isn't border nor margin, so remove border\r\n                if ( extra !== \"margin\" ) {\r\n                    val -= jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\r\n                }\r\n            } else {\r\n                // at this point, extra isn't content, so add padding\r\n                val += jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\r\n    \r\n                // at this point, extra isn't content nor padding, so add border\r\n                if ( extra !== \"padding\" ) {\r\n                    val += jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\r\n                }\r\n            }\r\n        }\r\n    \r\n        return val;\r\n    }\r\n    \r\n    function getWidthOrHeight( elem, name, extra ) {\r\n    \r\n        // Start with offset property, which is equivalent to the border-box value\r\n        var valueIsBorderBox = true,\r\n            val = name === \"width\" ? elem.offsetWidth : elem.offsetHeight,\r\n            styles = getStyles( elem ),\r\n            isBorderBox = jQuery.support.boxSizing && jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\";\r\n    \r\n        // some non-html elements return undefined for offsetWidth, so check for null/undefined\r\n        // svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285\r\n        // MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668\r\n        if ( val <= 0 || val == null ) {\r\n            // Fall back to computed then uncomputed css if necessary\r\n            val = curCSS( elem, name, styles );\r\n            if ( val < 0 || val == null ) {\r\n                val = elem.style[ name ];\r\n            }\r\n    \r\n            // Computed unit is not pixels. Stop here and return.\r\n            if ( rnumnonpx.test(val) ) {\r\n                return val;\r\n            }\r\n    \r\n            // we need the check for style in case a browser which returns unreliable values\r\n            // for getComputedStyle silently falls back to the reliable elem.style\r\n            valueIsBorderBox = isBorderBox && ( jQuery.support.boxSizingReliable || val === elem.style[ name ] );\r\n    \r\n            // Normalize \"\", auto, and prepare for extra\r\n            val = parseFloat( val ) || 0;\r\n        }\r\n    \r\n        // use the active box-sizing model to add/subtract irrelevant styles\r\n        return ( val +\r\n            augmentWidthOrHeight(\r\n                elem,\r\n                name,\r\n                extra || ( isBorderBox ? \"border\" : \"content\" ),\r\n                valueIsBorderBox,\r\n                styles\r\n            )\r\n        ) + \"px\";\r\n    }\r\n    \r\n    // Try to determine the default display value of an element\r\n    function css_defaultDisplay( nodeName ) {\r\n        var doc = document,\r\n            display = elemdisplay[ nodeName ];\r\n    \r\n        if ( !display ) {\r\n            display = actualDisplay( nodeName, doc );\r\n    \r\n            // If the simple way fails, read from inside an iframe\r\n            if ( display === \"none\" || !display ) {\r\n                // Use the already-created iframe if possible\r\n                iframe = ( iframe ||\r\n                    jQuery(\"<iframe frameborder='0' width='0' height='0'/>\")\r\n                    .css( \"cssText\", \"display:block !important\" )\r\n                ).appendTo( doc.documentElement );\r\n    \r\n                // Always write a new HTML skeleton so Webkit and Firefox don't choke on reuse\r\n                doc = ( iframe[0].contentWindow || iframe[0].contentDocument ).document;\r\n                doc.write(\"<!doctype html><html><body>\");\r\n                doc.close();\r\n    \r\n                display = actualDisplay( nodeName, doc );\r\n                iframe.detach();\r\n            }\r\n    \r\n            // Store the correct default display\r\n            elemdisplay[ nodeName ] = display;\r\n        }\r\n    \r\n        return display;\r\n    }\r\n    \r\n    // Called ONLY from within css_defaultDisplay\r\n    function actualDisplay( name, doc ) {\r\n        var elem = jQuery( doc.createElement( name ) ).appendTo( doc.body ),\r\n            display = jQuery.css( elem[0], \"display\" );\r\n        elem.remove();\r\n        return display;\r\n    }\r\n    \r\n    jQuery.each([ \"height\", \"width\" ], function( i, name ) {\r\n        jQuery.cssHooks[ name ] = {\r\n            get: function( elem, computed, extra ) {\r\n                if ( computed ) {\r\n                    // certain elements can have dimension info if we invisibly show them\r\n                    // however, it must have a current display style that would benefit from this\r\n                    return elem.offsetWidth === 0 && rdisplayswap.test( jQuery.css( elem, \"display\" ) ) ?\r\n                        jQuery.swap( elem, cssShow, function() {\r\n                            return getWidthOrHeight( elem, name, extra );\r\n                        }) :\r\n                        getWidthOrHeight( elem, name, extra );\r\n                }\r\n            },\r\n    \r\n            set: function( elem, value, extra ) {\r\n                var styles = extra && getStyles( elem );\r\n                return setPositiveNumber( elem, value, extra ?\r\n                    augmentWidthOrHeight(\r\n                        elem,\r\n                        name,\r\n                        extra,\r\n                        jQuery.support.boxSizing && jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\",\r\n                        styles\r\n                    ) : 0\r\n                );\r\n            }\r\n        };\r\n    });\r\n    \r\n    if ( !jQuery.support.opacity ) {\r\n        jQuery.cssHooks.opacity = {\r\n            get: function( elem, computed ) {\r\n                // IE uses filters for opacity\r\n                return ropacity.test( (computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || \"\" ) ?\r\n                    ( 0.01 * parseFloat( RegExp.$1 ) ) + \"\" :\r\n                    computed ? \"1\" : \"\";\r\n            },\r\n    \r\n            set: function( elem, value ) {\r\n                var style = elem.style,\r\n                    currentStyle = elem.currentStyle,\r\n                    opacity = jQuery.isNumeric( value ) ? \"alpha(opacity=\" + value * 100 + \")\" : \"\",\r\n                    filter = currentStyle && currentStyle.filter || style.filter || \"\";\r\n    \r\n                // IE has trouble with opacity if it does not have layout\r\n                // Force it by setting the zoom level\r\n                style.zoom = 1;\r\n    \r\n                // if setting opacity to 1, and no other filters exist - attempt to remove filter attribute #6652\r\n                // if value === \"\", then remove inline opacity #12685\r\n                if ( ( value >= 1 || value === \"\" ) &&\r\n                        jQuery.trim( filter.replace( ralpha, \"\" ) ) === \"\" &&\r\n                        style.removeAttribute ) {\r\n    \r\n                    // Setting style.filter to null, \"\" & \" \" still leave \"filter:\" in the cssText\r\n                    // if \"filter:\" is present at all, clearType is disabled, we want to avoid this\r\n                    // style.removeAttribute is IE Only, but so apparently is this code path...\r\n                    style.removeAttribute( \"filter\" );\r\n    \r\n                    // if there is no filter style applied in a css rule or unset inline opacity, we are done\r\n                    if ( value === \"\" || currentStyle && !currentStyle.filter ) {\r\n                        return;\r\n                    }\r\n                }\r\n    \r\n                // otherwise, set new filter values\r\n                style.filter = ralpha.test( filter ) ?\r\n                    filter.replace( ralpha, opacity ) :\r\n                    filter + \" \" + opacity;\r\n            }\r\n        };\r\n    }\r\n    \r\n    // These hooks cannot be added until DOM ready because the support test\r\n    // for it is not run until after DOM ready\r\n    jQuery(function() {\r\n        if ( !jQuery.support.reliableMarginRight ) {\r\n            jQuery.cssHooks.marginRight = {\r\n                get: function( elem, computed ) {\r\n                    if ( computed ) {\r\n                        // WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right\r\n                        // Work around by temporarily setting element display to inline-block\r\n                        return jQuery.swap( elem, { \"display\": \"inline-block\" },\r\n                            curCSS, [ elem, \"marginRight\" ] );\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    \r\n        // Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084\r\n        // getComputedStyle returns percent when specified for top/left/bottom/right\r\n        // rather than make the css module depend on the offset module, we just check for it here\r\n        if ( !jQuery.support.pixelPosition && jQuery.fn.position ) {\r\n            jQuery.each( [ \"top\", \"left\" ], function( i, prop ) {\r\n                jQuery.cssHooks[ prop ] = {\r\n                    get: function( elem, computed ) {\r\n                        if ( computed ) {\r\n                            computed = curCSS( elem, prop );\r\n                            // if curCSS returns percentage, fallback to offset\r\n                            return rnumnonpx.test( computed ) ?\r\n                                jQuery( elem ).position()[ prop ] + \"px\" :\r\n                                computed;\r\n                        }\r\n                    }\r\n                };\r\n            });\r\n        }\r\n    \r\n    });\r\n    \r\n    if ( jQuery.expr && jQuery.expr.filters ) {\r\n        jQuery.expr.filters.hidden = function( elem ) {\r\n            // Support: Opera <= 12.12\r\n            // Opera reports offsetWidths and offsetHeights less than zero on some elements\r\n            return elem.offsetWidth <= 0 && elem.offsetHeight <= 0 ||\r\n                (!jQuery.support.reliableHiddenOffsets && ((elem.style && elem.style.display) || jQuery.css( elem, \"display\" )) === \"none\");\r\n        };\r\n    \r\n        jQuery.expr.filters.visible = function( elem ) {\r\n            return !jQuery.expr.filters.hidden( elem );\r\n        };\r\n    }\r\n    \r\n    // These hooks are used by animate to expand properties\r\n    jQuery.each({\r\n        margin: \"\",\r\n        padding: \"\",\r\n        border: \"Width\"\r\n    }, function( prefix, suffix ) {\r\n        jQuery.cssHooks[ prefix + suffix ] = {\r\n            expand: function( value ) {\r\n                var i = 0,\r\n                    expanded = {},\r\n    \r\n                    // assumes a single number if not a string\r\n                    parts = typeof value === \"string\" ? value.split(\" \") : [ value ];\r\n    \r\n                for ( ; i < 4; i++ ) {\r\n                    expanded[ prefix + cssExpand[ i ] + suffix ] =\r\n                        parts[ i ] || parts[ i - 2 ] || parts[ 0 ];\r\n                }\r\n    \r\n                return expanded;\r\n            }\r\n        };\r\n    \r\n        if ( !rmargin.test( prefix ) ) {\r\n            jQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;\r\n        }\r\n    });\r\n    var r20 = /%20/g,\r\n        rbracket = /\\[\\]$/,\r\n        rCRLF = /\\r?\\n/g,\r\n        rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i,\r\n        rsubmittable = /^(?:input|select|textarea|keygen)/i;\r\n    \r\n    jQuery.fn.extend({\r\n        serialize: function() {\r\n            return jQuery.param( this.serializeArray() );\r\n        },\r\n        serializeArray: function() {\r\n            return this.map(function(){\r\n                // Can add propHook for \"elements\" to filter or add form elements\r\n                var elements = jQuery.prop( this, \"elements\" );\r\n                return elements ? jQuery.makeArray( elements ) : this;\r\n            })\r\n            .filter(function(){\r\n                var type = this.type;\r\n                // Use .is(\":disabled\") so that fieldset[disabled] works\r\n                return this.name && !jQuery( this ).is( \":disabled\" ) &&\r\n                    rsubmittable.test( this.nodeName ) && !rsubmitterTypes.test( type ) &&\r\n                    ( this.checked || !manipulation_rcheckableType.test( type ) );\r\n            })\r\n            .map(function( i, elem ){\r\n                var val = jQuery( this ).val();\r\n    \r\n                return val == null ?\r\n                    null :\r\n                    jQuery.isArray( val ) ?\r\n                        jQuery.map( val, function( val ){\r\n                            return { name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\r\n                        }) :\r\n                        { name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\r\n            }).get();\r\n        }\r\n    });\r\n    \r\n    //Serialize an array of form elements or a set of\r\n    //key/values into a query string\r\n    jQuery.param = function( a, traditional ) {\r\n        var prefix,\r\n            s = [],\r\n            add = function( key, value ) {\r\n                // If value is a function, invoke it and return its value\r\n                value = jQuery.isFunction( value ) ? value() : ( value == null ? \"\" : value );\r\n                s[ s.length ] = encodeURIComponent( key ) + \"=\" + encodeURIComponent( value );\r\n            };\r\n    \r\n        // Set traditional to true for jQuery <= 1.3.2 behavior.\r\n        if ( traditional === undefined ) {\r\n            traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;\r\n        }\r\n    \r\n        // If an array was passed in, assume that it is an array of form elements.\r\n        if ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {\r\n            // Serialize the form elements\r\n            jQuery.each( a, function() {\r\n                add( this.name, this.value );\r\n            });\r\n    \r\n        } else {\r\n            // If traditional, encode the \"old\" way (the way 1.3.2 or older\r\n            // did it), otherwise encode params recursively.\r\n            for ( prefix in a ) {\r\n                buildParams( prefix, a[ prefix ], traditional, add );\r\n            }\r\n        }\r\n    \r\n        // Return the resulting serialization\r\n        return s.join( \"&\" ).replace( r20, \"+\" );\r\n    };\r\n    \r\n    function buildParams( prefix, obj, traditional, add ) {\r\n        var name;\r\n    \r\n        if ( jQuery.isArray( obj ) ) {\r\n            // Serialize array item.\r\n            jQuery.each( obj, function( i, v ) {\r\n                if ( traditional || rbracket.test( prefix ) ) {\r\n                    // Treat each array item as a scalar.\r\n                    add( prefix, v );\r\n    \r\n                } else {\r\n                    // Item is non-scalar (array or object), encode its numeric index.\r\n                    buildParams( prefix + \"[\" + ( typeof v === \"object\" ? i : \"\" ) + \"]\", v, traditional, add );\r\n                }\r\n            });\r\n    \r\n        } else if ( !traditional && jQuery.type( obj ) === \"object\" ) {\r\n            // Serialize object item.\r\n            for ( name in obj ) {\r\n                buildParams( prefix + \"[\" + name + \"]\", obj[ name ], traditional, add );\r\n            }\r\n    \r\n        } else {\r\n            // Serialize scalar item.\r\n            add( prefix, obj );\r\n        }\r\n    }\r\n    jQuery.each( (\"blur focus focusin focusout load resize scroll unload click dblclick \" +\r\n        \"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave \" +\r\n        \"change select submit keydown keypress keyup error contextmenu\").split(\" \"), function( i, name ) {\r\n    \r\n        // Handle event binding\r\n        jQuery.fn[ name ] = function( data, fn ) {\r\n            return arguments.length > 0 ?\r\n                this.on( name, null, data, fn ) :\r\n                this.trigger( name );\r\n        };\r\n    });\r\n    \r\n    jQuery.fn.hover = function( fnOver, fnOut ) {\r\n        return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );\r\n    };\r\n    var\r\n        // Document location\r\n        ajaxLocParts,\r\n        ajaxLocation,\r\n        ajax_nonce = jQuery.now(),\r\n    \r\n        ajax_rquery = /\\?/,\r\n        rhash = /#.*$/,\r\n        rts = /([?&])_=[^&]*/,\r\n        rheaders = /^(.*?):[ \\t]*([^\\r\\n]*)\\r?$/mg, // IE leaves an \\r character at EOL\r\n        // #7653, #8125, #8152: local protocol detection\r\n        rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,\r\n        rnoContent = /^(?:GET|HEAD)$/,\r\n        rprotocol = /^\\/\\//,\r\n        rurl = /^([\\w.+-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+)|)|)/,\r\n    \r\n        // Keep a copy of the old load method\r\n        _load = jQuery.fn.load,\r\n    \r\n        /* Prefilters\r\n         * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)\r\n         * 2) These are called:\r\n         *    - BEFORE asking for a transport\r\n         *    - AFTER param serialization (s.data is a string if s.processData is true)\r\n         * 3) key is the dataType\r\n         * 4) the catchall symbol \"*\" can be used\r\n         * 5) execution will start with transport dataType and THEN continue down to \"*\" if needed\r\n         */\r\n        prefilters = {},\r\n    \r\n        /* Transports bindings\r\n         * 1) key is the dataType\r\n         * 2) the catchall symbol \"*\" can be used\r\n         * 3) selection will start with transport dataType and THEN go to \"*\" if needed\r\n         */\r\n        transports = {},\r\n    \r\n        // Avoid comment-prolog char sequence (#10098); must appease lint and evade compression\r\n        allTypes = \"*/\".concat(\"*\");\r\n    \r\n    // #8138, IE may throw an exception when accessing\r\n    // a field from window.location if document.domain has been set\r\n    try {\r\n        ajaxLocation = location.href;\r\n    } catch( e ) {\r\n        // Use the href attribute of an A element\r\n        // since IE will modify it given document.location\r\n        ajaxLocation = document.createElement( \"a\" );\r\n        ajaxLocation.href = \"\";\r\n        ajaxLocation = ajaxLocation.href;\r\n    }\r\n    \r\n    // Segment location into parts\r\n    ajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];\r\n    \r\n    // Base \"constructor\" for jQuery.ajaxPrefilter and jQuery.ajaxTransport\r\n    function addToPrefiltersOrTransports( structure ) {\r\n    \r\n        // dataTypeExpression is optional and defaults to \"*\"\r\n        return function( dataTypeExpression, func ) {\r\n    \r\n            if ( typeof dataTypeExpression !== \"string\" ) {\r\n                func = dataTypeExpression;\r\n                dataTypeExpression = \"*\";\r\n            }\r\n    \r\n            var dataType,\r\n                i = 0,\r\n                dataTypes = dataTypeExpression.toLowerCase().match( core_rnotwhite ) || [];\r\n    \r\n            if ( jQuery.isFunction( func ) ) {\r\n                // For each dataType in the dataTypeExpression\r\n                while ( (dataType = dataTypes[i++]) ) {\r\n                    // Prepend if requested\r\n                    if ( dataType[0] === \"+\" ) {\r\n                        dataType = dataType.slice( 1 ) || \"*\";\r\n                        (structure[ dataType ] = structure[ dataType ] || []).unshift( func );\r\n    \r\n                    // Otherwise append\r\n                    } else {\r\n                        (structure[ dataType ] = structure[ dataType ] || []).push( func );\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n    \r\n    // Base inspection function for prefilters and transports\r\n    function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR ) {\r\n    \r\n        var inspected = {},\r\n            seekingTransport = ( structure === transports );\r\n    \r\n        function inspect( dataType ) {\r\n            var selected;\r\n            inspected[ dataType ] = true;\r\n            jQuery.each( structure[ dataType ] || [], function( _, prefilterOrFactory ) {\r\n                var dataTypeOrTransport = prefilterOrFactory( options, originalOptions, jqXHR );\r\n                if( typeof dataTypeOrTransport === \"string\" && !seekingTransport && !inspected[ dataTypeOrTransport ] ) {\r\n                    options.dataTypes.unshift( dataTypeOrTransport );\r\n                    inspect( dataTypeOrTransport );\r\n                    return false;\r\n                } else if ( seekingTransport ) {\r\n                    return !( selected = dataTypeOrTransport );\r\n                }\r\n            });\r\n            return selected;\r\n        }\r\n    \r\n        return inspect( options.dataTypes[ 0 ] ) || !inspected[ \"*\" ] && inspect( \"*\" );\r\n    }\r\n    \r\n    // A special extend for ajax options\r\n    // that takes \"flat\" options (not to be deep extended)\r\n    // Fixes #9887\r\n    function ajaxExtend( target, src ) {\r\n        var deep, key,\r\n            flatOptions = jQuery.ajaxSettings.flatOptions || {};\r\n    \r\n        for ( key in src ) {\r\n            if ( src[ key ] !== undefined ) {\r\n                ( flatOptions[ key ] ? target : ( deep || (deep = {}) ) )[ key ] = src[ key ];\r\n            }\r\n        }\r\n        if ( deep ) {\r\n            jQuery.extend( true, target, deep );\r\n        }\r\n    \r\n        return target;\r\n    }\r\n    \r\n    jQuery.fn.load = function( url, params, callback ) {\r\n        if ( typeof url !== \"string\" && _load ) {\r\n            return _load.apply( this, arguments );\r\n        }\r\n    \r\n        var selector, response, type,\r\n            self = this,\r\n            off = url.indexOf(\" \");\r\n    \r\n        if ( off >= 0 ) {\r\n            selector = url.slice( off, url.length );\r\n            url = url.slice( 0, off );\r\n        }\r\n    \r\n        // If it's a function\r\n        if ( jQuery.isFunction( params ) ) {\r\n    \r\n            // We assume that it's the callback\r\n            callback = params;\r\n            params = undefined;\r\n    \r\n        // Otherwise, build a param string\r\n        } else if ( params && typeof params === \"object\" ) {\r\n            type = \"POST\";\r\n        }\r\n    \r\n        // If we have elements to modify, make the request\r\n        if ( self.length > 0 ) {\r\n            jQuery.ajax({\r\n                url: url,\r\n    \r\n                // if \"type\" variable is undefined, then \"GET\" method will be used\r\n                type: type,\r\n                dataType: \"html\",\r\n                data: params\r\n            }).done(function( responseText ) {\r\n    \r\n                // Save response for use in complete callback\r\n                response = arguments;\r\n    \r\n                self.html( selector ?\r\n    \r\n                    // If a selector was specified, locate the right elements in a dummy div\r\n                    // Exclude scripts to avoid IE 'Permission Denied' errors\r\n                    jQuery(\"<div>\").append( jQuery.parseHTML( responseText ) ).find( selector ) :\r\n    \r\n                    // Otherwise use the full result\r\n                    responseText );\r\n    \r\n            }).complete( callback && function( jqXHR, status ) {\r\n                self.each( callback, response || [ jqXHR.responseText, status, jqXHR ] );\r\n            });\r\n        }\r\n    \r\n        return this;\r\n    };\r\n    \r\n    // Attach a bunch of functions for handling common AJAX events\r\n    jQuery.each( [ \"ajaxStart\", \"ajaxStop\", \"ajaxComplete\", \"ajaxError\", \"ajaxSuccess\", \"ajaxSend\" ], function( i, type ){\r\n        jQuery.fn[ type ] = function( fn ){\r\n            return this.on( type, fn );\r\n        };\r\n    });\r\n    \r\n    jQuery.each( [ \"get\", \"post\" ], function( i, method ) {\r\n        jQuery[ method ] = function( url, data, callback, type ) {\r\n            // shift arguments if data argument was omitted\r\n            if ( jQuery.isFunction( data ) ) {\r\n                type = type || callback;\r\n                callback = data;\r\n                data = undefined;\r\n            }\r\n    \r\n            return jQuery.ajax({\r\n                url: url,\r\n                type: method,\r\n                dataType: type,\r\n                data: data,\r\n                success: callback\r\n            });\r\n        };\r\n    });\r\n    \r\n    jQuery.extend({\r\n    \r\n        // Counter for holding the number of active queries\r\n        active: 0,\r\n    \r\n        // Last-Modified header cache for next request\r\n        lastModified: {},\r\n        etag: {},\r\n    \r\n        ajaxSettings: {\r\n            url: ajaxLocation,\r\n            type: \"GET\",\r\n            isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),\r\n            global: true,\r\n            processData: true,\r\n            async: true,\r\n            contentType: \"application/x-www-form-urlencoded; charset=UTF-8\",\r\n            /*\r\n            timeout: 0,\r\n            data: null,\r\n            dataType: null,\r\n            username: null,\r\n            password: null,\r\n            cache: null,\r\n            throws: false,\r\n            traditional: false,\r\n            headers: {},\r\n            */\r\n    \r\n            accepts: {\r\n                \"*\": allTypes,\r\n                text: \"text/plain\",\r\n                html: \"text/html\",\r\n                xml: \"application/xml, text/xml\",\r\n                json: \"application/json, text/javascript\"\r\n            },\r\n    \r\n            contents: {\r\n                xml: /xml/,\r\n                html: /html/,\r\n                json: /json/\r\n            },\r\n    \r\n            responseFields: {\r\n                xml: \"responseXML\",\r\n                text: \"responseText\"\r\n            },\r\n    \r\n            // Data converters\r\n            // Keys separate source (or catchall \"*\") and destination types with a single space\r\n            converters: {\r\n    \r\n                // Convert anything to text\r\n                \"* text\": window.String,\r\n    \r\n                // Text to html (true = no transformation)\r\n                \"text html\": true,\r\n    \r\n                // Evaluate text as a json expression\r\n                \"text json\": jQuery.parseJSON,\r\n    \r\n                // Parse text as xml\r\n                \"text xml\": jQuery.parseXML\r\n            },\r\n    \r\n            // For options that shouldn't be deep extended:\r\n            // you can add your own custom options here if\r\n            // and when you create one that shouldn't be\r\n            // deep extended (see ajaxExtend)\r\n            flatOptions: {\r\n                url: true,\r\n                context: true\r\n            }\r\n        },\r\n    \r\n        // Creates a full fledged settings object into target\r\n        // with both ajaxSettings and settings fields.\r\n        // If target is omitted, writes into ajaxSettings.\r\n        ajaxSetup: function( target, settings ) {\r\n            return settings ?\r\n    \r\n                // Building a settings object\r\n                ajaxExtend( ajaxExtend( target, jQuery.ajaxSettings ), settings ) :\r\n    \r\n                // Extending ajaxSettings\r\n                ajaxExtend( jQuery.ajaxSettings, target );\r\n        },\r\n    \r\n        ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),\r\n        ajaxTransport: addToPrefiltersOrTransports( transports ),\r\n    \r\n        // Main method\r\n        ajax: function( url, options ) {\r\n    \r\n            // If url is an object, simulate pre-1.5 signature\r\n            if ( typeof url === \"object\" ) {\r\n                options = url;\r\n                url = undefined;\r\n            }\r\n    \r\n            // Force options to be an object\r\n            options = options || {};\r\n    \r\n            var // Cross-domain detection vars\r\n                parts,\r\n                // Loop variable\r\n                i,\r\n                // URL without anti-cache param\r\n                cacheURL,\r\n                // Response headers as string\r\n                responseHeadersString,\r\n                // timeout handle\r\n                timeoutTimer,\r\n    \r\n                // To know if global events are to be dispatched\r\n                fireGlobals,\r\n    \r\n                transport,\r\n                // Response headers\r\n                responseHeaders,\r\n                // Create the final options object\r\n                s = jQuery.ajaxSetup( {}, options ),\r\n                // Callbacks context\r\n                callbackContext = s.context || s,\r\n                // Context for global events is callbackContext if it is a DOM node or jQuery collection\r\n                globalEventContext = s.context && ( callbackContext.nodeType || callbackContext.jquery ) ?\r\n                    jQuery( callbackContext ) :\r\n                    jQuery.event,\r\n                // Deferreds\r\n                deferred = jQuery.Deferred(),\r\n                completeDeferred = jQuery.Callbacks(\"once memory\"),\r\n                // Status-dependent callbacks\r\n                statusCode = s.statusCode || {},\r\n                // Headers (they are sent all at once)\r\n                requestHeaders = {},\r\n                requestHeadersNames = {},\r\n                // The jqXHR state\r\n                state = 0,\r\n                // Default abort message\r\n                strAbort = \"canceled\",\r\n                // Fake xhr\r\n                jqXHR = {\r\n                    readyState: 0,\r\n    \r\n                    // Builds headers hashtable if needed\r\n                    getResponseHeader: function( key ) {\r\n                        var match;\r\n                        if ( state === 2 ) {\r\n                            if ( !responseHeaders ) {\r\n                                responseHeaders = {};\r\n                                while ( (match = rheaders.exec( responseHeadersString )) ) {\r\n                                    responseHeaders[ match[1].toLowerCase() ] = match[ 2 ];\r\n                                }\r\n                            }\r\n                            match = responseHeaders[ key.toLowerCase() ];\r\n                        }\r\n                        return match == null ? null : match;\r\n                    },\r\n    \r\n                    // Raw string\r\n                    getAllResponseHeaders: function() {\r\n                        return state === 2 ? responseHeadersString : null;\r\n                    },\r\n    \r\n                    // Caches the header\r\n                    setRequestHeader: function( name, value ) {\r\n                        var lname = name.toLowerCase();\r\n                        if ( !state ) {\r\n                            name = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;\r\n                            requestHeaders[ name ] = value;\r\n                        }\r\n                        return this;\r\n                    },\r\n    \r\n                    // Overrides response content-type header\r\n                    overrideMimeType: function( type ) {\r\n                        if ( !state ) {\r\n                            s.mimeType = type;\r\n                        }\r\n                        return this;\r\n                    },\r\n    \r\n                    // Status-dependent callbacks\r\n                    statusCode: function( map ) {\r\n                        var code;\r\n                        if ( map ) {\r\n                            if ( state < 2 ) {\r\n                                for ( code in map ) {\r\n                                    // Lazy-add the new callback in a way that preserves old ones\r\n                                    statusCode[ code ] = [ statusCode[ code ], map[ code ] ];\r\n                                }\r\n                            } else {\r\n                                // Execute the appropriate callbacks\r\n                                jqXHR.always( map[ jqXHR.status ] );\r\n                            }\r\n                        }\r\n                        return this;\r\n                    },\r\n    \r\n                    // Cancel the request\r\n                    abort: function( statusText ) {\r\n                        var finalText = statusText || strAbort;\r\n                        if ( transport ) {\r\n                            transport.abort( finalText );\r\n                        }\r\n                        done( 0, finalText );\r\n                        return this;\r\n                    }\r\n                };\r\n    \r\n            // Attach deferreds\r\n            deferred.promise( jqXHR ).complete = completeDeferred.add;\r\n            jqXHR.success = jqXHR.done;\r\n            jqXHR.error = jqXHR.fail;\r\n    \r\n            // Remove hash character (#7531: and string promotion)\r\n            // Add protocol if not provided (#5866: IE7 issue with protocol-less urls)\r\n            // Handle falsy url in the settings object (#10093: consistency with old signature)\r\n            // We also use the url parameter if available\r\n            s.url = ( ( url || s.url || ajaxLocation ) + \"\" ).replace( rhash, \"\" ).replace( rprotocol, ajaxLocParts[ 1 ] + \"//\" );\r\n    \r\n            // Alias method option to type as per ticket #12004\r\n            s.type = options.method || options.type || s.method || s.type;\r\n    \r\n            // Extract dataTypes list\r\n            s.dataTypes = jQuery.trim( s.dataType || \"*\" ).toLowerCase().match( core_rnotwhite ) || [\"\"];\r\n    \r\n            // A cross-domain request is in order when we have a protocol:host:port mismatch\r\n            if ( s.crossDomain == null ) {\r\n                parts = rurl.exec( s.url.toLowerCase() );\r\n                s.crossDomain = !!( parts &&\r\n                    ( parts[ 1 ] !== ajaxLocParts[ 1 ] || parts[ 2 ] !== ajaxLocParts[ 2 ] ||\r\n                        ( parts[ 3 ] || ( parts[ 1 ] === \"http:\" ? 80 : 443 ) ) !=\r\n                            ( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === \"http:\" ? 80 : 443 ) ) )\r\n                );\r\n            }\r\n    \r\n            // Convert data if not already a string\r\n            if ( s.data && s.processData && typeof s.data !== \"string\" ) {\r\n                s.data = jQuery.param( s.data, s.traditional );\r\n            }\r\n    \r\n            // Apply prefilters\r\n            inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );\r\n    \r\n            // If request was aborted inside a prefilter, stop there\r\n            if ( state === 2 ) {\r\n                return jqXHR;\r\n            }\r\n    \r\n            // We can fire global events as of now if asked to\r\n            fireGlobals = s.global;\r\n    \r\n            // Watch for a new set of requests\r\n            if ( fireGlobals && jQuery.active++ === 0 ) {\r\n                jQuery.event.trigger(\"ajaxStart\");\r\n            }\r\n    \r\n            // Uppercase the type\r\n            s.type = s.type.toUpperCase();\r\n    \r\n            // Determine if request has content\r\n            s.hasContent = !rnoContent.test( s.type );\r\n    \r\n            // Save the URL in case we're toying with the If-Modified-Since\r\n            // and/or If-None-Match header later on\r\n            cacheURL = s.url;\r\n    \r\n            // More options handling for requests with no content\r\n            if ( !s.hasContent ) {\r\n    \r\n                // If data is available, append data to url\r\n                if ( s.data ) {\r\n                    cacheURL = ( s.url += ( ajax_rquery.test( cacheURL ) ? \"&\" : \"?\" ) + s.data );\r\n                    // #9682: remove data so that it's not used in an eventual retry\r\n                    delete s.data;\r\n                }\r\n    \r\n                // Add anti-cache in url if needed\r\n                if ( s.cache === false ) {\r\n                    s.url = rts.test( cacheURL ) ?\r\n    \r\n                        // If there is already a '_' parameter, set its value\r\n                        cacheURL.replace( rts, \"$1_=\" + ajax_nonce++ ) :\r\n    \r\n                        // Otherwise add one to the end\r\n                        cacheURL + ( ajax_rquery.test( cacheURL ) ? \"&\" : \"?\" ) + \"_=\" + ajax_nonce++;\r\n                }\r\n            }\r\n    \r\n            // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\r\n            if ( s.ifModified ) {\r\n                if ( jQuery.lastModified[ cacheURL ] ) {\r\n                    jqXHR.setRequestHeader( \"If-Modified-Since\", jQuery.lastModified[ cacheURL ] );\r\n                }\r\n                if ( jQuery.etag[ cacheURL ] ) {\r\n                    jqXHR.setRequestHeader( \"If-None-Match\", jQuery.etag[ cacheURL ] );\r\n                }\r\n            }\r\n    \r\n            // Set the correct header, if data is being sent\r\n            if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {\r\n                jqXHR.setRequestHeader( \"Content-Type\", s.contentType );\r\n            }\r\n    \r\n            // Set the Accepts header for the server, depending on the dataType\r\n            jqXHR.setRequestHeader(\r\n                \"Accept\",\r\n                s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[0] ] ?\r\n                    s.accepts[ s.dataTypes[0] ] + ( s.dataTypes[ 0 ] !== \"*\" ? \", \" + allTypes + \"; q=0.01\" : \"\" ) :\r\n                    s.accepts[ \"*\" ]\r\n            );\r\n    \r\n            // Check for headers option\r\n            for ( i in s.headers ) {\r\n                jqXHR.setRequestHeader( i, s.headers[ i ] );\r\n            }\r\n    \r\n            // Allow custom headers/mimetypes and early abort\r\n            if ( s.beforeSend && ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {\r\n                // Abort if not done already and return\r\n                return jqXHR.abort();\r\n            }\r\n    \r\n            // aborting is no longer a cancellation\r\n            strAbort = \"abort\";\r\n    \r\n            // Install callbacks on deferreds\r\n            for ( i in { success: 1, error: 1, complete: 1 } ) {\r\n                jqXHR[ i ]( s[ i ] );\r\n            }\r\n    \r\n            // Get transport\r\n            transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );\r\n    \r\n            // If no transport, we auto-abort\r\n            if ( !transport ) {\r\n                done( -1, \"No Transport\" );\r\n            } else {\r\n                jqXHR.readyState = 1;\r\n    \r\n                // Send global event\r\n                if ( fireGlobals ) {\r\n                    globalEventContext.trigger( \"ajaxSend\", [ jqXHR, s ] );\r\n                }\r\n                // Timeout\r\n                if ( s.async && s.timeout > 0 ) {\r\n                    timeoutTimer = setTimeout(function() {\r\n                        jqXHR.abort(\"timeout\");\r\n                    }, s.timeout );\r\n                }\r\n    \r\n                try {\r\n                    state = 1;\r\n                    transport.send( requestHeaders, done );\r\n                } catch ( e ) {\r\n                    // Propagate exception as error if not done\r\n                    if ( state < 2 ) {\r\n                        done( -1, e );\r\n                    // Simply rethrow otherwise\r\n                    } else {\r\n                        throw e;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // Callback for when everything is done\r\n            function done( status, nativeStatusText, responses, headers ) {\r\n                var isSuccess, success, error, response, modified,\r\n                    statusText = nativeStatusText;\r\n    \r\n                // Called once\r\n                if ( state === 2 ) {\r\n                    return;\r\n                }\r\n    \r\n                // State is \"done\" now\r\n                state = 2;\r\n    \r\n                // Clear timeout if it exists\r\n                if ( timeoutTimer ) {\r\n                    clearTimeout( timeoutTimer );\r\n                }\r\n    \r\n                // Dereference transport for early garbage collection\r\n                // (no matter how long the jqXHR object will be used)\r\n                transport = undefined;\r\n    \r\n                // Cache response headers\r\n                responseHeadersString = headers || \"\";\r\n    \r\n                // Set readyState\r\n                jqXHR.readyState = status > 0 ? 4 : 0;\r\n    \r\n                // Get response data\r\n                if ( responses ) {\r\n                    response = ajaxHandleResponses( s, jqXHR, responses );\r\n                }\r\n    \r\n                // If successful, handle type chaining\r\n                if ( status >= 200 && status < 300 || status === 304 ) {\r\n    \r\n                    // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\r\n                    if ( s.ifModified ) {\r\n                        modified = jqXHR.getResponseHeader(\"Last-Modified\");\r\n                        if ( modified ) {\r\n                            jQuery.lastModified[ cacheURL ] = modified;\r\n                        }\r\n                        modified = jqXHR.getResponseHeader(\"etag\");\r\n                        if ( modified ) {\r\n                            jQuery.etag[ cacheURL ] = modified;\r\n                        }\r\n                    }\r\n    \r\n                    // if no content\r\n                    if ( status === 204 ) {\r\n                        isSuccess = true;\r\n                        statusText = \"nocontent\";\r\n    \r\n                    // if not modified\r\n                    } else if ( status === 304 ) {\r\n                        isSuccess = true;\r\n                        statusText = \"notmodified\";\r\n    \r\n                    // If we have data, let's convert it\r\n                    } else {\r\n                        isSuccess = ajaxConvert( s, response );\r\n                        statusText = isSuccess.state;\r\n                        success = isSuccess.data;\r\n                        error = isSuccess.error;\r\n                        isSuccess = !error;\r\n                    }\r\n                } else {\r\n                    // We extract error from statusText\r\n                    // then normalize statusText and status for non-aborts\r\n                    error = statusText;\r\n                    if ( status || !statusText ) {\r\n                        statusText = \"error\";\r\n                        if ( status < 0 ) {\r\n                            status = 0;\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                // Set data for the fake xhr object\r\n                jqXHR.status = status;\r\n                jqXHR.statusText = ( nativeStatusText || statusText ) + \"\";\r\n    \r\n                // Success/Error\r\n                if ( isSuccess ) {\r\n                    deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );\r\n                } else {\r\n                    deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );\r\n                }\r\n    \r\n                // Status-dependent callbacks\r\n                jqXHR.statusCode( statusCode );\r\n                statusCode = undefined;\r\n    \r\n                if ( fireGlobals ) {\r\n                    globalEventContext.trigger( isSuccess ? \"ajaxSuccess\" : \"ajaxError\",\r\n                        [ jqXHR, s, isSuccess ? success : error ] );\r\n                }\r\n    \r\n                // Complete\r\n                completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );\r\n    \r\n                if ( fireGlobals ) {\r\n                    globalEventContext.trigger( \"ajaxComplete\", [ jqXHR, s ] );\r\n                    // Handle the global AJAX counter\r\n                    if ( !( --jQuery.active ) ) {\r\n                        jQuery.event.trigger(\"ajaxStop\");\r\n                    }\r\n                }\r\n            }\r\n    \r\n            return jqXHR;\r\n        },\r\n    \r\n        getScript: function( url, callback ) {\r\n            return jQuery.get( url, undefined, callback, \"script\" );\r\n        },\r\n    \r\n        getJSON: function( url, data, callback ) {\r\n            return jQuery.get( url, data, callback, \"json\" );\r\n        }\r\n    });\r\n    \r\n    /* Handles responses to an ajax request:\r\n     * - sets all responseXXX fields accordingly\r\n     * - finds the right dataType (mediates between content-type and expected dataType)\r\n     * - returns the corresponding response\r\n     */\r\n    function ajaxHandleResponses( s, jqXHR, responses ) {\r\n        var firstDataType, ct, finalDataType, type,\r\n            contents = s.contents,\r\n            dataTypes = s.dataTypes,\r\n            responseFields = s.responseFields;\r\n    \r\n        // Fill responseXXX fields\r\n        for ( type in responseFields ) {\r\n            if ( type in responses ) {\r\n                jqXHR[ responseFields[type] ] = responses[ type ];\r\n            }\r\n        }\r\n    \r\n        // Remove auto dataType and get content-type in the process\r\n        while( dataTypes[ 0 ] === \"*\" ) {\r\n            dataTypes.shift();\r\n            if ( ct === undefined ) {\r\n                ct = s.mimeType || jqXHR.getResponseHeader(\"Content-Type\");\r\n            }\r\n        }\r\n    \r\n        // Check if we're dealing with a known content-type\r\n        if ( ct ) {\r\n            for ( type in contents ) {\r\n                if ( contents[ type ] && contents[ type ].test( ct ) ) {\r\n                    dataTypes.unshift( type );\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    \r\n        // Check to see if we have a response for the expected dataType\r\n        if ( dataTypes[ 0 ] in responses ) {\r\n            finalDataType = dataTypes[ 0 ];\r\n        } else {\r\n            // Try convertible dataTypes\r\n            for ( type in responses ) {\r\n                if ( !dataTypes[ 0 ] || s.converters[ type + \" \" + dataTypes[0] ] ) {\r\n                    finalDataType = type;\r\n                    break;\r\n                }\r\n                if ( !firstDataType ) {\r\n                    firstDataType = type;\r\n                }\r\n            }\r\n            // Or just use first one\r\n            finalDataType = finalDataType || firstDataType;\r\n        }\r\n    \r\n        // If we found a dataType\r\n        // We add the dataType to the list if needed\r\n        // and return the corresponding response\r\n        if ( finalDataType ) {\r\n            if ( finalDataType !== dataTypes[ 0 ] ) {\r\n                dataTypes.unshift( finalDataType );\r\n            }\r\n            return responses[ finalDataType ];\r\n        }\r\n    }\r\n    \r\n    // Chain conversions given the request and the original response\r\n    function ajaxConvert( s, response ) {\r\n        var conv2, current, conv, tmp,\r\n            converters = {},\r\n            i = 0,\r\n            // Work with a copy of dataTypes in case we need to modify it for conversion\r\n            dataTypes = s.dataTypes.slice(),\r\n            prev = dataTypes[ 0 ];\r\n    \r\n        // Apply the dataFilter if provided\r\n        if ( s.dataFilter ) {\r\n            response = s.dataFilter( response, s.dataType );\r\n        }\r\n    \r\n        // Create converters map with lowercased keys\r\n        if ( dataTypes[ 1 ] ) {\r\n            for ( conv in s.converters ) {\r\n                converters[ conv.toLowerCase() ] = s.converters[ conv ];\r\n            }\r\n        }\r\n    \r\n        // Convert to each sequential dataType, tolerating list modification\r\n        for ( ; (current = dataTypes[++i]); ) {\r\n    \r\n            // There's only work to do if current dataType is non-auto\r\n            if ( current !== \"*\" ) {\r\n    \r\n                // Convert response if prev dataType is non-auto and differs from current\r\n                if ( prev !== \"*\" && prev !== current ) {\r\n    \r\n                    // Seek a direct converter\r\n                    conv = converters[ prev + \" \" + current ] || converters[ \"* \" + current ];\r\n    \r\n                    // If none found, seek a pair\r\n                    if ( !conv ) {\r\n                        for ( conv2 in converters ) {\r\n    \r\n                            // If conv2 outputs current\r\n                            tmp = conv2.split(\" \");\r\n                            if ( tmp[ 1 ] === current ) {\r\n    \r\n                                // If prev can be converted to accepted input\r\n                                conv = converters[ prev + \" \" + tmp[ 0 ] ] ||\r\n                                    converters[ \"* \" + tmp[ 0 ] ];\r\n                                if ( conv ) {\r\n                                    // Condense equivalence converters\r\n                                    if ( conv === true ) {\r\n                                        conv = converters[ conv2 ];\r\n    \r\n                                    // Otherwise, insert the intermediate dataType\r\n                                    } else if ( converters[ conv2 ] !== true ) {\r\n                                        current = tmp[ 0 ];\r\n                                        dataTypes.splice( i--, 0, current );\r\n                                    }\r\n    \r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n    \r\n                    // Apply converter (if not an equivalence)\r\n                    if ( conv !== true ) {\r\n    \r\n                        // Unless errors are allowed to bubble, catch and return them\r\n                        if ( conv && s[\"throws\"] ) {\r\n                            response = conv( response );\r\n                        } else {\r\n                            try {\r\n                                response = conv( response );\r\n                            } catch ( e ) {\r\n                                return { state: \"parsererror\", error: conv ? e : \"No conversion from \" + prev + \" to \" + current };\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                // Update prev for next iteration\r\n                prev = current;\r\n            }\r\n        }\r\n    \r\n        return { state: \"success\", data: response };\r\n    }\r\n    // Install script dataType\r\n    jQuery.ajaxSetup({\r\n        accepts: {\r\n            script: \"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"\r\n        },\r\n        contents: {\r\n            script: /(?:java|ecma)script/\r\n        },\r\n        converters: {\r\n            \"text script\": function( text ) {\r\n                jQuery.globalEval( text );\r\n                return text;\r\n            }\r\n        }\r\n    });\r\n    \r\n    // Handle cache's special case and global\r\n    jQuery.ajaxPrefilter( \"script\", function( s ) {\r\n        if ( s.cache === undefined ) {\r\n            s.cache = false;\r\n        }\r\n        if ( s.crossDomain ) {\r\n            s.type = \"GET\";\r\n            s.global = false;\r\n        }\r\n    });\r\n    \r\n    // Bind script tag hack transport\r\n    jQuery.ajaxTransport( \"script\", function(s) {\r\n    \r\n        // This transport only deals with cross domain requests\r\n        if ( s.crossDomain ) {\r\n    \r\n            var script,\r\n                head = document.head || jQuery(\"head\")[0] || document.documentElement;\r\n    \r\n            return {\r\n    \r\n                send: function( _, callback ) {\r\n    \r\n                    script = document.createElement(\"script\");\r\n    \r\n                    script.async = true;\r\n    \r\n                    if ( s.scriptCharset ) {\r\n                        script.charset = s.scriptCharset;\r\n                    }\r\n    \r\n                    script.src = s.url;\r\n    \r\n                    // Attach handlers for all browsers\r\n                    script.onload = script.onreadystatechange = function( _, isAbort ) {\r\n    \r\n                        if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {\r\n    \r\n                            // Handle memory leak in IE\r\n                            script.onload = script.onreadystatechange = null;\r\n    \r\n                            // Remove the script\r\n                            if ( script.parentNode ) {\r\n                                script.parentNode.removeChild( script );\r\n                            }\r\n    \r\n                            // Dereference the script\r\n                            script = null;\r\n    \r\n                            // Callback if not abort\r\n                            if ( !isAbort ) {\r\n                                callback( 200, \"success\" );\r\n                            }\r\n                        }\r\n                    };\r\n    \r\n                    // Circumvent IE6 bugs with base elements (#2709 and #4378) by prepending\r\n                    // Use native DOM manipulation to avoid our domManip AJAX trickery\r\n                    head.insertBefore( script, head.firstChild );\r\n                },\r\n    \r\n                abort: function() {\r\n                    if ( script ) {\r\n                        script.onload( undefined, true );\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    });\r\n    var oldCallbacks = [],\r\n        rjsonp = /(=)\\?(?=&|$)|\\?\\?/;\r\n    \r\n    // Default jsonp settings\r\n    jQuery.ajaxSetup({\r\n        jsonp: \"callback\",\r\n        jsonpCallback: function() {\r\n            var callback = oldCallbacks.pop() || ( jQuery.expando + \"_\" + ( ajax_nonce++ ) );\r\n            this[ callback ] = true;\r\n            return callback;\r\n        }\r\n    });\r\n    \r\n    // Detect, normalize options and install callbacks for jsonp requests\r\n    jQuery.ajaxPrefilter( \"json jsonp\", function( s, originalSettings, jqXHR ) {\r\n    \r\n        var callbackName, overwritten, responseContainer,\r\n            jsonProp = s.jsonp !== false && ( rjsonp.test( s.url ) ?\r\n                \"url\" :\r\n                typeof s.data === \"string\" && !( s.contentType || \"\" ).indexOf(\"application/x-www-form-urlencoded\") && rjsonp.test( s.data ) && \"data\"\r\n            );\r\n    \r\n        // Handle iff the expected data type is \"jsonp\" or we have a parameter to set\r\n        if ( jsonProp || s.dataTypes[ 0 ] === \"jsonp\" ) {\r\n    \r\n            // Get callback name, remembering preexisting value associated with it\r\n            callbackName = s.jsonpCallback = jQuery.isFunction( s.jsonpCallback ) ?\r\n                s.jsonpCallback() :\r\n                s.jsonpCallback;\r\n    \r\n            // Insert callback into url or form data\r\n            if ( jsonProp ) {\r\n                s[ jsonProp ] = s[ jsonProp ].replace( rjsonp, \"$1\" + callbackName );\r\n            } else if ( s.jsonp !== false ) {\r\n                s.url += ( ajax_rquery.test( s.url ) ? \"&\" : \"?\" ) + s.jsonp + \"=\" + callbackName;\r\n            }\r\n    \r\n            // Use data converter to retrieve json after script execution\r\n            s.converters[\"script json\"] = function() {\r\n                if ( !responseContainer ) {\r\n                    jQuery.error( callbackName + \" was not called\" );\r\n                }\r\n                return responseContainer[ 0 ];\r\n            };\r\n    \r\n            // force json dataType\r\n            s.dataTypes[ 0 ] = \"json\";\r\n    \r\n            // Install callback\r\n            overwritten = window[ callbackName ];\r\n            window[ callbackName ] = function() {\r\n                responseContainer = arguments;\r\n            };\r\n    \r\n            // Clean-up function (fires after converters)\r\n            jqXHR.always(function() {\r\n                // Restore preexisting value\r\n                window[ callbackName ] = overwritten;\r\n    \r\n                // Save back as free\r\n                if ( s[ callbackName ] ) {\r\n                    // make sure that re-using the options doesn't screw things around\r\n                    s.jsonpCallback = originalSettings.jsonpCallback;\r\n    \r\n                    // save the callback name for future use\r\n                    oldCallbacks.push( callbackName );\r\n                }\r\n    \r\n                // Call if it was a function and we have a response\r\n                if ( responseContainer && jQuery.isFunction( overwritten ) ) {\r\n                    overwritten( responseContainer[ 0 ] );\r\n                }\r\n    \r\n                responseContainer = overwritten = undefined;\r\n            });\r\n    \r\n            // Delegate to script\r\n            return \"script\";\r\n        }\r\n    });\r\n    var xhrCallbacks, xhrSupported,\r\n        xhrId = 0,\r\n        // #5280: Internet Explorer will keep connections alive if we don't abort on unload\r\n        xhrOnUnloadAbort = window.ActiveXObject && function() {\r\n            // Abort all pending requests\r\n            var key;\r\n            for ( key in xhrCallbacks ) {\r\n                xhrCallbacks[ key ]( undefined, true );\r\n            }\r\n        };\r\n    \r\n    // Functions to create xhrs\r\n    function createStandardXHR() {\r\n        try {\r\n            return new window.XMLHttpRequest();\r\n        } catch( e ) {}\r\n    }\r\n    \r\n    function createActiveXHR() {\r\n        try {\r\n            return new window.ActiveXObject(\"Microsoft.XMLHTTP\");\r\n        } catch( e ) {}\r\n    }\r\n    \r\n    // Create the request object\r\n    // (This is still attached to ajaxSettings for backward compatibility)\r\n    jQuery.ajaxSettings.xhr = window.ActiveXObject ?\r\n        /* Microsoft failed to properly\r\n         * implement the XMLHttpRequest in IE7 (can't request local files),\r\n         * so we use the ActiveXObject when it is available\r\n         * Additionally XMLHttpRequest can be disabled in IE7/IE8 so\r\n         * we need a fallback.\r\n         */\r\n        function() {\r\n            return !this.isLocal && createStandardXHR() || createActiveXHR();\r\n        } :\r\n        // For all other browsers, use the standard XMLHttpRequest object\r\n        createStandardXHR;\r\n    \r\n    // Determine support properties\r\n    xhrSupported = jQuery.ajaxSettings.xhr();\r\n    jQuery.support.cors = !!xhrSupported && ( \"withCredentials\" in xhrSupported );\r\n    xhrSupported = jQuery.support.ajax = !!xhrSupported;\r\n    \r\n    // Create transport if the browser can provide an xhr\r\n    if ( xhrSupported ) {\r\n    \r\n        jQuery.ajaxTransport(function( s ) {\r\n            // Cross domain only allowed if supported through XMLHttpRequest\r\n            if ( !s.crossDomain || jQuery.support.cors ) {\r\n    \r\n                var callback;\r\n    \r\n                return {\r\n                    send: function( headers, complete ) {\r\n    \r\n                        // Get a new xhr\r\n                        var handle, i,\r\n                            xhr = s.xhr();\r\n    \r\n                        // Open the socket\r\n                        // Passing null username, generates a login popup on Opera (#2865)\r\n                        if ( s.username ) {\r\n                            xhr.open( s.type, s.url, s.async, s.username, s.password );\r\n                        } else {\r\n                            xhr.open( s.type, s.url, s.async );\r\n                        }\r\n    \r\n                        // Apply custom fields if provided\r\n                        if ( s.xhrFields ) {\r\n                            for ( i in s.xhrFields ) {\r\n                                xhr[ i ] = s.xhrFields[ i ];\r\n                            }\r\n                        }\r\n    \r\n                        // Override mime type if needed\r\n                        if ( s.mimeType && xhr.overrideMimeType ) {\r\n                            xhr.overrideMimeType( s.mimeType );\r\n                        }\r\n    \r\n                        // X-Requested-With header\r\n                        // For cross-domain requests, seeing as conditions for a preflight are\r\n                        // akin to a jigsaw puzzle, we simply never set it to be sure.\r\n                        // (it can always be set on a per-request basis or even using ajaxSetup)\r\n                        // For same-domain requests, won't change header if already provided.\r\n                        if ( !s.crossDomain && !headers[\"X-Requested-With\"] ) {\r\n                            headers[\"X-Requested-With\"] = \"XMLHttpRequest\";\r\n                        }\r\n    \r\n                        // Need an extra try/catch for cross domain requests in Firefox 3\r\n                        try {\r\n                            for ( i in headers ) {\r\n                                xhr.setRequestHeader( i, headers[ i ] );\r\n                            }\r\n                        } catch( err ) {}\r\n    \r\n                        // Do send the request\r\n                        // This may raise an exception which is actually\r\n                        // handled in jQuery.ajax (so no try/catch here)\r\n                        xhr.send( ( s.hasContent && s.data ) || null );\r\n    \r\n                        // Listener\r\n                        callback = function( _, isAbort ) {\r\n                            var status, responseHeaders, statusText, responses;\r\n    \r\n                            // Firefox throws exceptions when accessing properties\r\n                            // of an xhr when a network error occurred\r\n                            // http://helpful.knobs-dials.com/index.php/Component_returned_failure_code:_0x80040111_(NS_ERROR_NOT_AVAILABLE)\r\n                            try {\r\n    \r\n                                // Was never called and is aborted or complete\r\n                                if ( callback && ( isAbort || xhr.readyState === 4 ) ) {\r\n    \r\n                                    // Only called once\r\n                                    callback = undefined;\r\n    \r\n                                    // Do not keep as active anymore\r\n                                    if ( handle ) {\r\n                                        xhr.onreadystatechange = jQuery.noop;\r\n                                        if ( xhrOnUnloadAbort ) {\r\n                                            delete xhrCallbacks[ handle ];\r\n                                        }\r\n                                    }\r\n    \r\n                                    // If it's an abort\r\n                                    if ( isAbort ) {\r\n                                        // Abort it manually if needed\r\n                                        if ( xhr.readyState !== 4 ) {\r\n                                            xhr.abort();\r\n                                        }\r\n                                    } else {\r\n                                        responses = {};\r\n                                        status = xhr.status;\r\n                                        responseHeaders = xhr.getAllResponseHeaders();\r\n    \r\n                                        // When requesting binary data, IE6-9 will throw an exception\r\n                                        // on any attempt to access responseText (#11426)\r\n                                        if ( typeof xhr.responseText === \"string\" ) {\r\n                                            responses.text = xhr.responseText;\r\n                                        }\r\n    \r\n                                        // Firefox throws an exception when accessing\r\n                                        // statusText for faulty cross-domain requests\r\n                                        try {\r\n                                            statusText = xhr.statusText;\r\n                                        } catch( e ) {\r\n                                            // We normalize with Webkit giving an empty statusText\r\n                                            statusText = \"\";\r\n                                        }\r\n    \r\n                                        // Filter status for non standard behaviors\r\n    \r\n                                        // If the request is local and we have data: assume a success\r\n                                        // (success with no data won't get notified, that's the best we\r\n                                        // can do given current implementations)\r\n                                        if ( !status && s.isLocal && !s.crossDomain ) {\r\n                                            status = responses.text ? 200 : 404;\r\n                                        // IE - #1450: sometimes returns 1223 when it should be 204\r\n                                        } else if ( status === 1223 ) {\r\n                                            status = 204;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            } catch( firefoxAccessException ) {\r\n                                if ( !isAbort ) {\r\n                                    complete( -1, firefoxAccessException );\r\n                                }\r\n                            }\r\n    \r\n                            // Call complete if needed\r\n                            if ( responses ) {\r\n                                complete( status, statusText, responses, responseHeaders );\r\n                            }\r\n                        };\r\n    \r\n                        if ( !s.async ) {\r\n                            // if we're in sync mode we fire the callback\r\n                            callback();\r\n                        } else if ( xhr.readyState === 4 ) {\r\n                            // (IE6 & IE7) if it's in cache and has been\r\n                            // retrieved directly we need to fire the callback\r\n                            setTimeout( callback );\r\n                        } else {\r\n                            handle = ++xhrId;\r\n                            if ( xhrOnUnloadAbort ) {\r\n                                // Create the active xhrs callbacks list if needed\r\n                                // and attach the unload handler\r\n                                if ( !xhrCallbacks ) {\r\n                                    xhrCallbacks = {};\r\n                                    jQuery( window ).unload( xhrOnUnloadAbort );\r\n                                }\r\n                                // Add to list of active xhrs callbacks\r\n                                xhrCallbacks[ handle ] = callback;\r\n                            }\r\n                            xhr.onreadystatechange = callback;\r\n                        }\r\n                    },\r\n    \r\n                    abort: function() {\r\n                        if ( callback ) {\r\n                            callback( undefined, true );\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n        });\r\n    }\r\n    var fxNow, timerId,\r\n        rfxtypes = /^(?:toggle|show|hide)$/,\r\n        rfxnum = new RegExp( \"^(?:([+-])=|)(\" + core_pnum + \")([a-z%]*)$\", \"i\" ),\r\n        rrun = /queueHooks$/,\r\n        animationPrefilters = [ defaultPrefilter ],\r\n        tweeners = {\r\n            \"*\": [function( prop, value ) {\r\n                var end, unit,\r\n                    tween = this.createTween( prop, value ),\r\n                    parts = rfxnum.exec( value ),\r\n                    target = tween.cur(),\r\n                    start = +target || 0,\r\n                    scale = 1,\r\n                    maxIterations = 20;\r\n    \r\n                if ( parts ) {\r\n                    end = +parts[2];\r\n                    unit = parts[3] || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" );\r\n    \r\n                    // We need to compute starting value\r\n                    if ( unit !== \"px\" && start ) {\r\n                        // Iteratively approximate from a nonzero starting point\r\n                        // Prefer the current property, because this process will be trivial if it uses the same units\r\n                        // Fallback to end or a simple constant\r\n                        start = jQuery.css( tween.elem, prop, true ) || end || 1;\r\n    \r\n                        do {\r\n                            // If previous iteration zeroed out, double until we get *something*\r\n                            // Use a string for doubling factor so we don't accidentally see scale as unchanged below\r\n                            scale = scale || \".5\";\r\n    \r\n                            // Adjust and apply\r\n                            start = start / scale;\r\n                            jQuery.style( tween.elem, prop, start + unit );\r\n    \r\n                        // Update scale, tolerating zero or NaN from tween.cur()\r\n                        // And breaking the loop if scale is unchanged or perfect, or if we've just had enough\r\n                        } while ( scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations );\r\n                    }\r\n    \r\n                    tween.unit = unit;\r\n                    tween.start = start;\r\n                    // If a +=/-= token was provided, we're doing a relative animation\r\n                    tween.end = parts[1] ? start + ( parts[1] + 1 ) * end : end;\r\n                }\r\n                return tween;\r\n            }]\r\n        };\r\n    \r\n    // Animations created synchronously will run synchronously\r\n    function createFxNow() {\r\n        setTimeout(function() {\r\n            fxNow = undefined;\r\n        });\r\n        return ( fxNow = jQuery.now() );\r\n    }\r\n    \r\n    function createTweens( animation, props ) {\r\n        jQuery.each( props, function( prop, value ) {\r\n            var collection = ( tweeners[ prop ] || [] ).concat( tweeners[ \"*\" ] ),\r\n                index = 0,\r\n                length = collection.length;\r\n            for ( ; index < length; index++ ) {\r\n                if ( collection[ index ].call( animation, prop, value ) ) {\r\n    \r\n                    // we're done with this property\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    function Animation( elem, properties, options ) {\r\n        var result,\r\n            stopped,\r\n            index = 0,\r\n            length = animationPrefilters.length,\r\n            deferred = jQuery.Deferred().always( function() {\r\n                // don't match elem in the :animated selector\r\n                delete tick.elem;\r\n            }),\r\n            tick = function() {\r\n                if ( stopped ) {\r\n                    return false;\r\n                }\r\n                var currentTime = fxNow || createFxNow(),\r\n                    remaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),\r\n                    // archaic crash bug won't allow us to use 1 - ( 0.5 || 0 ) (#12497)\r\n                    temp = remaining / animation.duration || 0,\r\n                    percent = 1 - temp,\r\n                    index = 0,\r\n                    length = animation.tweens.length;\r\n    \r\n                for ( ; index < length ; index++ ) {\r\n                    animation.tweens[ index ].run( percent );\r\n                }\r\n    \r\n                deferred.notifyWith( elem, [ animation, percent, remaining ]);\r\n    \r\n                if ( percent < 1 && length ) {\r\n                    return remaining;\r\n                } else {\r\n                    deferred.resolveWith( elem, [ animation ] );\r\n                    return false;\r\n                }\r\n            },\r\n            animation = deferred.promise({\r\n                elem: elem,\r\n                props: jQuery.extend( {}, properties ),\r\n                opts: jQuery.extend( true, { specialEasing: {} }, options ),\r\n                originalProperties: properties,\r\n                originalOptions: options,\r\n                startTime: fxNow || createFxNow(),\r\n                duration: options.duration,\r\n                tweens: [],\r\n                createTween: function( prop, end ) {\r\n                    var tween = jQuery.Tween( elem, animation.opts, prop, end,\r\n                            animation.opts.specialEasing[ prop ] || animation.opts.easing );\r\n                    animation.tweens.push( tween );\r\n                    return tween;\r\n                },\r\n                stop: function( gotoEnd ) {\r\n                    var index = 0,\r\n                        // if we are going to the end, we want to run all the tweens\r\n                        // otherwise we skip this part\r\n                        length = gotoEnd ? animation.tweens.length : 0;\r\n                    if ( stopped ) {\r\n                        return this;\r\n                    }\r\n                    stopped = true;\r\n                    for ( ; index < length ; index++ ) {\r\n                        animation.tweens[ index ].run( 1 );\r\n                    }\r\n    \r\n                    // resolve when we played the last frame\r\n                    // otherwise, reject\r\n                    if ( gotoEnd ) {\r\n                        deferred.resolveWith( elem, [ animation, gotoEnd ] );\r\n                    } else {\r\n                        deferred.rejectWith( elem, [ animation, gotoEnd ] );\r\n                    }\r\n                    return this;\r\n                }\r\n            }),\r\n            props = animation.props;\r\n    \r\n        propFilter( props, animation.opts.specialEasing );\r\n    \r\n        for ( ; index < length ; index++ ) {\r\n            result = animationPrefilters[ index ].call( animation, elem, props, animation.opts );\r\n            if ( result ) {\r\n                return result;\r\n            }\r\n        }\r\n    \r\n        createTweens( animation, props );\r\n    \r\n        if ( jQuery.isFunction( animation.opts.start ) ) {\r\n            animation.opts.start.call( elem, animation );\r\n        }\r\n    \r\n        jQuery.fx.timer(\r\n            jQuery.extend( tick, {\r\n                elem: elem,\r\n                anim: animation,\r\n                queue: animation.opts.queue\r\n            })\r\n        );\r\n    \r\n        // attach callbacks from options\r\n        return animation.progress( animation.opts.progress )\r\n            .done( animation.opts.done, animation.opts.complete )\r\n            .fail( animation.opts.fail )\r\n            .always( animation.opts.always );\r\n    }\r\n    \r\n    function propFilter( props, specialEasing ) {\r\n        var value, name, index, easing, hooks;\r\n    \r\n        // camelCase, specialEasing and expand cssHook pass\r\n        for ( index in props ) {\r\n            name = jQuery.camelCase( index );\r\n            easing = specialEasing[ name ];\r\n            value = props[ index ];\r\n            if ( jQuery.isArray( value ) ) {\r\n                easing = value[ 1 ];\r\n                value = props[ index ] = value[ 0 ];\r\n            }\r\n    \r\n            if ( index !== name ) {\r\n                props[ name ] = value;\r\n                delete props[ index ];\r\n            }\r\n    \r\n            hooks = jQuery.cssHooks[ name ];\r\n            if ( hooks && \"expand\" in hooks ) {\r\n                value = hooks.expand( value );\r\n                delete props[ name ];\r\n    \r\n                // not quite $.extend, this wont overwrite keys already present.\r\n                // also - reusing 'index' from above because we have the correct \"name\"\r\n                for ( index in value ) {\r\n                    if ( !( index in props ) ) {\r\n                        props[ index ] = value[ index ];\r\n                        specialEasing[ index ] = easing;\r\n                    }\r\n                }\r\n            } else {\r\n                specialEasing[ name ] = easing;\r\n            }\r\n        }\r\n    }\r\n    \r\n    jQuery.Animation = jQuery.extend( Animation, {\r\n    \r\n        tweener: function( props, callback ) {\r\n            if ( jQuery.isFunction( props ) ) {\r\n                callback = props;\r\n                props = [ \"*\" ];\r\n            } else {\r\n                props = props.split(\" \");\r\n            }\r\n    \r\n            var prop,\r\n                index = 0,\r\n                length = props.length;\r\n    \r\n            for ( ; index < length ; index++ ) {\r\n                prop = props[ index ];\r\n                tweeners[ prop ] = tweeners[ prop ] || [];\r\n                tweeners[ prop ].unshift( callback );\r\n            }\r\n        },\r\n    \r\n        prefilter: function( callback, prepend ) {\r\n            if ( prepend ) {\r\n                animationPrefilters.unshift( callback );\r\n            } else {\r\n                animationPrefilters.push( callback );\r\n            }\r\n        }\r\n    });\r\n    \r\n    function defaultPrefilter( elem, props, opts ) {\r\n        /*jshint validthis:true */\r\n        var prop, index, length,\r\n            value, dataShow, toggle,\r\n            tween, hooks, oldfire,\r\n            anim = this,\r\n            style = elem.style,\r\n            orig = {},\r\n            handled = [],\r\n            hidden = elem.nodeType && isHidden( elem );\r\n    \r\n        // handle queue: false promises\r\n        if ( !opts.queue ) {\r\n            hooks = jQuery._queueHooks( elem, \"fx\" );\r\n            if ( hooks.unqueued == null ) {\r\n                hooks.unqueued = 0;\r\n                oldfire = hooks.empty.fire;\r\n                hooks.empty.fire = function() {\r\n                    if ( !hooks.unqueued ) {\r\n                        oldfire();\r\n                    }\r\n                };\r\n            }\r\n            hooks.unqueued++;\r\n    \r\n            anim.always(function() {\r\n                // doing this makes sure that the complete handler will be called\r\n                // before this completes\r\n                anim.always(function() {\r\n                    hooks.unqueued--;\r\n                    if ( !jQuery.queue( elem, \"fx\" ).length ) {\r\n                        hooks.empty.fire();\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    \r\n        // height/width overflow pass\r\n        if ( elem.nodeType === 1 && ( \"height\" in props || \"width\" in props ) ) {\r\n            // Make sure that nothing sneaks out\r\n            // Record all 3 overflow attributes because IE does not\r\n            // change the overflow attribute when overflowX and\r\n            // overflowY are set to the same value\r\n            opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];\r\n    \r\n            // Set display property to inline-block for height/width\r\n            // animations on inline elements that are having width/height animated\r\n            if ( jQuery.css( elem, \"display\" ) === \"inline\" &&\r\n                    jQuery.css( elem, \"float\" ) === \"none\" ) {\r\n    \r\n                // inline-level elements accept inline-block;\r\n                // block-level elements need to be inline with layout\r\n                if ( !jQuery.support.inlineBlockNeedsLayout || css_defaultDisplay( elem.nodeName ) === \"inline\" ) {\r\n                    style.display = \"inline-block\";\r\n    \r\n                } else {\r\n                    style.zoom = 1;\r\n                }\r\n            }\r\n        }\r\n    \r\n        if ( opts.overflow ) {\r\n            style.overflow = \"hidden\";\r\n            if ( !jQuery.support.shrinkWrapBlocks ) {\r\n                anim.always(function() {\r\n                    style.overflow = opts.overflow[ 0 ];\r\n                    style.overflowX = opts.overflow[ 1 ];\r\n                    style.overflowY = opts.overflow[ 2 ];\r\n                });\r\n            }\r\n        }\r\n    \r\n    \r\n        // show/hide pass\r\n        for ( index in props ) {\r\n            value = props[ index ];\r\n            if ( rfxtypes.exec( value ) ) {\r\n                delete props[ index ];\r\n                toggle = toggle || value === \"toggle\";\r\n                if ( value === ( hidden ? \"hide\" : \"show\" ) ) {\r\n                    continue;\r\n                }\r\n                handled.push( index );\r\n            }\r\n        }\r\n    \r\n        length = handled.length;\r\n        if ( length ) {\r\n            dataShow = jQuery._data( elem, \"fxshow\" ) || jQuery._data( elem, \"fxshow\", {} );\r\n            if ( \"hidden\" in dataShow ) {\r\n                hidden = dataShow.hidden;\r\n            }\r\n    \r\n            // store state if its toggle - enables .stop().toggle() to \"reverse\"\r\n            if ( toggle ) {\r\n                dataShow.hidden = !hidden;\r\n            }\r\n            if ( hidden ) {\r\n                jQuery( elem ).show();\r\n            } else {\r\n                anim.done(function() {\r\n                    jQuery( elem ).hide();\r\n                });\r\n            }\r\n            anim.done(function() {\r\n                var prop;\r\n                jQuery._removeData( elem, \"fxshow\" );\r\n                for ( prop in orig ) {\r\n                    jQuery.style( elem, prop, orig[ prop ] );\r\n                }\r\n            });\r\n            for ( index = 0 ; index < length ; index++ ) {\r\n                prop = handled[ index ];\r\n                tween = anim.createTween( prop, hidden ? dataShow[ prop ] : 0 );\r\n                orig[ prop ] = dataShow[ prop ] || jQuery.style( elem, prop );\r\n    \r\n                if ( !( prop in dataShow ) ) {\r\n                    dataShow[ prop ] = tween.start;\r\n                    if ( hidden ) {\r\n                        tween.end = tween.start;\r\n                        tween.start = prop === \"width\" || prop === \"height\" ? 1 : 0;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    function Tween( elem, options, prop, end, easing ) {\r\n        return new Tween.prototype.init( elem, options, prop, end, easing );\r\n    }\r\n    jQuery.Tween = Tween;\r\n    \r\n    Tween.prototype = {\r\n        constructor: Tween,\r\n        init: function( elem, options, prop, end, easing, unit ) {\r\n            this.elem = elem;\r\n            this.prop = prop;\r\n            this.easing = easing || \"swing\";\r\n            this.options = options;\r\n            this.start = this.now = this.cur();\r\n            this.end = end;\r\n            this.unit = unit || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" );\r\n        },\r\n        cur: function() {\r\n            var hooks = Tween.propHooks[ this.prop ];\r\n    \r\n            return hooks && hooks.get ?\r\n                hooks.get( this ) :\r\n                Tween.propHooks._default.get( this );\r\n        },\r\n        run: function( percent ) {\r\n            var eased,\r\n                hooks = Tween.propHooks[ this.prop ];\r\n    \r\n            if ( this.options.duration ) {\r\n                this.pos = eased = jQuery.easing[ this.easing ](\r\n                    percent, this.options.duration * percent, 0, 1, this.options.duration\r\n                );\r\n            } else {\r\n                this.pos = eased = percent;\r\n            }\r\n            this.now = ( this.end - this.start ) * eased + this.start;\r\n    \r\n            if ( this.options.step ) {\r\n                this.options.step.call( this.elem, this.now, this );\r\n            }\r\n    \r\n            if ( hooks && hooks.set ) {\r\n                hooks.set( this );\r\n            } else {\r\n                Tween.propHooks._default.set( this );\r\n            }\r\n            return this;\r\n        }\r\n    };\r\n    \r\n    Tween.prototype.init.prototype = Tween.prototype;\r\n    \r\n    Tween.propHooks = {\r\n        _default: {\r\n            get: function( tween ) {\r\n                var result;\r\n    \r\n                if ( tween.elem[ tween.prop ] != null &&\r\n                    (!tween.elem.style || tween.elem.style[ tween.prop ] == null) ) {\r\n                    return tween.elem[ tween.prop ];\r\n                }\r\n    \r\n                // passing an empty string as a 3rd parameter to .css will automatically\r\n                // attempt a parseFloat and fallback to a string if the parse fails\r\n                // so, simple values such as \"10px\" are parsed to Float.\r\n                // complex values such as \"rotate(1rad)\" are returned as is.\r\n                result = jQuery.css( tween.elem, tween.prop, \"\" );\r\n                // Empty strings, null, undefined and \"auto\" are converted to 0.\r\n                return !result || result === \"auto\" ? 0 : result;\r\n            },\r\n            set: function( tween ) {\r\n                // use step hook for back compat - use cssHook if its there - use .style if its\r\n                // available and use plain properties where available\r\n                if ( jQuery.fx.step[ tween.prop ] ) {\r\n                    jQuery.fx.step[ tween.prop ]( tween );\r\n                } else if ( tween.elem.style && ( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != null || jQuery.cssHooks[ tween.prop ] ) ) {\r\n                    jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );\r\n                } else {\r\n                    tween.elem[ tween.prop ] = tween.now;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    // Remove in 2.0 - this supports IE8's panic based approach\r\n    // to setting things on disconnected nodes\r\n    \r\n    Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {\r\n        set: function( tween ) {\r\n            if ( tween.elem.nodeType && tween.elem.parentNode ) {\r\n                tween.elem[ tween.prop ] = tween.now;\r\n            }\r\n        }\r\n    };\r\n    \r\n    jQuery.each([ \"toggle\", \"show\", \"hide\" ], function( i, name ) {\r\n        var cssFn = jQuery.fn[ name ];\r\n        jQuery.fn[ name ] = function( speed, easing, callback ) {\r\n            return speed == null || typeof speed === \"boolean\" ?\r\n                cssFn.apply( this, arguments ) :\r\n                this.animate( genFx( name, true ), speed, easing, callback );\r\n        };\r\n    });\r\n    \r\n    jQuery.fn.extend({\r\n        fadeTo: function( speed, to, easing, callback ) {\r\n    \r\n            // show any hidden elements after setting opacity to 0\r\n            return this.filter( isHidden ).css( \"opacity\", 0 ).show()\r\n    \r\n                // animate to the value specified\r\n                .end().animate({ opacity: to }, speed, easing, callback );\r\n        },\r\n        animate: function( prop, speed, easing, callback ) {\r\n            var empty = jQuery.isEmptyObject( prop ),\r\n                optall = jQuery.speed( speed, easing, callback ),\r\n                doAnimation = function() {\r\n                    // Operate on a copy of prop so per-property easing won't be lost\r\n                    var anim = Animation( this, jQuery.extend( {}, prop ), optall );\r\n                    doAnimation.finish = function() {\r\n                        anim.stop( true );\r\n                    };\r\n                    // Empty animations, or finishing resolves immediately\r\n                    if ( empty || jQuery._data( this, \"finish\" ) ) {\r\n                        anim.stop( true );\r\n                    }\r\n                };\r\n                doAnimation.finish = doAnimation;\r\n    \r\n            return empty || optall.queue === false ?\r\n                this.each( doAnimation ) :\r\n                this.queue( optall.queue, doAnimation );\r\n        },\r\n        stop: function( type, clearQueue, gotoEnd ) {\r\n            var stopQueue = function( hooks ) {\r\n                var stop = hooks.stop;\r\n                delete hooks.stop;\r\n                stop( gotoEnd );\r\n            };\r\n    \r\n            if ( typeof type !== \"string\" ) {\r\n                gotoEnd = clearQueue;\r\n                clearQueue = type;\r\n                type = undefined;\r\n            }\r\n            if ( clearQueue && type !== false ) {\r\n                this.queue( type || \"fx\", [] );\r\n            }\r\n    \r\n            return this.each(function() {\r\n                var dequeue = true,\r\n                    index = type != null && type + \"queueHooks\",\r\n                    timers = jQuery.timers,\r\n                    data = jQuery._data( this );\r\n    \r\n                if ( index ) {\r\n                    if ( data[ index ] && data[ index ].stop ) {\r\n                        stopQueue( data[ index ] );\r\n                    }\r\n                } else {\r\n                    for ( index in data ) {\r\n                        if ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {\r\n                            stopQueue( data[ index ] );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                for ( index = timers.length; index--; ) {\r\n                    if ( timers[ index ].elem === this && (type == null || timers[ index ].queue === type) ) {\r\n                        timers[ index ].anim.stop( gotoEnd );\r\n                        dequeue = false;\r\n                        timers.splice( index, 1 );\r\n                    }\r\n                }\r\n    \r\n                // start the next in the queue if the last step wasn't forced\r\n                // timers currently will call their complete callbacks, which will dequeue\r\n                // but only if they were gotoEnd\r\n                if ( dequeue || !gotoEnd ) {\r\n                    jQuery.dequeue( this, type );\r\n                }\r\n            });\r\n        },\r\n        finish: function( type ) {\r\n            if ( type !== false ) {\r\n                type = type || \"fx\";\r\n            }\r\n            return this.each(function() {\r\n                var index,\r\n                    data = jQuery._data( this ),\r\n                    queue = data[ type + \"queue\" ],\r\n                    hooks = data[ type + \"queueHooks\" ],\r\n                    timers = jQuery.timers,\r\n                    length = queue ? queue.length : 0;\r\n    \r\n                // enable finishing flag on private data\r\n                data.finish = true;\r\n    \r\n                // empty the queue first\r\n                jQuery.queue( this, type, [] );\r\n    \r\n                if ( hooks && hooks.cur && hooks.cur.finish ) {\r\n                    hooks.cur.finish.call( this );\r\n                }\r\n    \r\n                // look for any active animations, and finish them\r\n                for ( index = timers.length; index--; ) {\r\n                    if ( timers[ index ].elem === this && timers[ index ].queue === type ) {\r\n                        timers[ index ].anim.stop( true );\r\n                        timers.splice( index, 1 );\r\n                    }\r\n                }\r\n    \r\n                // look for any animations in the old queue and finish them\r\n                for ( index = 0; index < length; index++ ) {\r\n                    if ( queue[ index ] && queue[ index ].finish ) {\r\n                        queue[ index ].finish.call( this );\r\n                    }\r\n                }\r\n    \r\n                // turn off finishing flag\r\n                delete data.finish;\r\n            });\r\n        }\r\n    });\r\n    \r\n    // Generate parameters to create a standard animation\r\n    function genFx( type, includeWidth ) {\r\n        var which,\r\n            attrs = { height: type },\r\n            i = 0;\r\n    \r\n        // if we include width, step value is 1 to do all cssExpand values,\r\n        // if we don't include width, step value is 2 to skip over Left and Right\r\n        includeWidth = includeWidth? 1 : 0;\r\n        for( ; i < 4 ; i += 2 - includeWidth ) {\r\n            which = cssExpand[ i ];\r\n            attrs[ \"margin\" + which ] = attrs[ \"padding\" + which ] = type;\r\n        }\r\n    \r\n        if ( includeWidth ) {\r\n            attrs.opacity = attrs.width = type;\r\n        }\r\n    \r\n        return attrs;\r\n    }\r\n    \r\n    // Generate shortcuts for custom animations\r\n    jQuery.each({\r\n        slideDown: genFx(\"show\"),\r\n        slideUp: genFx(\"hide\"),\r\n        slideToggle: genFx(\"toggle\"),\r\n        fadeIn: { opacity: \"show\" },\r\n        fadeOut: { opacity: \"hide\" },\r\n        fadeToggle: { opacity: \"toggle\" }\r\n    }, function( name, props ) {\r\n        jQuery.fn[ name ] = function( speed, easing, callback ) {\r\n            return this.animate( props, speed, easing, callback );\r\n        };\r\n    });\r\n    \r\n    jQuery.speed = function( speed, easing, fn ) {\r\n        var opt = speed && typeof speed === \"object\" ? jQuery.extend( {}, speed ) : {\r\n            complete: fn || !fn && easing ||\r\n                jQuery.isFunction( speed ) && speed,\r\n            duration: speed,\r\n            easing: fn && easing || easing && !jQuery.isFunction( easing ) && easing\r\n        };\r\n    \r\n        opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === \"number\" ? opt.duration :\r\n            opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;\r\n    \r\n        // normalize opt.queue - true/undefined/null -> \"fx\"\r\n        if ( opt.queue == null || opt.queue === true ) {\r\n            opt.queue = \"fx\";\r\n        }\r\n    \r\n        // Queueing\r\n        opt.old = opt.complete;\r\n    \r\n        opt.complete = function() {\r\n            if ( jQuery.isFunction( opt.old ) ) {\r\n                opt.old.call( this );\r\n            }\r\n    \r\n            if ( opt.queue ) {\r\n                jQuery.dequeue( this, opt.queue );\r\n            }\r\n        };\r\n    \r\n        return opt;\r\n    };\r\n    \r\n    jQuery.easing = {\r\n        linear: function( p ) {\r\n            return p;\r\n        },\r\n        swing: function( p ) {\r\n            return 0.5 - Math.cos( p*Math.PI ) / 2;\r\n        }\r\n    };\r\n    \r\n    jQuery.timers = [];\r\n    jQuery.fx = Tween.prototype.init;\r\n    jQuery.fx.tick = function() {\r\n        var timer,\r\n            timers = jQuery.timers,\r\n            i = 0;\r\n    \r\n        fxNow = jQuery.now();\r\n    \r\n        for ( ; i < timers.length; i++ ) {\r\n            timer = timers[ i ];\r\n            // Checks the timer has not already been removed\r\n            if ( !timer() && timers[ i ] === timer ) {\r\n                timers.splice( i--, 1 );\r\n            }\r\n        }\r\n    \r\n        if ( !timers.length ) {\r\n            jQuery.fx.stop();\r\n        }\r\n        fxNow = undefined;\r\n    };\r\n    \r\n    jQuery.fx.timer = function( timer ) {\r\n        if ( timer() && jQuery.timers.push( timer ) ) {\r\n            jQuery.fx.start();\r\n        }\r\n    };\r\n    \r\n    jQuery.fx.interval = 13;\r\n    \r\n    jQuery.fx.start = function() {\r\n        if ( !timerId ) {\r\n            timerId = setInterval( jQuery.fx.tick, jQuery.fx.interval );\r\n        }\r\n    };\r\n    \r\n    jQuery.fx.stop = function() {\r\n        clearInterval( timerId );\r\n        timerId = null;\r\n    };\r\n    \r\n    jQuery.fx.speeds = {\r\n        slow: 600,\r\n        fast: 200,\r\n        // Default speed\r\n        _default: 400\r\n    };\r\n    \r\n    // Back Compat <1.8 extension point\r\n    jQuery.fx.step = {};\r\n    \r\n    if ( jQuery.expr && jQuery.expr.filters ) {\r\n        jQuery.expr.filters.animated = function( elem ) {\r\n            return jQuery.grep(jQuery.timers, function( fn ) {\r\n                return elem === fn.elem;\r\n            }).length;\r\n        };\r\n    }\r\n    jQuery.fn.offset = function( options ) {\r\n        if ( arguments.length ) {\r\n            return options === undefined ?\r\n                this :\r\n                this.each(function( i ) {\r\n                    jQuery.offset.setOffset( this, options, i );\r\n                });\r\n        }\r\n    \r\n        var docElem, win,\r\n            box = { top: 0, left: 0 },\r\n            elem = this[ 0 ],\r\n            doc = elem && elem.ownerDocument;\r\n    \r\n        if ( !doc ) {\r\n            return;\r\n        }\r\n    \r\n        docElem = doc.documentElement;\r\n    \r\n        // Make sure it's not a disconnected DOM node\r\n        if ( !jQuery.contains( docElem, elem ) ) {\r\n            return box;\r\n        }\r\n    \r\n        // If we don't have gBCR, just use 0,0 rather than error\r\n        // BlackBerry 5, iOS 3 (original iPhone)\r\n        if ( typeof elem.getBoundingClientRect !== core_strundefined ) {\r\n            box = elem.getBoundingClientRect();\r\n        }\r\n        win = getWindow( doc );\r\n        return {\r\n            top: box.top  + ( win.pageYOffset || docElem.scrollTop )  - ( docElem.clientTop  || 0 ),\r\n            left: box.left + ( win.pageXOffset || docElem.scrollLeft ) - ( docElem.clientLeft || 0 )\r\n        };\r\n    };\r\n    \r\n    jQuery.offset = {\r\n    \r\n        setOffset: function( elem, options, i ) {\r\n            var position = jQuery.css( elem, \"position\" );\r\n    \r\n            // set position first, in-case top/left are set even on static elem\r\n            if ( position === \"static\" ) {\r\n                elem.style.position = \"relative\";\r\n            }\r\n    \r\n            var curElem = jQuery( elem ),\r\n                curOffset = curElem.offset(),\r\n                curCSSTop = jQuery.css( elem, \"top\" ),\r\n                curCSSLeft = jQuery.css( elem, \"left\" ),\r\n                calculatePosition = ( position === \"absolute\" || position === \"fixed\" ) && jQuery.inArray(\"auto\", [curCSSTop, curCSSLeft]) > -1,\r\n                props = {}, curPosition = {}, curTop, curLeft;\r\n    \r\n            // need to be able to calculate position if either top or left is auto and position is either absolute or fixed\r\n            if ( calculatePosition ) {\r\n                curPosition = curElem.position();\r\n                curTop = curPosition.top;\r\n                curLeft = curPosition.left;\r\n            } else {\r\n                curTop = parseFloat( curCSSTop ) || 0;\r\n                curLeft = parseFloat( curCSSLeft ) || 0;\r\n            }\r\n    \r\n            if ( jQuery.isFunction( options ) ) {\r\n                options = options.call( elem, i, curOffset );\r\n            }\r\n    \r\n            if ( options.top != null ) {\r\n                props.top = ( options.top - curOffset.top ) + curTop;\r\n            }\r\n            if ( options.left != null ) {\r\n                props.left = ( options.left - curOffset.left ) + curLeft;\r\n            }\r\n    \r\n            if ( \"using\" in options ) {\r\n                options.using.call( elem, props );\r\n            } else {\r\n                curElem.css( props );\r\n            }\r\n        }\r\n    };\r\n    \r\n    \r\n    jQuery.fn.extend({\r\n    \r\n        position: function() {\r\n            if ( !this[ 0 ] ) {\r\n                return;\r\n            }\r\n    \r\n            var offsetParent, offset,\r\n                parentOffset = { top: 0, left: 0 },\r\n                elem = this[ 0 ];\r\n    \r\n            // fixed elements are offset from window (parentOffset = {top:0, left: 0}, because it is it's only offset parent\r\n            if ( jQuery.css( elem, \"position\" ) === \"fixed\" ) {\r\n                // we assume that getBoundingClientRect is available when computed position is fixed\r\n                offset = elem.getBoundingClientRect();\r\n            } else {\r\n                // Get *real* offsetParent\r\n                offsetParent = this.offsetParent();\r\n    \r\n                // Get correct offsets\r\n                offset = this.offset();\r\n                if ( !jQuery.nodeName( offsetParent[ 0 ], \"html\" ) ) {\r\n                    parentOffset = offsetParent.offset();\r\n                }\r\n    \r\n                // Add offsetParent borders\r\n                parentOffset.top  += jQuery.css( offsetParent[ 0 ], \"borderTopWidth\", true );\r\n                parentOffset.left += jQuery.css( offsetParent[ 0 ], \"borderLeftWidth\", true );\r\n            }\r\n    \r\n            // Subtract parent offsets and element margins\r\n            // note: when an element has margin: auto the offsetLeft and marginLeft\r\n            // are the same in Safari causing offset.left to incorrectly be 0\r\n            return {\r\n                top:  offset.top  - parentOffset.top - jQuery.css( elem, \"marginTop\", true ),\r\n                left: offset.left - parentOffset.left - jQuery.css( elem, \"marginLeft\", true)\r\n            };\r\n        },\r\n    \r\n        offsetParent: function() {\r\n            return this.map(function() {\r\n                var offsetParent = this.offsetParent || document.documentElement;\r\n                while ( offsetParent && ( !jQuery.nodeName( offsetParent, \"html\" ) && jQuery.css( offsetParent, \"position\") === \"static\" ) ) {\r\n                    offsetParent = offsetParent.offsetParent;\r\n                }\r\n                return offsetParent || document.documentElement;\r\n            });\r\n        }\r\n    });\r\n    \r\n    \r\n    // Create scrollLeft and scrollTop methods\r\n    jQuery.each( {scrollLeft: \"pageXOffset\", scrollTop: \"pageYOffset\"}, function( method, prop ) {\r\n        var top = /Y/.test( prop );\r\n    \r\n        jQuery.fn[ method ] = function( val ) {\r\n            return jQuery.access( this, function( elem, method, val ) {\r\n                var win = getWindow( elem );\r\n    \r\n                if ( val === undefined ) {\r\n                    return win ? (prop in win) ? win[ prop ] :\r\n                        win.document.documentElement[ method ] :\r\n                        elem[ method ];\r\n                }\r\n    \r\n                if ( win ) {\r\n                    win.scrollTo(\r\n                        !top ? val : jQuery( win ).scrollLeft(),\r\n                        top ? val : jQuery( win ).scrollTop()\r\n                    );\r\n    \r\n                } else {\r\n                    elem[ method ] = val;\r\n                }\r\n            }, method, val, arguments.length, null );\r\n        };\r\n    });\r\n    \r\n    function getWindow( elem ) {\r\n        return jQuery.isWindow( elem ) ?\r\n            elem :\r\n            elem.nodeType === 9 ?\r\n                elem.defaultView || elem.parentWindow :\r\n                false;\r\n    }\r\n    // Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods\r\n    jQuery.each( { Height: \"height\", Width: \"width\" }, function( name, type ) {\r\n        jQuery.each( { padding: \"inner\" + name, content: type, \"\": \"outer\" + name }, function( defaultExtra, funcName ) {\r\n            // margin is only for outerHeight, outerWidth\r\n            jQuery.fn[ funcName ] = function( margin, value ) {\r\n                var chainable = arguments.length && ( defaultExtra || typeof margin !== \"boolean\" ),\r\n                    extra = defaultExtra || ( margin === true || value === true ? \"margin\" : \"border\" );\r\n    \r\n                return jQuery.access( this, function( elem, type, value ) {\r\n                    var doc;\r\n    \r\n                    if ( jQuery.isWindow( elem ) ) {\r\n                        // As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there\r\n                        // isn't a whole lot we can do. See pull request at this URL for discussion:\r\n                        // https://github.com/jquery/jquery/pull/764\r\n                        return elem.document.documentElement[ \"client\" + name ];\r\n                    }\r\n    \r\n                    // Get document width or height\r\n                    if ( elem.nodeType === 9 ) {\r\n                        doc = elem.documentElement;\r\n    \r\n                        // Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height], whichever is greatest\r\n                        // unfortunately, this causes bug #3838 in IE6/8 only, but there is currently no good, small way to fix it.\r\n                        return Math.max(\r\n                            elem.body[ \"scroll\" + name ], doc[ \"scroll\" + name ],\r\n                            elem.body[ \"offset\" + name ], doc[ \"offset\" + name ],\r\n                            doc[ \"client\" + name ]\r\n                        );\r\n                    }\r\n    \r\n                    return value === undefined ?\r\n                        // Get width or height on the element, requesting but not forcing parseFloat\r\n                        jQuery.css( elem, type, extra ) :\r\n    \r\n                        // Set width or height on the element\r\n                        jQuery.style( elem, type, value, extra );\r\n                }, type, chainable ? margin : undefined, chainable, null );\r\n            };\r\n        });\r\n    });\r\n    // Limit scope pollution from any deprecated API\r\n    // (function() {\r\n    \r\n    // })();\r\n    // Expose jQuery to the global object\r\n    window.jQuery = window.$ = jQuery;\r\n    \r\n    // Expose jQuery as an AMD module, but only for AMD loaders that\r\n    // understand the issues with loading multiple versions of jQuery\r\n    // in a page that all might call define(). The loader will indicate\r\n    // they have special allowances for multiple jQuery versions by\r\n    // specifying define.amd.jQuery = true. Register as a named module,\r\n    // since jQuery can be concatenated with other files that may use define,\r\n    // but not use a proper concatenation script that understands anonymous\r\n    // AMD modules. A named AMD is safest and most robust way to register.\r\n    // Lowercase jquery is used because AMD module names are derived from\r\n    // file names, and jQuery is normally delivered in a lowercase file name.\r\n    // Do this after creating the global so that if an AMD module wants to call\r\n    // noConflict to hide this version of jQuery, it will work.\r\n    if ( typeof define === \"function\" && define.amd && define.amd.jQuery ) {\r\n        define( \"jquery\", [], function () { return jQuery; } );\r\n    }\r\n    \r\n    })( window );"]}]}